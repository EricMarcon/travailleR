<!DOCTYPE html>
<html lang="fr-FR">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 Rédiger | Travailler avec R</title>
<meta name="author" content="Eric Marcon">
<meta name="description" content="R et RStudio permettent de rédiger efficacement des documents de tous formats, du simple bloc-note à la thèse, en passant par des diaporamas. Les outils pour le faire sont l’objet de ce chapitre,...">
<meta name="generator" content="bookdown 0.41 with bs4_book()">
<meta property="og:title" content="4 Rédiger | Travailler avec R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ericmarcon.github.io/travailleR/chap-rediger.html">
<meta property="og:description" content="R et RStudio permettent de rédiger efficacement des documents de tous formats, du simple bloc-note à la thèse, en passant par des diaporamas. Les outils pour le faire sont l’objet de ce chapitre,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 Rédiger | Travailler avec R">
<meta name="twitter:description" content="R et RStudio permettent de rédiger efficacement des documents de tous formats, du simple bloc-note à la thèse, en passant par des diaporamas. Les outils pour le faire sont l’objet de ce chapitre,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7NVD1TWMCJ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7NVD1TWMCJ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Travailler avec R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Présentation</a></li>
<li><a class="" href="chap-logiciels.html"><span class="header-section-number">1</span> Logiciels</a></li>
<li><a class="" href="chap-utiliseR.html"><span class="header-section-number">2</span> Utiliser R</a></li>
<li><a class="" href="chap-git.html"><span class="header-section-number">3</span> Git et GitHub</a></li>
<li><a class="active" href="chap-rediger.html"><span class="header-section-number">4</span> Rédiger</a></li>
<li><a class="" href="chap-package.html"><span class="header-section-number">5</span> Package</a></li>
<li><a class="" href="chap-ci.html"><span class="header-section-number">6</span> Intégration continue</a></li>
<li><a class="" href="chap-shiny.html"><span class="header-section-number">7</span> Shiny</a></li>
<li><a class="" href="chap-enseigner.html"><span class="header-section-number">8</span> Enseigner avec R</a></li>
<li><a class="" href="chap-conclusion.html"><span class="header-section-number">9</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/EricMarcon/travailleR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-rediger" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Rédiger<a class="anchor" aria-label="anchor" href="#chap-rediger"><i class="fas fa-link"></i></a>
</h1>
<p>R et RStudio permettent de rédiger efficacement des documents de tous formats, du simple bloc-note à la thèse, en passant par des diaporamas.
Les outils pour le faire sont l’objet de ce chapitre, complété par la production de sites web (y compris un site personnel).</p>
<p>Deux procédés de production de documents sont disponibles :</p>
<ul>
<li>
<em>R Markdown</em> avec les packages <strong>knitR</strong> et <strong>bookdown</strong>.
C’est ma méthode classique, présentée ici en détail.</li>
<li>
<em>Quarto</em>, conçu pour être utilisé avec d’autres langages que R et dans d’autres environnements de travail que RStudio.
Quarto est en développement actif mais ne permet pas encore de produire des documents avec la même qualité que <em>R Markdown</em> : par exemple, la ponctuation des documents en français n’est pas gérée correctement en PDF<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/jgm/pandoc/issues/8283/" class="uri"&gt;https://github.com/jgm/pandoc/issues/8283/&lt;/a&gt;&lt;/p&gt;'><sup>48</sup></a>, les tableaux ne peuvent pas inclure d’équations<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/quarto-dev/quarto-cli/issues/555" class="uri"&gt;https://github.com/quarto-dev/quarto-cli/issues/555&lt;/a&gt;&lt;/p&gt;'><sup>49</sup></a> et la largeur des figures est incohérente dans les documents PDF formatés avec plusieurs colonnes<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/quarto-dev/quarto-cli/issues/855" class="uri"&gt;https://github.com/quarto-dev/quarto-cli/issues/855&lt;/a&gt;&lt;/p&gt;'><sup>50</sup></a>.
L’usage de Quarto est bien documenté sur son site<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://quarto.org/" class="uri"&gt;https://quarto.org/&lt;/a&gt;&lt;/p&gt;'><sup>51</sup></a> et n’est pas présenté ici.</li>
</ul>
<div id="bloc-note-markdown-r-notebook" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Bloc-note Markdown (R Notebook)<a class="anchor" aria-label="anchor" href="#bloc-note-markdown-r-notebook"><i class="fas fa-link"></i></a>
</h2>
<p>Dans un fichier <code>.R</code>, le code doit toujours être commenté pour faciliter sa lecture.
Quand l’explication du code nécessite plusieurs lignes de commentaire par ligne ou bloc de code, il est temps d’inverser la logique et de placer le code dans un texte.</p>
<p>Le concept de programmation lettrée (<em>literate programming</em>) a été développé par <span class="citation">Knuth (<a href="references.html#ref-Knuth1984">1984</a>)</span>.
Il s’agit de décrire les objectifs et les méthodes par du texte, dans lequel le code s’intègre.</p>
<p>L’outil le plus simple est le bloc-note Markdown (Menu “File &gt; New File &gt; R Notebook”).
Le modèle de document contient son mode d’emploi.</p>
<p>Le langage qui permet de formater le texte est Markdown<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://fr.wikipedia.org/wiki/Markdown" class="uri"&gt;https://fr.wikipedia.org/wiki/Markdown&lt;/a&gt;&lt;/p&gt;'><sup>52</sup></a>, un langage de balisage simple à utiliser :</p>
<ul>
<li>Les paragraphes sont séparés par des sauts de <span style="white-space:nowrap">ligne ;</span>
</li>
<li>Le document est structuré par des titres : leur ligne commence par un nombre de <code>#</code> correspondant à leur <span style="white-space:nowrap">niveau ;</span>
</li>
<li>Les formats de caractères sont limités à l’essentiel : italique ou gras (texte entouré par une ou deux <code>*</code><span style="white-space:nowrap">) ;</span>
</li>
<li>D’autres codes simples permettent tous les formatages utiles.</li>
</ul>
<p>Ce langage est le pivot du logiciel pandoc<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://fr.wikipedia.org/wiki/Pandoc" class="uri"&gt;https://fr.wikipedia.org/wiki/Pandoc&lt;/a&gt;&lt;/p&gt;'><sup>53</sup></a>, dédié à la conversion de documents de formats différents.</p>
<p>Le package <strong>rmarkdown</strong> <span class="citation">(<a href="references.html#ref-Xie2015">Xie 2015</a>)</span> fait le lien entre R et Markdown, en s’appuyant sur l’interface de RStudio qui n’est pas indispensable mais simplifie énormément son utilisation.
Le dialecte de Markdown utilisé par le package est appelé <em>R Markdown</em>.
Sa syntaxe est résumée dans une antisèche<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf" class="uri"&gt;https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf&lt;/a&gt;&lt;/p&gt;'><sup>54</sup></a>.
Sa documentation complète est en ligne <span class="citation">(<a href="references.html#ref-Xie2018">Xie, Allaire, et Grolemund 2018</a>)</span>.</p>
<p>Les équations sont écrites au format LaTeX<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://fr.wikibooks.org/wiki/LaTeX/%C3%89crire_des_math%C3%A9matiques" class="uri"&gt;https://fr.wikibooks.org/wiki/LaTeX/%C3%89crire_des_math%C3%A9matiques&lt;/a&gt;&lt;/p&gt;'><sup>55</sup></a>.</p>
<p>L’organisation la plus simple d’un document <em>R Markdown</em> est visible dans le modèle de bloc-note.
Il commence par un en-tête au format YAML<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://fr.wikipedia.org/wiki/YAML" class="uri"&gt;https://fr.wikipedia.org/wiki/YAML&lt;/a&gt;&lt;/p&gt;'><sup>56</sup></a>:</p>
<pre><code>---
title: "R Notebook"
output: html_notebook
---</code></pre>
<p>La première entrée est le titre, la seconde le format de sortie : plus précisément le nom de la fonction chargée de traiter le document.</p>
<p>Le document contient du texte formaté en Markdown et des bouts de code (<em>code chunks</em>) entourés par trois accents graves (la syntaxe markdown d’un bloc de code) et une description du langage, ici <code>r</code>.
Ces bouts de code sont traités par <strong>knitr</strong> qui transforme le résultat de l’exécution du code R en Markdown et l’intègre au texte du document.</p>
<p>Traiter un document R Markdown s’appelle le <em>tricoter</em> (<em>knit</em>).
La chaîne de production est la suivante :</p>
<ul>
<li>
<strong>knitr</strong> traite les bouts de code : calculs, production de <span style="white-space:nowrap">figures ;</span>
</li>
<li>
<strong>rmarkdown</strong> intègre la production des bouts de code et texte pour produire un fichier Markdown <span style="white-space:nowrap">standard ;</span>
</li>
<li>pandoc (installé avec RStudio) convertit ce fichier au format HTML, LaTeX ou <span style="white-space:nowrap">Word ;</span>
</li>
<li>LaTeX produit un fichier PDF quand ce format est demandé.</li>
</ul>
<p>RStudio permet de lancer le tricot par des boutons plutôt que par des commandes : dans la fenêtre source (celle du haut à gauche), un bouton “Knit” accompagne les documents R Markdown.
Pour les bloc-notes R Markdown, il est remplacé par un bouton “Preview” avec les mêmes fonctions.
Il peut être déroulé pour choisir le format de sortie : HTML, Word, PDF (en passant par LaTeX) et, pour les bloc-notes, une commande “Preview” qui affiche le document en HTML sans exécuter les bouts de code pour gagner du temps.
Dès le premier tricot au format Word ou HTML, on remarquera que le bouton “Preview” disparaît.</p>
<p>Au final, l’utilisation de R Markdown combine plusieurs avantages :</p>
<ul>
<li>La simplicité de la rédaction : le texte brut est plus facile à lire et à formater qu’en LaTeX par <span style="white-space:nowrap">exemple ;</span>
</li>
<li>L’automatisation de la production : le formatage et la mise en page sont entièrement <span style="white-space:nowrap">automatiques ;</span>
</li>
<li>La reproductibilité : chaque document peut être autosuffisant accompagné de ses données. Relancer le tricotage régénère entièrement le document, y compris les calculs nécessaires et la production des figures.</li>
</ul>
<p>Elle a aussi quelques inconvénients :</p>
<ul>
<li>Le formatage dépend de modèles, et developper de nouveaux modèles n’est pas <span style="white-space:nowrap">simple ;</span>
</li>
<li>Les erreurs de tricot sont parfois difficiles à corriger, notamment quand elles interviennent à l’étape de la compilation <span style="white-space:nowrap">LaTeX ;</span>
</li>
<li>La reproductibilité consomme du temps de calcul. Pour limiter ce problème, un système de cache permet de ne pas réévaluer tous les bouts de code R à chaque modification du texte. La production de gros documents peut aussi être déléguée à un système d’intégration continue (chapitre <a href="chap-ci.html#chap-ci">6</a>).</li>
</ul>
</div>
<div id="modèles-r-markdown" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Modèles R Markdown<a class="anchor" aria-label="anchor" href="#mod%C3%A8les-r-markdown"><i class="fas fa-link"></i></a>
</h2>
<p>Des modèles de document plus élaborés que le bloc-note sont fournis par des packages, dont <strong>rmarkdown</strong>.
Ils sont accessibles par le menu “File &gt; New File &gt; R Markdown…” (figure <a href="chap-rediger.html#fig:e-rmd1">4.1</a>)).</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:e-rmd1"></span>
<img src="images/e-rmd1.png" alt="Nouveau document Markdown à partir d’un modèle." width="80%"><p class="caption">
Figure 4.1: Nouveau document Markdown à partir d’un modèle.
</p>
</div>
<p></p>
<p>Les modèles les plus simples sont <em>Document</em> et <em>Presentation</em>.
Les informations à fournir sont le titre et le nom de l’auteur, et le format du document attendu (qui pourra être modifié plus tard).
Ces modèles créent un seul fichier dont l’enregistrement ne sera obligatoire qu’au moment de tricoter.</p>
<p>La syntaxe est la même que celle du bloc-note.
Dans l’entête, une entrée supplémentaire est utilisée pour la date, qui peut être calculée par R à chaque tricot :</p>
<pre><code>date: "|r format(Sys.Date(), '%d/%m/%Y')|"</code></pre>
<p>Remplacer les barres verticales <code>|</code> de l’exemple ci-dessus par des guillemets inversés : ce document étant écrit avec R Markdown, la date serait calculée et affichée à la place du code si les guillemets inversés étaient utilisés directement.</p>
<p>Le code R en ligne (par opposition aux bouts de code) peut être utilisé partout dans un document R Markdown, y compris dans l’entête pour l’affichage de la date.
Il commence par un guillemet inversé suivi de <code>r</code> et se termine par un autre guillemet inversé.</p>
<p>Les documents peuvent être tricotés au format HTML, PDF (via LaTeX) ou Word.
L’entête du fichier R Markdown est réécrit quand le tricot est lancé par le bouton de RStudio qui place en premier le format de sortie utilisé et l’ajoute si nécessaire.</p>
<p>Les présentations peuvent être tricotées dans deux formats HTML, ioslide<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/ioslides-presentation.html" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/ioslides-presentation.html&lt;/a&gt;&lt;/p&gt;'><sup>57</sup></a> ou Slidy<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/slidy-presentation.html" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/slidy-presentation.html&lt;/a&gt;&lt;/p&gt;'><sup>58</sup></a>, au format Beamer (PDF)<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/beamer-presentation.html" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/beamer-presentation.html&lt;/a&gt;&lt;/p&gt;'><sup>59</sup></a> ou en Powerpoint<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/powerpoint-presentation.html" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/powerpoint-presentation.html&lt;/a&gt;&lt;/p&gt;'><sup>60</sup></a>.</p>
<p>Le niveau 2 de plan (<code>##</code>) marque le changement de diapositive.</p>
<p>Du code supplémentaire, présenté dans les documentations des formats HTML, permet d’utiliser des fonctionnalités spécifiques.</p>
<p>Ces modèles sont simples mais assez peu utiles : le bloc-note R est plus facile à utiliser que le modèle de document pour des documents minimalistes.
Des modèles plus élaborés sont disponibles.</p>
</div>
<div id="articles-avec-bookdown" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Articles avec bookdown<a class="anchor" aria-label="anchor" href="#articles-avec-bookdown"><i class="fas fa-link"></i></a>
</h2>
<p>R Markdown ne permet pas de rédiger un article scientifique.
La bibliographie ne pose pas de problème parce qu’elle est gérée par pandoc pour les documents HTML ou Word et sous-traitée à LaTeX pour les documents PDF.
Les équations, figures et tableaux sont numérotés par LaTeX mais pas en HTML.
Les références croisées (les renvois à un numéro de figure par exemple) ne sont pas supportés.
Enfin, les légendes de figures ou tableaux ne supportent que du texte brut, sans aucun formatage.</p>
<p><strong>bookdown</strong> comble ces manques.
Le package a été conçu pour la rédaction d’ouvrages comportant plusieurs chapitres mais peut être utilisé pour des articles.</p>
<p>Le package <strong>memoiR</strong> fournit les modèles présentés ici.
Il doit être installé.</p>
<div id="ecrire" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Ecrire<a class="anchor" aria-label="anchor" href="#ecrire"><i class="fas fa-link"></i></a>
</h3>
<p>Les principales caractéristiques de Markdown sont résumées ici.
Une formation rapide et plus complète est proposée par RStudio<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://rmarkdown.rstudio.com/lesson-1.html" class="uri"&gt;https://rmarkdown.rstudio.com/lesson-1.html&lt;/a&gt;&lt;/p&gt;'><sup>61</sup></a>.</p>
<p>Le texte est écrit sans aucun autre formatage que les les retours à la ligne.
Un simple retour à la ligne n’a aucun effet sur le document produit : il permet de séparer les phrases pour simplifier le suivi du code source par git.</p>
<p>Un saut de ligne marque un changement de paragraphe.</p>
<p>Les différents niveaux de plan sont désignés par le nombre de croisillons correspondant en début de ligne : <code>#</code> pour un titre de niveau 1, <code>##</code> pour un titre de niveau 2, etc.
Un espace sépare les croisillons et le texte du titre.</p>
<p>Les liste à puces sont marquées par un tiret (suivi d’un espace) en début de ligne.
Un saut de ligne est nécessaire avant le début de la liste mais les éléments de la liste sont séparés par un simple retour à la ligne.
Les listes indentées sont créées en insérant 4 espaces avant le tiret de début de ligne.
Enfin, les listes numérotées sont créées de la même façon en remplaçant les tirets par des nombres, dont la valeur n’a pas d’importance.</p>
<p>Dans le texte, les parties en italique sont entourées par une étoile ou un tiret bas (<code>*italique*</code>), alors que deux étoiles marquent le gras.</p>
<div id="code-r" class="section level4" number="4.3.1.1">
<h4>
<span class="header-section-number">4.3.1.1</span> Code R<a class="anchor" aria-label="anchor" href="#code-r"><i class="fas fa-link"></i></a>
</h4>
<p>Le code R est inclus dans des bouts de code (<em>code chunks</em>) créés facilement en cliquant sur le bouton “Insert a new code chunk” au-dessus de la fenêtre du code source dans RStudio.
Ils commencent et se terminent par trois guillemets inversés sur une nouvelle ligne.
Ces bouts de code peuvent contenir du code R mais aussi Python par exemple : le type de code est indiqué dans l’entête sur la première ligne, avant le nom du bout de code, puis une liste d’options séparées par des virgules, par exemple :</p>
<pre><code>```{r cars, echo=TRUE}
```</code></pre>
<p>Le nom et les options sont facultatifs : l’entête minimal est <code>{r}</code>.</p>
<p>Les options les plus utiles sont :</p>
<ul>
<li>
<code>echo</code> pour afficher (<code>=TRUE</code>) ou cacher (<code>=FALSE</code>) le <span style="white-space:nowrap">code ;</span>
</li>
<li>
<code>message=FALSE</code> pour cacher les messages d’ouverture de certains <span style="white-space:nowrap">packages ;</span>
</li>
<li>
<code>warning=FALSE</code> pour cacher les avertissements.</li>
</ul>
<p>Les options par défaut sont déclarées dans le bout de code nommé “Options” au début du document Markdown, dans la fonction <code>opts_chunk$set()</code>.</p>
<p>L’option <code>include=FALSE</code> supprime tout affichage lié au bout de code.
Dans un document tel qu’un article scientifique, qui n’affiche pas son code, elle doit être utilisée pour tous les bouts de code sauf ceux qui produisent les figures.</p>
</div>
<div id="figures" class="section level4" number="4.3.1.2">
<h4>
<span class="header-section-number">4.3.1.2</span> Figures<a class="anchor" aria-label="anchor" href="#figures"><i class="fas fa-link"></i></a>
</h4>
<p></p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">pressure</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pressure"></span>
<img src="travailleR_files/figure-html/pressure-1.png" alt="Titre de la figure" width="80%"><p class="caption">
Figure 4.2: Titre de la figure
</p>
</div>
<p></p>
<p>Les figures peuvent être créées par le code R (figure <a href="chap-rediger.html#fig:pressure">4.2</a>).
Avec Bookdown, une étiquette est associée à chaque figure : son nom est <code>fig:xxx</code> où <code>xxx</code> est le nom du bout de code R.
Les renvois se font avec la commande <code>\@ref(fig:xxx)</code>.</p>
<p>L’entête du bout de code de la figure <a href="chap-rediger.html#fig:pressure">4.2</a> est :</p>
<pre><code>```{r pressure, fig.cap="Titre de la figure"}
```</code></pre>
<p>Il contient au minimum le nom de la figure et sa légende.
Si la légende est longue, l’entête est peu lisible.
De plus, la légende est limitée à du texte simple.
Pour des légendes plus élaborées, il est possible de déclarer la légende dans un paragraphe séparé qui commence par le texte <code>(ref:NomFigure)</code>.
La figure <a href="chap-rediger.html#fig:pressure2">4.3</a> bénéficie d’une légende améliorée.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pressure2"></span>
<img src="travailleR_files/figure-html/pressure2-1.png" alt="Titre avec italique, maths (\(\sqrt\pi\)) et renvoi vers la figure 4.2" width="80%"><p class="caption">
Figure 4.3: Titre avec <em>italique</em>, maths (<span class="math inline">\(\sqrt\pi\)</span>) et renvoi vers la figure <a href="chap-rediger.html#fig:pressure">4.2</a>
</p>
</div>
<p></p>
<p>Le texte de <code>fig.cap</code>, “Titre de la figure” précédemment, est remplacé par <code>(ref:pressure)</code> <em>à l’intérieur des guillemets</em> qui sont conservés et la légende est saisie dans un paragraphe commençant par <code>(ref:pressure)</code> suivi d’un espace.
Les légendes sont limitées à un paragraphe unique.</p>
<p>Si une table des figures est utilisée (option <code>lof: true</code> dans l’entête), une légende courte est nécessaire en plus de la légende complète.
Elle est déclarée dans <code>fig.scap</code>.</p>
<p>Les figures qui ne sont pas créées par R mais proviennent de fichiers sont intégrées dans un bout de code par la fonction <code>include_graphics()</code> dont l’argument est le fichier contenant l’image à afficher.
Placer systématiquement ces fichiers dans le dossier <code>images</code> pour une bonne organisation.</p>
</div>
<div id="tableaux" class="section level4" number="4.3.1.3">
<h4>
<span class="header-section-number">4.3.1.3</span> Tableaux<a class="anchor" aria-label="anchor" href="#tableaux"><i class="fas fa-link"></i></a>
</h4>
<p>Les séparateurs horizontaux - et verticaux | permettent de dessiner un tableau selon la syntaxe de Markdown, mais ce n’est pas la meilleure méthode.</p>
<p>Les tableaux peuvent aussi être produits par du code R.
Le contenu du tableau est dans un dataframe.
La fonction <code>kbl</code> du package <em>kableExtra</em> prépare le tableau pour l’affichage et passe le résultat à la fonction <code>kable_styling</code> pour le formatage final.</p>
<p></p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span>
<span><span class="va">mes_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mes_iris</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longueur sépales ($l_s$)"</span>, <span class="st">"Largeur"</span>,</span>
<span>    <span class="st">"Longueur pétales"</span>, <span class="st">"Largeur"</span>, <span class="st">"Espèce"</span><span class="op">)</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html">kbl</a></span><span class="op">(</span><span class="va">mes_iris</span>, caption <span class="op">=</span> <span class="st">"Tableau créé par kable"</span>,</span>
<span>    booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>,</span>
<span>        full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:kable">Table 4.1: </span>Tableau créé par kable
</caption>
<thead><tr>
<th style="text-align:right;">
Longueur sépales (<span class="math inline">\(l_s\)</span>)
</th>
<th style="text-align:right;">
Largeur
</th>
<th style="text-align:right;">
Longueur pétales
</th>
<th style="text-align:right;">
Largeur
</th>
<th style="text-align:left;">
Espèce
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
3.5
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
3.6
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.4
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
</tbody>
</table></div>
<p></p>
<p>La légende est précisée par l’argument <code>caption</code> et le référencement est possible parce que le tableau reçoit une étiquette dont le nom est <code>tab:</code> suivi du nom du bout de code (tableau <a href="chap-rediger.html#tab:kable">4.1</a>).
Comme pour les figures, une légende améliorée peut être écrite dans un paragraphe séparé.
Une légende courte pour une éventuelle liste des tableaux (option <code>lot: true</code> dans l’entête) est déclarée dans l’argument <code>caption.short</code> de <code>kbl()</code>.</p>
<p>Utiliser systématiquement l’argument <code>booktabs = TRUE</code> pour que l’épaisseur des lignes de séparation soit optimale en LaTeX.
Comme le tableau contient des mathématiques (dans le nom de la première colonne), l’option <code>escape = FALSE</code> est nécessaire.</p>
<p>L’option de style <code>bootstrap_options = "striped"</code> fournit des tableaux plus lisibles en HTML.
Enfin, l’option <code>full_width = FALSE</code> permet d’ajuster la largeur du tableau à son contenu au lieu d’occuper toute la largeur disponible.</p>
<p>Le package <strong>flextable</strong> permet de réaliser des tableaux plus élaborés, comme dans l’exemple suivant qui affiche en couleur les longs sépales.</p>
<p></p>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ardata-fr.github.io/flextable-book/">"flextable"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Attaching package: 'flextable'</code></pre>
<pre><code>## The following objects are masked from 'package:spatstat.geom':
## 
##     border, rotate</code></pre>
<pre><code>## The following object is masked from 'package:purrr':
## 
##     compose</code></pre>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rappel du jeu de données initial iris</span></span>
<span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Premières lignes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Création d'un objet flextable</span></span>
<span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Titre des colonnes</span></span>
<span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span>Sepal.Length <span class="op">=</span> <span class="st">"Longueur sépales"</span>, Sepal.Width <span class="op">=</span> <span class="st">"Largeur"</span>,</span>
<span>    Petal.Length <span class="op">=</span> <span class="st">"Longueur pétales"</span>, Petal.Width <span class="op">=</span> <span class="st">"Largeur"</span>,</span>
<span>    Species <span class="op">=</span> <span class="st">"Espèce"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Sélection des longs sépales (&gt;5) et affichage en</span></span>
<span>    <span class="co"># rouge</span></span>
<span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span><span class="op">~</span><span class="va">Sepal.Length</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">~</span><span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="tabwid">
<style>.cl-7ada576a{}.cl-7ad6ffac{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7ad6ffd4{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(255, 0, 0, 1.00);background-color:transparent;}.cl-7ad862ac{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7ad862b6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7ad87094{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ad87095{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ad870b2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ad870c6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ad870d0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ad870d1{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<div class="inline-table"><table data-quarto-disable-processing="true" class="cl-7ada576a">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-7ad87094"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">Longueur sépales</span></p></th>
<th class="cl-7ad87094"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">Largeur</span></p></th>
<th class="cl-7ad87094"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">Longueur pétales</span></p></th>
<th class="cl-7ad87094"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">Largeur</span></p></th>
<th class="cl-7ad87095"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">Espèce</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffd4">5.1</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">3.5</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">1.4</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">0.2</span></p></td>
<td class="cl-7ad870c6"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">setosa</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">4.9</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">3.0</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">1.4</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">0.2</span></p></td>
<td class="cl-7ad870c6"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">setosa</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">4.7</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">3.2</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">1.3</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">0.2</span></p></td>
<td class="cl-7ad870c6"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">setosa</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">4.6</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">3.1</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">1.5</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">0.2</span></p></td>
<td class="cl-7ad870c6"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">setosa</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">5.0</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">3.6</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">1.4</span></p></td>
<td class="cl-7ad870b2"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">0.2</span></p></td>
<td class="cl-7ad870c6"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">setosa</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-7ad870d0"><p class="cl-7ad862ac"><span class="cl-7ad6ffd4">5.4</span></p></td>
<td class="cl-7ad870d0"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">3.9</span></p></td>
<td class="cl-7ad870d0"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">1.7</span></p></td>
<td class="cl-7ad870d0"><p class="cl-7ad862ac"><span class="cl-7ad6ffac">0.4</span></p></td>
<td class="cl-7ad870d1"><p class="cl-7ad862b6"><span class="cl-7ad6ffac">setosa</span></p></td>
</tr>
</tbody>
</table></div>
</div>
<p></p>
<p>La documentation du package<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://ardata-fr.github.io/flextable-book/" class="uri"&gt;https://ardata-fr.github.io/flextable-book/&lt;/a&gt;&lt;/p&gt;'><sup>62</sup></a> est disponible en ligne, ainsi qu’une galerie<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://ardata-fr.github.io/flextable-gallery/gallery/" class="uri"&gt;https://ardata-fr.github.io/flextable-gallery/gallery/&lt;/a&gt;&lt;/p&gt;'><sup>63</sup></a>.</p>
<p><strong>flextable</strong> ne supporte pas la numérotation des légendes hormis dans les documents Word.
Cette limite est rédhibitoire.</p>
</div>
<div id="maths" class="section level4" number="4.3.1.4">
<h4>
<span class="header-section-number">4.3.1.4</span> Maths<a class="anchor" aria-label="anchor" href="#maths"><i class="fas fa-link"></i></a>
</h4>
<p>Les équations au format LaTeX peuvent être insérées en ligne, comme <span class="math inline">\(A=\pi r^2\)</span> (code : <code>$A=\pi r^2$</code>) ou isolées (les $ sont doublés) comme <span class="math display">\[e^{i \pi} = -1.\]</span></p>
<p>Elles peuvent être numérotées : voir équation <a href="chap-rediger.html#eq:disque">(4.1)</a>, en utilisant l’environnement <code>\equation</code>.</p>
<p><span class="math display" id="eq:disque">\[\begin{equation}
  A = \pi r^2.
  \tag{4.1}
\end{equation}\]</span></p>
<p>L’équation numérotée est créée par le code suivant :</p>
<pre><code>\begin{equation}
  A = \pi r^2.
  (\#eq:disque)
\end{equation}</code></pre>
</div>
<div id="références-croisées" class="section level4" number="4.3.1.5">
<h4>
<span class="header-section-number">4.3.1.5</span> Références croisées<a class="anchor" aria-label="anchor" href="#r%C3%A9f%C3%A9rences-crois%C3%A9es"><i class="fas fa-link"></i></a>
</h4>
<p>Les figures et tableaux ont une étiquette générée automatiquement, identique au nom du bout de code préfixé par <code>fig:</code> et <code>tab:</code>.</p>
<p>Pour les équations, l’étiquette est ajoutée manuellement par le code <code>(\#eq:xxx)</code> avant la fin de l’équation.</p>
<p>Les sections peuvent recevoir une étiquette en terminant leur titre par <code>{#yyy}</code>.
Les sections reçoivent par défaut une étiquette implicite<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://pandoc.org/MANUAL.html#extension-implicit_header_references" class="uri"&gt;https://pandoc.org/MANUAL.html#extension-implicit_header_references&lt;/a&gt;&lt;/p&gt;'><sup>64</sup></a> correspondant à leur texte, en minuscules, où les caractères spéciaux sont remplacés par des tirets.
Les étiquettes implicites sont instables (elles changent avec le titre de la section) et difficiles à prévoir : c’est pourquoi il est conseillé d’ajouter une étiquette explicite à chaque section faisant l’objet d’un renvoi.
C’est le cas des chapitres, pour lesquels le nom du fichier HMTL produit est identique à l’étiquette.
Les étiquettes de chapitres doivent respecter les règles de nomenclature des fichiers en ne contenant pas de caractères spéciaux.</p>
<p>Des signets peuvent aussi être placés librement dans le texte avec la commande <code>(ref:zzz)</code>.</p>
<p>Dans tous les cas, l’appel à la référence est fait par la commande <code>\@ref(ref:zzz)</code>.</p>
</div>
<div id="bibliographie" class="section level4" number="4.3.1.6">
<h4>
<span class="header-section-number">4.3.1.6</span> Bibliographie<a class="anchor" aria-label="anchor" href="#bibliographie"><i class="fas fa-link"></i></a>
</h4>
<p>Les références bibliographiques au format BibTeX doivent être incluses dans le fichier <code>.bib</code> déclaré dans l’entête du document Markdown.</p>
<pre><code>bibliography: references.bib</code></pre>
<p>Ce fichier peut être créé et maintenu à jour par Zotero installé avec l’extension Better BibTeX (voir section <a href="chap-logiciels.html#sec:Zotero">1.6</a>).
Il suffit pour cela de créer une collection Zotero correspondant au projet et d’y glisser les références pertinentes.
Utiliser ensuite le menu contextuel “Exporter la collection…” et sélectionner :</p>
<ul>
<li>Format : “Better BibTeX” pour les articles et présentations ou “Better BibLaTeX” pour les mémoires, selon que la bibliographie est gérée par BibTeX et natbib ou biber et BibLaTeX pour la production de documents PDF.</li>
<li>Cocher la case “Garder à jour” pour que toute modification dans Zotero soit exportée automatiquement.</li>
<li>Cliquer sur “OK” puis choisir le nom du fichier (<code>references.bib</code>) et son emplacement (le dossier du projet R).</li>
</ul>
<p>Les références peuvent être appelées dans le texte, entre parenthèses par le code <code>[@Reference]</code>, ou dans le texte, en supprimant les crochets.</p>
<p>La bibliographie est traitée par pandoc lors de la production de documents Word ou HTML.
Le style bibliographique peut être précisé, en ajoutant la ligne</p>
<pre><code>csl:nom_du_fichier.csl</code></pre>
<p>dans l’entête du document et en copiant le fichier de style <em>.csl</em> dans le dossier du projet.
Plus d’un millier de styles sont disponibles<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/citation-style-language/styles" class="uri"&gt;https://github.com/citation-style-language/styles&lt;/a&gt;&lt;/p&gt;'><sup>65</sup></a>.</p>
<p>Pour les documents PDF, la bibliographie est gérée par LaTeX.</p>
<p>Pour préparer la soumission d’un manuscrit à une revue, il faudra ouvrir le fichier <em>.tex</em> intermédiaire produit par pandoc et copier le contenu de l’environnement {document} dans le modèle proposé par la revue, qui se chargera du formatage.</p>
</div>
<div id="langues" class="section level4" number="4.3.1.7">
<h4>
<span class="header-section-number">4.3.1.7</span> Langues<a class="anchor" aria-label="anchor" href="#langues"><i class="fas fa-link"></i></a>
</h4>
<p>Les langues sont à déclarer dans l’entête des document produits par les modèles de <strong>memoiR</strong>.</p>
<p>La langue principale du document modifie le nom de certains éléments, comme la table des matières.
Les langues supplémentaires permettent la rédaction de documents multilingues.</p>
<p>Les champs de l’entête sont :</p>
<pre><code>lang: fr-FR
otherlangs: [en-US, it]</code></pre>
<p>Le changement de langue dans le document est géré en LaTeX mais pas en HTML en insérant sur une nouvelle ligne la commande suivante :</p>
<pre><code>\selectlanguage{english}</code></pre>
<p>La langue en cours n’a d’effet que dans les sorties LaTeX : un espace est ajouté devant les ponctuations doubles en Français, la taille des espaces est plus grande en début de phrase en Anglais, etc.
La commande <code>\selectlanguage</code> est simplement ignorée en HTML.</p>
<p>Les noms de langues sont différents dans l’entête (codes IETF) et dans le texte (nom de la langue).
La correspondance et la liste complète des langues se trouve dans le tableau 3 de la documentation du package <strong>polyglossia</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="http://mirrors.ctan.org/macros/unicodetex/latex/polyglossia/polyglossia.pdf" class="uri"&gt;http://mirrors.ctan.org/macros/unicodetex/latex/polyglossia/polyglossia.pdf&lt;/a&gt;&lt;/p&gt;'><sup>66</sup></a>.</p>
<p>Le formatage en HTML de la ponctuation des documents en français est possible par l’intermédiaire d’un filtre déclaré à pandoc <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/InseeFrLab/pandoc-filter-fr-nbsp" class="uri"&gt;https://github.com/InseeFrLab/pandoc-filter-fr-nbsp&lt;/a&gt;&lt;/p&gt;'><sup>67</sup></a>.
Le fichier <code>fr-nbsp.lua</code> doit être copié dans le répertoire du projet à partir de son dépôt GitHub et éclaré dans l’entête du document Markdown.</p>
<pre><code>output:
    pandoc_args:
      - --lua-filter=fr-nbsp.lua</code></pre>
<p>Le filtre formate toute la ponctuation du document, quelle que soit sa langue : il ne doit donc être utilisé que pour les documents entièrement en français.</p>
</div>
</div>
<div id="sec:memo" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Modèle Simple Article<a class="anchor" aria-label="anchor" href="#sec:memo"><i class="fas fa-link"></i></a>
</h3>
<p>Le modèle <em>Simple Article</em> de <strong>memoiR</strong> produit un document HTML simple avec une table des matières flottante (voir l’exemple<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/Krigeage/Krigeage.html" class="uri"&gt;https://EricMarcon.github.io/Krigeage/Krigeage.html&lt;/a&gt;&lt;/p&gt;'><sup>68</sup></a>).
D’autres formats HTML sont disponibles : voir la gallerie<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://ericmarcon.github.io/memoiR/" class="uri"&gt;https://ericmarcon.github.io/memoiR/&lt;/a&gt;&lt;/p&gt;'><sup>69</sup></a> du package.
Le format PDF est proche du modèle <em>article</em> de LaTeX (exemple<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/Krigeage/Krigeage.pdf" class="uri"&gt;https://EricMarcon.github.io/Krigeage/Krigeage.pdf&lt;/a&gt;&lt;/p&gt;'><sup>70</sup></a>).</p>
<p>Le modèle contient sa propre documentation.</p>
<div id="créer" class="section level4" number="4.3.2.1">
<h4>
<span class="header-section-number">4.3.2.1</span> Créer<a class="anchor" aria-label="anchor" href="#cr%C3%A9er"><i class="fas fa-link"></i></a>
</h4>
<p>Utiliser le menu “File &gt; New File &gt; R Markdown…” puis sélectionner “From template” (figure <a href="chap-rediger.html#fig:e-rmd1">4.1</a>).
La liste des modèles disponible et le package qui les propose est alors affichée.</p>
<p>Sélectionner le modèle <em>Simple Article</em> du package <strong>memoiR</strong>, choisir le nom du projet (“Name :”, qui sera le nom du dossier dans lequel il sera créé, et son dossier parent (“Location :”).
Dans l’organisation proposée en section <a href="chap-logiciels.html#sec:solution-dossiers">1.2.4</a>, le dossier parent est <code>%LOCALAPPDATA%\ProjetsR</code>.
Le nom du projet ne doit contenir aucun caractère spécial (accent, espace…) pour assurer sa portabilité sur tous les systèmes d’exploitation (Windows, Linux, MacOS).</p>
<p>Les modèles élaborés créent un dossier avec de nombreux fichiers (bibliographie, styles, modèle LaTeX…), contrairement aux modèles simples qui créent seulement un fichier.</p>
<p>Quand un dossier est créé, par exemple par le modèle <em>Simple Article</em>, il faut en faire un projet RStudio : dans le menu des projets (en haut à droite de la fenêtre de RStudio), utiliser le menu “New Project…” puis “Existing Directory” et sélectionner le dossier qui vient d’être créé.</p>
</div>
<div id="ecrire-1" class="section level4" number="4.3.2.2">
<h4>
<span class="header-section-number">4.3.2.2</span> Ecrire<a class="anchor" aria-label="anchor" href="#ecrire-1"><i class="fas fa-link"></i></a>
</h4>
<p>Les instructions pour utiliser le modèle sont contenues dans le texte fourni par défaut.</p>
</div>
<div id="tricoter" class="section level4" number="4.3.2.3">
<h4>
<span class="header-section-number">4.3.2.3</span> Tricoter<a class="anchor" aria-label="anchor" href="#tricoter"><i class="fas fa-link"></i></a>
</h4>
<p>Le document peut être tricoté en plusieurs formats :</p>
<ul>
<li>
<em>html_document2</em> est le format HTML pour lequel le modèle a été conçu : un bloc-note avec une table des matières <span style="white-space:nowrap">flottante ;</span>
</li>
<li>
<em>gitbook</em> est un format HTML alternatif, utilisé normalement pour les <span style="white-space:nowrap">ouvrages ;</span>
</li>
<li>
<em>downcute</em> est un format HTML proposé par le package <strong>rmdformats</strong><span style="white-space:nowrap"> ;</span>
</li>
<li>
<em>pdf_book</em> produit un document PDF suivant le modèle LaTeX <em>article</em>, couramment utilisé directement en <span style="white-space:nowrap">LaTeX ;</span>
</li>
<li>
<em>word_document2</em> crée un ficher Word.</li>
</ul>
</div>
<div id="sec:article-en-ligne" class="section level4" number="4.3.2.4">
<h4>
<span class="header-section-number">4.3.2.4</span> Mettre en ligne<a class="anchor" aria-label="anchor" href="#sec:article-en-ligne"><i class="fas fa-link"></i></a>
</h4>
<p>Le package <strong>memoiR</strong> simplifie la mise en ligne des documents produits.</p>
<p>La fonction <code>build_gitignore()</code> crée un fichier <code>.gitignore</code> pour le contrôle de source qui doit être activé (voir section <a href="chap-git.html#sec:git-cds">3.1.1</a>).</p>
<p>La fonction <code>build_readme()</code> crée un fichier <code>README.md</code> nécessaire à GitHub.
Il contient le titre du projet, son résumé et des liens vers les versions HTML et PDF des documents produits.</p>
<p>Le projet doit être lié à un dépôt GitHub (section <a href="chap-git.html#sec:creerdepot">3.2</a>).</p>
<p>Deux stratégies de publications sont possible.
Dans la première, les documents sont tricotés localement et placés dans le dossier <code>docs</code>, qui sera le support des pages GitHub.
Dans la seconde, les documents sont tricotés par GitHub Actions à chaque fois que des modifications sont poussées sur le dépôt : on parle d’intégration continue (section <a href="chap-ci.html#chap-ci">6</a>).</p>
<p>La stratégie de production locale est traitée <span style="white-space:nowrap">ici ;</span> l’intégration continue le sera dans la section <a href="chap-ci.html#sec:memoiR-ci">6.3.1</a>.</p>
<p>La fonction <code>build_githubpages()</code> place tous les documents tricotés (HTML et PDF) dans le dossier <code>docs</code>, avec une copie du fichier <code>README.md</code>.
De cette façon, il est possible d’activer les pages GitHub du projet (sur le dossier <code>docs</code> de la branche <code>master</code>).
Le fichier <code>README.md</code> sera la page d’accueil du site web produit.</p>
<p>En pratique, on tricote au format HTML pendant toute la phase de rédaction, parce que la production est très rapide.
Quand le document est stabilisé, il faut le tricoter au format HTML et au format PDF.
Enfin, l’exécution de <code>build_githubpages()</code> place tous les fichiers produits dans <code>docs</code>.
Il reste à pousser le dépôt sur GitHub et activer les pages GitHub.</p>
</div>
</div>
<div id="autres-modèles" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Autres modèles<a class="anchor" aria-label="anchor" href="#autres-mod%C3%A8les"><i class="fas fa-link"></i></a>
</h3>
<p>Le modèle <em>Stylish Article</em> de <strong>memoiR</strong> est destiné à la production d’articles PDF pour l’autoarchivage (typiquement, le dépôt sur HAL) bien formatés, au format A4 en double colonne<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Exemple : &lt;a href="https://EricMarcon.github.io/Rochebrune2018/Entropie.pdf" class="uri"&gt;https://EricMarcon.github.io/Rochebrune2018/Entropie.pdf&lt;/a&gt;&lt;/p&gt;'><sup>71</sup></a>.</p>
<p>Le format HTML est le même que celui du modèle <em>Simple Article</em>.</p>
<p>Le package <strong>rticles</strong> a pour ambition de fournir des modèles pour toutes les revues scientifiques qui acceptent une soumission d’articles en LaTeX.
Il propose donc des modèles Markdown qui produisent des fichiers PDF conformes aux exigences des revues et la possibilité de récupérer le fichier <code>.tex</code> intermédiaire (pandoc produit un fichier <code>.tex</code> transmis au compilateur LaTeX).
Le package ne permet pas de tricot HTML parce qu’il utilise la syntaxe LaTeX dans le document R Markdown au lieu d’utiliser <strong>bookdown</strong> pour gérer les références bibliographique et les références croisées.
Il n’est pas possible d’échanger directement du contenu R Markdown standard avec des documents écrits pour <strong>rticles</strong>, ce qui limite beaucoup l’intérêt du package.</p>
</div>
</div>
<div id="présentation-beamer" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Présentation Beamer<a class="anchor" aria-label="anchor" href="#pr%C3%A9sentation-beamer"><i class="fas fa-link"></i></a>
</h2>
<p>Le modèle <em>Beamer Presentation</em> de <strong>memoiR</strong> permet de créer des présentations au format HTML et PDF (beamer) simultanément, comme le montre l’exemple<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/Chao1/" class="uri"&gt;https://EricMarcon.github.io/Chao1/&lt;/a&gt;, choisir Lecture (HTML) ou Téléchargement (PDF).&lt;/p&gt;'><sup>72</sup></a>.</p>
<p>La démarche est identique à celle des articles du même package.
Les niveaux de titre permettent de séparer les parties de la présentation (<code>#</code>) et les diapositives (<code>##</code>).
Deux formats sont disponibles en HTML : ioslides<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/ioslides-presentation.html" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/ioslides-presentation.html&lt;/a&gt;&lt;/p&gt;'><sup>73</sup></a> et Slidy<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/slidy-presentation.html" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/slidy-presentation.html&lt;/a&gt;&lt;/p&gt;'><sup>74</sup></a>.
Quelques spécificités dans le code permettent d’affiner la présentation des diapositives, pour un affichage sur deux colonnes par exemple : elles sont documentées dans le modèle.</p>
</div>
<div id="memoir" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> memoir<a class="anchor" aria-label="anchor" href="#memoir"><i class="fas fa-link"></i></a>
</h2>
<p>Le modèle <em>Memoir</em> du package <strong>memoiR</strong> est destiné aux documents longs, qui présentent une différence importante avec les documents précédents : un document long est composé de plusieurs chapitres, chacun placé dans son fichier <code>.Rmd</code>.</p>
<p>Le format HTML est gitbook<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.gitbook.com/" class="uri"&gt;https://www.gitbook.com/&lt;/a&gt;&lt;/p&gt;'><sup>75</sup></a>, le standard de la lecture en ligne de documents de ce type.
Le format PDF est dérivé du modèle LaTeX <em>memoir</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.ctan.org/pkg/memoir" class="uri"&gt;https://www.ctan.org/pkg/memoir&lt;/a&gt;&lt;/p&gt;'><sup>76</sup></a>, optimisé aussi pour les documents longs.</p>
<p>Ce document a été écrit avec ce modèle.</p>
<div id="créer-1" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Créer<a class="anchor" aria-label="anchor" href="#cr%C3%A9er-1"><i class="fas fa-link"></i></a>
</h3>
<p>La création d’un projet d’ouvrage est identique à celle présentée plus haut : le modèle est : <em>Memoir</em>.
Le dossier créé doit être transformé en projet.</p>
<p>Exécuter <code>build_git()</code> et <code>build_readme()</code>, activer le contrôle de source et pousser le projet sur GitHub, de la même façon que pour un article (section <a href="chap-rediger.html#sec:article-en-ligne">4.3.2.4</a>).</p>
<p>Chaque chapitre de l’ouvrage est un fichier Rmd, dont le nom commence normalement par son numéro (ex. : <code>01-intro.Rmd</code>).
Tous les fichiers Rmd présents dans le dossier du projet sont en réalité traités comme des chapitres, triés par ordre de nom de fichier, dont ceux fournis par le modèle (démarrage et syntaxe) qui doivent être supprimés à l’exception de <code>99-references.Rmd</code> qui contient la bibliographie, placée à la fin.
Le fichier <code>index.Rmd</code> est particulier : il contient l’entête du document et le premier chapitre.</p>
</div>
<div id="ecrire-2" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Ecrire<a class="anchor" aria-label="anchor" href="#ecrire-2"><i class="fas fa-link"></i></a>
</h3>
<p>Le premier chapitre est placé dans l’avant-propos de l’ouvrage imprimé : il ne doit pas être numéroté (d’où le code <code>{-}</code> à côté du titre) dans la version HTML.
Il se termine obligatoirement par la commande LaTeX <code>\mainmatter</code> qui marque le début du corps de l’ouvrage.</p>
<p>Les niveaux de plan commencent par <code>#</code> pour les chapitres (un seul par fichier), <code>##</code> pour les sections, etc.</p>
</div>
<div id="tricoter-1" class="section level3" number="4.5.3">
<h3>
<span class="header-section-number">4.5.3</span> Tricoter<a class="anchor" aria-label="anchor" href="#tricoter-1"><i class="fas fa-link"></i></a>
</h3>
<p>La compilation au format PDF est faite par XeLaTeX, qui doit être installé.</p>
<p>Pendant la rédaction, il est fortement conseillé de ne créer que le fichier HTML, ce qui est beaucoup plus rapide qu’une compilation LaTeX.
Chaque chapitre peut être visualisé très rapidement en cliquant sur le bouton “Knit” au-dessus de la fenêtre de source.
Le livre entier est créé en cliquant sur le bouton “Build Book” de la fenêtre <em>Build</em> de RStudio.
La liste déroulante du bouton permet de créer tous les documents ou de se limiter à un format.</p>
<p>Les fichiers produits sont placés directement dans le dossier <code>docs</code>, qui sera utilisé par les pages GitHub pour permettre la lecture en ligne et le téléchargement du PDF.
La page d’accueil du site web est créée par bookdown à partir du fichier <code>index.Rmd</code> : le fichier <code>README.md</code> n’est pas dupliqué dans <code>docs</code>.</p>
</div>
<div id="finitions" class="section level3" number="4.5.4">
<h3>
<span class="header-section-number">4.5.4</span> Finitions<a class="anchor" aria-label="anchor" href="#finitions"><i class="fas fa-link"></i></a>
</h3>
<p>La mise en page est assurée de façon totalement automatique par pandoc (en HTML) et LaTeX (en PDF).</p>
<p>Il est souvent utile d’aider LaTeX à résoudre quelques dépassements de marge dus à de trop grandes contraintes de mise en page : pour la lisibilité optimale, les colonnes sont étroites, mais le code (texte formaté entre deux apostrophes inversées) n’autorise pas la césure.</p>
<p>Si une ligne de texte dépasse dans la marge de droite dans le document PDF, la solution consiste à ajouter manuellement le code <code>\break</code> à l’emplacement désiré pour le retour à la ligne dans le document R Markdown.
La commande n’a aucun effet sur le document HTML mais force la césure en LaTeX.
Pour couper du texte formaté (entre astérisques pour l’italique ou plus fréquemment entre apostrophes inversées pour du code), il faut terminer le formatage avant <code>\break</code> et le recommencer après.
Exemple, pour forcer le retour à la ligne avant <code>fichier.Rmd</code> :</p>
<pre><code>Le fichier `/chemin/`\break`fichier.Rmd`</code></pre>
<p>En HTML, un espace sera ajouté entre les deux portions de code.</p>
<p>Les bouts de code R sont formatés automatiquement par <strong>knitr</strong> quand l’option <code>tidy=TRUE</code> leur est appliquée.
Le comportement par défaut est indiqué dans les options de <strong>knitr</strong>, dans un bout de code au début du fichier <code>index.Rmd</code> :</p>
<p></p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># knitr options</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  cache<span class="op">=</span><span class="cn">TRUE</span>, warning<span class="op">=</span><span class="cn">FALSE</span>, echo <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fig.env<span class="op">=</span><span class="st">'SCfigure'</span>, fig.asp<span class="op">=</span><span class="fl">.75</span>, </span>
<span>  fig.align<span class="op">=</span><span class="st">'center'</span>, out.width<span class="op">=</span><span class="st">'80%'</span>, </span>
<span>  tidy<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>  tidy.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>blank<span class="op">=</span><span class="cn">FALSE</span>, width.cutoff<span class="op">=</span><span class="fl">55</span><span class="op">)</span>, </span>
<span>    size<span class="op">=</span><span class="st">"scriptsize"</span>,</span>
<span>  knitr.graphics.auto_pdf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>La largeur maximale d’une ligne de code formaté est ici de 55 caractères, optimal pour le modèle.
Il arrive que le formatage automatique ne fonctionne pas parce que <strong>knitr</strong> ne parvient pas à trouver une coupure de ligne respectant toutes les contraintes, ce qui provoque un dépassement de marge dans le code.
Dans ce cas, formater manuellement le bout de code en lui ajoutant l’option <code>tidy=FALSE</code>.</p>
<p>Les blocs de code littéral, délimités par trois apostrophes inversées, doivent être formatés manuellement, en évitant toute ligne de plus de 55 caractères.</p>
</div>
<div id="site-gitbook" class="section level3" number="4.5.5">
<h3>
<span class="header-section-number">4.5.5</span> Site gitbook<a class="anchor" aria-label="anchor" href="#site-gitbook"><i class="fas fa-link"></i></a>
</h3>
<p>Le site web contenant le document gitbook doit être paramétré dans <code>_output.yml</code> pour que :</p>
<ul>
<li>le titre du document apparaisse en haut de la table des <span style="white-space:nowrap">matières ;</span>
</li>
<li>une indication de l’usage de GitHub et bookdown soit affichée en bas de la table des <span style="white-space:nowrap">matières ;</span>
</li>
<li>un bouton GitHub dans la barre de titre permette d’ouvrir le dépôt du <span style="white-space:nowrap">projet ;</span>
</li>
<li>un autre bouton permette de télécharger le document PDF.</li>
</ul>
<p>Le fichier <code>_output.yml</code> de ce document est le suivant :</p>
<pre><code>bookdown::gitbook:
  css: style.css
  config:
    sharing:
      github: yes
      facebook: false
      twitter: false
    toc:
      before: |
        &lt;li&gt;&lt;a href="./"&gt;Travailler avec R&lt;/a&gt;&lt;/li&gt;
      after: |
        &lt;li&gt;
          &lt;a href="https://github.com/EricMarcon/travailleR" target="blank"&gt;
            Hébergé sur GitHub, publié par bookdown
          &lt;/a&gt;
        &lt;/li&gt;
    download: pdf</code></pre>
<p>La section <code>sharing:</code> gère les boutons de la barre de titre.
Par défaut, les liens vers Facebook et Twitter sont activés mais celui vers GitHub ne l’est pas.
Pour qu’il fonctionne, le dépôt GitHub doit être déclaré dans l’entête du fichier <code>index.rmd</code> :</p>
<pre><code>github-repo: EricMarcon/travailleR</code></pre>
<p>La section <code>toc:</code> contient deux portions de code HTML dans lesquelles le titre du document et le lien vers son dépôt GitHub doivent être adaptés au projet.</p>
<p>Enfin, la section <code>download:</code> liste les formats de documents téléchargeables et permet d’afficher un bouton de téléchargement dans la barre de titre.</p>
</div>
<div id="sec:rediger-ouvrage-ci" class="section level3" number="4.5.6">
<h3>
<span class="header-section-number">4.5.6</span> Intégration continue<a class="anchor" aria-label="anchor" href="#sec:rediger-ouvrage-ci"><i class="fas fa-link"></i></a>
</h3>
<p>La construction d’un ouvrage prend du temps, surtout s’il contient des calculs.
Elle doit être lancée au format gitbook et au format PDF.
En production, elle peut être confiée à GitHub (chapitre <a href="chap-ci.html#sec:bookdown-ci">6.3.1.1</a>).</p>
</div>
<div id="google-analytics" class="section level3" number="4.5.7">
<h3>
<span class="header-section-number">4.5.7</span> Google Analytics<a class="anchor" aria-label="anchor" href="#google-analytics"><i class="fas fa-link"></i></a>
</h3>
<p>Le suivi de l’audience de l’ouvrage peut être confié à Google Analytics.
Pour cela, il faut créer un compte et ajouter une <em>propriété</em> Google Analytics, c’est-à-dire un site web, puis un flux de données, ici un flux web<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://support.google.com/analytics/answer/9304153?hl=fr&amp;amp;ref_topic=9303319" class="uri"&gt;https://support.google.com/analytics/answer/9304153?hl=fr&amp;amp;ref_topic=9303319&lt;/a&gt;&lt;/p&gt;'><sup>77</sup></a>.</p>
<p>Google Analytics fournit un script de configuration nommé <code>gtag.js</code> à placer à la racine du dossier du projet.
Enfin, déclarer le script dans l’entête des pages web en ajoutant une instruction dans <code>_output.yml</code>, dans sa première section.</p>
<pre><code>bookdown::gitbook:
  includes:
    in_header: gtag.js</code></pre>
</div>
</div>
<div id="site-web-r-markdown" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Site web R Markdown<a class="anchor" aria-label="anchor" href="#site-web-r-markdown"><i class="fas fa-link"></i></a>
</h2>
<p>Un site web constitué de pages écrites avec R Markdown (sans les fonctionnalités de <strong>bookdown</strong>) et un menu peut être créé très simplement, avec un résultat de bonne facture<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://rstudio.github.io/learnr/" class="uri"&gt;https://rstudio.github.io/learnr/&lt;/a&gt; par exemple.&lt;/p&gt;'><sup>78</sup></a>.</p>
<div id="modèle" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Modèle<a class="anchor" aria-label="anchor" href="#mod%C3%A8le"><i class="fas fa-link"></i></a>
</h3>
<p>Dans RStudio, dans le menu des projets en haut à droite, cliquer sur “New Project…” puis “New Directory” puis “Simple R Markdown website”.
Saisir le nom du projet, sélectionner le dossier dans lequel le projet sera créé en cliquant sur “Browse” et enfin cliquer sur “Create Project”.</p>
<p>Le site par défaut contient deux pages : <code>index</code>, la page d’accueil, et <code>about</code>, la page “A propos”.
Le fichier <code>_site.yml</code> contient le nom du site et le contenu de sa barre de navigation : un titre et le fichier correspondant.
D’autres pages seront ajoutées en créant de nouveaux fichiers <code>.Rmd</code> et en les ajoutant au fichier <code>_site.yml</code>.</p>
</div>
<div id="améliorations" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Améliorations<a class="anchor" aria-label="anchor" href="#am%C3%A9liorations"><i class="fas fa-link"></i></a>
</h3>
<p>Le modèle de site peut facilement être amélioré en complétant <code>_site.yml</code> :</p>
<ul>
<li>en ajoutant une icône GitHub dans la barre de navigation pour renvoyer vers le code source du <span style="white-space:nowrap">site ;</span>
</li>
<li>en choisissant la méthode de tricot des pages, pour utiliser <strong>bookdown</strong> au lieu de <strong>rmarkdown</strong><span style="white-space:nowrap"> ;</span>
</li>
<li>en plaçant les fichiers du site dans le dossier <code>docs</code> et ainsi séparer le code et la production.</li>
</ul>
<p>Le fichier <code>_site.yml</code> complété est le suivant :</p>
<pre><code>name: "my-website"
navbar:
  title: "My Website"
  left:
    - text: "Home"
      href: index.html
    - text: "About"
      href: about.html
  right:
    - icon: fa-github
      href: https://github.com/rstudio/rmarkdown
output_dir: "docs"
output:
  bookdown::html_document2:
    theme: sandstone
    highlight: tango
    toc: true
    toc_float: yes</code></pre>
<p>L’icône de GitHub fait partie de la collection Font Awesome dont toutes les icônes gratuites<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://fontawesome.com/icons?d=gallery&amp;amp;m=free" class="uri"&gt;https://fontawesome.com/icons?d=gallery&amp;amp;m=free&lt;/a&gt;&lt;/p&gt;'><sup>79</sup></a> sont utilisables avec la même syntaxe : “fa-nom”.</p>
<p>Le lien correspondant à l’icône doit être celui du dépôt GitHub du site web.</p>
<p>La syntaxe de la section <code>output</code> est la même que celle des documents vus plus haut.
Elle s’applique à toutes les pages (dont l’entête YAML est réduite au minimum).
Les thèmes disponibles sont ceux de rmarkdown<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/rmarkdown/html-document.html#appearance-and-style" class="uri"&gt;https://bookdown.org/yihui/rmarkdown/html-document.html#appearance-and-style&lt;/a&gt;&lt;/p&gt;'><sup>80</sup></a>.</p>
<p>L’option <code>highlight</code> indique la façon dont le code R éventuellement affiché sera formaté.
Enfin, la table des matières est flottante, ce qui signifie que sa position s’ajuste quand la fenêtre défile.</p>
</div>
<div id="contôle-de-source" class="section level3" number="4.6.3">
<h3>
<span class="header-section-number">4.6.3</span> Contôle de source<a class="anchor" aria-label="anchor" href="#cont%C3%B4le-de-source"><i class="fas fa-link"></i></a>
</h3>
<p>Le projet doit être placé sous contrôle de source et poussé sur GitHub (chapitre <a href="chap-git.html#chap-git">3</a>).
Le fichier <code>.gitignore</code> est le suivant :</p>
<pre><code># R
.Rbuildignore
.RData
.Rhistory
.Rprofile
.Rproj.user

# Web Site
/_site/
/*_cache/
/*_files/</code></pre>
<p>Activer les pages GitHub (section <a href="chap-git.html#sec:github-pages">3.7</a>) sur le dossier <code>docs</code> pour héberger le site.
Ajouter un fichier vide nommé <code>.nojekyll</code> dans <code>docs</code> pour que les pages GitHub ne tentent pas de reformater le site.
On peut utiliser le terminal de RStudio pour exécuter :</p>
<pre><code>touch docs/.nojekyll</code></pre>
</div>
</div>
<div id="sec:blogdown" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Site web personnel : blogdown<a class="anchor" aria-label="anchor" href="#sec:blogdown"><i class="fas fa-link"></i></a>
</h2>
<p>Pour créer une page web personnelle, <em>Hugo</em> est un générateur de site statique capable de produire des pages HTML à partir de code Markdown.
Les sites statiques ont l’avantage, en comparaison aux sites dynamiques gérés par un système de gestion de contenu (CMS, par exemple : Wordpress, Joomla, SPIP), d’être portables sur n’importe quel serveur web sans support de base de données ni de code à exécuter côté le serveur (tel que PHP) et d’être très rapides puisque les pages sont créées une seule fois et non à chaque consultation.
Un site Hugo peut être hébergé par exemple sur la page personnelle de tout utilisateur de GitHub dont l’adresse est de la forme “GitHubID.github.io”.</p>
<p>Hugo propose de nombreux thèmes, qui sont des modèles de structure de sites, donc le thème <strong>Academic</strong>, destiné aux chercheurs.
Dans RStudio, le package <strong>blogdown</strong> est prévu pour produire facilement des pages web avec Hugo.
Ces pages peuvent contenir du code R : elles sont très proches d’un article, vu plus haut, dont le contenu peut être facilement copié et collé.
Nous utiliserons donc cette solution, pour un site comme celui proposé en exemple<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/" class="uri"&gt;https://EricMarcon.github.io/&lt;/a&gt;&lt;/p&gt;'><sup>81</sup></a>.</p>
<p>La structure du site web est simple :</p>
<ul>
<li>une page d’accueil, contenant divers composants paramétrables comme la biographie de l’auteur, une sélection de publications, de billets de blogs ou d’autres éléments et un formulaire de <span style="white-space:nowrap">contact ;</span>
</li>
<li>des pages détaillant les divers éléments (publications, billets, etc.) écrites en R Markdown.</li>
</ul>
<div id="installation-des-outils" class="section level3" number="4.7.1">
<h3>
<span class="header-section-number">4.7.1</span> Installation des outils<a class="anchor" aria-label="anchor" href="#installation-des-outils"><i class="fas fa-link"></i></a>
</h3>
<p>La première étape consiste à installer le package <strong>blogdown</strong> dans R.</p>
<p></p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"blogdown"</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p><strong>blogdown</strong> est capable d’installer Hugo sous Windows, macOS ou Linux.</p>
<p></p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">::</span><span class="fu">install_hugo</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>La documentation complète de <strong>blogdown</strong> est disponible<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://bookdown.org/yihui/blogdown/" class="uri"&gt;https://bookdown.org/yihui/blogdown/&lt;/a&gt;&lt;/p&gt;'><sup>82</sup></a>.</p>
<p>Les versions récentes de Hugo utilisent <em>Go</em> (le langage de programmation) pour installer leurs modules à la volée : ici le thème Academic est chargé depuis GitHub au moment de la création du site.
Go doit donc être installé<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://golang.org/doc/install" class="uri"&gt;https://golang.org/doc/install&lt;/a&gt;&lt;/p&gt;'><sup>83</sup></a>.</p>
</div>
<div id="créer-2" class="section level3" number="4.7.2">
<h3>
<span class="header-section-number">4.7.2</span> Créer<a class="anchor" aria-label="anchor" href="#cr%C3%A9er-2"><i class="fas fa-link"></i></a>
</h3>
<p>La façon la plus simple consiste à créer un dépôt sur GitHub à partir du modèle.
Sur la page du dépôt <em>starter-academic</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/wowchemy/starter-academic" class="uri"&gt;https://github.com/wowchemy/starter-academic&lt;/a&gt;&lt;/p&gt;'><sup>84</sup></a>, cliquer sur le bouton “Use this template”, s’authentifier éventuellement sur GitHub, puis saisir le nom du dépôt qui contiendra le projet, par exemple “MySite”.</p>
<p>Le dépôt peut être celui du site principal de son compte GitHub (voir section <a href="chap-git.html#sec:github-pages">3.7</a>), à l’adresse <a href="https://GitHubID.github.io" class="uri">https://GitHubID.github.io</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Exemple : &lt;a href="https://EricMarcon.github.io/Krigeage/" class="uri"&gt;https://EricMarcon.github.io/Krigeage/&lt;/a&gt;&lt;/p&gt;'><sup>85</sup></a>.
Le nom à saisir est simplement “GitHubID.github.io” (<em>GitHubID</em> est le nom du compte GitHub).</p>
<p>Créer le dépôt.
Copier l’adresse du dépôt en cliquant sur le bouton “Code” puis sur le bouton à droite de l’adresse (figure <a href="chap-rediger.html#fig:rediger-GitHub-Clone">4.4</a>).</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rediger-GitHub-Clone"></span>
<img src="images/rediger-GitHub-Clone.png" alt="Copie de l’adresse d’un dépôt à cloner sur GitHub." width="80%"><p class="caption">
Figure 4.4: Copie de l’adresse d’un dépôt à cloner sur GitHub.
</p>
</div>
<p></p>
<p>Dans RStudio, créer un nouveau projet à partir de GitHub : dans le menu des projets en haut à droite, cliquer sur “New Project…” puis “Version Control” puis “Git” puis coller l’adresse dans le champ “Repository URL” (figure <a href="chap-rediger.html#fig:rediger-Projet-GitHub">4.5</a>).
Sélectionner le dossier dans lequel le projet sera créé en cliquant sur “Browse” et enfin cliquer sur “Create Project”.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rediger-Projet-GitHub"></span>
<img src="images/rediger-Projet-GitHub.png" alt="Collage de l’adresse du dépôt à cloner." width="80%"><p class="caption">
Figure 4.5: Collage de l’adresse du dépôt à cloner.
</p>
</div>
<p></p>
<p>Le projet créé est une copie exacte du modèle, qui doit être personnalisée.</p>
<p>RStudio ajoute automatiquement à la fin du fichier <code>.gitignore</code> une ligne pour ignorer ses fichiers de travail (dossier <code>.Rproj.user</code>).
Ajouter une ligne de commentaire pour le signaler.
Le contenu de <code>.gitignore</code> doit être le suivant :</p>
<pre><code># R
.Rbuildignore
.RData
.Rhistory
.Rprofile
.Rproj.user

# Hugo
/resources/
/public/

# blogdown
/static/en/
/static/fr/
*.rmarkdown
_index.html
index.html
**/index_files/</code></pre>
<p>Un bug de <strong>blogdown</strong> nécessite de déplacer le fichier <code>config.toml</code> du dossier <code>config/_default/</code> à la racine du projet.</p>
<p>Prendre en compte ces modification dans git en faisant un commit.</p>
</div>
<div id="construction-du-site" class="section level3" number="4.7.3">
<h3>
<span class="header-section-number">4.7.3</span> Construction du site<a class="anchor" aria-label="anchor" href="#construction-du-site"><i class="fas fa-link"></i></a>
</h3>
<p>Exécuter</p>
<p></p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">::</span><span class="fu">build_site</span><span class="op">(</span>build_rmd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>pour construire le site web, y compris ses futures pages R Markdown.</p>
<p>Pour afficher le site, exécuter :</p>
<p></p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">:::</span><span class="fu">serve_site</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Il apparaît dans la fenêtre <em>Viewer</em> de RStudio, dont le bouton d’agrandissement permet l’affichage dans le navigateur internet par défaut du système.</p>
<p>Pour modifier le contenu du site, il est préférable d’arrêter le serveur web par la commande :</p>
<p></p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">:::</span><span class="fu">stop_server</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Le site produit par <strong>blogdown</strong> se trouve dans le dossier <code>public</code> qui peut être copié directement sur un serveur web qui l’hébergera.
Une solution simple consiste à déclarer ce dossier comme racine des pages GitHub du projet
(section <a href="chap-git.html#sec:github-pages">3.7</a>).
La méthode optimale consiste à utiliser l’intégration continue (voir section <a href="chap-ci.html#sec:blogdown-ci">6.3.2</a>) pour le copier à la racine de la branche <code>gh-pages</code> qui sera déclarée comme emplacement du site sur GitHub.</p>
</div>
<div id="site-multilingue" class="section level3" number="4.7.4">
<h3>
<span class="header-section-number">4.7.4</span> Site multilingue<a class="anchor" aria-label="anchor" href="#site-multilingue"><i class="fas fa-link"></i></a>
</h3>
<p>Si le site est multilingue, son contenu (dossier <code>content</code>) doit être copié dans un dossier correspondant à chaque langue.
Par exemple, le fichier <code>content/authors/admin/_index.md</code> qui contient les informations sur le propriétaire du site est remplacé par <code>content/en/authors/admin/_index.md</code> et <code>content/fr/authors/admin</code><code>/_index.md</code> si le site supporte l’Anglais et le Français.
En pratique, créer un dossier <code>en</code> et un dossier <code>fr</code> dans <code>content</code>.
Déplacer tout le contenu de original de <code>content</code> dans <code>en</code> puis copier ce même contenu dans <code>fr</code>.</p>
</div>
<div id="paramétrer" class="section level3" number="4.7.5">
<h3>
<span class="header-section-number">4.7.5</span> Paramétrer<a class="anchor" aria-label="anchor" href="#param%C3%A9trer"><i class="fas fa-link"></i></a>
</h3>
<p>Les fichiers de configuration du site sont bien documentés et offrent de nombreuses options.
Les principales sont passées en revue ici pour une création rapide d’un site fonctionnel.</p>
<p>Le fichier <code>config.toml</code> contient les paramètres généraux du site.
Les lignes à mettre à jour sont celle du titre du site (le nom du propriétaire puisqu’il s’agit d’un site personnel) et son adresse publique.
Pour le site exemple :</p>
<pre><code>title = "Eric Marcon"
baseurl = "https://EricMarcon.github.io/"</code></pre>
<p>Il contient aussi la ligne de sélection de la langue par défaut (“en” ou “fr” au choix) et celle qui permet de placer les fichiers produits par Hugo dans chaque dossier de langue (“true” obligatoirement pour un site multilingue) :</p>
<pre><code>defaultContentLanguage = "fr"
defaultContentLanguageInSubdir = true</code></pre>
<p>Le dossier <code>config/_default/</code> contient les autres fichiers de configuration.</p>
<p><code>languages.toml</code> contient les paramètres linguistiques et les traductions de menus.
Pour chaque langue, la version utilisée et le dossier de contenu sont précisés :</p>
<pre><code>[en]
  languageCode = "en-us"
  contentDir = "content/en"
[fr]
  languageCode = "fr-fr"
  contentDir = "content/fr"</code></pre>
<p>Pour les langues additionnelles, le titre du site, les paramètres d’affichage des dates et la traduction des menus sont ajoutés.
Dans la section <code>[fr]</code> :</p>
<pre><code>[fr]
  languageCode = "fr-fr"
  contentDir = "content/fr"
  title = "Eric Marcon"
  description = "Page personnelle d'Eric Marcon"
  [fr.params]
    description = ""
    date_format = "02-Jan-2006"
    time_format = "15:04"
  [[fr.menu.main]]
    name = "Accueil"
    url = "#about"
    weight = 20
(...)</code></pre>
<p>Ces lignes sont commentées dans le modèle et doivent dont être décommentées en retirant les <code>#</code> en têtes de lignes.</p>
<p>Les menus sont décrits plus bas.</p>
<p><code>params.toml</code> décrit l’aspect du site.
Les options sont regroupées par sujet, par exemple “Theme” pour l’apparence générale.
Dans “Basic Info”, la ligne</p>
<pre><code>site_type = "Person"</code></pre>
<p>sélectionne un site personnel.
Il est possible d’utiliser Academic pour un site de projet scientifique ou un site d’unité, non documentés en détail ici.
Les principales différences sont, pour un site collectif :</p>
<ul>
<li>la gestion des auteurs : dans le dossier <code>/contents/&lt;langue&gt;/authors</code>, un seul dossier <code>admin</code> est utilisé pour un site personnel alors qu’un dossier par personne est nécessaire pour un site <span style="white-space:nowrap">collectif ;</span>
</li>
<li>un composant décrit plus bas, qui permet de présenter les personnes, doit être activé.</li>
</ul>
<p>La description du site dans la langue par défaut est saisie, à destination des moteurs de recherche :</p>
<pre><code>description = "Eric Marcon's Homepage"</code></pre>
<p>Elle doit être traduite dans le fichier <code>languages.toml</code>, dans chaque langue.</p>
<p>Dans “Site Features”, nous sélectionnons la coloration du code R, l’activation du formatage des équations et l’avertissement légal pour l’utilisation des cookies.</p>
<pre><code>highlight_languages = ["r"] 
math = true
privacy_pack = true</code></pre>
<p>La ligne <code>edit_page</code> doit être mise à jour : remplacer le dépôt par défaut “<a href="https://github.com/gcushen/hugo-academic" class="uri">https://github.com/gcushen/hugo-academic</a>” par celui du site.</p>
<p>“Contact details” contient les informations pour contacter le propriétaire du site.
Elles doivent être saisies.</p>
<p>“Regional Settings” contient les paramètres d’affichage de date pour la langue par défaut (ceux des autres langues sont dans <code>languages.toml</code>).
Ils n’ont normalement pas à être modifiés.</p>
<p>“Comments” permet d’activer les commentaires des visiteurs en bas de pages, avec Disqus ou Comment.io (un compte est nécessaire chez le fournisseur).
“Marketing” permet d’activer le suivi de fréquentation du site en saisissant simplement son identifiant Google Analytics (à créer avec un compte Google).
“Content Management System” contient la ligne <code>netlify_cms</code> dont la valeur doit être <code>false</code> si le site n’est pas hébergé par Netlify.
Enfin “Icon Pack Extensions” permet d’activer les icônes Academicons si nécessaire.</p>
</div>
<div id="ecrire-3" class="section level3" number="4.7.6">
<h3>
<span class="header-section-number">4.7.6</span> Ecrire<a class="anchor" aria-label="anchor" href="#ecrire-3"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliser la documentation en ligne<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://wowchemy.com/docs/page-builder/" class="uri"&gt;https://wowchemy.com/docs/page-builder/&lt;/a&gt;&lt;/p&gt;'><sup>86</sup></a> en complément des informations principales détaillées ici.
L’exemple utilisé ici est le site personnel de l’auteur<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/" class="uri"&gt;https://EricMarcon.github.io/&lt;/a&gt;&lt;/p&gt;'><sup>87</sup></a>.</p>
<p>La méthode de travail consiste à progresser pas à pas en testant puis validant chaque étape :</p>
<ul>
<li>effectuer les <span style="white-space:nowrap">modifications ;</span>
</li>
<li>construire le site et vérifier le résultat : <code>blogdown:::serve_site()</code><span style="white-space:nowrap"> ;</span>
</li>
<li>arrêter le site : <code>blogdown::stop_server()</code><span style="white-space:nowrap"> ;</span>
</li>
<li>si le résultat n’est pas satisfaisant, <span style="white-space:nowrap">recommencer ;</span>
</li>
<li>valider les modifications (<em>commit</em>).</li>
</ul>
<div id="page-daccueil" class="section level4" number="4.7.6.1">
<h4>
<span class="header-section-number">4.7.6.1</span> Page d’accueil<a class="anchor" aria-label="anchor" href="#page-daccueil"><i class="fas fa-link"></i></a>
</h4>
<p>La page d’accueil du site est constituée par une suite d’éléments (<em>widgets</em>) qui se trouvent dans <code>/contents/&lt;langue&gt;/home</code>.
Chaque élément est décrit par un fichier markdown.
Le premier est <code>index.md</code>.
Il n’est normalement jamais modifié.
Son contenu est le suivant :</p>
<pre><code>+++
# Homepage
type = "widget_page"
headless = true  # Homepage is headless, other widget 
pages are not.
+++</code></pre>
<p>Le fichier ne contient qu’un entête au format TOML, encadré par une ligne de <code>+++</code>.
Le type de composant (<code>type</code>) indique qu’il s’agit d’une page de composants, dans laquelle les autres composants du dossier trouveront leur place.
<code>headless = true</code> signifie que la page n’a pas d’en-tête.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rediger-demo"></span>
<img src="images/rediger-demo.png" alt="Composant demo dans Academic." width="80%"><p class="caption">
Figure 4.6: Composant <code>demo</code> dans Academic.
</p>
</div>
<p></p>
<p>Le composant <code>demo.md</code> (figure <a href="chap-rediger.html#fig:rediger-demo">4.6</a>) est un composant de type “blank”, c’est-à-dire une page de texte libre : il sert ici à présenter le modèle Academic Kickstart et doit donc être désactivé.
L’entête contient ses informations de formatage (titre, nombre de colonnes, couleurs…) et le contenu de la page est écrit en markdown.
Les composants apparaissent par ordre croissant de poids (<code>weight</code> dans l’entête) : 15 marque le premier composant dans le modèle Academic.
Le composant peut être désactivé en supprimant son fichier ou en modifiant sa propriété <code>active</code> dans l’entête :</p>
<pre><code>active = false  # Activate this widget? true/false</code></pre>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rediger-about"></span>
<img src="images/rediger-about.png" alt="Composant about dans Academic." width="80%"><p class="caption">
Figure 4.7: Composant <code>about</code> dans Academic.
</p>
</div>
<p></p>
<p>Le composant suivant est <code>about.md</code> (figure <a href="chap-rediger.html#fig:rediger-about">4.7</a>).
Il présente le propriétaire du site.
Son titre doit être localisé.
Dans le dossier <code>/content/fr/home</code>, sa valeur sera :</p>
<pre><code>title = "Biographie"</code></pre>
<p>L’auteur (<code>author</code>) doit correspondre à un dossier de <code>/contents/&lt;langue&gt;</code><code>/authors</code>.
<code>admin</code> convient parfaitement pour un site personnel.
Academic permet de créer des sites d’équipes : dans cette configuration, un dossier par personne serait nécessaire.
L’image affichée par le composant est le fichier <code>avatar.jpg</code> placé dans ce dossier.
Limiter la taille du fichier pour la performance du site (moins d’un mégaoctet est une taille raisonnable), tout en assurant une taille minimale de quelques centaines de pixels de côté pour la qualité de l’affichage.</p>
<p>Le contenu du composant est lu dans le fichier <code>_index.md</code> du même dossier, qui contient toutes les informations sur l’auteur.
Son organisation est assez claire : modifier son contenu à partir de l’exemple fourni.
Si des icônes de type <code>ai</code> sont utilisées, activer le pack d’icône Academicons dans <code>config/_default/params.toml</code>.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rediger-skills"></span>
<img src="images/rediger-skills.png" alt="Composant skills dans Academic." width="80%"><p class="caption">
Figure 4.8: Composant <code>skills</code> dans Academic.
</p>
</div>
<p></p>
<p>Le composant talents (<code>skills</code>, figure <a href="chap-rediger.html#fig:rediger-skills">4.8</a>) présente les compétences de l’auteur de façon graphique.
Une collection d’icônes est disponible, et des icônes nouvelles peuvent être ajoutées.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rediger-experience"></span>
<img src="images/rediger-experience.png" alt="Composant experience dans Academic." width="80%"><p class="caption">
Figure 4.9: Composant <code>experience</code> dans Academic.
</p>
</div>
<p></p>
<p>Le composant expérience (<code>experience</code>, figure <a href="chap-rediger.html#fig:rediger-experience">4.9</a>) liste les expériences professionnelles.
Toutes les informations sont saisies dans son entête.</p>
<p>Le composant <code>accomplishments</code> présente les formations professionnelles et permet d’accéder à leurs certificats.</p>
<p>Le composant <code>posts</code> va chercher son contenu dans le dossier <code>/contents</code><code>/&lt;langue&gt;/post</code> qui contient les billets de blog (voir plus bas).
Le fichier <code>posts.md</code> contient des options de mise en page dans son entête.</p>
<p>Le composant <code>projects</code> fonctionne de la même façon.
La différence entre les deux composants est leur mise en forme : <code>posts</code> est du type “pages”, qui affiche les éléments les plus récents, alors que <code>projects</code> est de type “portfolio”, qui affiche les éléments sélectionnés qui contiennent la description <code>featured: true</code> dans leur propre entête.
Il est possible de créer des composants de ces types librement, en spécifiant le dossier contenant les éléments dans “page-type”.
Exemple : créer un composant nommé <code>software.md</code> en renommant <code>projects.md</code>, modifier sa ligne <code>page_type = "software"</code> et créer un dossier <code>/contents/&lt;langue&gt;/software</code> pour y placer du contenu.</p>
<p>Les composants <code>publications</code> et <code>featured</code> sont de type “pages” et “portfolio” respectivement et prennent leur contenu dans le dossier <code>publication</code>.</p>
<p>Le composant <code>tags</code> présente un nuage de mots à partir des mots-clés déclarés dans tous les fichiers de contenu (billets de blog, publications…) sous la forme suivante dans leur entête :</p>
<pre><code>tags = ["Mot Clé 1", "Autre Mot Clé"]</code></pre>
<p>Enfin, le composant <code>contact</code> permet d’afficher un formulaire de contact.
Il utilise les informations du fichier <code>config/_default/params.toml</code> dans sa partie commençant par :</p>
<pre><code>############################
## Contact details
##</code></pre>
<p>Pour afficher une carte, entrer la latitude et la longitude de l’adresse dans la ligne <code>coordinates</code>.
Pour afficher un formulaire de messagerie, choisir le service <em>formspree.io</em> (<code>email_form = 2</code> dans <code>contact.md</code>).
Pour activer le service de messagerie, il faudra construire le site web, s’envoyer un premier message en utilisant le formulaire et suivre les instructions de Formspree.</p>
<p>Le composant <code>people</code> est utilisé dans les sites collectifs pour présenter les membres.
Le composant <code>slider</code> permet d’afficher un carrousel (des éléments défilants) en haut de page.
Pour comprendre son fonctionnement, le plus simple consiste à l’activer.</p>
</div>
<div id="menu-de-la-page-daccueil" class="section level4" number="4.7.6.2">
<h4>
<span class="header-section-number">4.7.6.2</span> Menu de la page d’accueil<a class="anchor" aria-label="anchor" href="#menu-de-la-page-daccueil"><i class="fas fa-link"></i></a>
</h4>
<p>La page d’accueil comporte un menu qui permet de naviguer rapidement vers ses composants ou vers d’autres pages.
Il est paramétré dans <code>config/_default</code><code>/menus.toml</code>.
Les éléments du menu ont un nom affiché, un lien (commençant par <code>#</code> pour pointer vers un composant ou un chemin relatif dans le site comme <code>publication/</code>), et un poids qui définit leur ordre d’affichage, de la même façon que celui des composants de la page d’accueil.</p>
<p>Un menu à deux éléments pour pointer vers l’accueil du site et les billets de blogs est donc le suivant :</p>
<pre><code>[[main]]
  name = "Home"
  url = "#about"
  weight = 10

[[main]]
  name = "Posts"
  url = "#posts"
  weight = 20</code></pre>
<p>Le menu doit être traduit dans chaque langue dans le fichier <code>config/_default</code><code>/languages.toml</code> :</p>
<pre><code>[fr]
  [[fr.menu.main]]
    name = "Accueil"
    url = "#about"
    weight = 10
  [[fr.menu.main]]
    name = "Articles"
    url = "#posts"
    weight = 20</code></pre>
</div>
<div id="billets" class="section level4" number="4.7.6.3">
<h4>
<span class="header-section-number">4.7.6.3</span> Billets<a class="anchor" aria-label="anchor" href="#billets"><i class="fas fa-link"></i></a>
</h4>
<p>Le site est alimenté par des billets de blog placés dans le dossier <code>/contents/&lt;langue&gt;/post</code>.
Il doivent être traduits et placés dans le dossier <code>post</code> de chaque langue pour être disponibles dans la langue correspondante.
L’exemple utilisé ici est un guide pour estimer correctement la densité d’une variable bornée<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/post/densite/" class="uri"&gt;https://EricMarcon.github.io/post/densite/&lt;/a&gt;&lt;/p&gt;'><sup>88</sup></a>.</p>
<p>Son code est sur GitHub<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/post/densite" class="uri"&gt;https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/post/densite&lt;/a&gt;&lt;/p&gt;'><sup>89</sup></a>.</p>
<p>Un billet est placé dans un dossier (<code>/content/fr/post/densite</code>) qui contient son code R Markdown et éventuellement des images, des données pour alimenter le code et d’autres éléments appelés par le code.
Hugo supporte des fichiers markdown natifs.
L’apport de <strong>blogdown</strong> relativement à un site Hugo natif est le support de R Markdown, donc la possibilité d’exécuter tout code R comme dans un bloc-note (dont le contenu peut être réutilisé sans modification).</p>
<p>Le fichier principal d’un billet est <code>index.Rmd</code>.
<strong>blogdown</strong> crée un fichier <code>index.html</code> pendant la construction du site : il peut être ignoré (dans <code>.gitgnore</code>) et supprimé à tout moment.
Si une image <code>featured.png</code> (optimale pour un schéma) ou <code>featured.jpg</code> (optimale pour un photo) est placée dans le dossier, elle sera utilisée comme vignette du billet.</p>
<p><code>index.Rmd</code> comprend un entête au format yaml (entourée par des <code>---</code>) ou toml (entourée par des <code>+++</code>) qui décrit son affichage :</p>
<pre><code>---
title: "Titre du billet"
subtitle: "Sous-titre"
summary: "Résumé"
authors: []
tags: ["Mot Clé 1", "Autre Mot Clé"]
categories: []
date: 2020-04-17
featured: false
draft: false

# Featured image
# To use, add an image named `featured.jpg/png` to 
# your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight,
# Left, Right, BottomLeft, Bottom, BottomRight.
image:
  caption: ""
  focal_point: ""
  preview_only: false
  
bibliography: references.bib
---</code></pre>
<p>Les auteurs sont utilisés dans les sites collectifs.
Les tags permettent d’alimenter le composant nuage de mots s’il est activé dans la page d’accueil.
Les catégories permettent de rechercher des pages au contenu similaire (recherche par mot-clé sur le site).
L’option <code>featured: true</code> fait apparaître le billet dans les composants de type <code>featured</code> sur la page d’accueil.
L’option <code>draft: true</code> cache le billet.</p>
<p>Les éléments suivants précisent l’affichage de la vignette : légende et position.
L’option <code>preview_only: true</code> limite l’affichage aux miniatures (sur la page d’accueil), retirant donc l’image du billet lui-même.</p>
<p>Les éléments d’entête nécessaires au corps de texte R Markdown, comme le nom du fichier contenant les références bibliographiques, placé dans le même dossier, sont ajoutés.</p>
<p>Le corps du texte est celui d’un document R Markdown standard, avec du code R inclus.
Un bout de code initial permet de fixer les options de R et charger les packages nécessaires.</p>
<p>En pratique, la façon la plus efficace de créer un nouveau billet est de copier le dossier complet d’un billet précédent, de le renommer et de modifier son contenu.
La commande <code>blogdown::new_post()</code> peut aussi être utilisée mais ne gère pas les langues multiples (et crée donc le billet dans le dossier <code>/contents/post</code> à moins de préciser l’argument <code>subdir</code>).</p>
<p>La reconstruction du site ne met par défaut pas à jour les pages basées sur un fichier <code>.Rmd</code>.
Pour le faire, il faut forcer la commande <code>build_site()</code>.</p>
<p></p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">::</span><span class="fu">build_site</span><span class="op">(</span>build_rmd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">blogdown</span><span class="fu">::</span><span class="fu">serve_site</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
</div>
<div id="publications" class="section level4" number="4.7.6.4">
<h4>
<span class="header-section-number">4.7.6.4</span> Publications<a class="anchor" aria-label="anchor" href="#publications"><i class="fas fa-link"></i></a>
</h4>
<p>Les publications sont organisées comme les billets, mais placées dans le dossier <code>/contents/&lt;langue&gt;/publications</code>.</p>
<p>L’exemple utilisé est un article de revue<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/publication/marcon-2003-a/" class="uri"&gt;https://EricMarcon.github.io/publication/marcon-2003-a/&lt;/a&gt;&lt;/p&gt;'><sup>90</sup></a> avec son code<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/publication/marcon-2003-a" class="uri"&gt;https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/publication/marcon-2003-a&lt;/a&gt;&lt;/p&gt;'><sup>91</sup></a>.</p>
<p>Un fichier <code>cite.bib</code> contenant la référence au format BibTeX est placé dans le dossier.
Le nom du dossier est de préférence celui de l’identifiant de la publication.
L’entête du fichier <code>index.md</code> (ici au format Markdown, mais <code>.Rmd</code> est possible si du code R est nécessaire) contient les mêmes informations que le fichier BibTeX, mais au format approprié (yaml), et les éléments propres à Academic (<code>featured</code>) :</p>
<pre><code>---
title: "Evaluating the geographic concentration of |&gt;
industries using distance-based methods"
authors: ["Eric Marcon", "Florence Puech"]
publication_types: ["2"]
abstract: "We propose (...)"
publication: "*Journal of Economic Geography*"
doi: "10.1093/jeg/lbg016"

date: 2003-10-01
featured: false
---</code></pre>
<p>Les types de publication sont :</p>
<ul>
<li>0 = <span style="white-space:nowrap">Uncategorized ;</span>
</li>
<li>1 = Conference <span style="white-space:nowrap">paper ;</span>
</li>
<li>2 = Journal <span style="white-space:nowrap">article ;</span>
</li>
<li>3 = Preprint / Working <span style="white-space:nowrap">Paper ;</span>
</li>
<li>4 = <span style="white-space:nowrap">Report ;</span>
</li>
<li>5 = <span style="white-space:nowrap">Book ;</span>
</li>
<li>6 = Book <span style="white-space:nowrap">section ;</span>
</li>
<li>7 = <span style="white-space:nowrap">Thesis ;</span>
</li>
<li>8 = Patent.</li>
</ul>
<p>Des boutons sont affichés en haut de la page de la publication en fonction des informations trouvées :</p>
<ul>
<li>PDF : si la ligne <code>url</code> est présente dans <span style="white-space:nowrap">l’en-tête ;</span>
</li>
<li>Citation : si le fichier <code>cite.bib</code> est présent dans le <span style="white-space:nowrap">dossier ;</span>
</li>
<li>DOI : si la ligne <code>doi</code> est présente dans l’en-tête.</li>
</ul>
<p>Le corps de la publication contient un lien (au format HTML) vers le site Dimension qui fournit des informations bibliométriques.
Ce lien peut être réutilisé très simplement, en remplaçant simplement le DOI du document :</p>
<pre><code>&lt;span class="__dimensions_badge_embed__" 
  data-doi="10.1093/jeg/lbg016"&gt;&lt;/span&gt;
&lt;script async src="https://badge.dimensions.ai/
  badge.js" charset="utf-8"&gt;&lt;/script&gt;</code></pre>
<p>Enfin, un fichier <code>/contents/&lt;langue&gt;/publications/_index.Rmd</code> permet de présenter la bibliographie complète.
Il est accessible à partir du composant <code>publications</code> de la page d’accueil qui affiche un lien “Plus de Publications”.</p>
<p>Le fichier exemple<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/publication/" class="uri"&gt;https://EricMarcon.github.io/publication/&lt;/a&gt;&lt;/p&gt;'><sup>92</sup></a> avec son code<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/publication/marcon-2003-a" class="uri"&gt;https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/publication/marcon-2003-a&lt;/a&gt;&lt;/p&gt;'><sup>93</sup></a> permet d’interroger Google Scholar pour obtenir le réseau de coauteurs, l’indice h et le nombre de citations annuelles de l’auteur.
Il est réutilisable en modifiant simplement l’identifiant Google Scholar à la ligne 30.</p>
<p>En faisant exécuter le code régulièrement, par exemple par GitHub (voir ci-dessous), les statistiques affichées sont maintenues à jour sans intervention humaine.</p>
</div>
<div id="communications" class="section level4" number="4.7.6.5">
<h4>
<span class="header-section-number">4.7.6.5</span> Communications<a class="anchor" aria-label="anchor" href="#communications"><i class="fas fa-link"></i></a>
</h4>
<p>Les communications sont organisées comme les publications, dans le dossier <code>/contents/&lt;langue&gt;/talk</code>.</p>
<p>L’exemple utilisé est une communication en Français, donc dans <code>/contents/fr/talk</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://EricMarcon.github.io/talk/chao1/" class="uri"&gt;https://EricMarcon.github.io/talk/chao1/&lt;/a&gt;&lt;/p&gt;'><sup>94</sup></a> avec son code<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/talk/chao1" class="uri"&gt;https://github.com/EricMarcon/HomePage2020/tree/master/content/fr/talk/chao1&lt;/a&gt;&lt;/p&gt;'><sup>95</sup></a>.</p>
<p>Une image peut être utilisée plus facilement que pour une publication.</p>
<p>L’entête contient des lignes particulières adaptées aux communications :</p>
<pre><code>---
title: "Construction de l'estimateur de biodiversité |&gt;
Chao1"
event: "Semaine des mathématiques 2020"
event_url: https://eduscol.education.fr/cid59178/|&gt;
semaine-des-mathematiques.html

location: Université de Guyane

summary: []
abstract: |
  Pour estimer le nombre d’espèces (richesse 
  spécifique) d’une communauté à partir d’un 
  échantillon, l’estimateur Chao1 est l’outil 
  le plus utilisé.

  Sa construction est expliquée et son efficacité
  est testée sur des données simulées.

# Talk start and end times.
#   End time can optionally be hidden by 
# prefixing the line with `#`.
date: "2020-03-11T11:00:00Z"
date_end: "2020-03-11T12:00:00Z"
all_day: false

# Schedule page publish date (NOT talk date).
publishDate: "2020-04-14"

# Is this a featured talk? (true/false)
featured: false

image:
  caption: 'Produit scalaire des vecteurs $v_0$ |&gt;
et $v_2$'
  focal_point: Smart

url_code: "https://github.com/EricMarcon/Chao1"
url_pdf: "https://EricMarcon.github.io/Chao1/|&gt;
Chao1.pdf"
url_slides: "https://EricMarcon.github.io/Chao1/|&gt;
Chao1.html"

# Enable math on this page?
math: true
---</code></pre>
<p>Les liens (<code>url_code</code> par exemple) font apparaître des boutons qui permettent d’afficher respectivement le code source de la présentation, un fichier pdf et les diapositives en ligne.</p>
</div>
<div id="autres-éléments" class="section level4" number="4.7.6.6">
<h4>
<span class="header-section-number">4.7.6.6</span> Autres éléments<a class="anchor" aria-label="anchor" href="#autres-%C3%A9l%C3%A9ments"><i class="fas fa-link"></i></a>
</h4>
<p>Il est possible d’ajouter librement des éléments supplémentaires sur le site :</p>
<ul>
<li>dans <code>/contents/&lt;langue&gt;/</code>, créer un dossier dont le nom est le type d’éléments (exemple : <code>recette</code><span style="white-space:nowrap">) ;</span>
</li>
<li>ajouter des éléments dans ce dossier, chacun dans son propre <span style="white-space:nowrap">dossier ;</span>
</li>
<li>le fichier obligatoire est <code>index.md</code> ou <code>index.Rmd</code> avec un en-tête contenant possiblement tous les champs rencontrés dans les éléments <code>post</code>, <code>publication</code> et <code>talk</code><span style="white-space:nowrap"> ;</span>
</li>
<li>le fichier de vignette, <code>featured.png</code> ou <code>featured.jpg</code>, est <span style="white-space:nowrap">facultatif ;</span>
</li>
<li>tous les fichiers nécessaires au tricot (images, données) peuvent être ajoutés dans le même <span style="white-space:nowrap">dossier ;</span>
</li>
<li>dans <code>/contents/&lt;langue&gt;/home</code>, ajouter un composant de la page d’accueil en copiant-collant un élément existant de type “pages” (comme <code>publications</code>) ou “portfolio” (comme <code>featured</code>) et le paramétrer pour qu’il pointe sur le bon dossier (dans l’exemple : <code>page-type=recette</code>) et ajuster son apparence (nombre d’éléments par exemple) et sa position <span style="white-space:nowrap">(poids) ;</span>
</li>
<li>ajouter éventuellement une entrée de menu pour pointer sur le composant, avec le même poids que le composant.</li>
</ul>
<p>Les fichiers d’index peuvent porter l’extension <code>.Rmd</code> ou <code>.md</code>.
Dans le premier cas, ils seront traités par <strong>blogdown</strong>, qui supporte l’intégration de code R.
Dans l’autre cas, ils seront traités par Hugo, qui ne gère que le format markdown standard.
Les fichiers <code>.md</code> nécessitent moins de ressource et sont donc préférés quand ils suffisent.</p>
</div>
<div id="finitions-1" class="section level4" number="4.7.6.7">
<h4>
<span class="header-section-number">4.7.6.7</span> Finitions<a class="anchor" aria-label="anchor" href="#finitions-1"><i class="fas fa-link"></i></a>
</h4>
<p>L’icône du site, qui apparaît dans la barre d’adresse des navigateurs web, se trouve dans <code>assets/images</code>.
Le fichier <code>icon.png</code> peut être remplacé.</p>
</div>
</div>
<div id="sec:rediger-web-ci" class="section level3" number="4.7.7">
<h3>
<span class="header-section-number">4.7.7</span> Intégration continue<a class="anchor" aria-label="anchor" href="#sec:rediger-web-ci"><i class="fas fa-link"></i></a>
</h3>
<p>La construction du site web en production peut être confiée à GitHub (section <a href="chap-ci.html#sec:blogdown-ci">6.3.2</a>), y compris sa mise à jour périodique si des pages du site traitent des données qui évoluent dans le temps.</p>
</div>
<div id="mises-à-jour-1" class="section level3" number="4.7.8">
<h3>
<span class="header-section-number">4.7.8</span> Mises à jour<a class="anchor" aria-label="anchor" href="#mises-%C3%A0-jour-1"><i class="fas fa-link"></i></a>
</h3>
<p>Le thème Academic est régulièrement mis à jour.
La version utilisée est indiquée dans le fichier <code>go.mod</code>.
Pour utiliser la dernière version officielle, exécuter dans la console R la commande suivante :</p>
<p></p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">::</span><span class="fu">hugo_cmd</span><span class="op">(</span><span class="st">"mod get -u"</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Les fichiers <code>go.mod</code> et <code>go.sum</code>, qui contient les codes de hachage des fichiers du module, sont mis à jour.</p>
<p>Chaque changement de version peut nécessiter des adaptations du contenu du site, référencées dans la documentation en ligne du thème<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://wowchemy.com/updates/" class="uri"&gt;https://wowchemy.com/updates/&lt;/a&gt;&lt;/p&gt;'><sup>96</sup></a>.</p>
<p>Mettre Hugo à jour en même temps :</p>
<p></p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blogdown</span><span class="fu">::</span><span class="fu">update_hugo</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
</div>
</div>
<div id="exportation-de-figures" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Exportation de figures<a class="anchor" aria-label="anchor" href="#exportation-de-figures"><i class="fas fa-link"></i></a>
</h2>
<p>Quand la production de documents avec R Markdown n’est pas possible, les figures issues de R doivent être exportées sous forme de fichiers pour être intégrés dans un autre processus d’écriture.
Il est préférable de créer des scripts pour créer les figures de façon reproductible et au format optimal.</p>
<div id="formats-vectoriels-et-raster" class="section level3" number="4.8.1">
<h3>
<span class="header-section-number">4.8.1</span> Formats vectoriels et raster<a class="anchor" aria-label="anchor" href="#formats-vectoriels-et-raster"><i class="fas fa-link"></i></a>
</h3>
<p>Les figures doivent en général être produites dans un format vectoriel :</p>
<ul>
<li>SVG pour la publication d’affiches ou de <span style="white-space:nowrap">posters ;</span>
</li>
<li>EMF (Extended Meta-File) pour Word ou la suite Microsoft Office qui ne supporte pas d’autres <span style="white-space:nowrap">formats ;</span>
</li>
<li>EPS (Encapsulated PostScript) ou PDF (Portable Document Format) pour LaTeX.</li>
</ul>
<p>Les figures raster (composées d’un ensemble de points, comme les photographies) sont rares dans R.
La fonction <code><a href="https://rdrr.io/r/graphics/image.html">image()</a></code> utilisée pour afficher des cartes utilise par défaut des polygones plutôt que des points.
La figure <a href="chap-rediger.html#fig:volcano">4.10</a> montre le résultat du code suivant :</p>

<p></p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">volcano</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"terrain"</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html">contour</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">volcano</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"brown"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">800</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">600</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:volcano"></span>
<img src="travailleR_files/figure-html/volcano-1.png" alt="Courbes de niveau du volcan Maunga Whau, code fourni en exemple de l’aide de la fonction image()." width="80%"><p class="caption">
Figure 4.10: Courbes de niveau du volcan Maunga Whau, code fourni en exemple de l’aide de la fonction <code><a href="https://rdrr.io/r/graphics/image.html">image()</a></code>.
</p>
</div>
<p></p>
<p>Elle est composée d’un ensemble de rectangles colorés : il s’agit bien d’une image vectorielle.</p>
<p>Si nécessaire, des images peuvent être produites aux formats BMP (bitmap, sans compression), JPEG (compressées avec perte de qualité), PNG (compressées sans perte de qualité, avec transparence possible) ou Tiff (compressées ou non).</p>
</div>
<div id="fonctions" class="section level3" number="4.8.2">
<h3>
<span class="header-section-number">4.8.2</span> Fonctions<a class="anchor" aria-label="anchor" href="#fonctions"><i class="fas fa-link"></i></a>
</h3>
<p>Les graphiques produits par <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> peuvent être sauvegardés dans un fichier par la fonction <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave()</a></code>.
L’extension du nom du fichier définit son format.
Voir l’aide de la fonction pour plus de détails.</p>
<p>Les autres graphiques nécessitent une méthode différente.
La fonction <code><a href="https://rdrr.io/r/grDevices/postscript.html">postscript()</a></code> produit un fichier EPS.
Le code R doit appeler la fonction pour créer le fichier, produire la figure, puis fermer le fichier, par exemple :</p>
<p></p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ouverture du fichier</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html">postscript</a></span><span class="op">(</span><span class="st">"Fig1.eps"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, horizontal <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Création de la figure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span><span class="co"># Fermeture du fichier</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## pdf 
##   2</code></pre>
<p></p>
<p>La largeur et la hauteur (en pouces) d’un fichier vectoriel n’ont pas d’importance, mais leur rapport fixe l’aspect de la figure.
La taille des textes est fixe : augmenter la taille de la figure revient donc à diminuer la taille relative des textes : procéder par essais successifs, en veillant à ce que les légendes restent lisibles à la taille finale de la figure.</p>
<p>L’argument <code>horizontal</code> fixe l’orientation de la figure de façon assez imprévisible : procéder par essais.</p>
<p>Les fonctions <code>eps()</code>, <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">bmp()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">jpeg()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code> et <code><a href="https://rdrr.io/r/grDevices/png.html">tiff()</a></code> fonctionnent de la même manière.
Se référer à l’aide des fonctions pour le choix des options (résolution, niveau de compression, etc.).
La fonction <code>emf()</code> est fournie par le package <strong>devEMF</strong>.</p>
<p>Les polices de caractères ne sont pas incluses dans les fichiers EPS ou PDF.
Si nécessaire, la fonction <code><a href="https://rdrr.io/r/grDevices/embedFonts.html">embedFonts()</a></code> permet d’y remédier, à condition que GhostScript soit installé.</p>
</div>
<div id="package-ragg" class="section level3" number="4.8.3">
<h3>
<span class="header-section-number">4.8.3</span> Package ragg<a class="anchor" aria-label="anchor" href="#package-ragg"><i class="fas fa-link"></i></a>
</h3>
<p>Le package <strong>ragg</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://ragg.r-lib.org/" class="uri"&gt;https://ragg.r-lib.org/&lt;/a&gt;&lt;/p&gt;'><sup>97</sup></a> améliore la qualité des fichiers PNG, JPEG et TIFF.
Les fonctions optimisées sont <code>agg_png()</code>, <code>agg_jpeg()</code>et <code>agg_tiff()</code>. Leur usage est le même que celui des fonctions de <strong>grDevices</strong>.</p>
<p>Les documents R Markdown produisent des images au format PNG pour leur version HTML.
<strong>ragg</strong> améliore leur qualité : le package doit être installé et <code>dev = "ragg_png"</code> doit être ajoutée aux options de <strong>knitr</strong>.
Pour ce document, les options déclarées dans <code>index.Rmd</code> sont les suivantes :</p>
<p></p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  cache<span class="op">=</span><span class="cn">FALSE</span>, <span class="co"># Cache chunk results</span></span>
<span>  echo <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Show/Hide R chunks</span></span>
<span>  warning<span class="op">=</span><span class="cn">FALSE</span>, <span class="co"># Show/Hide warnings</span></span>
<span>  <span class="co"># Figure alignment and size</span></span>
<span>  fig.align<span class="op">=</span><span class="st">'center'</span>, out.width<span class="op">=</span><span class="st">'80%'</span>, fig.asp<span class="op">=</span><span class="fl">.75</span>,</span>
<span>  <span class="co"># Graphic devices (ragg_png is better than standard png)</span></span>
<span>  dev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ragg_png"</span>, <span class="st">"pdf"</span><span class="op">)</span>,</span>
<span>  <span class="co"># Code chunk format</span></span>
<span>  tidy<span class="op">=</span><span class="cn">TRUE</span>, tidy.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>blank<span class="op">=</span><span class="cn">FALSE</span>, width.cutoff<span class="op">=</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>  size<span class="op">=</span><span class="st">"scriptsize"</span>, knitr.graphics.auto_pdf <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">60</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Enfin, <strong>ragg</strong> peut être utilisé comme moteur de rendu graphique par défaut dans RStudio à partir de la version 1.4 (Menu “Tools &gt; Global Options &gt; General &gt; Graphics &gt; Backend”).</p>
</div>
</div>
<div id="sec:targetsmd" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> Flux de travail<a class="anchor" aria-label="anchor" href="#sec:targetsmd"><i class="fas fa-link"></i></a>
</h2>
<p>Un flux de travail (voir section <a href="chap-utiliseR.html#sec:targets">2.8</a>) peut être intégré dans un document R Markdown à partir de la version 0.5 du package <strong>targets</strong>.</p>
<p></p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/targets/">"targets"</a></span><span class="op">)</span></span></code></pre></div>
<p></p>
<div id="déclaration-du-flux" class="section level3" number="4.9.1">
<h3>
<span class="header-section-number">4.9.1</span> Déclaration du flux<a class="anchor" aria-label="anchor" href="#d%C3%A9claration-du-flux"><i class="fas fa-link"></i></a>
</h3>
<p>Le flux est géré par des bouts de code de type <code>targets</code>.
Leur entête minimal est <a href="https://docs.ropensci.org/targets/">targets</a> au lieu de <code>{r}</code>, et ils doivent être nommés.
Ces bouts de code permettent de créer le fichier <code>_targets.R</code> quand ils sont exécutés en mode non interactif, notamment pendant que le document est tricoté.
S’ils sont lancés en mode interactif, par exemple dans R Studio, leur code est exécuté.
L’option <code>tar_interactive = FALSE</code> dans leur entête permet de les tester sans tricoter tout le document.</p>
<p>Un ancien flux éventuel doit être supprimé avant d’écrire le nouveau :</p>
<p></p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_unscript.html">tar_unscript</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Le premier bout de code, avec l’option <code>tar_globals=TRUE</code>, écrit les options globales du flux.
Pour créer le flux présenté en section <a href="chap-utiliseR.html#sec:targets">2.8</a>, le code est simplement :</p>
<pre><code>```{targets targets_global, tar_globals=TRUE}
# Packages
tar_option_set(packages = c("spatstat", "dbmss"))
```</code></pre>
<p>Les fonctions utilisées par les cibles sont déclarées dans ce type de bout de code : elles sont ajoutées à un fichier dans le dossier de travail <code>_targets_r</code> (différent du dossier <code>_targets</code> qui contient les fichiers de calcul des cibles).</p>
</div>
<div id="déclaration-des-cibles" class="section level3" number="4.9.2">
<h3>
<span class="header-section-number">4.9.2</span> Déclaration des cibles<a class="anchor" aria-label="anchor" href="#d%C3%A9claration-des-cibles"><i class="fas fa-link"></i></a>
</h3>
<p>Les cibles elles-mêmes sont déclarées dans des bouts de code dont le nom est celui de la variable de destination.</p>
<pre><code>```{targets X, tar_simple=TRUE}
runifpoint(NbPoints)
```</code></pre>
<p>Chaque cible nécessite un bout de code construit de cette manière.
La valeur de la cible est la dernière valeur retournée, à la manière d’une fonction qui n’utiliserait pas <code><a href="https://rdrr.io/r/base/function.html">return()</a></code>.</p>
<p>Pendant le tricot, ce code simplifié (<code>tar_simple=TRUE</code>) est transformé automatiquement en écriture de cible :</p>
<p></p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span><span class="va">X</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/spatstat.random/man/runifpoint.html">runifpoint</a></span><span class="op">(</span><span class="va">NbPoints</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Define target X from chunk code.
## Establish _targets.R and _targets_r/targets/X.R.</code></pre>
<p></p>
<p>La lecture du document est alourdie par cette syntaxe particulière : <strong>targets</strong> n’est pas utile pour des documents dont le code, rapide à exécuter, doit être affiché dans le texte.
En revanche, si le code est long à exécuter et n’est pas affiché, son intérêt est considérable pour limiter le temps de calcul.</p>
<p>Les autres bouts de code nécessaires pour compléter le flux sont les suivants :</p>
<ul>
<li>
<code>NbPoints</code> :</li>
</ul>
<p></p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span><span class="va">NbPoints</span>, <span class="op">{</span></span>
<span>    <span class="fl">1000</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Define target NbPoints from chunk code.
## Establish _targets.R and _targets_r/targets/NbPoints.R.</code></pre>
<p></p>
<ul>
<li>
<code>d</code> :</li>
</ul>
<p></p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/pairdist.html">pairdist</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">NbPoints</span><span class="op">/</span><span class="op">(</span><span class="va">NbPoints</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Define target d from chunk code.
## Establish _targets.R and _targets_r/targets/d.R.</code></pre>
<p></p>
<ul>
<li>
<code>map</code> :</li>
</ul>
<p></p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span><span class="va">map</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="fu">as.wmppp</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Define target map from chunk code.
## Establish _targets.R and _targets_r/targets/map.R.</code></pre>
<p></p>
</div>
<div id="exécution-du-flux" class="section level3" number="4.9.3">
<h3>
<span class="header-section-number">4.9.3</span> Exécution du flux<a class="anchor" aria-label="anchor" href="#ex%C3%A9cution-du-flux"><i class="fas fa-link"></i></a>
</h3>
<p>Pour lancer le calcul des cibles, un bout de code standard (<code>{r}</code>) doit appeler <code><a href="https://docs.ropensci.org/targets/reference/tar_make.html">tar_make()</a></code> :</p>
<p></p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-f86449deb0c1fad89ea7" style="width:80%;height:504px;"></div>
<script type="application/json" data-for="htmlwidget-f86449deb0c1fad89ea7">{"x":{"nodes":{"name":["d","map","NbPoints","X"],"type":["stem","stem","stem","stem"],"description":[null,null,null,null],"status":["outdated","outdated","outdated","outdated"],"seconds":[null,null,null,null],"bytes":[null,null,null,null],"branches":[null,null,null,null],"label":["d","map","NbPoints","X"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["d","map","NbPoints","X"],"level":[3,3,1,2],"shape":["dot","dot","dot","dot"]},"edges":{"from":["NbPoints","NbPoints","X","X"],"to":["X","d","d","map"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem"],"color":["#78B7C5","#899DA4"],"shape":["dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html">tar_make</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## ▶ dispatched target NbPoints
## ● completed target NbPoints [0.656 seconds, 53 bytes]
## ▶ dispatched target X
## ● completed target X [0.001 seconds, 11.058 kilobytes]
## ▶ dispatched target d
## ● completed target d [0.007 seconds, 55 bytes]
## ▶ dispatched target map
## ● completed target map [0.014 seconds, 187.39 kilobytes]
## ▶ ended pipeline [0.77 seconds]</code></pre>
<p></p>
<p><code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> permet de vérifier que le flux est correct avant de l’exécuter.
Au moment de la production finale du document, l’option <code>include=FALSE</code> peut être ajoutée à l’entête de ce bout de code pour qu’il ne produise aucun affichage.</p>
</div>
<div id="utilisation-des-résultats" class="section level3" number="4.9.4">
<h3>
<span class="header-section-number">4.9.4</span> Utilisation des résultats<a class="anchor" aria-label="anchor" href="#utilisation-des-r%C3%A9sultats"><i class="fas fa-link"></i></a>
</h3>
<p>Les bouts de code qui utilisent les valeurs des cibles doivent les lire avec <code><a href="https://docs.ropensci.org/targets/reference/tar_read.html">tar_read()</a></code> :</p>
<p></p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html">tar_read</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="travailleR_files/figure-html/tar_read_4-1.png" width="80%" style="display: block; margin: auto;"></div>
<p></p>
</div>
<div id="contrôle-de-source" class="section level3" number="4.9.5">
<h3>
<span class="header-section-number">4.9.5</span> Contrôle de source<a class="anchor" aria-label="anchor" href="#contr%C3%B4le-de-source"><i class="fas fa-link"></i></a>
</h3>
<p>Les fichiers de <strong>targets</strong> doivent être inclus au contrôle de source.
De cette façon, les calculs effectués localement ne seront pas répétés par GitHub Actions (chapitre <a href="chap-ci.html#chap-ci">6</a>) et la construction du document sera rapide.</p>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-git.html"><span class="header-section-number">3</span> Git et GitHub</a></div>
<div class="next"><a href="chap-package.html"><span class="header-section-number">5</span> Package</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-rediger"><span class="header-section-number">4</span> Rédiger</a></li>
<li><a class="nav-link" href="#bloc-note-markdown-r-notebook"><span class="header-section-number">4.1</span> Bloc-note Markdown (R Notebook)</a></li>
<li><a class="nav-link" href="#mod%C3%A8les-r-markdown"><span class="header-section-number">4.2</span> Modèles R Markdown</a></li>
<li>
<a class="nav-link" href="#articles-avec-bookdown"><span class="header-section-number">4.3</span> Articles avec bookdown</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ecrire"><span class="header-section-number">4.3.1</span> Ecrire</a></li>
<li><a class="nav-link" href="#sec:memo"><span class="header-section-number">4.3.2</span> Modèle Simple Article</a></li>
<li><a class="nav-link" href="#autres-mod%C3%A8les"><span class="header-section-number">4.3.3</span> Autres modèles</a></li>
</ul>
</li>
<li><a class="nav-link" href="#pr%C3%A9sentation-beamer"><span class="header-section-number">4.4</span> Présentation Beamer</a></li>
<li>
<a class="nav-link" href="#memoir"><span class="header-section-number">4.5</span> memoir</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cr%C3%A9er-1"><span class="header-section-number">4.5.1</span> Créer</a></li>
<li><a class="nav-link" href="#ecrire-2"><span class="header-section-number">4.5.2</span> Ecrire</a></li>
<li><a class="nav-link" href="#tricoter-1"><span class="header-section-number">4.5.3</span> Tricoter</a></li>
<li><a class="nav-link" href="#finitions"><span class="header-section-number">4.5.4</span> Finitions</a></li>
<li><a class="nav-link" href="#site-gitbook"><span class="header-section-number">4.5.5</span> Site gitbook</a></li>
<li><a class="nav-link" href="#sec:rediger-ouvrage-ci"><span class="header-section-number">4.5.6</span> Intégration continue</a></li>
<li><a class="nav-link" href="#google-analytics"><span class="header-section-number">4.5.7</span> Google Analytics</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#site-web-r-markdown"><span class="header-section-number">4.6</span> Site web R Markdown</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#mod%C3%A8le"><span class="header-section-number">4.6.1</span> Modèle</a></li>
<li><a class="nav-link" href="#am%C3%A9liorations"><span class="header-section-number">4.6.2</span> Améliorations</a></li>
<li><a class="nav-link" href="#cont%C3%B4le-de-source"><span class="header-section-number">4.6.3</span> Contôle de source</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sec:blogdown"><span class="header-section-number">4.7</span> Site web personnel : blogdown</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#installation-des-outils"><span class="header-section-number">4.7.1</span> Installation des outils</a></li>
<li><a class="nav-link" href="#cr%C3%A9er-2"><span class="header-section-number">4.7.2</span> Créer</a></li>
<li><a class="nav-link" href="#construction-du-site"><span class="header-section-number">4.7.3</span> Construction du site</a></li>
<li><a class="nav-link" href="#site-multilingue"><span class="header-section-number">4.7.4</span> Site multilingue</a></li>
<li><a class="nav-link" href="#param%C3%A9trer"><span class="header-section-number">4.7.5</span> Paramétrer</a></li>
<li><a class="nav-link" href="#ecrire-3"><span class="header-section-number">4.7.6</span> Ecrire</a></li>
<li><a class="nav-link" href="#sec:rediger-web-ci"><span class="header-section-number">4.7.7</span> Intégration continue</a></li>
<li><a class="nav-link" href="#mises-%C3%A0-jour-1"><span class="header-section-number">4.7.8</span> Mises à jour</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exportation-de-figures"><span class="header-section-number">4.8</span> Exportation de figures</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#formats-vectoriels-et-raster"><span class="header-section-number">4.8.1</span> Formats vectoriels et raster</a></li>
<li><a class="nav-link" href="#fonctions"><span class="header-section-number">4.8.2</span> Fonctions</a></li>
<li><a class="nav-link" href="#package-ragg"><span class="header-section-number">4.8.3</span> Package ragg</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sec:targetsmd"><span class="header-section-number">4.9</span> Flux de travail</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#d%C3%A9claration-du-flux"><span class="header-section-number">4.9.1</span> Déclaration du flux</a></li>
<li><a class="nav-link" href="#d%C3%A9claration-des-cibles"><span class="header-section-number">4.9.2</span> Déclaration des cibles</a></li>
<li><a class="nav-link" href="#ex%C3%A9cution-du-flux"><span class="header-section-number">4.9.3</span> Exécution du flux</a></li>
<li><a class="nav-link" href="#utilisation-des-r%C3%A9sultats"><span class="header-section-number">4.9.4</span> Utilisation des résultats</a></li>
<li><a class="nav-link" href="#contr%C3%B4le-de-source"><span class="header-section-number">4.9.5</span> Contrôle de source</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/EricMarcon/travailleR/blob/master/04-Rediger.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/EricMarcon/travailleR/edit/master/04-Rediger.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Travailler avec R</strong>" was written by Eric Marcon. It was last built on 31/10/2024.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
