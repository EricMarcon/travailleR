<!DOCTYPE html>
<html lang="fr-FR">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Shiny | Travailler avec R</title>
<meta name="author" content="Eric Marcon">
<meta name="description" content="Shiny permet de publier sous la forme d’un site web une application interactive utilisant du code R. Le site peut fonctionner localement, sur le poste de travail d’un utilisateur qui le lance à...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="7 Shiny | Travailler avec R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ericmarcon.github.io/travailleR/chap-shiny.html">
<meta property="og:description" content="Shiny permet de publier sous la forme d’un site web une application interactive utilisant du code R. Le site peut fonctionner localement, sur le poste de travail d’un utilisateur qui le lance à...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Shiny | Travailler avec R">
<meta name="twitter:description" content="Shiny permet de publier sous la forme d’un site web une application interactive utilisant du code R. Le site peut fonctionner localement, sur le poste de travail d’un utilisateur qui le lance à...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7NVD1TWMCJ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7NVD1TWMCJ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Travailler avec R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Présentation</a></li>
<li><a class="" href="chap-logiciels.html"><span class="header-section-number">1</span> Logiciels</a></li>
<li><a class="" href="chap-utiliseR.html"><span class="header-section-number">2</span> Utiliser R</a></li>
<li><a class="" href="chap-git.html"><span class="header-section-number">3</span> Git et GitHub</a></li>
<li><a class="" href="chap-rediger.html"><span class="header-section-number">4</span> Rédiger</a></li>
<li><a class="" href="chap-package.html"><span class="header-section-number">5</span> Package</a></li>
<li><a class="" href="chap-ci.html"><span class="header-section-number">6</span> Intégration continue</a></li>
<li><a class="active" href="chap-shiny.html"><span class="header-section-number">7</span> Shiny</a></li>
<li><a class="" href="chap-enseigner.html"><span class="header-section-number">8</span> Enseigner avec R</a></li>
<li><a class="" href="chap-conclusion.html"><span class="header-section-number">9</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/EricMarcon/travailleR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-shiny" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Shiny<a class="anchor" aria-label="anchor" href="#chap-shiny"><i class="fas fa-link"></i></a>
</h1>
<p>Shiny permet de publier sous la forme d’un site web une application interactive utilisant du code R.
Le site peut fonctionner localement, sur le poste de travail d’un utilisateur qui le lance à partir de RStudio, ou en ligne, sur un serveur dédié exécutant Shiny Server<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://rstudio.com/products/shiny/download-server/" class="uri"&gt;https://rstudio.com/products/shiny/download-server/&lt;/a&gt;&lt;/p&gt;'><sup>119</sup></a>.</p>
<p>De façon basique, un formulaire permet de saisir les arguments d’un fonction et une fenêtre de visualisation d’afficher les résultats du calcul.</p>
<p>L’utilisation d’une application Shiny rend très simple l’exécution du code, y compris pour des utilisateurs étrangers à R, mais limite évidemment les possibilités.</p>
<div id="première-application" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Première application<a class="anchor" aria-label="anchor" href="#premi%C3%A8re-application"><i class="fas fa-link"></i></a>
</h2>
<p>Dans RStudio, créer une application avec le menu “File &gt; New File &gt; Shiny Web App…”, saisir le nom de l’application “MonAppShiny” et sélectionner le dossier où la placer.</p>
<p>Le nom de l’application a servi à créer un dossier qu’il faut maintenant transformer en projet (menu des projets en haut à droite de RStudio, “New Project &gt; Existing Directory”, sélectionner le dossier de l’application).</p>
<p>Le fichier de l’application nommé <code>app.R</code> contient deux fonctions : <code>ui()</code> qui définit l’interface graphique et <code>server()</code> qui contient le code R à exécuter.
L’application peut être lancée en cliquant sur “Run App” dans la fenêtre du code.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shiny-geiser"></span>
<img src="images/shiny-geiser.png" alt="Application Shiny Old Faithful Geyser Data." width="80%"><p class="caption">
Figure 7.1: Application Shiny <em>Old Faithful Geyser Data</em>.
</p>
</div>
<p></p>
<p>La correspondance entre la fenêtre affichée (figure <a href="chap-shiny.html#fig:shiny-geiser">7.1</a>) et le code de la fonction <code>ui()</code> est simple à voir :</p>
<ul>
<li>le titre de l’application est affiché par la fonction <code>titlePanel()</code><span style="white-space:nowrap"> ;</span>
</li>
<li>le curseur qui fixe le nombre de barres de l’histogramme est créé par <code>sliderInput()</code><span style="white-space:nowrap"> ;</span>
</li>
<li>la fonction <code>sidebarLayout()</code> fixe la disposition des éléments de la page, <code>sidebarPanel</code> pour les contrôles de saisie et <code>mainPanel()</code> pour l’affichage du résultat.</li>
</ul>
<p>Le résultat est affiché par la fonction <code>plotOutput()</code> dont l’argument est le nom d’un élément de <code>output</code>, la variable remplie par la fonction <code>server()</code>.</p>
<p>Toute modification d’un élément de l’interface, précisément d’un élément affiché par une fonction dont le nom se termine par <code>Input()</code> (il en existe pour tous les types d’entrées, par exemple <code>textInput()</code>) de <strong>Shiny</strong> provoque l’exécution de <code>server()</code> et la mise à jour des éléments de <code>output</code>.</p>
</div>
<div id="application-plus-élaborée" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Application plus élaborée<a class="anchor" aria-label="anchor" href="#application-plus-%C3%A9labor%C3%A9e"><i class="fas fa-link"></i></a>
</h2>
<div id="méthode-de-travail" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Méthode de travail<a class="anchor" aria-label="anchor" href="#m%C3%A9thode-de-travail"><i class="fas fa-link"></i></a>
</h3>
<p>Une application est créée en choisissant :</p>
<ul>
<li>une disposition de la fenêtre (<em>layout</em><span style="white-space:nowrap">) ;</span>
</li>
<li>les contrôles de saisie des paramètres (<em>intput</em><span style="white-space:nowrap">) ;</span>
</li>
<li>les contrôles d’affichage des résultats (<em>output</em>).</li>
</ul>
<p>Le code pour traiter les entrées et produire les sorties est ensuite écrit dans <code>server()</code>.</p>
<p>Le tutoriel de RStudio<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://shiny.rstudio.com/tutorial/" class="uri"&gt;https://shiny.rstudio.com/tutorial/&lt;/a&gt;&lt;/p&gt;'><sup>120</sup></a> est très détaillé et doit être utilisé pour aller plus loin.</p>
</div>
<div id="exemple" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Exemple<a class="anchor" aria-label="anchor" href="#exemple"><i class="fas fa-link"></i></a>
</h3>
<p>Cette application simple utilise le package <strong>scholar</strong> pour interroger Google Scholar et obtenir les données bibliométriques d’un auteur à partir de son identifiant.</p>
<p>Le fichier <code>app.R</code> contient tout le code et est construit progressivement ici.
L’application complète, avec des sorties graphiques en plus de sa version simplifiée présentée ici est disponible sur GitHub<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/EricMarcon/bibliometrics" class="uri"&gt;https://github.com/EricMarcon/bibliometrics&lt;/a&gt;&lt;/p&gt;'><sup>121</sup></a>.</p>
<p>Le début du code consiste à préparer l’exécution de l’application en chargeant les packages nécessaires :</p>
<p></p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare the application ####</span></span>
<span></span>
<span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://shiny.posit.co/">"shiny"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Le code de l’application complète intègre une fonction pour installer les packages manquants, à n’exécuter que quand l’application est exécutée sur un poste de travail (sur un serveur, la gestion des packages n’est pas du ressort de l’application).</p>
<p>L’interface utilisateur est la suivante :</p>
<p></p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># UI ####</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="co"># Application title</span></span>
<span>  <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Bibliometrics"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu">sidebarLayout</span><span class="op">(</span></span>
<span>    <span class="fu">sidebarPanel</span><span class="op">(</span></span>
<span>      <span class="fu">helpText</span><span class="op">(</span><span class="st">"Enter the Google Scholar ID of an author."</span><span class="op">)</span>,</span>
<span>      <span class="fu">textInput</span><span class="op">(</span><span class="st">"AuthorID"</span>, <span class="st">"Google Scholar ID"</span>, <span class="st">"4iLBmbUAAAAJ"</span><span class="op">)</span>,</span>
<span>      <span class="co"># End of input</span></span>
<span>      <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="co"># Display author's name and h</span></span>
<span>      <span class="fu">uiOutput</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>      <span class="fu">uiOutput</span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Show plots in the main panel</span></span>
<span>    <span class="fu">mainPanel</span><span class="op">(</span></span>
<span>      <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"network"</span><span class="op">)</span>,</span>
<span>      <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"citations"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>La fenêtre de l’application est fluide, c’est-à-dire qu’elle se réorganise seule quand sa taille varie, et est composée d’un panneau latéral (pour la saisie et l’affichage de texte) et d’un panneau principal, pour l’affichage de graphiques.</p>
<p>Les éléments du panneau latéral sont :</p>
<ul>
<li>un texte d’aide : <code>helpText()</code><span style="white-space:nowrap"> ;</span>
</li>
<li>un champ de texte à saisir, <code>textInput()</code>, dont les arguments sont le nom, le texte affiché, et la valeur par défaut (l’identifiant d’un <span style="white-space:nowrap">auteur) ;</span>
</li>
<li>un saut de ligne : <code>br()</code><span style="white-space:nowrap"> ;</span>
</li>
<li>des contrôles de sortie au format HTML : <code>uiOutput()</code>, dont l’argument unique est le nom.</li>
</ul>
<p>Le panneau principal contient deux contrôles de sortie graphiques, <code>plotOutput()</code> dont l’argument est aussi le nom.</p>
<p>Le code à exécuter pour traiter les entrées et produire les sorties est dans la fonction <code>server()</code>.</p>
<p></p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Server logic ####</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Run the get_profile function only once ####</span></span>
<span>  <span class="co"># Store the author profile</span></span>
<span>  <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu">reactiveVal</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># Update it when input$AuthorID is changed</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span>, </span>
<span>    <span class="fu">AuthorProfile</span><span class="op">(</span><span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Output ####</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">h2</span><span class="op">(</span><span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">a</span><span class="op">(</span>href <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"https://scholar.google.com/citations?user="</span>, </span>
<span>      <span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"h index:"</span>, <span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">h_index</span><span class="op">)</span>,</span>
<span>      target <span class="op">=</span> <span class="st">"_blank"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">citations</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">get_citation_history</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cites</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">year</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'darkgrey'</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Citations per year"</span>,</span>
<span>        caption <span class="op">=</span> <span class="st">"Source: Google Scholar"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">network</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_blank.html">geom_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Les informations nécessaires aux champs de sortie <code>$name</code> et <code>$h</code> (nom de l’auteur et indice h) sont obtenus par la fonction <code>get_profile()</code> du package <strong>scholar</strong>.
Cette fonction interroge la page web Google Scholar de l’auteur et extrait les valeurs du résultat : c’est une traitement lourd, qu’il vaut mieux n’exécuter qu’une seule fois plutôt que deux, dans les fonctions <code>renderUI()</code> chargées de calculer les valeurs de <code>output$h</code> et <code>output$name</code>.</p>
<p>Le code le plus simple pour le faire serait le suivant :</p>
<p></p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Run the get_profile function only once ####</span></span>
<span>  <span class="co"># Store the author profile</span></span>
<span>  <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>La difficulté de la programmation d’une application Shiny est que tout calcul se référant à un élément de l’interface d’entrée doit être <em>réactif</em>.
Si ce dernier code était exécuté, le message d’erreur suivant apparaît :
“Operation not allowed without an active reactive context. (You tried to do something that can only be done from inside a reactive expression or observer.)”.</p>
<p>En pratique, l’exécution du code est lancée par la modification d’un contrôle d’entrée (ici : <code>intput$AuthorID</code>).
Le code faisant référence à un de ces contrôles doit être en permanence en attente d’une modification : il doit donc placé dans des fonctions particulières comme <code>renderPlot()</code> dans l’application <em>Old Faithful Geyser Data</em> ou <code>renderUI()</code> ici.
Le code suivant s’exécuterait sans erreur :</p>
<p></p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Output ####</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span></span>
<span>    <span class="fu">h2</span><span class="op">(</span><span class="va">AuthorProfile</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>L’appel à la valeur du contrôle <code>input$AuthorID</code> a bien lieu dans une fonction réactive (mais <code>get_profile()</code> devrait être utilisé une deuxième fois dans le calcul de <code>output$h</code>, ce que nous voulons éviter).
La fonction <code>h2(AuthorProfile$name)</code> produit du code HTML, un paragraphe de titre de niveau 2 dont la valeur est passée en argument.</p>
<p>Toutes les fonctions dont le nom commence par <code>render</code> dans le package <strong>shiny</strong> sont réactives, et chacune est destinée à produire un type de sortie différent, par exemple du texte (<code>renderText()</code>) ou du code HTML (<code>renderUI()</code>).</p>
<p>Si du code est nécessaire pour calculer des variables communes à plusieurs contrôles de sortie (<code>output$name</code> et <code>output$h</code>), il doit lui-même être réactif.
Deux fonctions sont très utiles :</p>
<ul>
<li>
<code>observeEvent()</code> surveille les changements d’un contrôle d’entrée et exécute du code quand ils se <span style="white-space:nowrap">produisent ;</span>
</li>
<li>
<code>reactiveVal()</code> permet de définir une variable réactive, qui sera modifiée par le code de <code>observeEvent()</code> et entraînera à son tour l’exécution d’autres fonctions réactives qui utilisent sa valeur.</li>
</ul>
<p>Le code optimal crée donc une variable réactive pour y stocker le résultat de l’interrogation de Google Scholar :</p>
<p></p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Store the author profile</span></span>
<span>  <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu">reactiveVal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>La variable réactive est vide à ce stade.
Son utilisation est ensuite celle d’une fonction : <code>AuthorProfile(x)</code> lui attribue la valeur <code>x</code> et <code>AuthorProfile()</code>, sans argument, renvoie sa valeur.
La fonction <code>observeEvent()</code> est déclenchée quand <code>input$AuthorID</code> est modifié et exécute le code passé en deuxième argument, ici la mise à jour de <code>AuthorProfile</code>.</p>
<p></p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Update it when input$AuthorID is changed</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span>, <span class="fu">AuthorProfile</span><span class="op">(</span><span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Enfin, les fonctions <code>renderUI()</code> qui fournissent les valeurs des contrôles de sortie utilisent la valeur de <code>AuthorProfile</code> :</p>
<p></p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Output ####</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>     <span class="fu">h2</span><span class="op">(</span><span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Remarquer les parenthèses de <code>AuthorProfile()</code>, variable réactive, par opposition à la syntaxe <code>AuthorProfile$name</code> pour une variable classique.</p>
<p>La valeur de <code>output$h</code> est un lien internet, <code>&lt;a href=...</code> en HTML, écrit par la fonction <code>a()</code> du package <strong>htmltools</strong> utilisé par <code>renderUI()</code>.</p>
<p></p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">output</span><span class="op">$</span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">a</span><span class="op">(</span>href <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"https://scholar.google.com/citations?user="</span>, <span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"h index:"</span>, <span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">h_index</span><span class="op">)</span>,</span>
<span>      target <span class="op">=</span> <span class="st">"_blank"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Le lien est vers la page Google Scholar de l’auteur.
La valeur affichée est son indice h.
L’argument <code>target = "_blank"</code> indique que le lien doit être ouvert dans une nouvelle fenêtre du navigateur.</p>
<p>Le graphique <code>output$citations</code> est créé par la fonction réactive <code>renderPlot()</code>.
Les données fournies par la fonction <code>get_citation_history()</code> de <strong>scholar</strong> (qui interroge l’API de Google Scholar) sont traitées par <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<p>Enfin, le graphique <code>output$network</code> est un graphique vide dans cette version simplifiée de l’application.</p>
<p>L’application complète reprend ce code en y ajoutant le traitement des erreurs dans le cas où le code de l’auteur n’existe par sur Google Scholar et le graphique du réseau des co-auteurs.</p>
</div>
</div>
<div id="sec:hebergement-shiny" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Hébergement<a class="anchor" aria-label="anchor" href="#sec:hebergement-shiny"><i class="fas fa-link"></i></a>
</h2>
<p>Une application Shiny n’est pas forcément hébergée par un serveur web : elle peut être exécutée sur les postes de travail des utilisateurs s’ils disposent de R.</p>
<p>Pour un usage plus large, un serveur dédié est nécessaire.
Shinyapps.io<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.shinyapps.io/" class="uri"&gt;https://www.shinyapps.io/&lt;/a&gt;&lt;/p&gt;'><sup>122</sup></a> est un service de RStudio qui permet d’héberger gratuitement 5 applications Shiny avec un temps de fonctionnement maximal de 5 heures par mois.</p>
<p>Il faut tout d’abord ouvrir un compte sur le site, de préférence avec ses identifiants GitHub.
Pour permettre la gestion des applications en ligne directement depuis RStudio, il faut installer ensuite le package <strong>rsconnect</strong> et le paramétrer :</p>
<p></p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rsconnect</span><span class="fu">::</span><span class="fu">setAccountInfo</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'prenom.nom'</span>,</span>
<span>    token <span class="op">=</span> <span class="st">'xxx'</span>,</span>
<span>    secret <span class="op">=</span> <span class="st">'&lt;SECRET&gt;'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Le code exact, avec le nom d’utilisateur et le jeton à utiliser, sont affichés sur la page d’accueil de Shinyapps.io : cliquer sur “Show Secret”, copier le code et le coller dans la console de RStudio pour l’exécuter.
Un bouton “Publish” est disponible juste à droite du bouton “Run App”.
Cliquer dessus et valider la publication (figure <a href="chap-shiny.html#fig:shiny-publish">7.2</a>).</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shiny-publish"></span>
<img src="images/shiny-publish.png" alt="Publication de l’application Shiny sur Shinyapps.io." width="80%"><p class="caption">
Figure 7.2: Publication de l’application Shiny sur Shinyapps.io.
</p>
</div>
<p></p>
<p>L’application est maintenant accessible à l’adresse <a href="https://prenom-nom.shinyapps.io/MonAppShiny/" class="uri">https://prenom-nom.shinyapps.io/MonAppShiny/</a></p>
<p>L’application “Bibliometrics” ne fonctionne pas sur Shinyapps.io parce que la façon dont le package <strong>Scholar</strong> interroge Google Scholar n’est pas supportée.
La plupart des applications Shiny fonctionnent sans difficulté, tant qu’elles ne nécessitent pas de fonctionnalités réseau complexes.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-ci.html"><span class="header-section-number">6</span> Intégration continue</a></div>
<div class="next"><a href="chap-enseigner.html"><span class="header-section-number">8</span> Enseigner avec R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-shiny"><span class="header-section-number">7</span> Shiny</a></li>
<li><a class="nav-link" href="#premi%C3%A8re-application"><span class="header-section-number">7.1</span> Première application</a></li>
<li>
<a class="nav-link" href="#application-plus-%C3%A9labor%C3%A9e"><span class="header-section-number">7.2</span> Application plus élaborée</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#m%C3%A9thode-de-travail"><span class="header-section-number">7.2.1</span> Méthode de travail</a></li>
<li><a class="nav-link" href="#exemple"><span class="header-section-number">7.2.2</span> Exemple</a></li>
</ul>
</li>
<li><a class="nav-link" href="#sec:hebergement-shiny"><span class="header-section-number">7.3</span> Hébergement</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/EricMarcon/travailleR/blob/master/07-Shiny.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/EricMarcon/travailleR/edit/master/07-Shiny.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Travailler avec R</strong>" was written by Eric Marcon. It was last built on 26/06/2025.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
