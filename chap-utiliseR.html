<!DOCTYPE html>
<html lang="fr-FR" xml:lang="fr-FR">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Utiliser R | Travailler avec R</title>
  <meta name="description" content="Organisation du travail autour de R et RStudio" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Utiliser R | Travailler avec R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Organisation du travail autour de R et RStudio" />
  <meta name="github-repo" content="EricMarcon/travailleR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Utiliser R | Travailler avec R" />
  
  <meta name="twitter:description" content="Organisation du travail autour de R et RStudio" />
  

<meta name="author" content="Eric Marcon" />


<meta name="date" content="2022-10-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chap-logiciels.html"/>
<link rel="next" href="chap-git.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<link href="libs/tabwid-1.0.0/scrool.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7NVD1TWMCJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7NVD1TWMCJ');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Travailler avec R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#objectifs"><i class="fa fa-check"></i>Objectifs</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-logiciels.html"><a href="chap-logiciels.html"><i class="fa fa-check"></i><b>1</b> Logiciels</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#r"><i class="fa fa-check"></i><b>1.1</b> R</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation"><i class="fa fa-check"></i><b>1.1.1</b> Installation</a></li>
<li class="chapter" data-level="1.1.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#rtools"><i class="fa fa-check"></i><b>1.1.2</b> Rtools</a></li>
<li class="chapter" data-level="1.1.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#mise-à-jour"><i class="fa fa-check"></i><b>1.1.3</b> Mise à jour</a></li>
<li class="chapter" data-level="1.1.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:librairies"><i class="fa fa-check"></i><b>1.1.4</b> Librairies</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-1"><i class="fa fa-check"></i><b>1.2.1</b> Installation</a></li>
<li class="chapter" data-level="1.2.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#encodage-des-fichiers"><i class="fa fa-check"></i><b>1.2.2</b> Encodage des fichiers</a></li>
<li class="chapter" data-level="1.2.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#dossier-de-travail"><i class="fa fa-check"></i><b>1.2.3</b> Dossier de travail</a></li>
<li class="chapter" data-level="1.2.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:solution-dossiers"><i class="fa fa-check"></i><b>1.2.4</b> Solution retenue</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#packages"><i class="fa fa-check"></i><b>1.3</b> Packages</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-depuis-cran"><i class="fa fa-check"></i><b>1.3.1</b> Installation depuis CRAN</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-depuis-github"><i class="fa fa-check"></i><b>1.3.2</b> Installation depuis GitHub</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-depuis-bioconductor"><i class="fa fa-check"></i><b>1.3.3</b> Installation depuis Bioconductor</a></li>
<li class="chapter" data-level="1.3.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#solution-retenue"><i class="fa fa-check"></i><b>1.3.4</b> Solution retenue</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#git-et-github"><i class="fa fa-check"></i><b>1.4</b> git et GitHub</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#git"><i class="fa fa-check"></i><b>1.4.1</b> git</a></li>
<li class="chapter" data-level="1.4.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#github"><i class="fa fa-check"></i><b>1.4.2</b> GitHub</a></li>
<li class="chapter" data-level="1.4.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:SSH"><i class="fa fa-check"></i><b>1.4.3</b> Authentification SSH</a></li>
<li class="chapter" data-level="1.4.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:pat"><i class="fa fa-check"></i><b>1.4.4</b> Obtention d’un jeton d’accès personnel</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="chap-logiciels.html"><a href="chap-logiciels.html#compilateur-latex"><i class="fa fa-check"></i><b>1.5</b> Compilateur LaTeX</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#tinytex"><i class="fa fa-check"></i><b>1.5.1</b> tinytex</a></li>
<li class="chapter" data-level="1.5.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#miktex"><i class="fa fa-check"></i><b>1.5.2</b> MiKTeX</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:Zotero"><i class="fa fa-check"></i><b>1.6</b> Zotero</a></li>
<li class="chapter" data-level="1.7" data-path="chap-logiciels.html"><a href="chap-logiciels.html#go"><i class="fa fa-check"></i><b>1.7</b> Go</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html"><i class="fa fa-check"></i><b>2</b> Utiliser R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#les-langages-de-r"><i class="fa fa-check"></i><b>2.1</b> Les langages de R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#base"><i class="fa fa-check"></i><b>2.1.1</b> Base</a></li>
<li class="chapter" data-level="2.1.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:S3"><i class="fa fa-check"></i><b>2.1.2</b> S3</a></li>
<li class="chapter" data-level="2.1.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#s4"><i class="fa fa-check"></i><b>2.1.3</b> S4</a></li>
<li class="chapter" data-level="2.1.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#rc"><i class="fa fa-check"></i><b>2.1.4</b> RC</a></li>
<li class="chapter" data-level="2.1.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#s6"><i class="fa fa-check"></i><b>2.1.5</b> S6</a></li>
<li class="chapter" data-level="2.1.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#tidyverse"><i class="fa fa-check"></i><b>2.1.6</b> Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:environnements"><i class="fa fa-check"></i><b>2.2</b> Environnements</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#organisation"><i class="fa fa-check"></i><b>2.2.1</b> Organisation</a></li>
<li class="chapter" data-level="2.2.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#recherche"><i class="fa fa-check"></i><b>2.2.2</b> Recherche</a></li>
<li class="chapter" data-level="2.2.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#espaces-de-nom-des-packages"><i class="fa fa-check"></i><b>2.2.3</b> Espaces de nom des packages</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#mesure-du-temps-dexécution"><i class="fa fa-check"></i><b>2.3</b> Mesure du temps d’exécution</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#system.time"><i class="fa fa-check"></i><b>2.3.1</b> system.time</a></li>
<li class="chapter" data-level="2.3.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#microbenchmark"><i class="fa fa-check"></i><b>2.3.2</b> microbenchmark</a></li>
<li class="chapter" data-level="2.3.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#profilage"><i class="fa fa-check"></i><b>2.3.3</b> Profilage</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucles"><i class="fa fa-check"></i><b>2.4</b> Boucles</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#fonctions-vectorielles"><i class="fa fa-check"></i><b>2.4.1</b> Fonctions vectorielles</a></li>
<li class="chapter" data-level="2.4.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#lapply"><i class="fa fa-check"></i><b>2.4.2</b> lapply</a></li>
<li class="chapter" data-level="2.4.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucles-for"><i class="fa fa-check"></i><b>2.4.3</b> Boucles for</a></li>
<li class="chapter" data-level="2.4.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#replicate"><i class="fa fa-check"></i><b>2.4.4</b> replicate</a></li>
<li class="chapter" data-level="2.4.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#vectorize"><i class="fa fa-check"></i><b>2.4.5</b> Vectorize</a></li>
<li class="chapter" data-level="2.4.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#statistiques-marginales"><i class="fa fa-check"></i><b>2.4.6</b> Statistiques marginales</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:cpp"><i class="fa fa-check"></i><b>2.5</b> Code C++</a></li>
<li class="chapter" data-level="2.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#paralléliser-r"><i class="fa fa-check"></i><b>2.6</b> Paralléliser R</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#mclapply-fork"><i class="fa fa-check"></i><b>2.6.1</b> mclapply (fork)</a></li>
<li class="chapter" data-level="2.6.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#parlapply-socket"><i class="fa fa-check"></i><b>2.6.2</b> parLapply (socket)</a></li>
<li class="chapter" data-level="2.6.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#foreach"><i class="fa fa-check"></i><b>2.6.3</b> foreach</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:cas"><i class="fa fa-check"></i><b>2.7</b> Etude de cas</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#création-des-données"><i class="fa fa-check"></i><b>2.7.1</b> Création des données</a></li>
<li class="chapter" data-level="2.7.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#spatstat"><i class="fa fa-check"></i><b>2.7.2</b> Spatstat</a></li>
<li class="chapter" data-level="2.7.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#apply"><i class="fa fa-check"></i><b>2.7.3</b> apply</a></li>
<li class="chapter" data-level="2.7.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucle-for"><i class="fa fa-check"></i><b>2.7.4</b> boucle for</a></li>
<li class="chapter" data-level="2.7.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucle-foreach"><i class="fa fa-check"></i><b>2.7.5</b> boucle foreach</a></li>
<li class="chapter" data-level="2.7.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#rcpp"><i class="fa fa-check"></i><b>2.7.6</b> RCpp</a></li>
<li class="chapter" data-level="2.7.7" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#rcppparallel"><i class="fa fa-check"></i><b>2.7.7</b> RcppParallel</a></li>
<li class="chapter" data-level="2.7.8" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#conclusions-sur-loptimisation-de-la-vitesse-du-code"><i class="fa fa-check"></i><b>2.7.8</b> Conclusions sur l’optimisation de la vitesse du code</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:targets"><i class="fa fa-check"></i><b>2.8</b> Flux de travail</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#principe-de-fonctionnement"><i class="fa fa-check"></i><b>2.8.1</b> Principe de fonctionnement</a></li>
<li class="chapter" data-level="2.8.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#exemple-minimal"><i class="fa fa-check"></i><b>2.8.2</b> Exemple minimal</a></li>
<li class="chapter" data-level="2.8.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#intérêt-pratique"><i class="fa fa-check"></i><b>2.8.3</b> Intérêt pratique</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-git.html"><a href="chap-git.html"><i class="fa fa-check"></i><b>3</b> Git et GitHub</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chap-git.html"><a href="chap-git.html#sec:principes-git"><i class="fa fa-check"></i><b>3.1</b> Principes</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="chap-git.html"><a href="chap-git.html#sec:git-cds"><i class="fa fa-check"></i><b>3.1.1</b> Contrôle de source</a></li>
<li class="chapter" data-level="3.1.2" data-path="chap-git.html"><a href="chap-git.html#git-et-github-1"><i class="fa fa-check"></i><b>3.1.2</b> git et GitHub</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chap-git.html"><a href="chap-git.html#sec:creerdepot"><i class="fa fa-check"></i><b>3.2</b> Créer un nouveau dépôt</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chap-git.html"><a href="chap-git.html#a-partir-dun-projet-existant"><i class="fa fa-check"></i><b>3.2.1</b> A partir d’un projet existant</a></li>
<li class="chapter" data-level="3.2.2" data-path="chap-git.html"><a href="chap-git.html#prendre-en-compte-des-fichiers"><i class="fa fa-check"></i><b>3.2.2</b> Prendre en compte des fichiers</a></li>
<li class="chapter" data-level="3.2.3" data-path="chap-git.html"><a href="chap-git.html#valider-des-modifications"><i class="fa fa-check"></i><b>3.2.3</b> Valider des modifications</a></li>
<li class="chapter" data-level="3.2.4" data-path="chap-git.html"><a href="chap-git.html#créer-un-dépôt-vide-sur-github"><i class="fa fa-check"></i><b>3.2.4</b> Créer un dépôt vide sur GitHub</a></li>
<li class="chapter" data-level="3.2.5" data-path="chap-git.html"><a href="chap-git.html#lier-git-et-github"><i class="fa fa-check"></i><b>3.2.5</b> Lier git et GitHub</a></li>
<li class="chapter" data-level="3.2.6" data-path="chap-git.html"><a href="chap-git.html#pousser-les-premières-modifications"><i class="fa fa-check"></i><b>3.2.6</b> Pousser les premières modifications</a></li>
<li class="chapter" data-level="3.2.7" data-path="chap-git.html"><a href="chap-git.html#cloner-un-dépôt-de-github"><i class="fa fa-check"></i><b>3.2.7</b> Cloner un dépôt de GitHub</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chap-git.html"><a href="chap-git.html#usage-courant"><i class="fa fa-check"></i><b>3.3</b> Usage courant</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chap-git.html"><a href="chap-git.html#tirer-modifier-valider-pousser"><i class="fa fa-check"></i><b>3.3.1</b> Tirer, modifier, valider, pousser</a></li>
<li class="chapter" data-level="3.3.2" data-path="chap-git.html"><a href="chap-git.html#régler-les-conflits"><i class="fa fa-check"></i><b>3.3.2</b> Régler les conflits</a></li>
<li class="chapter" data-level="3.3.3" data-path="chap-git.html"><a href="chap-git.html#voir-les-différences"><i class="fa fa-check"></i><b>3.3.3</b> Voir les différences</a></li>
<li class="chapter" data-level="3.3.4" data-path="chap-git.html"><a href="chap-git.html#revenir-en-arrière"><i class="fa fa-check"></i><b>3.3.4</b> Revenir en arrière</a></li>
<li class="chapter" data-level="3.3.5" data-path="chap-git.html"><a href="chap-git.html#voir-lhistorique"><i class="fa fa-check"></i><b>3.3.5</b> Voir l’historique</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chap-git.html"><a href="chap-git.html#sec:branches"><i class="fa fa-check"></i><b>3.4</b> Branches</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chap-git.html"><a href="chap-git.html#créer-une-nouvelle-branche"><i class="fa fa-check"></i><b>3.4.1</b> Créer une nouvelle branche</a></li>
<li class="chapter" data-level="3.4.2" data-path="chap-git.html"><a href="chap-git.html#changer-de-branche"><i class="fa fa-check"></i><b>3.4.2</b> Changer de branche</a></li>
<li class="chapter" data-level="3.4.3" data-path="chap-git.html"><a href="chap-git.html#pousser-la-nouvelle-branche"><i class="fa fa-check"></i><b>3.4.3</b> Pousser la nouvelle branche</a></li>
<li class="chapter" data-level="3.4.4" data-path="chap-git.html"><a href="chap-git.html#comportement-du-système-de-fichier"><i class="fa fa-check"></i><b>3.4.4</b> Comportement du système de fichier</a></li>
<li class="chapter" data-level="3.4.5" data-path="chap-git.html"><a href="chap-git.html#fusionner-avec-merge"><i class="fa fa-check"></i><b>3.4.5</b> Fusionner avec <code>merge</code></a></li>
<li class="chapter" data-level="3.4.6" data-path="chap-git.html"><a href="chap-git.html#fusionner-avec-une-requête-de-tirage"><i class="fa fa-check"></i><b>3.4.6</b> Fusionner avec une requête de tirage</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="chap-git.html"><a href="chap-git.html#usage-avancé"><i class="fa fa-check"></i><b>3.5</b> Usage avancé</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="chap-git.html"><a href="chap-git.html#commandes-de-git"><i class="fa fa-check"></i><b>3.5.1</b> Commandes de git</a></li>
<li class="chapter" data-level="3.5.2" data-path="chap-git.html"><a href="chap-git.html#taille-dun-dépôt"><i class="fa fa-check"></i><b>3.5.2</b> Taille d’un dépôt</a></li>
<li class="chapter" data-level="3.5.3" data-path="chap-git.html"><a href="chap-git.html#supprimer-un-dossier"><i class="fa fa-check"></i><b>3.5.3</b> Supprimer un dossier</a></li>
<li class="chapter" data-level="3.5.4" data-path="chap-git.html"><a href="chap-git.html#revenir-en-arrière-1"><i class="fa fa-check"></i><b>3.5.4</b> Revenir en arrière</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="chap-git.html"><a href="chap-git.html#sec:confidentiel"><i class="fa fa-check"></i><b>3.6</b> Données confidentielles dans un dépôt public</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="chap-git.html"><a href="chap-git.html#génération-dune-paire-de-clés-pour-le-propriétaire-du-projet"><i class="fa fa-check"></i><b>3.6.1</b> Génération d’une paire de clés pour le propriétaire du projet</a></li>
<li class="chapter" data-level="3.6.2" data-path="chap-git.html"><a href="chap-git.html#génération-dune-paire-de-clés-pour-le-projet"><i class="fa fa-check"></i><b>3.6.2</b> Génération d’une paire de clés pour le projet</a></li>
<li class="chapter" data-level="3.6.3" data-path="chap-git.html"><a href="chap-git.html#création-dun-coffre-fort"><i class="fa fa-check"></i><b>3.6.3</b> Création d’un coffre-fort</a></li>
<li class="chapter" data-level="3.6.4" data-path="chap-git.html"><a href="chap-git.html#ajout-des-utilisateurs"><i class="fa fa-check"></i><b>3.6.4</b> Ajout des utilisateurs</a></li>
<li class="chapter" data-level="3.6.5" data-path="chap-git.html"><a href="chap-git.html#stockage-des-données"><i class="fa fa-check"></i><b>3.6.5</b> Stockage des données</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="chap-git.html"><a href="chap-git.html#sec:github-pages"><i class="fa fa-check"></i><b>3.7</b> Pages GitHub</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="chap-git.html"><a href="chap-git.html#activation"><i class="fa fa-check"></i><b>3.7.1</b> Activation</a></li>
<li class="chapter" data-level="3.7.2" data-path="chap-git.html"><a href="chap-git.html#badges"><i class="fa fa-check"></i><b>3.7.2</b> Badges</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-rediger.html"><a href="chap-rediger.html"><i class="fa fa-check"></i><b>4</b> Rédiger</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chap-rediger.html"><a href="chap-rediger.html#bloc-note-markdown-r-notebook"><i class="fa fa-check"></i><b>4.1</b> Bloc-note Markdown (R Notebook)</a></li>
<li class="chapter" data-level="4.2" data-path="chap-rediger.html"><a href="chap-rediger.html#modèles-r-markdown"><i class="fa fa-check"></i><b>4.2</b> Modèles R Markdown</a></li>
<li class="chapter" data-level="4.3" data-path="chap-rediger.html"><a href="chap-rediger.html#articles-avec-bookdown"><i class="fa fa-check"></i><b>4.3</b> Articles avec bookdown</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="chap-rediger.html"><a href="chap-rediger.html#ecrire"><i class="fa fa-check"></i><b>4.3.1</b> Ecrire</a></li>
<li class="chapter" data-level="4.3.2" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:memo"><i class="fa fa-check"></i><b>4.3.2</b> Modèle Simple Article</a></li>
<li class="chapter" data-level="4.3.3" data-path="chap-rediger.html"><a href="chap-rediger.html#autres-modèles"><i class="fa fa-check"></i><b>4.3.3</b> Autres modèles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chap-rediger.html"><a href="chap-rediger.html#présentation-beamer"><i class="fa fa-check"></i><b>4.4</b> Présentation Beamer</a></li>
<li class="chapter" data-level="4.5" data-path="chap-rediger.html"><a href="chap-rediger.html#memoir"><i class="fa fa-check"></i><b>4.5</b> memoir</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="chap-rediger.html"><a href="chap-rediger.html#créer-1"><i class="fa fa-check"></i><b>4.5.1</b> Créer</a></li>
<li class="chapter" data-level="4.5.2" data-path="chap-rediger.html"><a href="chap-rediger.html#ecrire-2"><i class="fa fa-check"></i><b>4.5.2</b> Ecrire</a></li>
<li class="chapter" data-level="4.5.3" data-path="chap-rediger.html"><a href="chap-rediger.html#tricoter-1"><i class="fa fa-check"></i><b>4.5.3</b> Tricoter</a></li>
<li class="chapter" data-level="4.5.4" data-path="chap-rediger.html"><a href="chap-rediger.html#finitions"><i class="fa fa-check"></i><b>4.5.4</b> Finitions</a></li>
<li class="chapter" data-level="4.5.5" data-path="chap-rediger.html"><a href="chap-rediger.html#site-gitbook"><i class="fa fa-check"></i><b>4.5.5</b> Site gitbook</a></li>
<li class="chapter" data-level="4.5.6" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:rediger-ouvrage-ci"><i class="fa fa-check"></i><b>4.5.6</b> Intégration continue</a></li>
<li class="chapter" data-level="4.5.7" data-path="chap-rediger.html"><a href="chap-rediger.html#google-analytics"><i class="fa fa-check"></i><b>4.5.7</b> Google Analytics</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="chap-rediger.html"><a href="chap-rediger.html#site-web-r-markdown"><i class="fa fa-check"></i><b>4.6</b> Site web R Markdown</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="chap-rediger.html"><a href="chap-rediger.html#modèle"><i class="fa fa-check"></i><b>4.6.1</b> Modèle</a></li>
<li class="chapter" data-level="4.6.2" data-path="chap-rediger.html"><a href="chap-rediger.html#améliorations"><i class="fa fa-check"></i><b>4.6.2</b> Améliorations</a></li>
<li class="chapter" data-level="4.6.3" data-path="chap-rediger.html"><a href="chap-rediger.html#contôle-de-source"><i class="fa fa-check"></i><b>4.6.3</b> Contôle de source</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:blogdown"><i class="fa fa-check"></i><b>4.7</b> Site web personnel : blogdown</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="chap-rediger.html"><a href="chap-rediger.html#installation-des-outils"><i class="fa fa-check"></i><b>4.7.1</b> Installation des outils</a></li>
<li class="chapter" data-level="4.7.2" data-path="chap-rediger.html"><a href="chap-rediger.html#créer-2"><i class="fa fa-check"></i><b>4.7.2</b> Créer</a></li>
<li class="chapter" data-level="4.7.3" data-path="chap-rediger.html"><a href="chap-rediger.html#construction-du-site"><i class="fa fa-check"></i><b>4.7.3</b> Construction du site</a></li>
<li class="chapter" data-level="4.7.4" data-path="chap-rediger.html"><a href="chap-rediger.html#site-multilingue"><i class="fa fa-check"></i><b>4.7.4</b> Site multilingue</a></li>
<li class="chapter" data-level="4.7.5" data-path="chap-rediger.html"><a href="chap-rediger.html#paramétrer"><i class="fa fa-check"></i><b>4.7.5</b> Paramétrer</a></li>
<li class="chapter" data-level="4.7.6" data-path="chap-rediger.html"><a href="chap-rediger.html#ecrire-3"><i class="fa fa-check"></i><b>4.7.6</b> Ecrire</a></li>
<li class="chapter" data-level="4.7.7" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:rediger-web-ci"><i class="fa fa-check"></i><b>4.7.7</b> Intégration continue</a></li>
<li class="chapter" data-level="4.7.8" data-path="chap-rediger.html"><a href="chap-rediger.html#mises-à-jour-1"><i class="fa fa-check"></i><b>4.7.8</b> Mises à jour</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="chap-rediger.html"><a href="chap-rediger.html#exportation-de-figures"><i class="fa fa-check"></i><b>4.8</b> Exportation de figures</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="chap-rediger.html"><a href="chap-rediger.html#formats-vectoriels-et-raster"><i class="fa fa-check"></i><b>4.8.1</b> Formats vectoriels et raster</a></li>
<li class="chapter" data-level="4.8.2" data-path="chap-rediger.html"><a href="chap-rediger.html#fonctions"><i class="fa fa-check"></i><b>4.8.2</b> Fonctions</a></li>
<li class="chapter" data-level="4.8.3" data-path="chap-rediger.html"><a href="chap-rediger.html#package-ragg"><i class="fa fa-check"></i><b>4.8.3</b> Package ragg</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:targetsmd"><i class="fa fa-check"></i><b>4.9</b> Flux de travail</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="chap-rediger.html"><a href="chap-rediger.html#déclaration-du-flux"><i class="fa fa-check"></i><b>4.9.1</b> Déclaration du flux</a></li>
<li class="chapter" data-level="4.9.2" data-path="chap-rediger.html"><a href="chap-rediger.html#déclaration-des-cibles"><i class="fa fa-check"></i><b>4.9.2</b> Déclaration des cibles</a></li>
<li class="chapter" data-level="4.9.3" data-path="chap-rediger.html"><a href="chap-rediger.html#exécution-du-flux"><i class="fa fa-check"></i><b>4.9.3</b> Exécution du flux</a></li>
<li class="chapter" data-level="4.9.4" data-path="chap-rediger.html"><a href="chap-rediger.html#utilisation-des-résultats"><i class="fa fa-check"></i><b>4.9.4</b> Utilisation des résultats</a></li>
<li class="chapter" data-level="4.9.5" data-path="chap-rediger.html"><a href="chap-rediger.html#contrôle-de-source"><i class="fa fa-check"></i><b>4.9.5</b> Contrôle de source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-package.html"><a href="chap-package.html"><i class="fa fa-check"></i><b>5</b> Package</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chap-package.html"><a href="chap-package.html#premier-package"><i class="fa fa-check"></i><b>5.1</b> Premier package</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="chap-package.html"><a href="chap-package.html#création"><i class="fa fa-check"></i><b>5.1.1</b> Création</a></li>
<li class="chapter" data-level="5.1.2" data-path="chap-package.html"><a href="chap-package.html#première-fonction"><i class="fa fa-check"></i><b>5.1.2</b> Première fonction</a></li>
<li class="chapter" data-level="5.1.3" data-path="chap-package.html"><a href="chap-package.html#sec:package-cds"><i class="fa fa-check"></i><b>5.1.3</b> Contrôle de source</a></li>
<li class="chapter" data-level="5.1.4" data-path="chap-package.html"><a href="chap-package.html#package.r"><i class="fa fa-check"></i><b>5.1.4</b> package.R</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chap-package.html"><a href="chap-package.html#organisation-du-package"><i class="fa fa-check"></i><b>5.2</b> Organisation du package</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="chap-package.html"><a href="chap-package.html#sec:package-description"><i class="fa fa-check"></i><b>5.2.1</b> Fichier DESCRIPTION</a></li>
<li class="chapter" data-level="5.2.2" data-path="chap-package.html"><a href="chap-package.html#fichier-news.md"><i class="fa fa-check"></i><b>5.2.2</b> Fichier NEWS.md</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chap-package.html"><a href="chap-package.html#vignette"><i class="fa fa-check"></i><b>5.3</b> Vignette</a></li>
<li class="chapter" data-level="5.4" data-path="chap-package.html"><a href="chap-package.html#pkgdown"><i class="fa fa-check"></i><b>5.4</b> pkgdown</a></li>
<li class="chapter" data-level="5.5" data-path="chap-package.html"><a href="chap-package.html#code-spécifique-aux-packages"><i class="fa fa-check"></i><b>5.5</b> Code spécifique aux packages</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="chap-package.html"><a href="chap-package.html#importation-de-fonctions"><i class="fa fa-check"></i><b>5.5.1</b> Importation de fonctions</a></li>
<li class="chapter" data-level="5.5.2" data-path="chap-package.html"><a href="chap-package.html#méthodes-s3"><i class="fa fa-check"></i><b>5.5.2</b> Méthodes S3</a></li>
<li class="chapter" data-level="5.5.3" data-path="chap-package.html"><a href="chap-package.html#en-pratique"><i class="fa fa-check"></i><b>5.5.3</b> En pratique</a></li>
<li class="chapter" data-level="5.5.4" data-path="chap-package.html"><a href="chap-package.html#code-c"><i class="fa fa-check"></i><b>5.5.4</b> Code C++</a></li>
<li class="chapter" data-level="5.5.5" data-path="chap-package.html"><a href="chap-package.html#package-bien-rangé"><i class="fa fa-check"></i><b>5.5.5</b> Package bien rangé</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="chap-package.html"><a href="chap-package.html#bibliographie-1"><i class="fa fa-check"></i><b>5.6</b> Bibliographie</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="chap-package.html"><a href="chap-package.html#préparation"><i class="fa fa-check"></i><b>5.6.1</b> Préparation</a></li>
<li class="chapter" data-level="5.6.2" data-path="chap-package.html"><a href="chap-package.html#citations"><i class="fa fa-check"></i><b>5.6.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="chap-package.html"><a href="chap-package.html#données"><i class="fa fa-check"></i><b>5.7</b> Données</a></li>
<li class="chapter" data-level="5.8" data-path="chap-package.html"><a href="chap-package.html#tests-unitaires"><i class="fa fa-check"></i><b>5.8</b> Tests unitaires</a></li>
<li class="chapter" data-level="5.9" data-path="chap-package.html"><a href="chap-package.html#fichier-.gitignore"><i class="fa fa-check"></i><b>5.9</b> Fichier .gitignore</a></li>
<li class="chapter" data-level="5.10" data-path="chap-package.html"><a href="chap-package.html#sec:package-ci5"><i class="fa fa-check"></i><b>5.10</b> Intégration continue</a></li>
<li class="chapter" data-level="5.11" data-path="chap-package.html"><a href="chap-package.html#sec:package-cran"><i class="fa fa-check"></i><b>5.11</b> CRAN</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="chap-package.html"><a href="chap-package.html#test-du-package"><i class="fa fa-check"></i><b>5.11.1</b> Test du package</a></li>
<li class="chapter" data-level="5.11.2" data-path="chap-package.html"><a href="chap-package.html#soumission"><i class="fa fa-check"></i><b>5.11.2</b> Soumission</a></li>
<li class="chapter" data-level="5.11.3" data-path="chap-package.html"><a href="chap-package.html#maintenance"><i class="fa fa-check"></i><b>5.11.3</b> Maintenance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-ci.html"><a href="chap-ci.html"><i class="fa fa-check"></i><b>6</b> Intégration continue</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chap-ci.html"><a href="chap-ci.html#outils"><i class="fa fa-check"></i><b>6.1</b> Outils</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="chap-ci.html"><a href="chap-ci.html#github-actions"><i class="fa fa-check"></i><b>6.1.1</b> GitHub Actions</a></li>
<li class="chapter" data-level="6.1.2" data-path="chap-ci.html"><a href="chap-ci.html#codecov"><i class="fa fa-check"></i><b>6.1.2</b> Codecov</a></li>
<li class="chapter" data-level="6.1.3" data-path="chap-ci.html"><a href="chap-ci.html#github-pages"><i class="fa fa-check"></i><b>6.1.3</b> GitHub Pages</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chap-ci.html"><a href="chap-ci.html#principes"><i class="fa fa-check"></i><b>6.2</b> Principes</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="chap-ci.html"><a href="chap-ci.html#obtention-dun-jeton-daccès-personnel"><i class="fa fa-check"></i><b>6.2.1</b> Obtention d’un jeton d’accès personnel</a></li>
<li class="chapter" data-level="6.2.2" data-path="chap-ci.html"><a href="chap-ci.html#sec:secrets-ci"><i class="fa fa-check"></i><b>6.2.2</b> Secrets du projet</a></li>
<li class="chapter" data-level="6.2.3" data-path="chap-ci.html"><a href="chap-ci.html#activation-du-dépôt-sur-codecov"><i class="fa fa-check"></i><b>6.2.3</b> Activation du dépôt sur CodeCov</a></li>
<li class="chapter" data-level="6.2.4" data-path="chap-ci.html"><a href="chap-ci.html#scripter-les-actions-de-github"><i class="fa fa-check"></i><b>6.2.4</b> Scripter les actions de GitHub</a></li>
<li class="chapter" data-level="6.2.5" data-path="chap-ci.html"><a href="chap-ci.html#sec:confidentielCI"><i class="fa fa-check"></i><b>6.2.5</b> Données confidentielles dans un dépôt public</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="chap-ci.html"><a href="chap-ci.html#modèles-de-scripts"><i class="fa fa-check"></i><b>6.3</b> Modèles de scripts</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="chap-ci.html"><a href="chap-ci.html#sec:memoiR-ci"><i class="fa fa-check"></i><b>6.3.1</b> memoiR</a></li>
<li class="chapter" data-level="6.3.2" data-path="chap-ci.html"><a href="chap-ci.html#sec:bookdown-ci"><i class="fa fa-check"></i><b>6.3.2</b> Projet d’ouvrage</a></li>
<li class="chapter" data-level="6.3.3" data-path="chap-ci.html"><a href="chap-ci.html#articles-et-présentations"><i class="fa fa-check"></i><b>6.3.3</b> Articles et présentations</a></li>
<li class="chapter" data-level="6.3.4" data-path="chap-ci.html"><a href="chap-ci.html#sec:blogdown-ci"><i class="fa fa-check"></i><b>6.3.4</b> Site web blogdown</a></li>
<li class="chapter" data-level="6.3.5" data-path="chap-ci.html"><a href="chap-ci.html#sec:package-ci6"><i class="fa fa-check"></i><b>6.3.5</b> Packages R</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="chap-ci.html"><a href="chap-ci.html#sec:ci-badges"><i class="fa fa-check"></i><b>6.4</b> Ajouter des badges</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chap-shiny.html"><a href="chap-shiny.html"><i class="fa fa-check"></i><b>7</b> Shiny</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chap-shiny.html"><a href="chap-shiny.html#première-application"><i class="fa fa-check"></i><b>7.1</b> Première application</a></li>
<li class="chapter" data-level="7.2" data-path="chap-shiny.html"><a href="chap-shiny.html#application-plus-élaborée"><i class="fa fa-check"></i><b>7.2</b> Application plus élaborée</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="chap-shiny.html"><a href="chap-shiny.html#méthode-de-travail"><i class="fa fa-check"></i><b>7.2.1</b> Méthode de travail</a></li>
<li class="chapter" data-level="7.2.2" data-path="chap-shiny.html"><a href="chap-shiny.html#exemple"><i class="fa fa-check"></i><b>7.2.2</b> Exemple</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chap-shiny.html"><a href="chap-shiny.html#sec:hebergement-shiny"><i class="fa fa-check"></i><b>7.3</b> Hébergement</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chap-enseigner.html"><a href="chap-enseigner.html"><i class="fa fa-check"></i><b>8</b> Enseigner avec R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chap-enseigner.html"><a href="chap-enseigner.html#learnr"><i class="fa fa-check"></i><b>8.1</b> learnr</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="chap-enseigner.html"><a href="chap-enseigner.html#premier-tutoriel"><i class="fa fa-check"></i><b>8.1.1</b> Premier tutoriel</a></li>
<li class="chapter" data-level="8.1.2" data-path="chap-enseigner.html"><a href="chap-enseigner.html#diffusion"><i class="fa fa-check"></i><b>8.1.2</b> Diffusion</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="chap-enseigner.html"><a href="chap-enseigner.html#github-classrooms"><i class="fa fa-check"></i><b>8.2</b> GitHub Classrooms</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="chap-enseigner.html"><a href="chap-enseigner.html#inscription"><i class="fa fa-check"></i><b>8.2.1</b> Inscription</a></li>
<li class="chapter" data-level="8.2.2" data-path="chap-enseigner.html"><a href="chap-enseigner.html#organisations"><i class="fa fa-check"></i><b>8.2.2</b> Organisations</a></li>
<li class="chapter" data-level="8.2.3" data-path="chap-enseigner.html"><a href="chap-enseigner.html#nouvelle-salle-de-classe"><i class="fa fa-check"></i><b>8.2.3</b> Nouvelle salle de classe</a></li>
<li class="chapter" data-level="8.2.4" data-path="chap-enseigner.html"><a href="chap-enseigner.html#préparer-un-modèle-de-dépôt"><i class="fa fa-check"></i><b>8.2.4</b> Préparer un modèle de dépôt</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chap-conclusion.html"><a href="chap-conclusion.html"><i class="fa fa-check"></i><b>9</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li>
  <a href="https://github.com/EricMarcon/travailleR" target="blank">
    Hébergé sur GitHub, publié par bookdown
  </a>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Travailler avec R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap-utiliseR" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Utiliser R<a href="chap-utiliseR.html#chap-utiliseR" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>La documentation consacrée à l’apprentissage de R est florissante.
Les ouvrages suivants sont une sélection arbitraire mais utile pour progresser:</p>
<ul>
<li>L’<a href="https://juba.github.io/tidyverse/">Introduction à R et au tidyverse</a> <span class="citation">(<a href="#ref-Barnier2020" role="doc-biblioref">Barnier 2020</a>)</span> est un excellent cours de prise en main.</li>
<li><a href="http://adv-r.had.co.nz/">Advanced R</a> <span class="citation">(<a href="#ref-Wickham2014" role="doc-biblioref">Wickham 2014</a>)</span> est la référence pour maîtriser les subtilités du langage et bien comprendre le fonctionnement de R.</li>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a> <span class="citation">(<a href="#ref-Wickham2016" role="doc-biblioref">Wickham et Grolemund 2016</a>)</span> présente une méthode de travail complète, cohérente avec le tidyverse.</li>
<li>Enfin, <a href="https://csgillespie.github.io/efficientR/">Efficient R programming</a> <span class="citation">(<a href="#ref-Gillespie2016" role="doc-biblioref">Gillespie et Lovelace 2016</a>)</span> traite de l’optimisation du code.</li>
</ul>
<p>Quelques aspects avancés du codage sont vus ici.
Des précisions sur les différents langages de R sont utiles pour la création de packages.
Les environnements sont présentés ensuite, pour la bonne compréhension de la recherche des objets appelés par le code.
Enfin, l’optimisation des performances du code est traitée en détail (boucles, code C++ et parallélisation) et illustrée par une étude de cas.</p>
<div id="les-langages-de-r" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Les langages de R<a href="chap-utiliseR.html#les-langages-de-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R comprend plusieurs langages de programmation.
Le plus courant est S3, mais ce n’est pas le seul<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>.</p>
<div id="base" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Base<a href="chap-utiliseR.html#base" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Le cœur de R est constitué des fonctions primitives et structures de données de base comme la fonction <code>sum</code> et les données de type <code>matrix</code>:</p>
<p></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="chap-utiliseR.html#cb18-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(sum)</span></code></pre></div>
<pre><code>## [1] &quot;base&quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="chap-utiliseR.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(sum)</span></code></pre></div>
<pre><code>## [1] &quot;builtin&quot;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chap-utiliseR.html#cb22-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(<span class="fu">matrix</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;base&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="chap-utiliseR.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">matrix</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p></p>
<p>Le package <strong>pryr</strong> permet d’afficher le langage dans lequel des objets sont définis.
La fonction <code>typeof()</code> affiche le type de stockage interne des objets:</p>
<ul>
<li>la fonction <code>sum()</code> appartient au langage de base de R et est une fonction primitive (<em>builtin</em>);</li>
<li>les éléments de la matrice numérique contenant un seul 1 sont des réels à double précision, et la matrice elle-même est définie dans le langage de base.</li>
</ul>
<p>Les fonctions primitives sont codées en C et sont très rapides.
Elles sont toujours disponibles, quels que soient les packages chargés.
Leur usage est donc à privilégier.</p>
</div>
<div id="sec:S3" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> S3<a href="chap-utiliseR.html#sec:S3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>S3 est le langage le plus utilisé, souvent le seul connu par les utilisateurs de R.</p>
<p>C’est un langage orienté objet dans lequel les classes, c’est-à-dire le type des objets, sont déclaratives.</p>
<p></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chap-utiliseR.html#cb26-1" aria-hidden="true" tabindex="-1"></a>MonPrenom <span class="ot">&lt;-</span> <span class="st">&quot;Eric&quot;</span></span>
<span id="cb26-2"><a href="chap-utiliseR.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(MonPrenom) <span class="ot">&lt;-</span> <span class="st">&quot;Prenom&quot;</span></span></code></pre></div>
<p></p>
<p>La variable <code>MonPrenom</code> est ici de classe “Prenom” par une simple déclaration.</p>
<p>Contrairement au fonctionnement d’un langage orienté objet classique<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>, les méthodes S3 sont liées aux fonctions, pas aux objets.</p>
<p></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chap-utiliseR.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage par défaut</span></span>
<span id="cb27-2"><a href="chap-utiliseR.html#cb27-2" aria-hidden="true" tabindex="-1"></a>MonPrenom</span></code></pre></div>
<pre><code>## [1] &quot;Eric&quot;
## attr(,&quot;class&quot;)
## [1] &quot;Prenom&quot;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chap-utiliseR.html#cb29-1" aria-hidden="true" tabindex="-1"></a>print.Prenom <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">cat</span>(<span class="st">&quot;Le prénom est&quot;</span>, x)</span>
<span id="cb29-2"><a href="chap-utiliseR.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage modifié</span></span>
<span id="cb29-3"><a href="chap-utiliseR.html#cb29-3" aria-hidden="true" tabindex="-1"></a>MonPrenom</span></code></pre></div>
<pre><code>## Le prénom est Eric</code></pre>
<p></p>
<p>Dans cet exemple, la méthode <code>print()</code> appliquée à la classe “Prenom” est modifiée.
Dans un langage orienté objet classique, la méthode serait définie dans la classe <code>Prenom</code>.
Dans R, les méthodes sont définies à partir de méthodes génériques.</p>
<p><code>print</code> est une méthode générique (“un générique”) déclaré dans <strong>base</strong>.</p>
<p></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chap-utiliseR.html#cb31-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(print)</span></code></pre></div>
<pre><code>## [1] &quot;base&quot;</code></pre>
<p></p>
<p>Son code se résume à une déclaration <code>UseMethod("print")</code>:</p>
<p></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chap-utiliseR.html#cb33-1" aria-hidden="true" tabindex="-1"></a>print</span></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;print&quot;)
## &lt;bytecode: 0x7fb34d20f228&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p></p>
<p>Il existe beaucoup de méthodes S3 pour <code>print</code>:</p>
<p></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="chap-utiliseR.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">methods</span>(<span class="st">&quot;print&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;print.acf&quot;      &quot;print.AES&quot;      &quot;print.all_vars&quot;
## [4] &quot;print.anova&quot;    &quot;print.any_vars&quot; &quot;print.aov&quot;</code></pre>
<p></p>
<p>Chacune s’applique à une classe. <code>print.default</code> est utilisée en dernier ressort et s’appuie sur le type de l’objet, pas sur sa classe S3.</p>
<p></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="chap-utiliseR.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(MonPrenom)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="chap-utiliseR.html#cb39-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(MonPrenom)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<p></p>
<p>Un objet peut appartenir à plusieurs classes, ce qui permet une forme d’héritage des méthodes.
Dans un langage orienté objet classique, l’héritage permet de définir des classes plus précises (“PrenomFrancais”) qui héritent de classes plus générales (“Prenom”) et bénéficient de cette façon de leurs méthodes sans avoir à les redéfinir.
Dans R, l’héritage consiste simplement à déclarer un vecteur de classes de plus en plus larges pour un objet:</p>
<p></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="chap-utiliseR.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition des classes par un vecteur</span></span>
<span id="cb41-2"><a href="chap-utiliseR.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(MonPrenom) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;PrenomFrancais&quot;</span>, <span class="st">&quot;Prenom&quot;</span>)</span>
<span id="cb41-3"><a href="chap-utiliseR.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture alternative, avec inherits()</span></span>
<span id="cb41-4"><a href="chap-utiliseR.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(MonPrenom, <span class="at">what =</span> <span class="st">&quot;PrenomFrancais&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="chap-utiliseR.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(MonPrenom, <span class="at">what =</span> <span class="st">&quot;Prenom&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Le générique cherche une méthode pour chaque classe, dans l’ordre de leur déclaration.</p>
<p></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="chap-utiliseR.html#cb45-1" aria-hidden="true" tabindex="-1"></a>print.PrenomFrancais <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">cat</span>(<span class="st">&quot;Prénom français:&quot;</span>,</span>
<span id="cb45-2"><a href="chap-utiliseR.html#cb45-2" aria-hidden="true" tabindex="-1"></a>    x)</span>
<span id="cb45-3"><a href="chap-utiliseR.html#cb45-3" aria-hidden="true" tabindex="-1"></a>MonPrenom</span></code></pre></div>
<pre><code>## Prénom français: Eric</code></pre>
<p></p>
<p>En résumé, S3 est le langage courant de R.
Presque tous les packages sont écrits en S3.
Les génériques sont partout mais passent inaperçus, par exemple dans des packages:</p>
<p></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="chap-utiliseR.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;entropart&quot;</span>)</span>
<span id="cb47-2"><a href="chap-utiliseR.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">.S3methods</span>(<span class="at">class =</span> <span class="st">&quot;SpeciesDistribution&quot;</span>)</span></code></pre></div>
<pre><code>## [1] autoplot plot    
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>
La fonction <code>.S3methods()</code> permet d’afficher toutes les méthodes disponibles pour une classe, par opposition à <code>methods()</code> qui affiche toutes les classes pour lesquelles la méthode passée en argument est définie.</p>
<p>De nombreuses fonctions primitives de R sont des méthodes génériques.
Utiliser l’aide <code>help(InternalMethods)</code> pour les découvrir.</p>
</div>
<div id="s4" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> S4<a href="chap-utiliseR.html#s4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>S4 est une évolution de S3 qui structure les classes pour se rapprocher d’un langage orienté objet classique:</p>
<ul>
<li>les classes doivent être définies explicitement, pas simplement déclarées;</li>
<li>les attributs (c’est-à-dire les variables décrivant les objets), appelés <em>slots</em>, sont déclarés explicitement;</li>
<li>le constructeur, c’est-à-dire la méthode qui crée un nouvelle instance d’une classe (c’est-à-dire une variable contenant un objet de la classe), est explicite.</li>
</ul>
<p>En reprenant l’exemple précédent, la syntaxe S4 est la suivante:</p>
<p></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chap-utiliseR.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition de la classe Personne, avec ses slots</span></span>
<span id="cb49-2"><a href="chap-utiliseR.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">&quot;Personne&quot;</span>,  </span>
<span id="cb49-3"><a href="chap-utiliseR.html#cb49-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">slots =</span> <span class="fu">list</span>(<span class="at">Nom =</span> <span class="st">&quot;character&quot;</span>, <span class="at">Prenom =</span> <span class="st">&quot;character&quot;</span>))</span>
<span id="cb49-4"><a href="chap-utiliseR.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction d&#39;une instance</span></span>
<span id="cb49-5"><a href="chap-utiliseR.html#cb49-5" aria-hidden="true" tabindex="-1"></a>Moi <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Personne&quot;</span>, <span class="at">Nom =</span> <span class="st">&quot;Marcon&quot;</span>, <span class="at">Prenom =</span> <span class="st">&quot;Eric&quot;</span>)</span>
<span id="cb49-6"><a href="chap-utiliseR.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Langage</span></span>
<span id="cb49-7"><a href="chap-utiliseR.html#cb49-7" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(Moi)</span></code></pre></div>
<pre><code>## [1] &quot;S4&quot;</code></pre>
<p></p>
<p>Les méthodes appartiennent toujours aux fonctions.
Elles sont déclarées par la fonction <code>setMethod()</code>:</p>
<p></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="chap-utiliseR.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">&quot;print&quot;</span>, <span class="at">signature =</span> <span class="st">&quot;Personne&quot;</span>, <span class="cf">function</span>(x, ...) {</span>
<span id="cb51-2"><a href="chap-utiliseR.html#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;La personne est:&quot;</span>, x<span class="sc">@</span>Prenom, x<span class="sc">@</span>Nom)</span>
<span id="cb51-3"><a href="chap-utiliseR.html#cb51-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-4"><a href="chap-utiliseR.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Moi)</span></code></pre></div>
<pre><code>## La personne est: Eric Marcon</code></pre>
<p></p>
<p>Les attributs sont appelés par la syntaxe <code>variable@slot</code>.</p>
<p>En résumé, S4 est plus rigoureux que S3.
Quelques packages sur CRAN : <strong>Matrix</strong>, <strong>sp</strong>, <strong>odbc</strong>… et beaucoup sur Bioconductor sont écrits en S4 mais le langage est maintenant clairement délaissé au profit de S3, notamment à cause du succès du <strong>tidyverse</strong>.</p>
</div>
<div id="rc" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> RC<a href="chap-utiliseR.html#rc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RC a été introduit dans R 2.12 (2010) avec le package <strong>methods</strong>.</p>
<p>Les méthodes appartiennent aux classes, comme en C++: elles sont déclarées dans la classe et appelées à partir des objets.</p>
<p></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="chap-utiliseR.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;methods&quot;</span>)</span>
<span id="cb53-2"><a href="chap-utiliseR.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Déclaration de la classe</span></span>
<span id="cb53-3"><a href="chap-utiliseR.html#cb53-3" aria-hidden="true" tabindex="-1"></a>PersonneRC <span class="ot">&lt;-</span> <span class="fu">setRefClass</span>(<span class="st">&quot;PersonneRC&quot;</span>, </span>
<span id="cb53-4"><a href="chap-utiliseR.html#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fields =</span> <span class="fu">list</span>(<span class="at">Nom =</span> <span class="st">&quot;character&quot;</span>, <span class="at">Prenom =</span> <span class="st">&quot;character&quot;</span>),</span>
<span id="cb53-5"><a href="chap-utiliseR.html#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">methods =</span> <span class="fu">list</span>(<span class="at">print =</span> <span class="cf">function</span>() <span class="fu">cat</span>(Prenom, Nom)))</span>
<span id="cb53-6"><a href="chap-utiliseR.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructeur</span></span>
<span id="cb53-7"><a href="chap-utiliseR.html#cb53-7" aria-hidden="true" tabindex="-1"></a>MoiRC <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;PersonneRC&quot;</span>, <span class="at">Nom =</span> <span class="st">&quot;Marcon&quot;</span>, <span class="at">Prenom =</span><span class="st">&quot;Eric&quot;</span>)</span>
<span id="cb53-8"><a href="chap-utiliseR.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Langage</span></span>
<span id="cb53-9"><a href="chap-utiliseR.html#cb53-9" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(MoiRC)</span></code></pre></div>
<pre><code>## [1] &quot;RC&quot;</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chap-utiliseR.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Appel de la méthode print</span></span>
<span id="cb55-2"><a href="chap-utiliseR.html#cb55-2" aria-hidden="true" tabindex="-1"></a>MoiRC<span class="sc">$</span><span class="fu">print</span>()</span></code></pre></div>
<pre><code>## Eric Marcon</code></pre>
<p></p>
<p>RC est un langage confidentiel, bien que ce soit le premier “vrai” langage orienté objet de R.</p>
</div>
<div id="s6" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> S6<a href="chap-utiliseR.html#s6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>S6<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a> perfectionne RC mais n’est pas inclus dans R: il nécessite d’installer son package.</p>
<p>Les attributs et les méthodes peuvent être publics ou privés.
Une méthode <code>initialize()</code> est utilisée comme constructeur.</p>
<p></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="chap-utiliseR.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb57-2"><a href="chap-utiliseR.html#cb57-2" aria-hidden="true" tabindex="-1"></a>PersonneR6 <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;PersonneR6&quot;</span>, <span class="at">public =</span> <span class="fu">list</span>(<span class="at">Nom =</span> <span class="st">&quot;character&quot;</span>,</span>
<span id="cb57-3"><a href="chap-utiliseR.html#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prenom =</span> <span class="st">&quot;character&quot;</span>, <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">Nom =</span> <span class="cn">NA</span>, <span class="at">Prenom =</span> <span class="cn">NA</span>) {</span>
<span id="cb57-4"><a href="chap-utiliseR.html#cb57-4" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>Nom <span class="ot">&lt;-</span> Nom</span>
<span id="cb57-5"><a href="chap-utiliseR.html#cb57-5" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>Prenom <span class="ot">&lt;-</span> Prenom</span>
<span id="cb57-6"><a href="chap-utiliseR.html#cb57-6" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">print =</span> <span class="cf">function</span>() <span class="fu">cat</span>(self<span class="sc">$</span>Prenom, self<span class="sc">$</span>Nom)))</span>
<span id="cb57-7"><a href="chap-utiliseR.html#cb57-7" aria-hidden="true" tabindex="-1"></a>MoiR6 <span class="ot">&lt;-</span> PersonneR6<span class="sc">$</span><span class="fu">new</span>(<span class="at">Nom =</span> <span class="st">&quot;Marcon&quot;</span>, <span class="at">Prenom =</span> <span class="st">&quot;Eric&quot;</span>)</span>
<span id="cb57-8"><a href="chap-utiliseR.html#cb57-8" aria-hidden="true" tabindex="-1"></a>MoiR6<span class="sc">$</span><span class="fu">print</span>()</span></code></pre></div>
<pre><code>## Eric Marcon</code></pre>
<p></p>
<p>S6 permet de programmer rigoureusement en objet mais est très peu utilisé.
Les performances de S6 sont bien supérieures à celles de RC mais sont inférieures à celles de S3<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>.</p>
<p>La non-inclusion de R6 à R est montrée par <strong>pryr</strong>:</p>
<p></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="chap-utiliseR.html#cb59-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(MoiR6)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<p></p>
</div>
<div id="tidyverse" class="section level3 hasAnchor" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Tidyverse<a href="chap-utiliseR.html#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Le tidyverse est un ensemble de packages cohérents qui ont fait évoluer la façon de programmer R.
L’ensemble des packages indispensables peut être chargé par le package <strong>tidyverse</strong> qui n’a pas d’autre utilité:</p>
<p></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="chap-utiliseR.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p></p>
<p>Il ne s’agit pas d’un nouveau langage à proprement parler mais plutôt d’une extension de S3, avec de profondes modifications techniques, notamment l’évaluation non conventionnelle des expressions<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>, qu’il n’est pas essentiel de maîtriser en détail.</p>
<p>Ses principes sont inscrits dans un manifeste<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>.
Son apport le plus visible pour l’utilisateur sont l’enchaînement des commandes dans un flux (pipeline de code).</p>
<p>En programmation standard, l’enchaînement des fonctions s’écrit par emboîtements successifs, ce qui en rend la lecture difficile, surtout quand des arguments sont nécessaires:</p>
<p></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="chap-utiliseR.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logarithme de base 2 de la moyenne de 100 tirages</span></span>
<span id="cb62-2"><a href="chap-utiliseR.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># aléatoires dans une loi uniforme</span></span>
<span id="cb62-3"><a href="chap-utiliseR.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fu">mean</span>(<span class="fu">runif</span>(<span class="dv">100</span>)), <span class="at">base =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -1.127903</code></pre>
<p></p>
<p>Dans le tidyverse, les fonctions s’enchaînent, ce qui correspond souvent mieux à la réflexion du programmeur sur le traitement des données:</p>
<p></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="chap-utiliseR.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 100 tirages aléatoires dans une loi uniforme</span></span>
<span id="cb64-2"><a href="chap-utiliseR.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="chap-utiliseR.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Moyenne</span></span>
<span id="cb64-4"><a href="chap-utiliseR.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  mean <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="chap-utiliseR.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Logarithme</span></span>
<span id="cb64-6"><a href="chap-utiliseR.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(<span class="at">base=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -0.9772102</code></pre>
<p></p>
<p>Le tuyau <code>%&gt;%</code> est un opérateur qui appelle la fonction suivante en lui passant comme premier argument le résultat de la fonction précédente.
Les arguments supplémentaires sont passés normalement: pour la lisibilité du code, il est indispensable de les nommer.
La plupart des fonctions de R sont utilisables sans difficultés dans le tidyverse bien qu’elles n’aient pas été prévues pour cela: il suffit que leur premier argument soit les données à traiter.</p>
<p>Le pipeline ne permet de passer qu’une seule valeur à la fonction suivante, ce qui interdit les fonctions multidimensionnelles, de type <code>f(x,y)</code>.
La structure de données préférée est le <em>tibble</em>, qui est un dataframe amélioré: sa méthode <code>print()</code> est plus lisible, et il corrige quelques comportements non-intuitifs des dataframes, comme la conversion automatique en vecteurs des dataframes à une seule colonne.
Les colonnes du dataframe ou du tibble permettent de passer autant de données que nécessaire.</p>
<p>Enfin, la visualisation des données est prise en charge par <strong>ggplot2</strong> qui s’appuie sur une grammaire des graphiques <span class="citation">(<a href="#ref-Wickham2010" role="doc-biblioref">Wickham 2010</a>)</span> solide sur le plan théorique.
Schématiquement, un graphique est construit selon le modèle suivant:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;</code></pre>
<ul>
<li>les données sont obligatoirement un dataframe;</li>
<li>la géométrie est le type de graphique choisi (points, lignes, histogrammes ou autre);</li>
<li>l’esthétique (fonction <code>aes()</code>) désigne ce qui est représenté: c’est la correspondance entre les colonnes du dataframe et les éléments nécessaires à la géométrie;</li>
<li>la statistique est le traitement appliqué aux données avant de les transmettre à la géométrie (souvent “identity”, c’est-à-dire aucune transformation mais “boxplot” pour une boîte à moustache).
Les données peuvent être transformées par une fonction d’échelle, comme <code>scale_y_log10()</code>;</li>
<li>la position est l’emplacement des objets sur le graphique (souvent “identity”; “stack” pour un histogramme empilé, “jitter” pour déplacer légèrement les points superposés dans un <code>geom_point</code>);</li>
<li>les coordonnées définissent l’affichage du graphique (<code>coord_fixed()</code> pour ne pas déformer une carte par exemple) ;</li>
<li>enfin, les facettes offrent la possibilité d’afficher plusieurs aspects des mêmes données en produisant un graphique par modalité d’une variable.</li>
</ul>
<p>L’ensemble formé par le pipeline et <strong>ggplot2</strong> permet des traitements complexes dans un code lisible.
La figure <a href="chap-utiliseR.html#fig:diamonds">2.1</a> montre le résultat du code suivant:</p>

<p></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="chap-utiliseR.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Données sur les diamants fournies par ggplot2</span></span>
<span id="cb67-2"><a href="chap-utiliseR.html#cb67-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="chap-utiliseR.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ne conserver que les diamants de plus d&#39;un demi-carat</span></span>
<span id="cb67-4"><a href="chap-utiliseR.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(carat <span class="sc">&gt;</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-5"><a href="chap-utiliseR.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Graphique : prix en fonction du poids</span></span>
<span id="cb67-6"><a href="chap-utiliseR.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> carat, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb67-7"><a href="chap-utiliseR.html#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nuage de points</span></span>
<span id="cb67-8"><a href="chap-utiliseR.html#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb67-9"><a href="chap-utiliseR.html#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Echelle logarithmique</span></span>
<span id="cb67-10"><a href="chap-utiliseR.html#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb67-11"><a href="chap-utiliseR.html#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb67-12"><a href="chap-utiliseR.html#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Régression linéaire</span></span>
<span id="cb67-13"><a href="chap-utiliseR.html#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:diamonds"></span>
<img src="travailleR_files/figure-html/diamonds-1.png" alt="Prix des diamants en fonction de leur poids. Démonstration du code de ggplot2 combiné au traitement de données du tidyverse." width="80%" />
<p class="caption">
Figure 2.1: Prix des diamants en fonction de leur poids. Démonstration du code de <strong>ggplot2</strong> combiné au traitement de données du tidyverse.
</p>
</div>
<p></p>
<p>Dans cette figure, deux géométries (nuage de points et régression linéaire) partagent la même esthétique (prix en fonction du poids en carats) qui est donc déclarée en amont, dans la fonction <code>ggplot()</code>.</p>
<p>Le tidyverse est documenté en détail dans <span class="citation">Wickham et Grolemund (<a href="#ref-Wickham2016" role="doc-biblioref">2016</a>)</span> et <strong>ggplot2</strong> dans <span class="citation">Wickham (<a href="#ref-Wickham2017" role="doc-biblioref">2017</a>)</span>.</p>
</div>
</div>
<div id="sec:environnements" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Environnements<a href="chap-utiliseR.html#sec:environnements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Les objets de R, données et fonctions, sont nommés.
Comme R est modulaire, avec la possibilité de lui ajouter un nombre indéterminé de packages, il est très probable que des conflits de nom apparaissent.
Pour les régler, R dispose d’un système rigoureux de précédence des noms: le code s’exécute dans un environnement défini, héritant d’environnements parents.</p>
<div id="organisation" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Organisation<a href="chap-utiliseR.html#organisation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R démarre dans un environnement vide.
Chaque package chargé crée un environnement fils pour former une pile des environnements, dont chaque nouvel élément est appelé “fils” du précédent, qui est son “parent”.</p>
<p>La console se trouve dans l’environnement global, fils du dernier package chargé.</p>
<p></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="chap-utiliseR.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;         &quot;package:R6&quot;        
##  [3] &quot;package:entropart&quot;  &quot;package:forcats&quot;   
##  [5] &quot;package:stringr&quot;    &quot;package:dplyr&quot;     
##  [7] &quot;package:purrr&quot;      &quot;package:readr&quot;     
##  [9] &quot;package:tidyr&quot;      &quot;package:tibble&quot;    
## [11] &quot;package:ggplot2&quot;    &quot;package:tidyverse&quot; 
## [13] &quot;package:kableExtra&quot; &quot;package:stats&quot;     
## [15] &quot;package:graphics&quot;   &quot;package:grDevices&quot; 
## [17] &quot;package:utils&quot;      &quot;package:datasets&quot;  
## [19] &quot;package:methods&quot;    &quot;Autoloads&quot;         
## [21] &quot;package:base&quot;</code></pre>
<p></p>
<p>Le code d’une fonction appelée de la console s’exécute dans un environnement fils de l’environnement global:</p>
<p></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="chap-utiliseR.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Environnement actuel</span></span>
<span id="cb70-2"><a href="chap-utiliseR.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>()</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="chap-utiliseR.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La fonction f affiche son environnement</span></span>
<span id="cb72-2"><a href="chap-utiliseR.html#cb72-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">environment</span>()</span>
<span id="cb72-3"><a href="chap-utiliseR.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de l&#39;environnement de la fonction</span></span>
<span id="cb72-4"><a href="chap-utiliseR.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span></code></pre></div>
<pre><code>## &lt;environment: 0x7fb359b53300&gt;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="chap-utiliseR.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Environnement parent de celui de la fonction</span></span>
<span id="cb74-2"><a href="chap-utiliseR.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(<span class="fu">f</span>())</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<p></p>
</div>
<div id="recherche" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Recherche<a href="chap-utiliseR.html#recherche" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La recherche des objets commence dans l’environnement local.
S’il n’est pas trouvé, il est cherché dans l’environnement parent, puis dans le parent du parent, jusqu’à l’épuisement des environnements qui génère une erreur indiquant que l’objet n’a pas été trouvé.</p>
<p>Exemple:</p>
<p></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="chap-utiliseR.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable q définie dans l&#39;environnement global</span></span>
<span id="cb76-2"><a href="chap-utiliseR.html#cb76-2" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="st">&quot;GlobalEnv&quot;</span></span>
<span id="cb76-3"><a href="chap-utiliseR.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction définissant q dans son environnement</span></span>
<span id="cb76-4"><a href="chap-utiliseR.html#cb76-4" aria-hidden="true" tabindex="-1"></a>qLocalFonction <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb76-5"><a href="chap-utiliseR.html#cb76-5" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="st">&quot;Fonction&quot;</span></span>
<span id="cb76-6"><a href="chap-utiliseR.html#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(q)</span>
<span id="cb76-7"><a href="chap-utiliseR.html#cb76-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-8"><a href="chap-utiliseR.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># La variable locale est retournée</span></span>
<span id="cb76-9"><a href="chap-utiliseR.html#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">qLocalFonction</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Fonction&quot;</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="chap-utiliseR.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction (mal écrite) utilisant une variable qu&#39;elle ne</span></span>
<span id="cb78-2"><a href="chap-utiliseR.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># définit pas</span></span>
<span id="cb78-3"><a href="chap-utiliseR.html#cb78-3" aria-hidden="true" tabindex="-1"></a>qGlobalEnv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb78-4"><a href="chap-utiliseR.html#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(q)</span>
<span id="cb78-5"><a href="chap-utiliseR.html#cb78-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-6"><a href="chap-utiliseR.html#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># La variable de l&#39;environnement global est retournée</span></span>
<span id="cb78-7"><a href="chap-utiliseR.html#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="fu">qGlobalEnv</span>()</span></code></pre></div>
<pre><code>## [1] &quot;GlobalEnv&quot;</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="chap-utiliseR.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression de cette variable</span></span>
<span id="cb80-2"><a href="chap-utiliseR.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(q)</span>
<span id="cb80-3"><a href="chap-utiliseR.html#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># La fonction base::q est retournée</span></span>
<span id="cb80-4"><a href="chap-utiliseR.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qGlobalEnv</span>()</span></code></pre></div>
<pre><code>## function (save = &quot;default&quot;, status = 0, runLast = TRUE) 
## .Internal(quit(save, status, runLast))
## &lt;bytecode: 0x7fb35bbc30b0&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p></p>
<p>La variable <code>q</code> est définie dans l’environnement global.
La fonction <code>qLocalFonction</code> définit sa propre variable <code>q</code>.
L’appel de la fonction retourne la valeur locale de la fonction parce qu’elle se trouve dans l’environnement de la fonction.</p>
<p>La fonction <code>qGlobalEnv</code> retourne la variable <code>q</code> qu’elle ne définit pas localement.
Elle la recherche donc dans son environnement parent et trouve la variable définie dans l’environnement global.
En supprimant la variable de l’environnement global par <code>rm(q)</code>, la fonction <code>qGlobalEnv()</code> parcourt la pile des environnements jusqu’à trouver un objet nommé <code>q</code> dans le package <strong>base</strong>, qui est la fonction permettant de quitter R.
Elle aurait pu trouver un autre objet si un package contenant un objet <code>q</code> avait été chargé.</p>
<p>Pour éviter ce comportement erratique, une fonction ne doit <em>jamais</em> appeler un objet non défini dans son propre environnement.</p>
</div>
<div id="espaces-de-nom-des-packages" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Espaces de nom des packages<a href="chap-utiliseR.html#espaces-de-nom-des-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Il est temps de définir précisément ce que les packages rendent visible.
Les packages contiennent des objets (fonctions et données) qu’ils <em>exportent</em> ou non.
Ils sont habituellement appelés par la fonction <code>library()</code> qui effectue deux opérations:</p>
<ul>
<li>elle <em>charge</em> le package en mémoire, ce qui permet d’accéder à tous ses objets avec la syntaxe <code>package::objet</code> pour les objets exportés et <code>package:::objet</code> pour ceux qui ne le sont pas;</li>
<li>elle <em>attache</em> ensuite le package, ce qui place son environnement en haut de la pile.</li>
</ul>
<p>Il est possible de détacher un package avec la fonction <code>unloadNamespace()</code> pour le retirer de la pile des environnements.
Exemple:</p>
<p></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="chap-utiliseR.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># entropart chargé et attaché</span></span>
<span id="cb82-2"><a href="chap-utiliseR.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;entropart&quot;</span>)</span>
<span id="cb82-3"><a href="chap-utiliseR.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Est-il attaché ?</span></span>
<span id="cb82-4"><a href="chap-utiliseR.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">isNamespaceLoaded</span>(<span class="st">&quot;entropart&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="chap-utiliseR.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pile des environnements</span></span>
<span id="cb84-2"><a href="chap-utiliseR.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;         &quot;package:R6&quot;        
##  [3] &quot;package:entropart&quot;  &quot;package:forcats&quot;   
##  [5] &quot;package:stringr&quot;    &quot;package:dplyr&quot;     
##  [7] &quot;package:purrr&quot;      &quot;package:readr&quot;     
##  [9] &quot;package:tidyr&quot;      &quot;package:tibble&quot;    
## [11] &quot;package:ggplot2&quot;    &quot;package:tidyverse&quot; 
## [13] &quot;package:kableExtra&quot; &quot;package:stats&quot;     
## [15] &quot;package:graphics&quot;   &quot;package:grDevices&quot; 
## [17] &quot;package:utils&quot;      &quot;package:datasets&quot;  
## [19] &quot;package:methods&quot;    &quot;Autoloads&quot;         
## [21] &quot;package:base&quot;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="chap-utiliseR.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diversity(), une fonction exportée par entropart est</span></span>
<span id="cb86-2"><a href="chap-utiliseR.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># trouvée</span></span>
<span id="cb86-3"><a href="chap-utiliseR.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Diversity</span>(<span class="dv">1</span>, <span class="at">CheckArguments =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## None 
##    1</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="chap-utiliseR.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Détacher et décharger entropart</span></span>
<span id="cb88-2"><a href="chap-utiliseR.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unloadNamespace</span>(<span class="st">&quot;entropart&quot;</span>)</span>
<span id="cb88-3"><a href="chap-utiliseR.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Est-il attaché ?</span></span>
<span id="cb88-4"><a href="chap-utiliseR.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">isNamespaceLoaded</span>(<span class="st">&quot;entropart&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="chap-utiliseR.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pile des environnements, sans entropart</span></span>
<span id="cb90-2"><a href="chap-utiliseR.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;         &quot;package:R6&quot;        
##  [3] &quot;package:forcats&quot;    &quot;package:stringr&quot;   
##  [5] &quot;package:dplyr&quot;      &quot;package:purrr&quot;     
##  [7] &quot;package:readr&quot;      &quot;package:tidyr&quot;     
##  [9] &quot;package:tibble&quot;     &quot;package:ggplot2&quot;   
## [11] &quot;package:tidyverse&quot;  &quot;package:kableExtra&quot;
## [13] &quot;package:stats&quot;      &quot;package:graphics&quot;  
## [15] &quot;package:grDevices&quot;  &quot;package:utils&quot;     
## [17] &quot;package:datasets&quot;   &quot;package:methods&quot;   
## [19] &quot;Autoloads&quot;          &quot;package:base&quot;</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="chap-utiliseR.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diversity() est introuvable</span></span>
<span id="cb92-2"><a href="chap-utiliseR.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">Diversity</span>(<span class="dv">1</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">print</span>(e))</span></code></pre></div>
<pre><code>## &lt;simpleError in Diversity(1): could not find function &quot;Diversity&quot;&gt;</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="chap-utiliseR.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mais peut être appelée avec son nom complet</span></span>
<span id="cb94-2"><a href="chap-utiliseR.html#cb94-2" aria-hidden="true" tabindex="-1"></a>entropart<span class="sc">::</span><span class="fu">Diversity</span>(<span class="dv">1</span>, <span class="at">CheckArguments =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## None 
##    1</code></pre>
<p></p>
<p>L’appel de <code>entropart::Diversity()</code> charge le package (c’est-à-dire, exécute implicitement <code>loadNamespace("entropart")</code>) mais ne l’attache pas.</p>
<p>En pratique, il faut limiter le nombre de package attachés pour limiter le risque d’appeler une fonction non désirée, homonyme de la fonction recherchée.
Dans les cas critiques, il faut utiliser le nom complet de la fonction: <code>package::fonction()</code>.</p>
<p>Un problème fréquent concerne la fonction <code>filter()</code> de <strong>dplyr</strong> homonyme de celle de <strong>stats</strong>.
Le package <strong>stats</strong> est habituellement chargé avant <strong>dplyr</strong>, un package du tidyverse.
<code>stats::filter()</code> doit donc être appelée explicitement.</p>
<p>Cependant, le package <strong>dplyr</strong> ou <strong>tidyverse</strong> (qui attache tous les packages du tidyverse) peut être chargé systématiquement en créant un fichier <code>.RProfile</code> à la racine du projet contenant la commande:</p>
<p></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="chap-utiliseR.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p></p>
<p>Dans ce cas, <strong>dplyr</strong> est chargé <em>avant</em> <strong>stats</strong> et c’est sa fonction qui est inaccessible.</p>
</div>
</div>
<div id="mesure-du-temps-dexécution" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Mesure du temps d’exécution<a href="chap-utiliseR.html#mesure-du-temps-dexécution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Le temps d’exécution d’un code long peut être mesuré très simplement par la commande <code>system.time</code>.
Pour des temps d’exécution très courts, il est nécessaire de répéter la mesure: c’est l’objet du package <strong>microbenchmark</strong>.</p>
<div id="system.time" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> system.time<a href="chap-utiliseR.html#system.time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La fonction retourne le temps d’exécution du code.</p>
<p></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="chap-utiliseR.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecart absolu moyen de 1000 valeurs dans une loi uniforme,</span></span>
<span id="cb97-2"><a href="chap-utiliseR.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># répété 100 fois</span></span>
<span id="cb97-3"><a href="chap-utiliseR.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="fu">mad</span>(<span class="fu">runif</span>(<span class="dv">1000</span>)))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.020   0.000   0.021</code></pre>
<p></p>
</div>
<div id="microbenchmark" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> microbenchmark<a href="chap-utiliseR.html#microbenchmark" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Le package <strong>microbenchmark</strong> est le plus avancé.</p>
<p>L’objectif est de comparer la vitesse du calcul du carré d’un vecteur (ou d’un nombre) en le multipliant par lui-même (<span class="math inline">\(x \times x\)</span>) ou en l’élevant à la puissance 2 (<span class="math inline">\(x^2\)</span>).</p>
<p></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="chap-utiliseR.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonctions à tester</span></span>
<span id="cb99-2"><a href="chap-utiliseR.html#cb99-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">*</span> x</span>
<span id="cb99-3"><a href="chap-utiliseR.html#cb99-3" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb99-4"><a href="chap-utiliseR.html#cb99-4" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="fl">2.1</span></span>
<span id="cb99-5"><a href="chap-utiliseR.html#cb99-5" aria-hidden="true" tabindex="-1"></a>f4 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb99-6"><a href="chap-utiliseR.html#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialisation</span></span>
<span id="cb99-7"><a href="chap-utiliseR.html#cb99-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb99-8"><a href="chap-utiliseR.html#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb99-9"><a href="chap-utiliseR.html#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;microbenchmark&quot;</span>)</span>
<span id="cb99-10"><a href="chap-utiliseR.html#cb99-10" aria-hidden="true" tabindex="-1"></a>(mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">f1</span>(X), <span class="fu">f2</span>(X), <span class="fu">f3</span>(X), <span class="fu">f4</span>(X)))</span></code></pre></div>
<pre><code>## Unit: microseconds
##   expr     min       lq      mean   median       uq
##  f1(X)  40.813  43.0640  62.86464  44.6725  47.9560
##  f2(X)  48.282  51.2580  70.33143  52.3055  57.3290
##  f3(X) 279.472 281.2380 307.66624 282.9800 290.7585
##  f4(X) 412.237 414.7845 448.80810 419.7845 432.2950
##       max neval
##  1444.052   100
##  1632.009   100
##  1772.684   100
##  2009.261   100</code></pre>
<p></p>
<p>Le tableau retourné contient les temps minimum, médian, moyen, max et les premiers et troisièmes quartiles, ainsi que le nombre de répétitions.
La valeur médiane est à comparer.
Le nombre de répétition est par défaut de 100, à moduler (argument <code>times</code>) en fonction de la complexité du calcul.</p>
<p>Le résultat du test, un objet de type <code>microbenchmark</code>, est un tableau brut des temps d’exécution.
L’analyse statistique est faite par les méthodes <code>print</code> et <code>summary</code>.
Pour choisir les colonnes à afficher, utiliser la syntaxe suivante:</p>
<p></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="chap-utiliseR.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##    expr   median
## 1 f1(X)  44.6725
## 2 f2(X)  52.3055
## 3 f3(X) 282.9800
## 4 f4(X) 419.7845</code></pre>
<p></p>
<p>Pour faire des calculs sur ces résultats, il faut les stocker dans une variable.
Pour empêcher l’affichage dans la console, la solution la plus simple est d’utiliser la fonction <code>capture.output</code> en affectant son résultat à une variable.</p>
<p></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="chap-utiliseR.html#cb103-1" aria-hidden="true" tabindex="-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(mbs <span class="ot">&lt;-</span> <span class="fu">summary</span>(mb))</span></code></pre></div>
<p></p>
<p>Le test précédent est affiché à nouveau.</p>
<p></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="chap-utiliseR.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##    expr   median
## 1 f1(X)  44.6725
## 2 f2(X)  52.3055
## 3 f3(X) 282.9800
## 4 f4(X) 419.7845</code></pre>
<p></p>
<p>Le temps de calcul est à peu près identique entre <span class="math inline">\(x \times x\)</span> et <span class="math inline">\(x^2\)</span>.
Le calcul de puissance est nettement plus long, surtout si la puissance n’est pas entière, parce qu’il nécessite un calcul de logarithme.
Le calcul de la puissance 2 est donc optimisé par R pour éviter l’usage du log.</p>
<p>Deux représentations graphiques sont disponibles: les violons représentent la densité de probabilité du temps d’exécution; les boîtes à moustache sont classiques.</p>
<p></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="chap-utiliseR.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb106-2"><a href="chap-utiliseR.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(mb)</span></code></pre></div>
<p><img src="travailleR_files/figure-html/boxplot-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="chap-utiliseR.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(mb)</span></code></pre></div>
<p><img src="travailleR_files/figure-html/boxplot-2.png" width="80%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="profilage" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Profilage<a href="chap-utiliseR.html#profilage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>profvis</strong> est l’outil de profilage de RStudio.</p>
<p>Il permet de suivre le temps d’exécution de chaque ligne de code et la mémoire utilisée.
L’objectif est de détecter les portions de code lentes, à améliorer.</p>
<p></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="chap-utiliseR.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(profvis)</span>
<span id="cb108-2"><a href="chap-utiliseR.html#cb108-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">profvis</span>({</span>
<span id="cb108-3"><a href="chap-utiliseR.html#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculs de cosinus</span></span>
<span id="cb108-4"><a href="chap-utiliseR.html#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cos</span>(<span class="fu">runif</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">7</span>))</span>
<span id="cb108-5"><a href="chap-utiliseR.html#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1/2 seconde de pause</span></span>
<span id="cb108-6"><a href="chap-utiliseR.html#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pause</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb108-7"><a href="chap-utiliseR.html#cb108-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb108-8"><a href="chap-utiliseR.html#cb108-8" aria-hidden="true" tabindex="-1"></a>htmlwidgets<span class="sc">::</span><span class="fu">saveWidget</span>(p, <span class="st">&quot;docs/profile.html&quot;</span>)</span></code></pre></div>
<p></p>
<p>Le résultat est un fichier HTML contenant le rapport de profilage<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>.
On peut observer que le temps de tirage des nombres aléatoires est similaire à celui du calcul des cosinus.</p>
<p>Lire la documentation complète<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> sur le site de RStudio.</p>
</div>
</div>
<div id="boucles" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Boucles<a href="chap-utiliseR.html#boucles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Le cas le plus fréquent de code long à exécuter est celui des boucles: le même code est répété un grand nombre de fois.</p>
<div id="fonctions-vectorielles" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Fonctions vectorielles<a href="chap-utiliseR.html#fonctions-vectorielles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La plupart des fonctions de R sont vectorielles: les boucles sont traitées de façon interne, extrêmement rapide.
Il faut donc raisonner en termes de vecteurs plutôt que de scalaires.</p>
<p></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="chap-utiliseR.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tirage de deux vecteurs de trois nombres aléatoires entre</span></span>
<span id="cb109-2"><a href="chap-utiliseR.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 et 1</span></span>
<span id="cb109-3"><a href="chap-utiliseR.html#cb109-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">3</span>)</span>
<span id="cb109-4"><a href="chap-utiliseR.html#cb109-4" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">3</span>)</span>
<span id="cb109-5"><a href="chap-utiliseR.html#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Racine carrée des trois nombres de x1</span></span>
<span id="cb109-6"><a href="chap-utiliseR.html#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(x1)</span></code></pre></div>
<pre><code>## [1] 0.9427738 0.8665204 0.4586981</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="chap-utiliseR.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sommes respective des trois nombres de x1 et x2</span></span>
<span id="cb111-2"><a href="chap-utiliseR.html#cb111-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="sc">+</span> x2</span></code></pre></div>
<pre><code>## [1] 1.6262539 1.6881583 0.9063973</code></pre>
<p></p>
<p>Il faut aussi écrire des fonctions vectorielles sur leur premier argument.
La fonction <code>lnq</code> du package <strong>entropart</strong> retourne le logarithme déformé d’ordre <span class="math inline">\(q\)</span> d’un nombre <span class="math inline">\(x\)</span>.</p>
<p></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="chap-utiliseR.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Code de la fonction</span></span>
<span id="cb113-2"><a href="chap-utiliseR.html#cb113-2" aria-hidden="true" tabindex="-1"></a>entropart<span class="sc">::</span>lnq</span></code></pre></div>
<pre><code>## function (x, q) 
## {
##     if (q == 1) {
##         return(log(x))
##     }
##     else {
##         Log &lt;- (x^(1 - q) - 1)/(1 - q)
##         Log[x &lt; 0] &lt;- NA
##         return(Log)
##     }
## }
## &lt;bytecode: 0x7fb33d8f6b70&gt;
## &lt;environment: namespace:entropart&gt;</code></pre>
<p></p>
<p>Pour qu’une fonction soit vectorielle, chaque ligne de son code doit permettre que le premier argument soit traité comme un vecteur.
Ici: <code>log(x)</code> et <code>x^</code> sont une fonction et un opérateur vectoriels et la condition <code>[x &lt; 0]</code> retourne aussi un vecteur.</p>
</div>
<div id="lapply" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> lapply<a href="chap-utiliseR.html#lapply" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Les codes qui ne peuvent pas être écrits comme une fonction vectorielle nécessitent des boucles.</p>
<p><code>lapply()</code> applique une fonction à chaque élément d’une liste.
Elle est déclinée sous plusieurs versions:</p>
<ul>
<li><code>lapply()</code> renvoie une liste (économise le temps de leur réorganisation dans un tableau);</li>
<li><code>sapply()</code> renvoie un dataframe en rassemblant les listes par <code>simplify2array()</code>;</li>
<li><code>vapply()</code> est presque identique mais demande que le type de données du résultat soit fourni.</li>
</ul>
<p></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="chap-utiliseR.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tirage de 1000 valeurs dans une loi uniforme</span></span>
<span id="cb115-2"><a href="chap-utiliseR.html#cb115-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>)</span>
<span id="cb115-3"><a href="chap-utiliseR.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># La racine carrée peut être calculée pour le vecteur ou</span></span>
<span id="cb115-4"><a href="chap-utiliseR.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># chaque valeur</span></span>
<span id="cb115-5"><a href="chap-utiliseR.html#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">sqrt</span>(x1), <span class="fu">sapply</span>(x1, <span class="at">FUN =</span> sqrt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="chap-utiliseR.html#cb117-1" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">sqrt</span>(x1), <span class="fu">lapply</span>(x1, <span class="at">FUN =</span> sqrt), <span class="fu">sapply</span>(x1,</span>
<span id="cb117-2"><a href="chap-utiliseR.html#cb117-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> sqrt), <span class="fu">vapply</span>(x1, <span class="at">FUN =</span> sqrt, <span class="at">FUN.VALUE =</span> <span class="dv">0</span>))</span>
<span id="cb117-3"><a href="chap-utiliseR.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                                    expr   median
## 1                              sqrt(x1)   4.6680
## 2                lapply(x1, FUN = sqrt) 305.6015
## 3                sapply(x1, FUN = sqrt) 364.6970
## 4 vapply(x1, FUN = sqrt, FUN.VALUE = 0) 298.8190</code></pre>
<p></p>
<p><code>lapply()</code> est beaucoup plus lent qu’une fonction vectorielle.
<code>sapply()</code> nécessite plus de temps pour <code>simplify2array()</code>, qui doit détecter comment rassembler les résultats.
Enfin, <code>vapply()</code> économise le temps de détermination du type de données du résultat et permet d’accélérer le calcul avec peu d’efforts.</p>
</div>
<div id="boucles-for" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Boucles for<a href="chap-utiliseR.html#boucles-for" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Les boucles sont gérées par la fonction <code>for</code>.
Elles ont la réputation d’être lentes dans R parce que le code à l’intérieur de la boucle doit être interprété à chaque exécution.
Ce n’est plus le cas depuis la version 3.5 de R: les boucles sont compilées systématiquement avant leur exécution.
Le comportement du compilateur “juste à temps” est défini par la fonction <code>enableJIT</code>.
Le niveau par défaut est 3: les fonctions sont toutes compilées, et les boucles dans le code aussi.</p>
<p>Pour évaluer le gain de performance, le code suivant supprime toute compilation automatique, et compare la même boucle compilée ou non.</p>
<p></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="chap-utiliseR.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;compiler&quot;</span>)</span>
<span id="cb119-2"><a href="chap-utiliseR.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pas de compilation automatique</span></span>
<span id="cb119-3"><a href="chap-utiliseR.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">enableJIT</span>(<span class="at">level =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="chap-utiliseR.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boucle pour calculer la racine carrée d&#39;un vecteur</span></span>
<span id="cb121-2"><a href="chap-utiliseR.html#cb121-2" aria-hidden="true" tabindex="-1"></a>Boucle <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb121-3"><a href="chap-utiliseR.html#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation du vecteur de résultat, indispensable</span></span>
<span id="cb121-4"><a href="chap-utiliseR.html#cb121-4" aria-hidden="true" tabindex="-1"></a>    Racine <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(x))</span>
<span id="cb121-5"><a href="chap-utiliseR.html#cb121-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Boucle</span></span>
<span id="cb121-6"><a href="chap-utiliseR.html#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) Racine[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x[i])</span>
<span id="cb121-7"><a href="chap-utiliseR.html#cb121-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(Racine)</span>
<span id="cb121-8"><a href="chap-utiliseR.html#cb121-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-9"><a href="chap-utiliseR.html#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Version compilée</span></span>
<span id="cb121-10"><a href="chap-utiliseR.html#cb121-10" aria-hidden="true" tabindex="-1"></a>Boucle2 <span class="ot">&lt;-</span> <span class="fu">cmpfun</span>(Boucle)</span>
<span id="cb121-11"><a href="chap-utiliseR.html#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison</span></span>
<span id="cb121-12"><a href="chap-utiliseR.html#cb121-12" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">Boucle</span>(x1), <span class="fu">Boucle2</span>(x1))</span>
<span id="cb121-13"><a href="chap-utiliseR.html#cb121-13" aria-hidden="true" tabindex="-1"></a>(mbs <span class="ot">&lt;-</span> <span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)])</span></code></pre></div>
<pre><code>##          expr  median
## 1  Boucle(x1) 847.265
## 2 Boucle2(x1)  78.581</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="chap-utiliseR.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compilation automatique par défaut depuis la version 3.5</span></span>
<span id="cb123-2"><a href="chap-utiliseR.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">enableJIT</span>(<span class="at">level =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p></p>
<p>Le gain est considérable: de 1 à <code>11</code>.</p>
<p>Les boucles for sont maintenant nettement plus rapides que <code>vapply</code>.</p>
<p></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="chap-utiliseR.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb125-2"><a href="chap-utiliseR.html#cb125-2" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">vapply</span>(x1, <span class="at">FUN =</span> sqrt, <span class="dv">0</span>), <span class="fu">Boucle</span>(x1))</span>
<span id="cb125-3"><a href="chap-utiliseR.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                        expr   median
## 1 vapply(x1, FUN = sqrt, 0) 296.2795
## 2                Boucle(x1)  76.5660</code></pre>
<p></p>
<p>Attention, le test de performance peut être trompeur:</p>
<p></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="chap-utiliseR.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Préparation du vecteur de résultat</span></span>
<span id="cb127-2"><a href="chap-utiliseR.html#cb127-2" aria-hidden="true" tabindex="-1"></a>Racine <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(x1))</span>
<span id="cb127-3"><a href="chap-utiliseR.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb127-4"><a href="chap-utiliseR.html#cb127-4" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">vapply</span>(x1, <span class="at">FUN =</span> sqrt, <span class="dv">0</span>), </span>
<span id="cb127-5"><a href="chap-utiliseR.html#cb127-5" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x1)) </span>
<span id="cb127-6"><a href="chap-utiliseR.html#cb127-6" aria-hidden="true" tabindex="-1"></a>                       Racine[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x1[i]))</span>
<span id="cb127-7"><a href="chap-utiliseR.html#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                                               expr
## 1                        vapply(x1, FUN = sqrt, 0)
## 2 for (i in 1:length(x1)) Racine[i] &lt;- sqrt(x1[i])
##      median
## 1  302.1985
## 2 3594.1100</code></pre>
<p></p>
<p>Dans ce code, la boucle for n’est pas compilée donc elle est beaucoup plus lente que dans le cadre normal de son utilisation (dans une fonction ou au niveau supérieur du code).</p>
<p>Les boucles longues permettent un suivi de leur progression par une barre de texte, ce qui est un autre avantage.
La fonction suivante exécute des pauses d’un dixième de seconde pendant le temps passé en paramètre (en secondes).</p>
<p></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="chap-utiliseR.html#cb129-1" aria-hidden="true" tabindex="-1"></a>BoucleSuivie <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">duree =</span> <span class="dv">1</span>) {</span>
<span id="cb129-2"><a href="chap-utiliseR.html#cb129-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Barre de progression</span></span>
<span id="cb129-3"><a href="chap-utiliseR.html#cb129-3" aria-hidden="true" tabindex="-1"></a>    pgb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> duree <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb129-4"><a href="chap-utiliseR.html#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Boucle</span></span>
<span id="cb129-5"><a href="chap-utiliseR.html#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(duree <span class="sc">*</span> <span class="dv">10</span>)) {</span>
<span id="cb129-6"><a href="chap-utiliseR.html#cb129-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pause d&#39;un dixième de seconde</span></span>
<span id="cb129-7"><a href="chap-utiliseR.html#cb129-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Sys.sleep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb129-8"><a href="chap-utiliseR.html#cb129-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Suivi de la progression</span></span>
<span id="cb129-9"><a href="chap-utiliseR.html#cb129-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setTxtProgressBar</span>(pgb, i)</span>
<span id="cb129-10"><a href="chap-utiliseR.html#cb129-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb129-11"><a href="chap-utiliseR.html#cb129-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-12"><a href="chap-utiliseR.html#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="fu">BoucleSuivie</span>()</span></code></pre></div>
<pre><code>## ============================================================</code></pre>
<p></p>
</div>
<div id="replicate" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> replicate<a href="chap-utiliseR.html#replicate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>replicate()</code> répète une instruction.</p>
<p></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="chap-utiliseR.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">replicate</span>(<span class="dv">3</span>, <span class="fu">runif</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 0.9453453 0.5262818 0.7233425</code></pre>
<p></p>
<p>Ce code est équivalent à <code>runif(3)</code>, avec des performances similaires à celles de <code>vapply</code>: de 50 à 100 fois plus lent qu’une fonction vectorielle.</p>
<p></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="chap-utiliseR.html#cb133-1" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">runif</span>(<span class="dv">1</span>)), <span class="fu">runif</span>(<span class="dv">1000</span>))</span>
<span id="cb133-2"><a href="chap-utiliseR.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                        expr   median
## 1 replicate(1000, runif(1)) 4146.871
## 2               runif(1000)   34.169</code></pre>
<p></p>
</div>
<div id="vectorize" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Vectorize<a href="chap-utiliseR.html#vectorize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>Vectorize()</code> rend vectorielle une fonction qui ne l’est pas, par des boucles.
Ecrire plutôt les boucles.</p>
</div>
<div id="statistiques-marginales" class="section level3 hasAnchor" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Statistiques marginales<a href="chap-utiliseR.html#statistiques-marginales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>apply</code> applique une fonction aux lignes ou colonnes d’un objet en deux dimensions.</p>
<p><code>colSums</code> et ses semblables (<code>rowSums</code>, <code>colMeans</code>, <code>rowMeans</code>) sont optimisées.</p>
<p></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="chap-utiliseR.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Somme des colonnes numériques du jeu de données diamonds de ggplot()</span></span>
<span id="cb135-2"><a href="chap-utiliseR.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Boucle identique à l&#39;action de apply(, 2, )</span></span>
<span id="cb135-3"><a href="chap-utiliseR.html#cb135-3" aria-hidden="true" tabindex="-1"></a>BoucleSomme <span class="ot">&lt;-</span> <span class="cf">function</span>(Table) {</span>
<span id="cb135-4"><a href="chap-utiliseR.html#cb135-4" aria-hidden="true" tabindex="-1"></a>  Somme <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="fu">ncol</span>(Table))</span>
<span id="cb135-5"><a href="chap-utiliseR.html#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(Table)) Somme[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(Table[, i])</span>
<span id="cb135-6"><a href="chap-utiliseR.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Somme)</span>
<span id="cb135-7"><a href="chap-utiliseR.html#cb135-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-8"><a href="chap-utiliseR.html#cb135-8" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">BoucleSomme</span>(diamonds[<span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)]), </span>
<span id="cb135-9"><a href="chap-utiliseR.html#cb135-9" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">apply</span>(diamonds[<span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="dv">2</span>, sum), </span>
<span id="cb135-10"><a href="chap-utiliseR.html#cb135-10" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">colSums</span>(diamonds[<span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)]))</span>
<span id="cb135-11"><a href="chap-utiliseR.html#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mb)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                              expr   median
## 1   BoucleSomme(diamonds[-(2:4)]) 3.877607
## 2 apply(diamonds[-(2:4)], 2, sum) 9.904540
## 3       colSums(diamonds[-(2:4)]) 2.682257</code></pre>
<p></p>
<p><code>apply</code> clarifie le code mais est plus lent que la boucle, qui est à peine plus lente que <code>colSums</code>.</p>
</div>
</div>
<div id="sec:cpp" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Code C++<a href="chap-utiliseR.html#sec:cpp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>L’intégration de code C++ dans R est largement simplifiée par le package <strong>Rcpp</strong> mais reste difficile à déboguer et donc à réserver à du code très simple (pour éviter toute erreur) et répété un grand nombre de fois (pour mériter l’effort).
La préparation des données et leur vérification doivent être exécutées sous R, de même que le traitement et la présentation des résultats.</p>
<p>L’utilisation habituelle est l’inclusion de code C++ dans un package, mais l’utilisation hors package est possible:</p>
<ul>
<li>Le code C++ peut être inclus dans un document C++ (fichier avec l’extension <code>.cpp</code>): il est compilé par la commande <code>sourceCpp()</code> qui crée les fonctions R permettant d’appeler le code C++.</li>
<li>Dans un document RMarkdown, des bouts de code Rcpp peuvent être créés pour y insérer le code C++: ils sont compilés et interfacés pour R au moment du tricotage.</li>
</ul>
<p>L’exemple suivant montre comment créer une fonction C++ pour calculer le double d’un vecteur numérique.</p>
<p></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb137-1"><a href="chap-utiliseR.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb137-2"><a href="chap-utiliseR.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb137-3"><a href="chap-utiliseR.html#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="chap-utiliseR.html#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb137-5"><a href="chap-utiliseR.html#cb137-5" aria-hidden="true" tabindex="-1"></a>NumericVector timesTwo<span class="op">(</span>NumericVector x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb137-6"><a href="chap-utiliseR.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb137-7"><a href="chap-utiliseR.html#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Une fonction R du même nom que la fonction C++ est maintenant disponible.</p>
<p></p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="chap-utiliseR.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">timesTwo</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]  2  4  6  8 10</code></pre>
<p></p>
<p>Les performances sont deux ordres de grandeur plus rapides que le code R (voir l’étude de cas, section <a href="chap-utiliseR.html#sec:cas">2.7</a>).</p>
</div>
<div id="paralléliser-r" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Paralléliser R<a href="chap-utiliseR.html#paralléliser-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lorsque des calculs longs peuvent être découpés en tâches indépendantes, l’exécution simultanée (<em>parallèle</em>) de ces tâches permet de réduire le temps de calcul total à celui de la tâche la plus longue, auquel s’ajoute le coût de la mise en place de la parallélisation (création des tâches, récupération des résultats…).</p>
<p>Lire l’excellente introduction de Josh Errickson<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a> qui détaille les enjeux et les contraintes de la parallélisation.</p>
<p>Deux mécanismes sont disponibles pour l’exécution de code en parallèle:</p>
<ul>
<li><em>fork</em>: le processus en cours d’exécution est dupliqué sur plusieurs cœurs du processeur de l’ordinateur de calcul.
C’est la méthode la plus simple mais elle ne fonctionne pas sous Windows (limite du système d’exploitation).</li>
<li><em>socket</em>: un cluster est constitué, soit physiquement (un ensemble d’ordinateurs exécutant R est nécessaire) soit logiquement (une instance de R sur chaque cœur de l’ordinateur utilisé).
Les membres du cluster communiquent par le réseau (le réseau interne de l’ordinateur utilisé pour un cluster logique).</li>
</ul>
<p>Différents packages de R permettent de mettre en œuvre ces mécanismes.</p>
<div id="mclapply-fork" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> mclapply (fork)<a href="chap-utiliseR.html#mclapply-fork" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La fonction <code>mclapply</code> du package <strong>parallel</strong> a la même syntaxe que <code>lapply</code> mais parallélise l’exécution des boucles.
Sous Windows, elle n’a aucun effet puisque le système ne permet pas les <em>fork</em>: elle appelle simplement <code>lapply</code>.
Cependant, un contournement existe pour émuler <code>mclapply</code> sous Windows en appelant <code>parLapply</code>, qui utilise un cluster.</p>
<p></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="chap-utiliseR.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb140-2"><a href="chap-utiliseR.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="do">## mclapply.hack.R</span></span>
<span id="cb140-3"><a href="chap-utiliseR.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb140-4"><a href="chap-utiliseR.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Nathan VanHoudnos</span></span>
<span id="cb140-5"><a href="chap-utiliseR.html#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="do">## nathanvan AT northwestern FULL STOP edu</span></span>
<span id="cb140-6"><a href="chap-utiliseR.html#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="do">## July 14, 2014</span></span>
<span id="cb140-7"><a href="chap-utiliseR.html#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb140-8"><a href="chap-utiliseR.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="do">## A script to implement a hackish version of </span></span>
<span id="cb140-9"><a href="chap-utiliseR.html#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="do">## parallel:mclapply() on Windows machines.</span></span>
<span id="cb140-10"><a href="chap-utiliseR.html#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="do">## On Linux or Mac, the script has no effect</span></span>
<span id="cb140-11"><a href="chap-utiliseR.html#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="do">## beyond loading the parallel library. </span></span>
<span id="cb140-12"><a href="chap-utiliseR.html#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="chap-utiliseR.html#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(parallel)    </span></code></pre></div>
<pre><code>## Loading required package: parallel</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="chap-utiliseR.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the hack</span></span>
<span id="cb142-2"><a href="chap-utiliseR.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mc.cores argument added: Eric Marcon</span></span>
<span id="cb142-3"><a href="chap-utiliseR.html#cb142-3" aria-hidden="true" tabindex="-1"></a>mclapply.hack <span class="ot">&lt;-</span> <span class="cf">function</span>(..., <span class="at">mc.cores=</span><span class="fu">detectCores</span>()) {</span>
<span id="cb142-4"><a href="chap-utiliseR.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create a cluster</span></span>
<span id="cb142-5"><a href="chap-utiliseR.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  size.of.list <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">list</span>(...)[[<span class="dv">1</span>]])</span>
<span id="cb142-6"><a href="chap-utiliseR.html#cb142-6" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>( <span class="fu">min</span>(size.of.list, mc.cores) )</span>
<span id="cb142-7"><a href="chap-utiliseR.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-8"><a href="chap-utiliseR.html#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Find out the names of the loaded packages </span></span>
<span id="cb142-9"><a href="chap-utiliseR.html#cb142-9" aria-hidden="true" tabindex="-1"></a>  loaded.package.names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb142-10"><a href="chap-utiliseR.html#cb142-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Base packages</span></span>
<span id="cb142-11"><a href="chap-utiliseR.html#cb142-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sessionInfo</span>()<span class="sc">$</span>basePkgs,</span>
<span id="cb142-12"><a href="chap-utiliseR.html#cb142-12" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Additional packages</span></span>
<span id="cb142-13"><a href="chap-utiliseR.html#cb142-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>( <span class="fu">sessionInfo</span>()<span class="sc">$</span>otherPkgs ))</span>
<span id="cb142-14"><a href="chap-utiliseR.html#cb142-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-15"><a href="chap-utiliseR.html#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>( {</span>
<span id="cb142-16"><a href="chap-utiliseR.html#cb142-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-17"><a href="chap-utiliseR.html#cb142-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Copy over all of the objects within scope to</span></span>
<span id="cb142-18"><a href="chap-utiliseR.html#cb142-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">## all clusters. </span></span>
<span id="cb142-19"><a href="chap-utiliseR.html#cb142-19" aria-hidden="true" tabindex="-1"></a>    this.env <span class="ot">&lt;-</span> <span class="fu">environment</span>()</span>
<span id="cb142-20"><a href="chap-utiliseR.html#cb142-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span>( <span class="fu">identical</span>( this.env, <span class="fu">globalenv</span>() ) <span class="sc">==</span> <span class="cn">FALSE</span> ) {</span>
<span id="cb142-21"><a href="chap-utiliseR.html#cb142-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clusterExport</span>(cl,</span>
<span id="cb142-22"><a href="chap-utiliseR.html#cb142-22" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ls</span>(<span class="at">all.names=</span><span class="cn">TRUE</span>, <span class="at">env=</span>this.env),</span>
<span id="cb142-23"><a href="chap-utiliseR.html#cb142-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">envir=</span>this.env)</span>
<span id="cb142-24"><a href="chap-utiliseR.html#cb142-24" aria-hidden="true" tabindex="-1"></a>      this.env <span class="ot">&lt;-</span> <span class="fu">parent.env</span>(<span class="fu">environment</span>())</span>
<span id="cb142-25"><a href="chap-utiliseR.html#cb142-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb142-26"><a href="chap-utiliseR.html#cb142-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clusterExport</span>(cl,</span>
<span id="cb142-27"><a href="chap-utiliseR.html#cb142-27" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ls</span>(<span class="at">all.names=</span><span class="cn">TRUE</span>, <span class="at">env=</span><span class="fu">globalenv</span>()),</span>
<span id="cb142-28"><a href="chap-utiliseR.html#cb142-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">envir=</span><span class="fu">globalenv</span>())</span>
<span id="cb142-29"><a href="chap-utiliseR.html#cb142-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-30"><a href="chap-utiliseR.html#cb142-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Load the libraries on all the clusters</span></span>
<span id="cb142-31"><a href="chap-utiliseR.html#cb142-31" aria-hidden="true" tabindex="-1"></a>    <span class="do">## N.B. length(cl) returns the number of clusters</span></span>
<span id="cb142-32"><a href="chap-utiliseR.html#cb142-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">parLapply</span>( cl, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cl), <span class="cf">function</span>(xx){</span>
<span id="cb142-33"><a href="chap-utiliseR.html#cb142-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(loaded.package.names, <span class="cf">function</span>(yy) {</span>
<span id="cb142-34"><a href="chap-utiliseR.html#cb142-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">require</span>(yy , <span class="at">character.only=</span><span class="cn">TRUE</span>)})</span>
<span id="cb142-35"><a href="chap-utiliseR.html#cb142-35" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb142-36"><a href="chap-utiliseR.html#cb142-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-37"><a href="chap-utiliseR.html#cb142-37" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Run the lapply in parallel </span></span>
<span id="cb142-38"><a href="chap-utiliseR.html#cb142-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">parLapply</span>( cl, ...) )</span>
<span id="cb142-39"><a href="chap-utiliseR.html#cb142-39" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">finally =</span> {        </span>
<span id="cb142-40"><a href="chap-utiliseR.html#cb142-40" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Stop the cluster</span></span>
<span id="cb142-41"><a href="chap-utiliseR.html#cb142-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopCluster</span>(cl)</span>
<span id="cb142-42"><a href="chap-utiliseR.html#cb142-42" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb142-43"><a href="chap-utiliseR.html#cb142-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-44"><a href="chap-utiliseR.html#cb142-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-45"><a href="chap-utiliseR.html#cb142-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Warn the user if they are using Windows</span></span>
<span id="cb142-46"><a href="chap-utiliseR.html#cb142-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( <span class="fu">Sys.info</span>()[[<span class="st">&#39;sysname&#39;</span>]] <span class="sc">==</span> <span class="st">&#39;Windows&#39;</span> ){</span>
<span id="cb142-47"><a href="chap-utiliseR.html#cb142-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(</span>
<span id="cb142-48"><a href="chap-utiliseR.html#cb142-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb142-49"><a href="chap-utiliseR.html#cb142-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   *** Microsoft Windows detected ***</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-50"><a href="chap-utiliseR.html#cb142-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-51"><a href="chap-utiliseR.html#cb142-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   For technical reasons, the MS Windows version of mclapply()</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-52"><a href="chap-utiliseR.html#cb142-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   is implemented as a serial function instead of a parallel</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-53"><a href="chap-utiliseR.html#cb142-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   function.&quot;</span>,</span>
<span id="cb142-54"><a href="chap-utiliseR.html#cb142-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   </span><span class="sc">\n\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-55"><a href="chap-utiliseR.html#cb142-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   As a quick hack, we replace this serial version of mclapply()</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-56"><a href="chap-utiliseR.html#cb142-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   with a wrapper to parLapply() for this R session. Please see</span><span class="sc">\n\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-57"><a href="chap-utiliseR.html#cb142-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;     http://www.stat.cmu.edu/~nmv/2014/07/14/</span></span>
<span id="cb142-58"><a href="chap-utiliseR.html#cb142-58" aria-hidden="true" tabindex="-1"></a><span class="st">    implementing-mclapply-on-windows </span><span class="sc">\n\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-59"><a href="chap-utiliseR.html#cb142-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;   for details.</span><span class="sc">\n\n</span><span class="st">&quot;</span>))</span>
<span id="cb142-60"><a href="chap-utiliseR.html#cb142-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-61"><a href="chap-utiliseR.html#cb142-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-62"><a href="chap-utiliseR.html#cb142-62" aria-hidden="true" tabindex="-1"></a><span class="do">## If the OS is Windows, set mclapply to the</span></span>
<span id="cb142-63"><a href="chap-utiliseR.html#cb142-63" aria-hidden="true" tabindex="-1"></a><span class="do">## the hackish version. Otherwise, leave the</span></span>
<span id="cb142-64"><a href="chap-utiliseR.html#cb142-64" aria-hidden="true" tabindex="-1"></a><span class="do">## definition alone. </span></span>
<span id="cb142-65"><a href="chap-utiliseR.html#cb142-65" aria-hidden="true" tabindex="-1"></a>mclapply <span class="ot">&lt;-</span> <span class="cf">switch</span>( <span class="fu">Sys.info</span>()[[<span class="st">&#39;sysname&#39;</span>]],</span>
<span id="cb142-66"><a href="chap-utiliseR.html#cb142-66" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Windows =</span> {mclapply.hack}, </span>
<span id="cb142-67"><a href="chap-utiliseR.html#cb142-67" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Linux   =</span> {mclapply},</span>
<span id="cb142-68"><a href="chap-utiliseR.html#cb142-68" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Darwin  =</span> {mclapply})</span>
<span id="cb142-69"><a href="chap-utiliseR.html#cb142-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-70"><a href="chap-utiliseR.html#cb142-70" aria-hidden="true" tabindex="-1"></a><span class="do">## end mclapply.hack.R</span></span></code></pre></div>
<p></p>
<p>Le code suivant teste la parallélisation d’une fonction qui renvoie son argument inchangé après une pause d’un quart de seconde.
Ce document est tricoté avec <code>3</code> cœurs, qui sont tous utilisés sauf un pour ne pas saturer le système.</p>
<p></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="chap-utiliseR.html#cb143-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">time =</span> <span class="fl">0.25</span>) {</span>
<span id="cb143-2"><a href="chap-utiliseR.html#cb143-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(time)</span>
<span id="cb143-3"><a href="chap-utiliseR.html#cb143-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb143-4"><a href="chap-utiliseR.html#cb143-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-5"><a href="chap-utiliseR.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Laisser un coeur libre pour le système</span></span>
<span id="cb143-6"><a href="chap-utiliseR.html#cb143-6" aria-hidden="true" tabindex="-1"></a>nbCoeurs <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb143-7"><a href="chap-utiliseR.html#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Série : temps théorique = nbCoeurs/4 secondes</span></span>
<span id="cb143-8"><a href="chap-utiliseR.html#cb143-8" aria-hidden="true" tabindex="-1"></a>(tserie <span class="ot">&lt;-</span> <span class="fu">system.time</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>nbCoeurs, f)))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.003   0.000   0.606</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="chap-utiliseR.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallèle : temps théorique = 1/4 seconde</span></span>
<span id="cb145-2"><a href="chap-utiliseR.html#cb145-2" aria-hidden="true" tabindex="-1"></a>(tparallele <span class="ot">&lt;-</span> <span class="fu">system.time</span>(<span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>nbCoeurs, f, <span class="at">mc.cores =</span> nbCoeurs)))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.005   0.018   0.265</code></pre>
<p></p>
<p>La mise en place de la parallélisation a un coût d’environ <code>0.015</code> secondes ici.
Le temps d’exécution est bien plus long en parallèle sous Windows parce que la mise en place du cluster prend bien plus de temps que la parallélisation n’en fait gagner.
La parallélisation est intéressante pour des tâches plus longues, comme une pause d’un seconde.</p>
<p></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="chap-utiliseR.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Série</span></span>
<span id="cb147-2"><a href="chap-utiliseR.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>nbCoeurs, f, <span class="at">time =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.001   0.000   2.133</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="chap-utiliseR.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallèle</span></span>
<span id="cb149-2"><a href="chap-utiliseR.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>nbCoeurs, f, <span class="at">time =</span> <span class="dv">1</span>, <span class="at">mc.cores =</span> nbCoeurs))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.001   0.003   1.072</code></pre>
<p></p>
<p>Le temps additionnel nécessaire pour l’exécution parallèle du nouveau code est relativement plus faible: les coûts deviennent inférieurs à l’économie quand le temps de chaque tâche s’allonge.</p>
<p>Si le nombre de tâches parallèles dépasse le nombre de cœurs utilisés, les performances s’effondrent parce que la tâche supplémentaire doit être exécutée après les premières.</p>
<p></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="chap-utiliseR.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>nbCoeurs, f, <span class="at">time =</span> <span class="dv">1</span>, <span class="at">mc.cores =</span> nbCoeurs))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.002   0.006   1.078</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="chap-utiliseR.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>(nbCoeurs <span class="sc">+</span> <span class="dv">1</span>), f, <span class="at">time =</span> <span class="dv">1</span>, <span class="at">mc.cores =</span> nbCoeurs))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.003   0.007   2.171</code></pre>
<p></p>
<p>Le temps reste ensuite stable jusqu’au double du nombre de cœurs.
La figure <a href="chap-utiliseR.html#fig:r-parallele">2.2</a> montre l’évolution du temps de calcul en fonction du nombre de tâches.</p>

<p></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="chap-utiliseR.html#cb155-1" aria-hidden="true" tabindex="-1"></a>Taches <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>(<span class="dv">2</span> <span class="sc">*</span> nbCoeurs<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb155-2"><a href="chap-utiliseR.html#cb155-2" aria-hidden="true" tabindex="-1"></a>Temps <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Taches, <span class="cf">function</span>(nbTaches) {</span>
<span id="cb155-3"><a href="chap-utiliseR.html#cb155-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">system.time</span>(<span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>nbTaches, f, <span class="at">time=</span><span class="dv">1</span>, <span class="at">mc.cores=</span>nbCoeurs))</span>
<span id="cb155-4"><a href="chap-utiliseR.html#cb155-4" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb155-5"><a href="chap-utiliseR.html#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb155-6"><a href="chap-utiliseR.html#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(Taches, <span class="at">Temps=</span>Temps[<span class="st">&quot;elapsed&quot;</span>, ]) <span class="sc">%&gt;%</span> </span>
<span id="cb155-7"><a href="chap-utiliseR.html#cb155-7" aria-hidden="true" tabindex="-1"></a>  ggplot <span class="sc">+</span></span>
<span id="cb155-8"><a href="chap-utiliseR.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Taches, <span class="at">y =</span> Temps)) <span class="sc">+</span></span>
<span id="cb155-9"><a href="chap-utiliseR.html#cb155-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> nbCoeurs, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb155-10"><a href="chap-utiliseR.html#cb155-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span> <span class="sc">*</span> nbCoeurs, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:r-parallele"></span>
<img src="travailleR_files/figure-html/r-parallele-1.png" alt="Temps d’exécution en parallèle de tâches nécessitant une seconde (chaque tâche est une pause d’une seconde). Le nombre de tâches varie de 1 à deux fois le nombre de cœurs utilisés (égal à 2) plus une." width="80%" />
<p class="caption">
Figure 2.2: Temps d’exécution en parallèle de tâches nécessitant une seconde (chaque tâche est une pause d’une seconde). Le nombre de tâches varie de 1 à deux fois le nombre de cœurs utilisés (égal à <code>2</code>) plus une.
</p>
</div>
<p></p>
<p>La forme théorique de cette courbe est la suivante:</p>
<ul>
<li>pour une tâche, le temps est égal à une seconde plus le temps de mise en place de la parallélisation;</li>
<li>le temps devrait rester stable jusqu’au nombre de cœurs utilisés;</li>
<li>quand les cœurs sont tous utilisés (pointillés rouges), le temps devrait augmenter d’une seconde puis rester stable jusqu’à la limite suivante.</li>
</ul>
<p>En pratique, le temps de calcul est déterminé par d’autres facteurs difficilement prévisibles.
La bonne pratique est d’adapter le nombre de tâches au nombre de cœurs sous peine de perte de performance.</p>
</div>
<div id="parlapply-socket" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> parLapply (socket)<a href="chap-utiliseR.html#parlapply-socket" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>parLapply</code> nécessite de créer un cluster, exporter les variables utiles sur chaque noeud, charger les packages nécessaires sur chaque noeud, exécuter le code et enfin arrêter le cluster.
Le code de chaque étape se trouve dans la fonction <code>mclapply.hack</code> ci-dessus.</p>
<p>Pour un usage courant, <code>mclapply</code> est plus rapide, sauf sous Windows, et plus simple (y compris sous Windows grâce au contournement ci-dessus.)</p>
</div>
<div id="foreach" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> foreach<a href="chap-utiliseR.html#foreach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fonctionnement" class="section level4 hasAnchor" number="2.6.3.1">
<h4><span class="header-section-number">2.6.3.1</span> Fonctionnement<a href="chap-utiliseR.html#fonctionnement" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le package <strong>foreach</strong> permet un usage avancé de la parallélisation.
Lire ses vignettes.</p>
<p></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="chap-utiliseR.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Manuel</span></span>
<span id="cb156-2"><a href="chap-utiliseR.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&quot;foreach&quot;</span>, <span class="st">&quot;foreach&quot;</span>)</span>
<span id="cb156-3"><a href="chap-utiliseR.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Boucles imbriquées</span></span>
<span id="cb156-4"><a href="chap-utiliseR.html#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&quot;nested&quot;</span>, <span class="st">&quot;foreach&quot;</span>)</span></code></pre></div>
<p></p>
<p>Indépendamment de la parallélisation, <strong>foreach</strong> redéfinit les boucles <em>for</em>.</p>
<p></p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="chap-utiliseR.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb157-2"><a href="chap-utiliseR.html#cb157-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(i)</span>
<span id="cb157-3"><a href="chap-utiliseR.html#cb157-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-4"><a href="chap-utiliseR.html#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="co"># devient</span></span>
<span id="cb157-5"><a href="chap-utiliseR.html#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;foreach&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;foreach&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     accumulate, when</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="chap-utiliseR.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%do%</span> {</span>
<span id="cb160-2"><a href="chap-utiliseR.html#cb160-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(i)</span>
<span id="cb160-3"><a href="chap-utiliseR.html#cb160-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3</code></pre>
<p></p>
<p>La fonction <code>foreach</code> retourne une liste contenant les résultats de chaque boucle.
Les éléments de la liste peuvent être combinés par une fonction quelconque, comme <code>c</code>.</p>
<p></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="chap-utiliseR.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb162-2"><a href="chap-utiliseR.html#cb162-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(i)</span>
<span id="cb162-3"><a href="chap-utiliseR.html#cb162-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p></p>
<p>La fonction <code>foreach</code> est capable d’utiliser des itérateurs, c’est-à-dire des fonctions qui ne passent à la boucle que les données dont elle a besoin sans charger les autres en mémoire.
Ici, l’itérateur <code>icount</code> passe les valeurs 1, 2 et 3 individuellement, sans charger le vecteur 1:3 en mémoire.</p>
<p></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="chap-utiliseR.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;iterators&quot;</span>)</span>
<span id="cb164-2"><a href="chap-utiliseR.html#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span>(<span class="at">i =</span> <span class="fu">icount</span>(<span class="dv">3</span>), <span class="at">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb164-3"><a href="chap-utiliseR.html#cb164-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(i)</span>
<span id="cb164-4"><a href="chap-utiliseR.html#cb164-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p></p>
<p>Elle est donc très utile quand chaque objet de la boucle utilise une grande quantité de mémoire.</p>
</div>
<div id="parallélisation" class="section level4 hasAnchor" number="2.6.3.2">
<h4><span class="header-section-number">2.6.3.2</span> Parallélisation<a href="chap-utiliseR.html#parallélisation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Remplacer l’opérateur <code>%do%</code> par <code>%dopar%</code> parallélise les boucles, à condition qu’un adaptateur, c’est-à-dire un package intermédiaire entre <code>foreach</code> et un package chargé de l’implémentation de la parallélisation, soit chargé.
<strong>doParallel</strong> est un adaptateur pour utiliser le package <strong>parallel</strong> livré avec R.</p>
<p></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="chap-utiliseR.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb166-2"><a href="chap-utiliseR.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> nbCoeurs)</span>
<span id="cb166-3"><a href="chap-utiliseR.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Série</span></span>
<span id="cb166-4"><a href="chap-utiliseR.html#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">foreach</span>(<span class="at">i =</span> <span class="fu">icount</span>(nbCoeurs), <span class="at">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%do%</span></span>
<span id="cb166-5"><a href="chap-utiliseR.html#cb166-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb166-6"><a href="chap-utiliseR.html#cb166-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">f</span>(i)</span>
<span id="cb166-7"><a href="chap-utiliseR.html#cb166-7" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.004   0.000   0.629</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="chap-utiliseR.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallèle</span></span>
<span id="cb168-2"><a href="chap-utiliseR.html#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">foreach</span>(<span class="at">i =</span> <span class="fu">icount</span>(nbCoeurs), <span class="at">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%dopar%</span></span>
<span id="cb168-3"><a href="chap-utiliseR.html#cb168-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb168-4"><a href="chap-utiliseR.html#cb168-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">f</span>(i)</span>
<span id="cb168-5"><a href="chap-utiliseR.html#cb168-5" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.008   0.018   0.296</code></pre>
<p></p>
<p>Le coût fixe de la parallélisation est faible.</p>
</div>
</div>
</div>
<div id="sec:cas" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Etude de cas<a href="chap-utiliseR.html#sec:cas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cette étude de cas permet de tester les différentes techniques vues plus haut pour résoudre un problème concret.
L’objectif est de calculer la distance moyenne entre deux points d’un semis aléatoire de 1000 points dans une fenêtre carrée de côté 1.</p>
<p>Son espérance est calculable<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a>.
Elle est égale à <span class="math inline">\(\frac{2+\sqrt{2}+5\ln{(1+\sqrt{2})}}{15} \approx 0,5214\)</span>.</p>
<div id="création-des-données" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Création des données<a href="chap-utiliseR.html#création-des-données" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Le semis de points est créé avec le package <strong>spatstat</strong>.</p>
<p></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="chap-utiliseR.html#cb170-1" aria-hidden="true" tabindex="-1"></a>NbPoints <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb170-2"><a href="chap-utiliseR.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;spatstat&quot;</span>)</span>
<span id="cb170-3"><a href="chap-utiliseR.html#cb170-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">runifpoint</span>(NbPoints)</span></code></pre></div>
<p></p>
</div>
<div id="spatstat" class="section level3 hasAnchor" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Spatstat<a href="chap-utiliseR.html#spatstat" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La fonction <code>pairdist()</code> de <strong>spatstat</strong> retourne la matrice des distances entre les points.
La distance moyenne est calculée en divisant la somme par le nombre de paires de points distincts.</p>
<p></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="chap-utiliseR.html#cb171-1" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(d <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">pairdist</span>(X))<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span></span>
<span id="cb171-2"><a href="chap-utiliseR.html#cb171-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>))</span>
<span id="cb171-3"><a href="chap-utiliseR.html#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="co"># suppressmessages pour éliminer les messages superflus</span></span>
<span id="cb171-4"><a href="chap-utiliseR.html#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">autoplot</span>(mb))</span></code></pre></div>
<p><img src="travailleR_files/figure-html/pairdist-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="chap-utiliseR.html#cb172-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>La fonction est rapide parce qu’elle est codée en langage C dans le package <strong>spatstat</strong> pour le cœur de ses calculs.</p>
</div>
<div id="apply" class="section level3 hasAnchor" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> apply<a href="chap-utiliseR.html#apply" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La distance peut être calculée par deux <code>sapply()</code> imbriqués.</p>
<p></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="chap-utiliseR.html#cb174-1" aria-hidden="true" tabindex="-1"></a>fsapply1 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb174-2"><a href="chap-utiliseR.html#cb174-2" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(i) <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints,</span>
<span id="cb174-3"><a href="chap-utiliseR.html#cb174-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(j) <span class="fu">sqrt</span>((X<span class="sc">$</span>x[i] <span class="sc">-</span> X<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (X<span class="sc">$</span>y[i] <span class="sc">-</span> X<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb174-4"><a href="chap-utiliseR.html#cb174-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(distances)<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb174-5"><a href="chap-utiliseR.html#cb174-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb174-6"><a href="chap-utiliseR.html#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fsapply1</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.758   0.041   5.812</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="chap-utiliseR.html#cb176-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>Un peu de temps peut être gagnée en remplaçant <code>sapply</code> par <code>vapply</code>: le format des résultats n’a pas à être déterminé par la fonction.
Le gain est négligeable sur un long calcul comme celui-ci mais important pour des calculs courts.</p>
<p></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="chap-utiliseR.html#cb178-1" aria-hidden="true" tabindex="-1"></a>fsapply2 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb178-2"><a href="chap-utiliseR.html#cb178-2" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(i) <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints,</span>
<span id="cb178-3"><a href="chap-utiliseR.html#cb178-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(j) <span class="fu">sqrt</span>((X<span class="sc">$</span>x[i] <span class="sc">-</span> X<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (X<span class="sc">$</span>y[i] <span class="sc">-</span> X<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb178-4"><a href="chap-utiliseR.html#cb178-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span> <span class="sc">+</span> <span class="dv">0</span>)</span>
<span id="cb178-5"><a href="chap-utiliseR.html#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(distances)<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb178-6"><a href="chap-utiliseR.html#cb178-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-7"><a href="chap-utiliseR.html#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fsapply2</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.402   0.018   5.438</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="chap-utiliseR.html#cb180-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p>
Le format de sortie n’est pas toujours évident à écrire:</p>
<ul>
<li>il doit respecter la taille des données: un vecteur de taille 1000 pour la boucle externe, un scalaire pour la boucle interne.</li>
<li>il doit respecter leur type: <code>0</code> pour un entier, <code>0.0</code> pour un réel. Dans la boucle externe, l’ajout de <code>0.0</code> au vecteur d’entiers le transforme en vecteur de réels.</li>
</ul>
<p>Une amélioration plus significative consiste à ne calculer les racines carrées qu’à la fin de la boucle, pour profiter de la vectorisation de la fonction.</p>
<p></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="chap-utiliseR.html#cb182-1" aria-hidden="true" tabindex="-1"></a>fsapply3 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb182-2"><a href="chap-utiliseR.html#cb182-2" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(i) <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints,</span>
<span id="cb182-3"><a href="chap-utiliseR.html#cb182-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(j) (X<span class="sc">$</span>x[i] <span class="sc">-</span> X<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (X<span class="sc">$</span>y[i] <span class="sc">-</span> X<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb182-4"><a href="chap-utiliseR.html#cb182-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span> <span class="sc">+</span> <span class="dv">0</span>)</span>
<span id="cb182-5"><a href="chap-utiliseR.html#cb182-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">sqrt</span>(distances))<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb182-6"><a href="chap-utiliseR.html#cb182-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-7"><a href="chap-utiliseR.html#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fsapply3</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.333   0.023   5.362</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="chap-utiliseR.html#cb184-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>Les calculs sont effectués deux fois (distance entre les points <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>, mais aussi entre les points <span class="math inline">\(j\)</span> et <span class="math inline">\(i\)</span>): un test sur les indices permet de diviser presque le temps par 2 (pas tout à fait parce que les boucles sans calcul, qui retournent <span class="math inline">\(0\)</span>, prennent du temps).</p>
<p></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="chap-utiliseR.html#cb186-1" aria-hidden="true" tabindex="-1"></a>fsapply4 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb186-2"><a href="chap-utiliseR.html#cb186-2" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(i) {</span>
<span id="cb186-3"><a href="chap-utiliseR.html#cb186-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(j) {</span>
<span id="cb186-4"><a href="chap-utiliseR.html#cb186-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (j <span class="sc">&gt;</span> i) {</span>
<span id="cb186-5"><a href="chap-utiliseR.html#cb186-5" aria-hidden="true" tabindex="-1"></a>                (X<span class="sc">$</span>x[i] <span class="sc">-</span> X<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (X<span class="sc">$</span>y[i] <span class="sc">-</span> X<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb186-6"><a href="chap-utiliseR.html#cb186-6" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb186-7"><a href="chap-utiliseR.html#cb186-7" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span></span>
<span id="cb186-8"><a href="chap-utiliseR.html#cb186-8" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb186-9"><a href="chap-utiliseR.html#cb186-9" aria-hidden="true" tabindex="-1"></a>        }, <span class="dv">0</span>)</span>
<span id="cb186-10"><a href="chap-utiliseR.html#cb186-10" aria-hidden="true" tabindex="-1"></a>    }, <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span> <span class="sc">+</span> <span class="dv">0</span>)</span>
<span id="cb186-11"><a href="chap-utiliseR.html#cb186-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">sqrt</span>(distances))<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb186-12"><a href="chap-utiliseR.html#cb186-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb186-13"><a href="chap-utiliseR.html#cb186-13" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fsapply4</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   3.131   0.012   3.157</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="chap-utiliseR.html#cb188-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>En parallèle, le temps de calcul n’est pas amélioré sous Windows parce que les tâches individuelles sont trop courtes.
Sous MacOS ou Linux, le calcul est accéléré.</p>
<p></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="chap-utiliseR.html#cb190-1" aria-hidden="true" tabindex="-1"></a>fsapply5 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb190-2"><a href="chap-utiliseR.html#cb190-2" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(i) {</span>
<span id="cb190-3"><a href="chap-utiliseR.html#cb190-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>NbPoints, <span class="cf">function</span>(j) {</span>
<span id="cb190-4"><a href="chap-utiliseR.html#cb190-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (j <span class="sc">&gt;</span> i) {</span>
<span id="cb190-5"><a href="chap-utiliseR.html#cb190-5" aria-hidden="true" tabindex="-1"></a>                (X<span class="sc">$</span>x[i] <span class="sc">-</span> X<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (X<span class="sc">$</span>y[i] <span class="sc">-</span> X<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb190-6"><a href="chap-utiliseR.html#cb190-6" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb190-7"><a href="chap-utiliseR.html#cb190-7" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span></span>
<span id="cb190-8"><a href="chap-utiliseR.html#cb190-8" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb190-9"><a href="chap-utiliseR.html#cb190-9" aria-hidden="true" tabindex="-1"></a>        }, <span class="dv">0</span>)</span>
<span id="cb190-10"><a href="chap-utiliseR.html#cb190-10" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb190-11"><a href="chap-utiliseR.html#cb190-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">sqrt</span>(<span class="fu">simplify2array</span>(distances)))<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span></span>
<span id="cb190-12"><a href="chap-utiliseR.html#cb190-12" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb190-13"><a href="chap-utiliseR.html#cb190-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb190-14"><a href="chap-utiliseR.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fsapply5</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   3.596   0.396   2.035</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="chap-utiliseR.html#cb192-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
</div>
<div id="boucle-for" class="section level3 hasAnchor" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> boucle for<a href="chap-utiliseR.html#boucle-for" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Une boucle for est plus rapide et consomme moins de mémoire parce qu’elle ne stocke pas la matrice de distances.</p>
<p></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="chap-utiliseR.html#cb194-1" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb194-2"><a href="chap-utiliseR.html#cb194-2" aria-hidden="true" tabindex="-1"></a>ffor <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb194-3"><a href="chap-utiliseR.html#cb194-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(NbPoints <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb194-4"><a href="chap-utiliseR.html#cb194-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>NbPoints) {</span>
<span id="cb194-5"><a href="chap-utiliseR.html#cb194-5" aria-hidden="true" tabindex="-1"></a>            distance <span class="ot">&lt;-</span> distance <span class="sc">+</span> <span class="fu">sqrt</span>((X<span class="sc">$</span>x[i] <span class="sc">-</span> X<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb194-6"><a href="chap-utiliseR.html#cb194-6" aria-hidden="true" tabindex="-1"></a>                (X<span class="sc">$</span>y[i] <span class="sc">-</span> X<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb194-7"><a href="chap-utiliseR.html#cb194-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb194-8"><a href="chap-utiliseR.html#cb194-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb194-9"><a href="chap-utiliseR.html#cb194-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(distance<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb194-10"><a href="chap-utiliseR.html#cb194-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-11"><a href="chap-utiliseR.html#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Temps de calcul, mémorisé</span></span>
<span id="cb194-12"><a href="chap-utiliseR.html#cb194-12" aria-hidden="true" tabindex="-1"></a>(for_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">ffor</span>()))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.816   0.010   1.829</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="chap-utiliseR.html#cb196-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>C’est la façon la plus simple et efficace d’écrire ce code sans parallélisation et en se limitant au langage de R.</p>
</div>
<div id="boucle-foreach" class="section level3 hasAnchor" number="2.7.5">
<h3><span class="header-section-number">2.7.5</span> boucle foreach<a href="chap-utiliseR.html#boucle-foreach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Deux boucles foreach imbriquées sont nécessaires ici: elles sont extrêmement lentes en comparaison d’une boucle simple.
Le test est lancé ici avec 10 fois moins de points, donc 100 fois moins de distances à calculer.</p>
<p></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="chap-utiliseR.html#cb198-1" aria-hidden="true" tabindex="-1"></a>NbPointsReduit <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb198-2"><a href="chap-utiliseR.html#cb198-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">runifpoint</span>(NbPointsReduit)</span>
<span id="cb198-3"><a href="chap-utiliseR.html#cb198-3" aria-hidden="true" tabindex="-1"></a>fforeach1 <span class="ot">&lt;-</span> <span class="cf">function</span>(Y) {</span>
<span id="cb198-4"><a href="chap-utiliseR.html#cb198-4" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>NbPointsReduit, <span class="at">.combine =</span> <span class="st">&quot;cbind&quot;</span>) <span class="sc">%:%</span></span>
<span id="cb198-5"><a href="chap-utiliseR.html#cb198-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">foreach</span>(<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span>NbPointsReduit, <span class="at">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb198-6"><a href="chap-utiliseR.html#cb198-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (j <span class="sc">&gt;</span> i) {</span>
<span id="cb198-7"><a href="chap-utiliseR.html#cb198-7" aria-hidden="true" tabindex="-1"></a>            (Y<span class="sc">$</span>x[i] <span class="sc">-</span> Y<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (Y<span class="sc">$</span>y[i] <span class="sc">-</span> Y<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb198-8"><a href="chap-utiliseR.html#cb198-8" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb198-9"><a href="chap-utiliseR.html#cb198-9" aria-hidden="true" tabindex="-1"></a>            <span class="dv">0</span></span>
<span id="cb198-10"><a href="chap-utiliseR.html#cb198-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb198-11"><a href="chap-utiliseR.html#cb198-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb198-12"><a href="chap-utiliseR.html#cb198-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">sqrt</span>(distances))<span class="sc">/</span>NbPointsReduit<span class="sc">/</span>(NbPointsReduit <span class="sc">-</span></span>
<span id="cb198-13"><a href="chap-utiliseR.html#cb198-13" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb198-14"><a href="chap-utiliseR.html#cb198-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb198-15"><a href="chap-utiliseR.html#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fforeach1</span>(Y))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   2.786   0.028   2.818</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="chap-utiliseR.html#cb200-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5181951</code></pre>
<p></p>
<p>Les boucles foreach imbriquées sont à réserver à des tâches très longues (plusieurs secondes au moins) pour amortir les coûts fixes de leur mise en place.</p>
<p>La parallélisation est efficace dans le code ci-dessous, notamment parce qu’elle permet d’éviter les boucles foreach imbriquées.
En revanche, les distances sont calculées deux fois.
La performance reste très inférieure à celle d’une simple boucle for (rappel: 100 fois moins de distances sont calculées).</p>
<p></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="chap-utiliseR.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> <span class="fu">detectCores</span>())</span>
<span id="cb202-2"><a href="chap-utiliseR.html#cb202-2" aria-hidden="true" tabindex="-1"></a>fforeach3 <span class="ot">&lt;-</span> <span class="cf">function</span>(Y) {</span>
<span id="cb202-3"><a href="chap-utiliseR.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> </span>
<span id="cb202-4"><a href="chap-utiliseR.html#cb202-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span>(<span class="at">i=</span><span class="fu">icount</span>(NbPointsReduit), </span>
<span id="cb202-5"><a href="chap-utiliseR.html#cb202-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.combine=</span><span class="st">&#39;+&#39;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb202-6"><a href="chap-utiliseR.html#cb202-6" aria-hidden="true" tabindex="-1"></a>      distance <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb202-7"><a href="chap-utiliseR.html#cb202-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Y<span class="sc">$</span>n) {</span>
<span id="cb202-8"><a href="chap-utiliseR.html#cb202-8" aria-hidden="true" tabindex="-1"></a>        distance <span class="ot">&lt;-</span> distance <span class="sc">+</span> </span>
<span id="cb202-9"><a href="chap-utiliseR.html#cb202-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sqrt</span>((Y<span class="sc">$</span>x[i]<span class="sc">-</span>Y<span class="sc">$</span>x[j])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (Y<span class="sc">$</span>y[i]<span class="sc">-</span>Y<span class="sc">$</span>y[j])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb202-10"><a href="chap-utiliseR.html#cb202-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb202-11"><a href="chap-utiliseR.html#cb202-11" aria-hidden="true" tabindex="-1"></a>      distance</span>
<span id="cb202-12"><a href="chap-utiliseR.html#cb202-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb202-13"><a href="chap-utiliseR.html#cb202-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(distances<span class="sc">/</span>NbPointsReduit<span class="sc">/</span>(NbPointsReduit<span class="dv">-1</span>))</span>
<span id="cb202-14"><a href="chap-utiliseR.html#cb202-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb202-15"><a href="chap-utiliseR.html#cb202-15" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">fforeach3</span>(Y))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.134   0.067   0.164</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="chap-utiliseR.html#cb204-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5181951</code></pre>
<p></p>
<p><strong>foreach</strong> dispose d’adaptateurs optimisés permettant d’utiliser des clusters physiques par exemple.
Son intérêt est limité avec le package <strong>parallel</strong>.</p>
</div>
<div id="rcpp" class="section level3 hasAnchor" number="2.7.6">
<h3><span class="header-section-number">2.7.6</span> RCpp<a href="chap-utiliseR.html#rcpp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La fonction C++ permettant de calculer les distances est la suivante.</p>
<p></p>
<div class="sourceCode" id="cb206"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb206-1"><a href="chap-utiliseR.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb206-2"><a href="chap-utiliseR.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb206-3"><a href="chap-utiliseR.html#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="chap-utiliseR.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb206-5"><a href="chap-utiliseR.html#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> MeanDistance<span class="op">(</span>NumericVector x<span class="op">,</span> NumericVector y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb206-6"><a href="chap-utiliseR.html#cb206-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> distance<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb206-7"><a href="chap-utiliseR.html#cb206-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> dx<span class="op">,</span> dy<span class="op">;</span></span>
<span id="cb206-8"><a href="chap-utiliseR.html#cb206-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="op">(</span>x<span class="op">.</span>length<span class="op">()-</span><span class="dv">1</span><span class="op">);</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb206-9"><a href="chap-utiliseR.html#cb206-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j<span class="op">=</span>i<span class="op">+</span><span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> x<span class="op">.</span>length<span class="op">();</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb206-10"><a href="chap-utiliseR.html#cb206-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate distance</span></span>
<span id="cb206-11"><a href="chap-utiliseR.html#cb206-11" aria-hidden="true" tabindex="-1"></a>        dx <span class="op">=</span> x<span class="op">[</span>i<span class="op">]-</span>x<span class="op">[</span>j<span class="op">];</span></span>
<span id="cb206-12"><a href="chap-utiliseR.html#cb206-12" aria-hidden="true" tabindex="-1"></a>        dy <span class="op">=</span> y<span class="op">[</span>i<span class="op">]-</span>y<span class="op">[</span>j<span class="op">];</span></span>
<span id="cb206-13"><a href="chap-utiliseR.html#cb206-13" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">+=</span> sqrt<span class="op">(</span>dx<span class="op">*</span>dx <span class="op">+</span> dy<span class="op">*</span>dy<span class="op">);</span></span>
<span id="cb206-14"><a href="chap-utiliseR.html#cb206-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb206-15"><a href="chap-utiliseR.html#cb206-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb206-16"><a href="chap-utiliseR.html#cb206-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> distance<span class="op">/(</span><span class="dt">double</span><span class="op">)(</span>x<span class="op">.</span>length<span class="op">()/</span><span class="dv">2</span><span class="op">*(</span>x<span class="op">.</span>length<span class="op">()-</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb206-17"><a href="chap-utiliseR.html#cb206-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Elle est appelée dans R très simplement.
Le temps d’exécution est très court.</p>
<p></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="chap-utiliseR.html#cb207-1" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(d <span class="ot">&lt;-</span> <span class="fu">MeanDistance</span>(X<span class="sc">$</span>x, X<span class="sc">$</span>y))</span>
<span id="cb207-2"><a href="chap-utiliseR.html#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="co"># suppressmessages pour éliminer les messages superflus</span></span>
<span id="cb207-3"><a href="chap-utiliseR.html#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">autoplot</span>(mb))</span></code></pre></div>
<p><img src="travailleR_files/figure-html/RCpp-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="chap-utiliseR.html#cb208-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
</div>
<div id="rcppparallel" class="section level3 hasAnchor" number="2.7.7">
<h3><span class="header-section-number">2.7.7</span> RcppParallel<a href="chap-utiliseR.html#rcppparallel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>RcppParallel</strong> permet d’interfacer du code C++ parallélisé, au prix d’une syntaxe plus complexe qu’avec <strong>RCpp</strong>.
Une documentation est disponible<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>.</p>
<p>La fonction C++ exportée dans R ne réalise pas les calculs mais organise seulement l’exécution en parallèle d’une autre fonction, non exportée, de type <code>Worker</code>.</p>
<p>Deux fonctions (C++) de parallélisation sont disponibles pour deux types de tâches:</p>
<ul>
<li><code>parallelReduce</code> pour l’accumulation d’une valeur, utilisée ici pour additionner les distances.</li>
<li><code>parallelFor</code> pour remplir une matrice de résultats.</li>
</ul>
<p>La syntaxe du <code>Worker</code> est un peu laborieuse mais assez simple à adapter: les constructeurs initialisent les variables C à partir des valeurs transmises par R et déclarent la parallélisation.</p>
<p></p>
<div class="sourceCode" id="cb210"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb210-1"><a href="chap-utiliseR.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::depends(RcppParallel)]]</span></span>
<span id="cb210-2"><a href="chap-utiliseR.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb210-3"><a href="chap-utiliseR.html#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;RcppParallel.h&gt;</span></span>
<span id="cb210-4"><a href="chap-utiliseR.html#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb210-5"><a href="chap-utiliseR.html#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> RcppParallel<span class="op">;</span></span>
<span id="cb210-6"><a href="chap-utiliseR.html#cb210-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-7"><a href="chap-utiliseR.html#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Fonction de travail, non exportée</span></span>
<span id="cb210-8"><a href="chap-utiliseR.html#cb210-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> TotalDistanceWrkr <span class="op">:</span> <span class="kw">public</span> Worker</span>
<span id="cb210-9"><a href="chap-utiliseR.html#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb210-10"><a href="chap-utiliseR.html#cb210-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// source vectors</span></span>
<span id="cb210-11"><a href="chap-utiliseR.html#cb210-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> RVector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> Rx<span class="op">;</span></span>
<span id="cb210-12"><a href="chap-utiliseR.html#cb210-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> RVector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> Ry<span class="op">;</span></span>
<span id="cb210-13"><a href="chap-utiliseR.html#cb210-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb210-14"><a href="chap-utiliseR.html#cb210-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// accumulated value</span></span>
<span id="cb210-15"><a href="chap-utiliseR.html#cb210-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> distance<span class="op">;</span></span>
<span id="cb210-16"><a href="chap-utiliseR.html#cb210-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb210-17"><a href="chap-utiliseR.html#cb210-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// constructors</span></span>
<span id="cb210-18"><a href="chap-utiliseR.html#cb210-18" aria-hidden="true" tabindex="-1"></a>  TotalDistanceWrkr<span class="op">(</span><span class="at">const</span> NumericVector x<span class="op">,</span> <span class="at">const</span> NumericVector y<span class="op">)</span> <span class="op">:</span></span>
<span id="cb210-19"><a href="chap-utiliseR.html#cb210-19" aria-hidden="true" tabindex="-1"></a>    Rx<span class="op">(</span>x<span class="op">),</span> Ry<span class="op">(</span>y<span class="op">),</span> distance<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">{}</span></span>
<span id="cb210-20"><a href="chap-utiliseR.html#cb210-20" aria-hidden="true" tabindex="-1"></a>  TotalDistanceWrkr<span class="op">(</span><span class="at">const</span> TotalDistanceWrkr<span class="op">&amp;</span> totalDistanceWrkr<span class="op">,</span> Split<span class="op">)</span> <span class="op">:</span></span>
<span id="cb210-21"><a href="chap-utiliseR.html#cb210-21" aria-hidden="true" tabindex="-1"></a>    Rx<span class="op">(</span>totalDistanceWrkr<span class="op">.</span>Rx<span class="op">),</span> Ry<span class="op">(</span>totalDistanceWrkr<span class="op">.</span>Ry<span class="op">),</span>  distance<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">{}</span></span>
<span id="cb210-22"><a href="chap-utiliseR.html#cb210-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb210-23"><a href="chap-utiliseR.html#cb210-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// count neighbors</span></span>
<span id="cb210-24"><a href="chap-utiliseR.html#cb210-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> <span class="kw">operator</span><span class="op">()(</span><span class="bu">std::</span>size_t<span class="op"> </span>begin<span class="op">,</span> <span class="bu">std::</span>size_t<span class="op"> </span>end<span class="op">)</span> <span class="op">{</span></span>
<span id="cb210-25"><a href="chap-utiliseR.html#cb210-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> dx<span class="op">,</span> dy<span class="op">;</span></span>
<span id="cb210-26"><a href="chap-utiliseR.html#cb210-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> Npoints <span class="op">=</span> Rx<span class="op">.</span>length<span class="op">();</span></span>
<span id="cb210-27"><a href="chap-utiliseR.html#cb210-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-28"><a href="chap-utiliseR.html#cb210-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> begin<span class="op">;</span> i <span class="op">&lt;</span> end<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb210-29"><a href="chap-utiliseR.html#cb210-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> j<span class="op">=</span>i<span class="op">+</span><span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> Npoints<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb210-30"><a href="chap-utiliseR.html#cb210-30" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Calculate squared distance</span></span>
<span id="cb210-31"><a href="chap-utiliseR.html#cb210-31" aria-hidden="true" tabindex="-1"></a>          dx <span class="op">=</span> Rx<span class="op">[</span>i<span class="op">]-</span>Rx<span class="op">[</span>j<span class="op">];</span></span>
<span id="cb210-32"><a href="chap-utiliseR.html#cb210-32" aria-hidden="true" tabindex="-1"></a>          dy <span class="op">=</span> Ry<span class="op">[</span>i<span class="op">]-</span>Ry<span class="op">[</span>j<span class="op">];</span></span>
<span id="cb210-33"><a href="chap-utiliseR.html#cb210-33" aria-hidden="true" tabindex="-1"></a>          distance <span class="op">+=</span> sqrt<span class="op">(</span>dx<span class="op">*</span>dx <span class="op">+</span> dy<span class="op">*</span>dy<span class="op">);</span></span>
<span id="cb210-34"><a href="chap-utiliseR.html#cb210-34" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb210-35"><a href="chap-utiliseR.html#cb210-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb210-36"><a href="chap-utiliseR.html#cb210-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb210-37"><a href="chap-utiliseR.html#cb210-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-38"><a href="chap-utiliseR.html#cb210-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// join my value with that of another Sum</span></span>
<span id="cb210-39"><a href="chap-utiliseR.html#cb210-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> join<span class="op">(</span><span class="at">const</span> TotalDistanceWrkr<span class="op">&amp;</span> rhs<span class="op">)</span> <span class="op">{</span> </span>
<span id="cb210-40"><a href="chap-utiliseR.html#cb210-40" aria-hidden="true" tabindex="-1"></a>    distance <span class="op">+=</span> rhs<span class="op">.</span>distance<span class="op">;</span> </span>
<span id="cb210-41"><a href="chap-utiliseR.html#cb210-41" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb210-42"><a href="chap-utiliseR.html#cb210-42" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb210-43"><a href="chap-utiliseR.html#cb210-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-44"><a href="chap-utiliseR.html#cb210-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-45"><a href="chap-utiliseR.html#cb210-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Fonction exportée</span></span>
<span id="cb210-46"><a href="chap-utiliseR.html#cb210-46" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb210-47"><a href="chap-utiliseR.html#cb210-47" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> TotalDistance<span class="op">(</span>NumericVector x<span class="op">,</span> NumericVector y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb210-48"><a href="chap-utiliseR.html#cb210-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb210-49"><a href="chap-utiliseR.html#cb210-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Declare TotalDistanceWrkr instance</span></span>
<span id="cb210-50"><a href="chap-utiliseR.html#cb210-50" aria-hidden="true" tabindex="-1"></a>  TotalDistanceWrkr totalDistanceWrkr<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb210-51"><a href="chap-utiliseR.html#cb210-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb210-52"><a href="chap-utiliseR.html#cb210-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">// call parallel_reduce to start the work</span></span>
<span id="cb210-53"><a href="chap-utiliseR.html#cb210-53" aria-hidden="true" tabindex="-1"></a>  parallelReduce<span class="op">(</span><span class="dv">0</span><span class="op">,</span> x<span class="op">.</span>length<span class="op">(),</span> totalDistanceWrkr<span class="op">);</span></span>
<span id="cb210-54"><a href="chap-utiliseR.html#cb210-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb210-55"><a href="chap-utiliseR.html#cb210-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return the result</span></span>
<span id="cb210-56"><a href="chap-utiliseR.html#cb210-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> totalDistanceWrkr<span class="op">.</span>distance<span class="op">;</span></span>
<span id="cb210-57"><a href="chap-utiliseR.html#cb210-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>L’usage dans R est identique à celui des fonctions C++ interfacées par <strong>RCpp</strong>.</p>
<p></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="chap-utiliseR.html#cb211-1" aria-hidden="true" tabindex="-1"></a>(mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(d <span class="ot">&lt;-</span> <span class="fu">TotalDistance</span>(X<span class="sc">$</span>x, X<span class="sc">$</span>y)<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span></span>
<span id="cb211-2"><a href="chap-utiliseR.html#cb211-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Unit: microseconds
##                                                      expr
##  d &lt;- TotalDistance(X$x, X$y)/NbPoints/(NbPoints - 1) * 2
##      min      lq     mean   median      uq      max neval
##  785.276 790.867 853.8495 794.5385 802.954 2661.118   100</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="chap-utiliseR.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># suppressmessages pour éliminer les messages superflus</span></span>
<span id="cb213-2"><a href="chap-utiliseR.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">autoplot</span>(mb))</span></code></pre></div>
<p><img src="travailleR_files/figure-html/RcppParallel-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="chap-utiliseR.html#cb214-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>Le temps de mise en place des tâches parallèles est bien plus long que le temps de calcul en série.</p>
<p>En multipliant le nombre de points par 50, le temps de calcul en série doit être multiplié par 2500 environ.</p>
<p></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="chap-utiliseR.html#cb216-1" aria-hidden="true" tabindex="-1"></a>NbPoints <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb216-2"><a href="chap-utiliseR.html#cb216-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">runifpoint</span>(NbPoints)</span>
<span id="cb216-3"><a href="chap-utiliseR.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">MeanDistance</span>(X<span class="sc">$</span>x, X<span class="sc">$</span>y))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   7.093   0.026   7.141</code></pre>
<p></p>
<p>En parallèle, le temps augmente peu: la parallélisation devient réellement efficace.
Ce temps est à comparer à celui de la boucle for de référence, multiplié par 2500, soit <code>4572</code> secondes.</p>
<p></p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="chap-utiliseR.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d <span class="ot">&lt;-</span> <span class="fu">TotalDistance</span>(X<span class="sc">$</span>x, X<span class="sc">$</span>y)<span class="sc">/</span>NbPoints<span class="sc">/</span>(NbPoints <span class="sc">-</span></span>
<span id="cb218-2"><a href="chap-utiliseR.html#cb218-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.217   0.039   2.072</code></pre>
<p></p>
</div>
<div id="conclusions-sur-loptimisation-de-la-vitesse-du-code" class="section level3 hasAnchor" number="2.7.8">
<h3><span class="header-section-number">2.7.8</span> Conclusions sur l’optimisation de la vitesse du code<a href="chap-utiliseR.html#conclusions-sur-loptimisation-de-la-vitesse-du-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>De cette étude de cas, plusieurs enseignements peuvent être retirés:</p>
<ul>
<li>une boucle for est une bonne base pour des calculs répétitifs, plus rapide que <code>vapply()</code>, simple à lire et à écrire;</li>
<li>des fonctions optimisées peuvent exister dans les packages de R pour des tâches courantes (ici, la fonction <code>pairdist()</code> de <strong>spatstat</strong> est deux ordres de grandeur plus rapide que la boucle for);</li>
<li>le recours au code C++ permet d’accélérer significativement les calculs, de trois ordres de grandeur ici;</li>
<li>la parallélisation du code C++ divise encore le temps de calcul par environ la moitié du nombre de cœurs pour de longs calculs.</li>
</ul>
<p>Au-delà de cet exemple, l’optimisation du temps de calcul sous R peut être compliquée si elle passe par la parallélisation et l’écriture de code C++.
L’effort doit donc être concentré sur les calculs réellement long alors que la lisibilité du code doit rester la priorité pour le code courant.
Le code C est assez facile à intégrer grâce à <strong>RCpp</strong> et sa parallélisation n’est pas très coûteuse avec <strong>RCppParallel</strong>.</p>
<p>L’utilisation de boucles for n’est plus pénalisante depuis la version 3.5 de R.
L’écriture de code vectoriel, utilisant <code>sapply()</code> se justifie toujours pour sa lisibilité.</p>
<p>Le choix de paralléliser le code doit être évalué selon le temps d’exécution de chaque tâche parallélisable.
S’il dépasse quelques secondes, la parallélisation se justifie.
<code>mclapply()</code> remplace <code>lapply()</code> sans aucun effort, mais nécessite un hack (fourni ici) sous Windows.
<code>foreach()</code> ne remplace pas <code>for()</code> aussi simplement et ne se justifie que pour des tâches très lourdes en termes de mémoire et de temps de calcul, en particulier sur des clusters de calcul.</p>
</div>
</div>
<div id="sec:targets" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Flux de travail<a href="chap-utiliseR.html#sec:targets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Le package <strong>targets</strong> permet de gérer un flux de travail (<em>workflow</em>), c’est-à dire de décomposer le code en tâches élémentaires appelées <em>cibles</em> qui s’enchaînent, dont le résultat est stocké dans une variable, elle-même enregistrée sur le disque.
En cas de changement dans le code ou les données utilisées, seules les cibles concernées sont réévaluées.</p>
<p>Le fonctionnement du flux est proche de celui d’un cache, mais ne dépend pas de l’ordinateur sur lequel il s’exécute.
<strong>targets</strong> permet de visualiser les tâches obsolètes, d’intégrer le flux à un projet de document (voir section <a href="chap-rediger.html#sec:targetsmd">4.9</a>), et même de faire appel à un cluster de calcul pour traiter les tâches en parallèle.</p>
<div id="principe-de-fonctionnement" class="section level3 hasAnchor" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Principe de fonctionnement<a href="chap-utiliseR.html#principe-de-fonctionnement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La documentation<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> de <strong>targets</strong> est détaillée et fournit un exemple travaillé pour apprendre à utiliser le package<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>.
Elle n’est pas reprise ici, mais les principes du fonctionnement du flux sont expliqués.</p>
<p>Le flux de travail est unique pour un projet donné.
Il est codé dans le fichier <code>_targets.R</code> à la racine du projet.
Il contient:</p>
<ul>
<li>des commandes globales, comme le chargement des packages;</li>
<li>une liste de cibles, qui décrivent le code à exécuter et la variable qui stocke leur résultat.</li>
</ul>
<p>Le flux est exécuté par la fonction <code>tar_make()</code> qui met à jour les cibles qui le nécessitent.
Son contenu est placé dans le dossier <code>_targets</code>.
Les variables stockées sont lues par <code>tar_read()</code>.</p>
<p>Si le projet nécessite de longs calculs, <strong>targets</strong> permet de n’exécuter que ceux qui sont nécessaires.
Si le projet est partagé ou placé sous contrôle de source (chapitre <a href="chap-git.html#chap-git">3</a>), le résultat des calcul est intégré l’est aussi.
Enfin, si le projet est un document (chapitre <a href="chap-rediger.html#chap-rediger">4</a>), son formatage est complètement indépendant du calcul de son contenu, pour un gain de temps qui peut être considérable.</p>
</div>
<div id="exemple-minimal" class="section level3 hasAnchor" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Exemple minimal<a href="chap-utiliseR.html#exemple-minimal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>L’exemple suivant est encore plus simple que celui du manuel de <strong>targets</strong>, qui permettra d’aller plus loin.
Il reprend l’étude de cas précédente: un jeu de points est généré puis la distance moyenne entre les points obtenus est calculée.
Une carte des points est tracée en plus.
Chacune de ces trois opérations est une cible dans le vocabulaire de <strong>targets</strong>.</p>
<p>Le fichier du flux de travail est donc le suivant:</p>
<p></p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="chap-utiliseR.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fichier _targets.R </span></span>
<span id="cb220-2"><a href="chap-utiliseR.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;targets&quot;</span>)</span>
<span id="cb220-3"><a href="chap-utiliseR.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;spatstat&quot;</span>, <span class="st">&quot;dbmss&quot;</span>))</span>
<span id="cb220-4"><a href="chap-utiliseR.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb220-5"><a href="chap-utiliseR.html#cb220-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tirage des points</span></span>
<span id="cb220-6"><a href="chap-utiliseR.html#cb220-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(X,</span>
<span id="cb220-7"><a href="chap-utiliseR.html#cb220-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">runifpoint</span>(NbPoints)</span>
<span id="cb220-8"><a href="chap-utiliseR.html#cb220-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb220-9"><a href="chap-utiliseR.html#cb220-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Paramétrage</span></span>
<span id="cb220-10"><a href="chap-utiliseR.html#cb220-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(NbPoints,</span>
<span id="cb220-11"><a href="chap-utiliseR.html#cb220-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span></span>
<span id="cb220-12"><a href="chap-utiliseR.html#cb220-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb220-13"><a href="chap-utiliseR.html#cb220-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Distance moyenne</span></span>
<span id="cb220-14"><a href="chap-utiliseR.html#cb220-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(d,</span>
<span id="cb220-15"><a href="chap-utiliseR.html#cb220-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">pairdist</span>(X)) <span class="sc">/</span> NbPoints <span class="sc">/</span> (NbPoints <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb220-16"><a href="chap-utiliseR.html#cb220-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb220-17"><a href="chap-utiliseR.html#cb220-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Carte</span></span>
<span id="cb220-18"><a href="chap-utiliseR.html#cb220-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(map, </span>
<span id="cb220-19"><a href="chap-utiliseR.html#cb220-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="fu">as.wmppp</span>(X))</span>
<span id="cb220-20"><a href="chap-utiliseR.html#cb220-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-21"><a href="chap-utiliseR.html#cb220-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Les commandes globales consistent à charger le package <strong>targets</strong> lui-même puis lister les packages nécessaires au code.
L’exécution du flux a lieu dans une nouvelle instance de R.</p>
<p>Les cibles sont ensuite listées.
Chacune est déclarée par la fonction <code>tar_target()</code> dont le premier argument est le nom de la cible, qui sera celui de la variable qui recevra le résultat.
Le deuxième argument est le code qui produit le résultat.
Les cibles sont très simples ici et peuvent être écrites en une seule commande.
Quand ce n’est pas le cas, chaque cible peut être écrite sous la forme d’une fonction, stockée dans un fichier de code séparé chargé par la fonction <code>source()</code> au début du fichier de flux.</p>
<p>La commande <code>tar_visnetwork</code> permet d’afficher l’enchaînement des cibles et leur état éventuellement obsolète.</p>
<p></p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="chap-utiliseR.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;targets&quot;</span>)</span>
<span id="cb221-2"><a href="chap-utiliseR.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_visnetwork</span>()</span></code></pre></div>
<div id="htmlwidget-4c2873e5859f69562509" style="width:80%;height:504px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c2873e5859f69562509">{"x":{"nodes":{"name":["d","map","NbPoints","X"],"type":["stem","stem","stem","stem"],"status":["outdated","outdated","outdated","outdated"],"seconds":[null,null,null,null],"bytes":[null,null,null,null],"branches":[null,null,null,null],"label":["d","map","NbPoints","X"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["d","map","NbPoints","X"],"level":[3,3,1,2],"shape":["dot","dot","dot","dot"]},"edges":{"from":["NbPoints","NbPoints","X","X"],"to":["X","d","d","map"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem"],"color":["#78B7C5","#899DA4"],"shape":["dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p></p>
<p>L’ordre de déclaration des cibles dans la liste sans importance: elles sont ordonnées automatiquement.</p>
<p>Le flux est exécuté par <code>tar_make()</code>.</p>
<p></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="chap-utiliseR.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span></code></pre></div>
<pre><code>## • start target NbPoints
## • built target NbPoints
## • start target X
## • built target X
## • start target d
## • built target d
## • start target map
## • built target map
## • end pipeline: 2.25 seconds</code></pre>
<p></p>
<p>Le flux est maintenant à jour et <code>tar_make()</code> ne refait aucun calcul.</p>
<p></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chap-utiliseR.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_visnetwork</span>()</span></code></pre></div>
<div id="htmlwidget-c5409db81165a82e2db3" style="width:80%;height:504px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-c5409db81165a82e2db3">{"x":{"nodes":{"name":["d","map","NbPoints","X"],"type":["stem","stem","stem","stem"],"status":["uptodate","uptodate","uptodate","uptodate"],"seconds":[0.022,0.018,2.074,0.004],"bytes":[54,99942,51,11042],"branches":[null,null,null,null],"label":["d","map","NbPoints","X"],"color":["#354823","#354823","#354823","#354823"],"id":["d","map","NbPoints","X"],"level":[3,3,1,2],"shape":["dot","dot","dot","dot"]},"edges":{"from":["NbPoints","NbPoints","X","X"],"to":["X","d","d","map"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Stem"],"color":["#354823","#899DA4"],"shape":["dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chap-utiliseR.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span></code></pre></div>
<pre><code>## ✔ skip target NbPoints
## ✔ skip target X
## ✔ skip target d
## ✔ skip target map
## ✔ skip pipeline: 0.072 seconds</code></pre>
<p></p>
<p>Les résultats sont lus par <code>tar_read()</code>.</p>
<p></p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chap-utiliseR.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(d)</span></code></pre></div>
<pre><code>## [1] 0.5189867</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="chap-utiliseR.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(map)</span></code></pre></div>
<p><img src="travailleR_files/figure-html/tar_read-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="intérêt-pratique" class="section level3 hasAnchor" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Intérêt pratique<a href="chap-utiliseR.html#intérêt-pratique" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans cet exemple, <strong>targets</strong> complique l’écriture du code et <code>tar_make()</code> est beaucoup plus lent que la simple exécution du code qu’il traite parce qu’il doit vérifier si les cibles sont à jour.
Dans un projet réel qui nécessite de longs calculs, le traitement du statut des cibles est négligeable et le gain de temps apporté par la seule évaluation des cibles nécessaires est considérable.
La définition des cibles reste une contrainte, mais force à bien structurer son projet.</p>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Barnier2020" class="csl-entry">
Barnier, Julien. 2020. <em>Introduction à <span>R</span> et Au <span>Tidyverse</span></em>. <a href="https://juba.github.io/tidyverse/">https://juba.github.io/tidyverse/</a>.
</div>
<div id="ref-Gillespie2016" class="csl-entry">
Gillespie, Colin, et Robin Lovelace. 2016. <em>Efficient <span>R</span> Programming</em>. <span>O’Reilly Media</span>. <a href="https://csgillespie.github.io/efficientR/">https://csgillespie.github.io/efficientR/</a>.
</div>
<div id="ref-Wickham2010" class="csl-entry">
Wickham, Hadley. 2010. <span>« A Layered Grammar of Graphics »</span>. <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3‑28. <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">http://vita.had.co.nz/papers/layered-grammar.pdf</a>.
</div>
<div id="ref-Wickham2014" class="csl-entry">
———. 2014. <em>Advanced <span>R</span></em>. <span>Chapman and Hall/CRC</span>. <a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a>.
</div>
<div id="ref-Wickham2017" class="csl-entry">
———. 2017. <em>Ggplot2: <span>Elegant</span> Graphics for Data Analysis</em>. 2ᵉ éd. <span>Springer</span>. <a href="https://doi.org/10.1007/978-3-319-24277-4">https://doi.org/10.1007/978-3-319-24277-4</a>.
</div>
<div id="ref-Wickham2016" class="csl-entry">
Wickham, Hadley, et Garrett Grolemund. 2016. <em>R for Data Science</em>. <span>O’Reilly Media</span>. <a href="http://r4ds.had.co.nz/">http://r4ds.had.co.nz/</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="17">
<li id="fn17"><p><a href="https://adv-r.had.co.nz/OO-essentials.html" class="uri">https://adv-r.had.co.nz/OO-essentials.html</a><a href="chap-utiliseR.html#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p><a href="https://www.troispointzero.fr/le-blog/introduction-a-la-programmation-orientee-objet-poo/" class="uri">https://www.troispointzero.fr/le-blog/introduction-a-la-programmation-orientee-objet-poo/</a><a href="chap-utiliseR.html#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p><a href="https://r6.r-lib.org/" class="uri">https://r6.r-lib.org/</a><a href="chap-utiliseR.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p><a href="https://r6.r-lib.org/articles/Performance.html" class="uri">https://r6.r-lib.org/articles/Performance.html</a><a href="chap-utiliseR.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p><a href="https://dplyr.tidyverse.org/articles/programming.html" class="uri">https://dplyr.tidyverse.org/articles/programming.html</a><a href="chap-utiliseR.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p><a href="https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html" class="uri">https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html</a><a href="chap-utiliseR.html#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p><a href="https://EricMarcon.github.io/travailleR/profile.html" class="uri">https://EricMarcon.github.io/travailleR/profile.html</a><a href="chap-utiliseR.html#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p><a href="https://rstudio.github.io/profvis/" class="uri">https://rstudio.github.io/profvis/</a><a href="chap-utiliseR.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p><a href="http://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/parallel.html" class="uri">http://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/parallel.html</a><a href="chap-utiliseR.html#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p><a href="https://mindyourdecisions.com/blog/2016/07/03/distance-between-two-random-points-in-a-square-sunday-puzzle/" class="uri">https://mindyourdecisions.com/blog/2016/07/03/distance-between-two-random-points-in-a-square-sunday-puzzle/</a><a href="chap-utiliseR.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p><a href="http://rcppcore.github.io/RcppParallel/" class="uri">http://rcppcore.github.io/RcppParallel/</a><a href="chap-utiliseR.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p><a href="https://books.ropensci.org/targets/" class="uri">https://books.ropensci.org/targets/</a><a href="chap-utiliseR.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p><a href="https://books.ropensci.org/targets/walkthrough.html" class="uri">https://books.ropensci.org/targets/walkthrough.html</a><a href="chap-utiliseR.html#fnref29" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chap-logiciels.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-git.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["travailleR.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
