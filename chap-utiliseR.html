<!DOCTYPE html>
<html lang="fr" xml:lang="fr">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Utiliser R | Travailler avec R</title>
  <meta name="description" content="Support du cours Travailler avec R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Utiliser R | Travailler avec R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Support du cours Travailler avec R." />
  <meta name="github-repo" content="EricMarcon/travailleR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Utiliser R | Travailler avec R" />
  
  <meta name="twitter:description" content="Support du cours Travailler avec R." />
  

<meta name="author" content="Eric Marcon" />


<meta name="date" content="2021-03-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chap-logiciels.html"/>
<link rel="next" href="chap-git.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7NVD1TWMCJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7NVD1TWMCJ');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Travailler avec R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Présentation</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#objectifs"><i class="fa fa-check"></i>Objectifs</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-logiciels.html"><a href="chap-logiciels.html"><i class="fa fa-check"></i><b>1</b> Logiciels</a><ul>
<li class="chapter" data-level="1.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#r"><i class="fa fa-check"></i><b>1.1</b> R</a><ul>
<li class="chapter" data-level="1.1.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation"><i class="fa fa-check"></i><b>1.1.1</b> Installation</a></li>
<li class="chapter" data-level="1.1.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#rtools"><i class="fa fa-check"></i><b>1.1.2</b> Rtools</a></li>
<li class="chapter" data-level="1.1.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#mise-à-jour"><i class="fa fa-check"></i><b>1.1.3</b> Mise à jour</a></li>
<li class="chapter" data-level="1.1.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:librairies"><i class="fa fa-check"></i><b>1.1.4</b> Librairies</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a><ul>
<li class="chapter" data-level="1.2.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-1"><i class="fa fa-check"></i><b>1.2.1</b> Installation</a></li>
<li class="chapter" data-level="1.2.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#encodage-des-fichiers"><i class="fa fa-check"></i><b>1.2.2</b> Encodage des fichiers</a></li>
<li class="chapter" data-level="1.2.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#dossier-de-travail"><i class="fa fa-check"></i><b>1.2.3</b> Dossier de travail</a></li>
<li class="chapter" data-level="1.2.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#sec:solution-dossiers"><i class="fa fa-check"></i><b>1.2.4</b> Solution retenue</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#packages"><i class="fa fa-check"></i><b>1.3</b> Packages</a><ul>
<li class="chapter" data-level="1.3.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-depuis-cran"><i class="fa fa-check"></i><b>1.3.1</b> Installation depuis CRAN</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-depuis-github"><i class="fa fa-check"></i><b>1.3.2</b> Installation depuis GitHub</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-depuis-bioconductor"><i class="fa fa-check"></i><b>1.3.3</b> Installation depuis Bioconductor</a></li>
<li class="chapter" data-level="1.3.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#solution-retenue"><i class="fa fa-check"></i><b>1.3.4</b> Solution retenue</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-logiciels.html"><a href="chap-logiciels.html#git"><i class="fa fa-check"></i><b>1.4</b> Git</a></li>
<li class="chapter" data-level="1.5" data-path="chap-logiciels.html"><a href="chap-logiciels.html#github"><i class="fa fa-check"></i><b>1.5</b> GitHub</a></li>
<li class="chapter" data-level="1.6" data-path="chap-logiciels.html"><a href="chap-logiciels.html#miktex"><i class="fa fa-check"></i><b>1.6</b> MiKTeX</a><ul>
<li class="chapter" data-level="1.6.1" data-path="chap-logiciels.html"><a href="chap-logiciels.html#installation-2"><i class="fa fa-check"></i><b>1.6.1</b> Installation</a></li>
<li class="chapter" data-level="1.6.2" data-path="chap-logiciels.html"><a href="chap-logiciels.html#mises-à-jour"><i class="fa fa-check"></i><b>1.6.2</b> Mises à jour</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="chap-logiciels.html"><a href="chap-logiciels.html#go"><i class="fa fa-check"></i><b>1.7</b> Go</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html"><i class="fa fa-check"></i><b>2</b> Utiliser R</a><ul>
<li class="chapter" data-level="2.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#les-langages-de-r"><i class="fa fa-check"></i><b>2.1</b> Les langages de R</a><ul>
<li class="chapter" data-level="2.1.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#base"><i class="fa fa-check"></i><b>2.1.1</b> Base</a></li>
<li class="chapter" data-level="2.1.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:S3"><i class="fa fa-check"></i><b>2.1.2</b> S3</a></li>
<li class="chapter" data-level="2.1.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#s4"><i class="fa fa-check"></i><b>2.1.3</b> S4</a></li>
<li class="chapter" data-level="2.1.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#rc"><i class="fa fa-check"></i><b>2.1.4</b> RC</a></li>
<li class="chapter" data-level="2.1.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#s6"><i class="fa fa-check"></i><b>2.1.5</b> S6</a></li>
<li class="chapter" data-level="2.1.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#tidyverse"><i class="fa fa-check"></i><b>2.1.6</b> Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:environnements"><i class="fa fa-check"></i><b>2.2</b> Environnements</a><ul>
<li class="chapter" data-level="2.2.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#organisation"><i class="fa fa-check"></i><b>2.2.1</b> Organisation</a></li>
<li class="chapter" data-level="2.2.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#recherche"><i class="fa fa-check"></i><b>2.2.2</b> Recherche</a></li>
<li class="chapter" data-level="2.2.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#espaces-de-nom-des-packages"><i class="fa fa-check"></i><b>2.2.3</b> Espaces de nom des packages</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#mesure-du-temps-dexécution"><i class="fa fa-check"></i><b>2.3</b> Mesure du temps d’exécution</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#system.time"><i class="fa fa-check"></i><b>2.3.1</b> system.time</a></li>
<li class="chapter" data-level="2.3.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#microbenchmark"><i class="fa fa-check"></i><b>2.3.2</b> microbenchmark</a></li>
<li class="chapter" data-level="2.3.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#profilage"><i class="fa fa-check"></i><b>2.3.3</b> Profilage</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucles"><i class="fa fa-check"></i><b>2.4</b> Boucles</a><ul>
<li class="chapter" data-level="2.4.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#fonctions-vectorielles"><i class="fa fa-check"></i><b>2.4.1</b> Fonctions vectorielles</a></li>
<li class="chapter" data-level="2.4.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#lapply"><i class="fa fa-check"></i><b>2.4.2</b> lapply</a></li>
<li class="chapter" data-level="2.4.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucles-for"><i class="fa fa-check"></i><b>2.4.3</b> Boucles for</a></li>
<li class="chapter" data-level="2.4.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#replicate"><i class="fa fa-check"></i><b>2.4.4</b> replicate</a></li>
<li class="chapter" data-level="2.4.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#vectorize"><i class="fa fa-check"></i><b>2.4.5</b> Vectorize</a></li>
<li class="chapter" data-level="2.4.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#statistiques-marginales"><i class="fa fa-check"></i><b>2.4.6</b> Statistiques marginales</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:cpp"><i class="fa fa-check"></i><b>2.5</b> Code C++</a></li>
<li class="chapter" data-level="2.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#paralléliser-r"><i class="fa fa-check"></i><b>2.6</b> Paralléliser R</a><ul>
<li class="chapter" data-level="2.6.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#mclapply-fork"><i class="fa fa-check"></i><b>2.6.1</b> mclapply (fork)</a></li>
<li class="chapter" data-level="2.6.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#parlapply-socket"><i class="fa fa-check"></i><b>2.6.2</b> parLapply (socket)</a></li>
<li class="chapter" data-level="2.6.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#foreach"><i class="fa fa-check"></i><b>2.6.3</b> foreach</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#sec:cas"><i class="fa fa-check"></i><b>2.7</b> Etude de cas</a><ul>
<li class="chapter" data-level="2.7.1" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#création-des-données"><i class="fa fa-check"></i><b>2.7.1</b> Création des données</a></li>
<li class="chapter" data-level="2.7.2" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#spatstat"><i class="fa fa-check"></i><b>2.7.2</b> Spatstat</a></li>
<li class="chapter" data-level="2.7.3" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#apply"><i class="fa fa-check"></i><b>2.7.3</b> apply</a></li>
<li class="chapter" data-level="2.7.4" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucle-for"><i class="fa fa-check"></i><b>2.7.4</b> boucle for</a></li>
<li class="chapter" data-level="2.7.5" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#boucle-foreach"><i class="fa fa-check"></i><b>2.7.5</b> boucle foreach</a></li>
<li class="chapter" data-level="2.7.6" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#rcpp"><i class="fa fa-check"></i><b>2.7.6</b> RCpp</a></li>
<li class="chapter" data-level="2.7.7" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#rcppparallel"><i class="fa fa-check"></i><b>2.7.7</b> RcppParallel</a></li>
<li class="chapter" data-level="2.7.8" data-path="chap-utiliseR.html"><a href="chap-utiliseR.html#conclusions-sur-loptimisation-de-la-vitesse-du-code"><i class="fa fa-check"></i><b>2.7.8</b> Conclusions sur l’optimisation de la vitesse du code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-git.html"><a href="chap-git.html"><i class="fa fa-check"></i><b>3</b> Git et GitHub</a><ul>
<li class="chapter" data-level="3.1" data-path="chap-git.html"><a href="chap-git.html#sec:principes-git"><i class="fa fa-check"></i><b>3.1</b> Principes</a><ul>
<li class="chapter" data-level="3.1.1" data-path="chap-git.html"><a href="chap-git.html#sec:git-cds"><i class="fa fa-check"></i><b>3.1.1</b> Contrôle de source</a></li>
<li class="chapter" data-level="3.1.2" data-path="chap-git.html"><a href="chap-git.html#git-et-github"><i class="fa fa-check"></i><b>3.1.2</b> git et GitHub</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chap-git.html"><a href="chap-git.html#créer-un-nouveau-dépôt"><i class="fa fa-check"></i><b>3.2</b> Créer un nouveau dépôt</a><ul>
<li class="chapter" data-level="3.2.1" data-path="chap-git.html"><a href="chap-git.html#a-partir-dun-projet-existant"><i class="fa fa-check"></i><b>3.2.1</b> A partir d’un projet existant</a></li>
<li class="chapter" data-level="3.2.2" data-path="chap-git.html"><a href="chap-git.html#prendre-en-compte-des-fichiers"><i class="fa fa-check"></i><b>3.2.2</b> Prendre en compte des fichiers</a></li>
<li class="chapter" data-level="3.2.3" data-path="chap-git.html"><a href="chap-git.html#valider-des-modifications"><i class="fa fa-check"></i><b>3.2.3</b> Valider des modifications</a></li>
<li class="chapter" data-level="3.2.4" data-path="chap-git.html"><a href="chap-git.html#créer-un-dépôt-vide-sur-github"><i class="fa fa-check"></i><b>3.2.4</b> Créer un dépôt vide sur GitHub</a></li>
<li class="chapter" data-level="3.2.5" data-path="chap-git.html"><a href="chap-git.html#lier-git-et-github"><i class="fa fa-check"></i><b>3.2.5</b> Lier git et GitHub</a></li>
<li class="chapter" data-level="3.2.6" data-path="chap-git.html"><a href="chap-git.html#pousser-les-premières-modifications"><i class="fa fa-check"></i><b>3.2.6</b> Pousser les premières modifications</a></li>
<li class="chapter" data-level="3.2.7" data-path="chap-git.html"><a href="chap-git.html#cloner-un-dépôt-de-github"><i class="fa fa-check"></i><b>3.2.7</b> Cloner un dépôt de GitHub</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chap-git.html"><a href="chap-git.html#usage-courant"><i class="fa fa-check"></i><b>3.3</b> Usage courant</a><ul>
<li class="chapter" data-level="3.3.1" data-path="chap-git.html"><a href="chap-git.html#tirer-modifier-valider-pousser"><i class="fa fa-check"></i><b>3.3.1</b> Tirer, modifier, valider, pousser</a></li>
<li class="chapter" data-level="3.3.2" data-path="chap-git.html"><a href="chap-git.html#régler-les-conflits"><i class="fa fa-check"></i><b>3.3.2</b> Régler les conflits</a></li>
<li class="chapter" data-level="3.3.3" data-path="chap-git.html"><a href="chap-git.html#voir-les-différences"><i class="fa fa-check"></i><b>3.3.3</b> Voir les différences</a></li>
<li class="chapter" data-level="3.3.4" data-path="chap-git.html"><a href="chap-git.html#revenir-en-arrière"><i class="fa fa-check"></i><b>3.3.4</b> Revenir en arrière</a></li>
<li class="chapter" data-level="3.3.5" data-path="chap-git.html"><a href="chap-git.html#voir-lhistorique"><i class="fa fa-check"></i><b>3.3.5</b> Voir l’historique</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chap-git.html"><a href="chap-git.html#sec:branches"><i class="fa fa-check"></i><b>3.4</b> Branches</a><ul>
<li class="chapter" data-level="3.4.1" data-path="chap-git.html"><a href="chap-git.html#créer-une-nouvelle-branche"><i class="fa fa-check"></i><b>3.4.1</b> Créer une nouvelle branche</a></li>
<li class="chapter" data-level="3.4.2" data-path="chap-git.html"><a href="chap-git.html#changer-de-branche"><i class="fa fa-check"></i><b>3.4.2</b> Changer de branche</a></li>
<li class="chapter" data-level="3.4.3" data-path="chap-git.html"><a href="chap-git.html#comportement-du-système-de-fichier"><i class="fa fa-check"></i><b>3.4.3</b> Comportement du système de fichier</a></li>
<li class="chapter" data-level="3.4.4" data-path="chap-git.html"><a href="chap-git.html#fusionner-avec-merge"><i class="fa fa-check"></i><b>3.4.4</b> Fusionner avec <code>merge</code></a></li>
<li class="chapter" data-level="3.4.5" data-path="chap-git.html"><a href="chap-git.html#fusionner-avec-une-requête-de-tirage"><i class="fa fa-check"></i><b>3.4.5</b> Fusionner avec une requête de tirage</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="chap-git.html"><a href="chap-git.html#usage-avancé"><i class="fa fa-check"></i><b>3.5</b> Usage avancé</a><ul>
<li class="chapter" data-level="3.5.1" data-path="chap-git.html"><a href="chap-git.html#commandes-de-git"><i class="fa fa-check"></i><b>3.5.1</b> Commandes de git</a></li>
<li class="chapter" data-level="3.5.2" data-path="chap-git.html"><a href="chap-git.html#taille-dun-dépôt"><i class="fa fa-check"></i><b>3.5.2</b> Taille d’un dépôt</a></li>
<li class="chapter" data-level="3.5.3" data-path="chap-git.html"><a href="chap-git.html#supprimer-un-dossier"><i class="fa fa-check"></i><b>3.5.3</b> Supprimer un dossier</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="chap-git.html"><a href="chap-git.html#sec:github-pages"><i class="fa fa-check"></i><b>3.6</b> Pages GitHub</a><ul>
<li class="chapter" data-level="3.6.1" data-path="chap-git.html"><a href="chap-git.html#activation"><i class="fa fa-check"></i><b>3.6.1</b> Activation</a></li>
<li class="chapter" data-level="3.6.2" data-path="chap-git.html"><a href="chap-git.html#badges"><i class="fa fa-check"></i><b>3.6.2</b> Badges</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-rediger.html"><a href="chap-rediger.html"><i class="fa fa-check"></i><b>4</b> Rédiger</a><ul>
<li class="chapter" data-level="4.1" data-path="chap-rediger.html"><a href="chap-rediger.html#bloc-note-markdown-r-notebook"><i class="fa fa-check"></i><b>4.1</b> Bloc-note Markdown (R Notebook)</a></li>
<li class="chapter" data-level="4.2" data-path="chap-rediger.html"><a href="chap-rediger.html#modèles-r-markdown"><i class="fa fa-check"></i><b>4.2</b> Modèles R Markdown</a></li>
<li class="chapter" data-level="4.3" data-path="chap-rediger.html"><a href="chap-rediger.html#memo-article-bookdown"><i class="fa fa-check"></i><b>4.3</b> Memo, article : bookdown</a><ul>
<li class="chapter" data-level="4.3.1" data-path="chap-rediger.html"><a href="chap-rediger.html#ecrire"><i class="fa fa-check"></i><b>4.3.1</b> Ecrire</a></li>
<li class="chapter" data-level="4.3.2" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:memo"><i class="fa fa-check"></i><b>4.3.2</b> Modèle Memo EcoFoG</a></li>
<li class="chapter" data-level="4.3.3" data-path="chap-rediger.html"><a href="chap-rediger.html#autres-modèles"><i class="fa fa-check"></i><b>4.3.3</b> Autres modèles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chap-rediger.html"><a href="chap-rediger.html#présentation-ecofog-bookdown"><i class="fa fa-check"></i><b>4.4</b> Présentation EcoFoG : bookdown</a></li>
<li class="chapter" data-level="4.5" data-path="chap-rediger.html"><a href="chap-rediger.html#ouvrage-ecofog-bookdown"><i class="fa fa-check"></i><b>4.5</b> Ouvrage EcoFoG : bookdown</a><ul>
<li class="chapter" data-level="4.5.1" data-path="chap-rediger.html"><a href="chap-rediger.html#créer-1"><i class="fa fa-check"></i><b>4.5.1</b> Créer</a></li>
<li class="chapter" data-level="4.5.2" data-path="chap-rediger.html"><a href="chap-rediger.html#ecrire-2"><i class="fa fa-check"></i><b>4.5.2</b> Ecrire</a></li>
<li class="chapter" data-level="4.5.3" data-path="chap-rediger.html"><a href="chap-rediger.html#tricoter-1"><i class="fa fa-check"></i><b>4.5.3</b> Tricoter</a></li>
<li class="chapter" data-level="4.5.4" data-path="chap-rediger.html"><a href="chap-rediger.html#finitions"><i class="fa fa-check"></i><b>4.5.4</b> Finitions</a></li>
<li class="chapter" data-level="4.5.5" data-path="chap-rediger.html"><a href="chap-rediger.html#site-gitbook"><i class="fa fa-check"></i><b>4.5.5</b> Site gitbook</a></li>
<li class="chapter" data-level="4.5.6" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:rediger-ouvrage-ci"><i class="fa fa-check"></i><b>4.5.6</b> Intégration continue</a></li>
<li class="chapter" data-level="4.5.7" data-path="chap-rediger.html"><a href="chap-rediger.html#google-analytics"><i class="fa fa-check"></i><b>4.5.7</b> Google Analytics</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="chap-rediger.html"><a href="chap-rediger.html#site-web-r-markdown"><i class="fa fa-check"></i><b>4.6</b> Site web R Markdown</a><ul>
<li class="chapter" data-level="4.6.1" data-path="chap-rediger.html"><a href="chap-rediger.html#modèle"><i class="fa fa-check"></i><b>4.6.1</b> Modèle</a></li>
<li class="chapter" data-level="4.6.2" data-path="chap-rediger.html"><a href="chap-rediger.html#améliorations"><i class="fa fa-check"></i><b>4.6.2</b> Améliorations</a></li>
<li class="chapter" data-level="4.6.3" data-path="chap-rediger.html"><a href="chap-rediger.html#contôle-de-source"><i class="fa fa-check"></i><b>4.6.3</b> Contôle de source</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:blogdown"><i class="fa fa-check"></i><b>4.7</b> Site web personnel : blogdown</a><ul>
<li class="chapter" data-level="4.7.1" data-path="chap-rediger.html"><a href="chap-rediger.html#installation-des-outils"><i class="fa fa-check"></i><b>4.7.1</b> Installation des outils</a></li>
<li class="chapter" data-level="4.7.2" data-path="chap-rediger.html"><a href="chap-rediger.html#créer-2"><i class="fa fa-check"></i><b>4.7.2</b> Créer</a></li>
<li class="chapter" data-level="4.7.3" data-path="chap-rediger.html"><a href="chap-rediger.html#site-personnel-sur-github"><i class="fa fa-check"></i><b>4.7.3</b> Site personnel sur GitHub</a></li>
<li class="chapter" data-level="4.7.4" data-path="chap-rediger.html"><a href="chap-rediger.html#construction-du-site"><i class="fa fa-check"></i><b>4.7.4</b> Construction du site</a></li>
<li class="chapter" data-level="4.7.5" data-path="chap-rediger.html"><a href="chap-rediger.html#site-multilingue"><i class="fa fa-check"></i><b>4.7.5</b> Site multilingue</a></li>
<li class="chapter" data-level="4.7.6" data-path="chap-rediger.html"><a href="chap-rediger.html#paramétrer"><i class="fa fa-check"></i><b>4.7.6</b> Paramétrer</a></li>
<li class="chapter" data-level="4.7.7" data-path="chap-rediger.html"><a href="chap-rediger.html#ecrire-3"><i class="fa fa-check"></i><b>4.7.7</b> Ecrire</a></li>
<li class="chapter" data-level="4.7.8" data-path="chap-rediger.html"><a href="chap-rediger.html#sec:rediger-web-ci"><i class="fa fa-check"></i><b>4.7.8</b> Intégration continue</a></li>
<li class="chapter" data-level="4.7.9" data-path="chap-rediger.html"><a href="chap-rediger.html#mises-à-jour-1"><i class="fa fa-check"></i><b>4.7.9</b> Mises à jour</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="chap-rediger.html"><a href="chap-rediger.html#exportation-de-figures"><i class="fa fa-check"></i><b>4.8</b> Exportation de figures</a><ul>
<li class="chapter" data-level="4.8.1" data-path="chap-rediger.html"><a href="chap-rediger.html#formats-vectoriels-et-raster"><i class="fa fa-check"></i><b>4.8.1</b> Formats vectoriels et raster</a></li>
<li class="chapter" data-level="4.8.2" data-path="chap-rediger.html"><a href="chap-rediger.html#fonctions"><i class="fa fa-check"></i><b>4.8.2</b> Fonctions</a></li>
<li class="chapter" data-level="4.8.3" data-path="chap-rediger.html"><a href="chap-rediger.html#package-ragg"><i class="fa fa-check"></i><b>4.8.3</b> Package ragg</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-package.html"><a href="chap-package.html"><i class="fa fa-check"></i><b>5</b> Package</a><ul>
<li class="chapter" data-level="5.1" data-path="chap-package.html"><a href="chap-package.html#premier-package"><i class="fa fa-check"></i><b>5.1</b> Premier package</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chap-package.html"><a href="chap-package.html#création"><i class="fa fa-check"></i><b>5.1.1</b> Création</a></li>
<li class="chapter" data-level="5.1.2" data-path="chap-package.html"><a href="chap-package.html#première-fonction"><i class="fa fa-check"></i><b>5.1.2</b> Première fonction</a></li>
<li class="chapter" data-level="5.1.3" data-path="chap-package.html"><a href="chap-package.html#sec:package-cds"><i class="fa fa-check"></i><b>5.1.3</b> Contrôle de source</a></li>
<li class="chapter" data-level="5.1.4" data-path="chap-package.html"><a href="chap-package.html#package.r"><i class="fa fa-check"></i><b>5.1.4</b> package.R</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chap-package.html"><a href="chap-package.html#organisation-du-package"><i class="fa fa-check"></i><b>5.2</b> Organisation du package</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chap-package.html"><a href="chap-package.html#sec:package-description"><i class="fa fa-check"></i><b>5.2.1</b> Fichier DESCRIPTION</a></li>
<li class="chapter" data-level="5.2.2" data-path="chap-package.html"><a href="chap-package.html#fichier-news.md"><i class="fa fa-check"></i><b>5.2.2</b> Fichier NEWS.md</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chap-package.html"><a href="chap-package.html#vignette-et-pkgdown"><i class="fa fa-check"></i><b>5.3</b> Vignette et pkgdown</a></li>
<li class="chapter" data-level="5.4" data-path="chap-package.html"><a href="chap-package.html#code-spécifique-aux-packages"><i class="fa fa-check"></i><b>5.4</b> Code spécifique aux packages</a><ul>
<li class="chapter" data-level="5.4.1" data-path="chap-package.html"><a href="chap-package.html#importation-de-fonctions"><i class="fa fa-check"></i><b>5.4.1</b> Importation de fonctions</a></li>
<li class="chapter" data-level="5.4.2" data-path="chap-package.html"><a href="chap-package.html#méthodes-s3"><i class="fa fa-check"></i><b>5.4.2</b> Méthodes S3</a></li>
<li class="chapter" data-level="5.4.3" data-path="chap-package.html"><a href="chap-package.html#en-pratique"><i class="fa fa-check"></i><b>5.4.3</b> En pratique</a></li>
<li class="chapter" data-level="5.4.4" data-path="chap-package.html"><a href="chap-package.html#code-c"><i class="fa fa-check"></i><b>5.4.4</b> Code C++</a></li>
<li class="chapter" data-level="5.4.5" data-path="chap-package.html"><a href="chap-package.html#package-bien-rangé"><i class="fa fa-check"></i><b>5.4.5</b> Package bien rangé</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="chap-package.html"><a href="chap-package.html#bibliographie-1"><i class="fa fa-check"></i><b>5.5</b> Bibliographie</a><ul>
<li class="chapter" data-level="5.5.1" data-path="chap-package.html"><a href="chap-package.html#préparation"><i class="fa fa-check"></i><b>5.5.1</b> Préparation</a></li>
<li class="chapter" data-level="5.5.2" data-path="chap-package.html"><a href="chap-package.html#citations"><i class="fa fa-check"></i><b>5.5.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="chap-package.html"><a href="chap-package.html#données"><i class="fa fa-check"></i><b>5.6</b> Données</a></li>
<li class="chapter" data-level="5.7" data-path="chap-package.html"><a href="chap-package.html#tests-unitaires"><i class="fa fa-check"></i><b>5.7</b> Tests unitaires</a></li>
<li class="chapter" data-level="5.8" data-path="chap-package.html"><a href="chap-package.html#fichier-.gitignore"><i class="fa fa-check"></i><b>5.8</b> Fichier .gitignore</a></li>
<li class="chapter" data-level="5.9" data-path="chap-package.html"><a href="chap-package.html#sec:package-ci5"><i class="fa fa-check"></i><b>5.9</b> Intégration continue</a></li>
<li class="chapter" data-level="5.10" data-path="chap-package.html"><a href="chap-package.html#sec:package-cran"><i class="fa fa-check"></i><b>5.10</b> CRAN</a><ul>
<li class="chapter" data-level="5.10.1" data-path="chap-package.html"><a href="chap-package.html#test-du-package"><i class="fa fa-check"></i><b>5.10.1</b> Test du package</a></li>
<li class="chapter" data-level="5.10.2" data-path="chap-package.html"><a href="chap-package.html#soumission"><i class="fa fa-check"></i><b>5.10.2</b> Soumission</a></li>
<li class="chapter" data-level="5.10.3" data-path="chap-package.html"><a href="chap-package.html#maintenance"><i class="fa fa-check"></i><b>5.10.3</b> Maintenance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-ci.html"><a href="chap-ci.html"><i class="fa fa-check"></i><b>6</b> Intégration continue</a><ul>
<li class="chapter" data-level="6.1" data-path="chap-ci.html"><a href="chap-ci.html#outils"><i class="fa fa-check"></i><b>6.1</b> Outils</a><ul>
<li class="chapter" data-level="6.1.1" data-path="chap-ci.html"><a href="chap-ci.html#github-actions"><i class="fa fa-check"></i><b>6.1.1</b> GitHub Actions</a></li>
<li class="chapter" data-level="6.1.2" data-path="chap-ci.html"><a href="chap-ci.html#codecov"><i class="fa fa-check"></i><b>6.1.2</b> Codecov</a></li>
<li class="chapter" data-level="6.1.3" data-path="chap-ci.html"><a href="chap-ci.html#github-pages"><i class="fa fa-check"></i><b>6.1.3</b> GitHub Pages</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chap-ci.html"><a href="chap-ci.html#principes"><i class="fa fa-check"></i><b>6.2</b> Principes</a><ul>
<li class="chapter" data-level="6.2.1" data-path="chap-ci.html"><a href="chap-ci.html#sec:pat"><i class="fa fa-check"></i><b>6.2.1</b> Obtention d’un jeton d’accès personnel</a></li>
<li class="chapter" data-level="6.2.2" data-path="chap-ci.html"><a href="chap-ci.html#sec:secrets-ci"><i class="fa fa-check"></i><b>6.2.2</b> Secrets du projet</a></li>
<li class="chapter" data-level="6.2.3" data-path="chap-ci.html"><a href="chap-ci.html#activation-du-dépôt-sur-codecov"><i class="fa fa-check"></i><b>6.2.3</b> Activation du dépôt sur CodeCov</a></li>
<li class="chapter" data-level="6.2.4" data-path="chap-ci.html"><a href="chap-ci.html#scripter-les-actions-de-github"><i class="fa fa-check"></i><b>6.2.4</b> Scripter les actions de GitHub</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="chap-ci.html"><a href="chap-ci.html#modèles-de-scripts"><i class="fa fa-check"></i><b>6.3</b> Modèles de scripts</a><ul>
<li class="chapter" data-level="6.3.1" data-path="chap-ci.html"><a href="chap-ci.html#sec:bookdown-ci"><i class="fa fa-check"></i><b>6.3.1</b> Projet d’ouvrage</a></li>
<li class="chapter" data-level="6.3.2" data-path="chap-ci.html"><a href="chap-ci.html#sec:rmarkdown-ci"><i class="fa fa-check"></i><b>6.3.2</b> Mémos et présentatons</a></li>
<li class="chapter" data-level="6.3.3" data-path="chap-ci.html"><a href="chap-ci.html#sec:blogdown-ci"><i class="fa fa-check"></i><b>6.3.3</b> Site web blogdown</a></li>
<li class="chapter" data-level="6.3.4" data-path="chap-ci.html"><a href="chap-ci.html#sec:package-ci6"><i class="fa fa-check"></i><b>6.3.4</b> Packages R</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="chap-ci.html"><a href="chap-ci.html#sec:ci-badges"><i class="fa fa-check"></i><b>6.4</b> Ajouter des badges</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chap-shiny.html"><a href="chap-shiny.html"><i class="fa fa-check"></i><b>7</b> Shiny</a><ul>
<li class="chapter" data-level="7.1" data-path="chap-shiny.html"><a href="chap-shiny.html#première-application"><i class="fa fa-check"></i><b>7.1</b> Première application</a></li>
<li class="chapter" data-level="7.2" data-path="chap-shiny.html"><a href="chap-shiny.html#application-plus-élaborée"><i class="fa fa-check"></i><b>7.2</b> Application plus élaborée</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chap-shiny.html"><a href="chap-shiny.html#méthode-de-travail"><i class="fa fa-check"></i><b>7.2.1</b> Méthode de travail</a></li>
<li class="chapter" data-level="7.2.2" data-path="chap-shiny.html"><a href="chap-shiny.html#exemple"><i class="fa fa-check"></i><b>7.2.2</b> Exemple</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chap-shiny.html"><a href="chap-shiny.html#sec:hebergement-shiny"><i class="fa fa-check"></i><b>7.3</b> Hébergement</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chap-enseigner.html"><a href="chap-enseigner.html"><i class="fa fa-check"></i><b>8</b> Enseigner avec R</a><ul>
<li class="chapter" data-level="8.1" data-path="chap-enseigner.html"><a href="chap-enseigner.html#learnr"><i class="fa fa-check"></i><b>8.1</b> learnr</a><ul>
<li class="chapter" data-level="8.1.1" data-path="chap-enseigner.html"><a href="chap-enseigner.html#premier-tutoriel"><i class="fa fa-check"></i><b>8.1.1</b> Premier tutoriel</a></li>
<li class="chapter" data-level="8.1.2" data-path="chap-enseigner.html"><a href="chap-enseigner.html#diffusion"><i class="fa fa-check"></i><b>8.1.2</b> Diffusion</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="chap-enseigner.html"><a href="chap-enseigner.html#github-classrooms"><i class="fa fa-check"></i><b>8.2</b> GitHub Classrooms</a><ul>
<li class="chapter" data-level="8.2.1" data-path="chap-enseigner.html"><a href="chap-enseigner.html#inscription"><i class="fa fa-check"></i><b>8.2.1</b> Inscription</a></li>
<li class="chapter" data-level="8.2.2" data-path="chap-enseigner.html"><a href="chap-enseigner.html#organisations"><i class="fa fa-check"></i><b>8.2.2</b> Organisations</a></li>
<li class="chapter" data-level="8.2.3" data-path="chap-enseigner.html"><a href="chap-enseigner.html#nouvelle-salle-de-classe"><i class="fa fa-check"></i><b>8.2.3</b> Nouvelle salle de classe</a></li>
<li class="chapter" data-level="8.2.4" data-path="chap-enseigner.html"><a href="chap-enseigner.html#préparer-un-modèle-de-dépôt"><i class="fa fa-check"></i><b>8.2.4</b> Préparer un modèle de dépôt</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chap-conclusion.html"><a href="chap-conclusion.html"><i class="fa fa-check"></i><b>9</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li>
  <a href="https://github.com/EricMarcon/travailleR" target="blank">
    Hébergé sur GitHub, publié par bookdown
  </a>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Travailler avec R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap:utiliseR" class="section level1">
<h1><span class="header-section-number">2</span> Utiliser R</h1>
<p>La documentation consacrée à l’apprentissage de R est florissante.
Les ouvrages suivants sont une sélection arbitraire mais utile pour progresser:</p>
<ul>
<li>L’<a href="https://juba.github.io/tidyverse/">Introduction à R et au tidyverse</a> <span class="citation">(Barnier <a href="#ref-Barnier2020" role="doc-biblioref">2020</a>)</span> est un excellent cours de prise en main.</li>
<li><a href="http://adv-r.had.co.nz/">Advanced R</a> <span class="citation">(Wickham <a href="#ref-Wickham2014" role="doc-biblioref">2014</a>)</span> est la référence pour maîtriser les subtilités du langage et bien comprendre le fonctionnement de R.</li>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a> <span class="citation">(Wickham et Grolemund <a href="#ref-Wickham2016" role="doc-biblioref">2016</a>)</span> présente une méthode de travail complète, cohérente avec le tidyverse.</li>
<li>Enfin, <a href="https://csgillespie.github.io/efficientR/">Efficient R programming</a> <span class="citation">(Gillespie et Lovelace <a href="#ref-Gillespie2016" role="doc-biblioref">2016</a>)</span> traite de l’optimisation du code.</li>
</ul>
<p>Quelques aspects avancés du codage sont vus ici.
Des précisions sur les différents langages de R sont utiles pour la création de packages.
Les environnements sont présentés ensuite, pour la bonne compréhension de la recherche des objets appelés par le code.
Enfin, l’optimisation des performances du code est traitée en détail (boucles, code C++ et parallélisation) et illustrée par une étude de cas.</p>
<div id="les-langages-de-r" class="section level2">
<h2><span class="header-section-number">2.1</span> Les langages de R</h2>
<p>R comprend plusieurs langages de programmation.
Le plus courant est S3, mais ce n’est pas le seul<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>.</p>
<div id="base" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Base</h3>
<p>Le coeur de R est constitué des fonctions primitives et structures de données de base comme la fonction <code>sum</code> et les données de type <code>matrix</code>:</p>
<p></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chap-utiliseR.html#cb13-1"></a>pryr<span class="op">::</span><span class="kw">otype</span>(sum)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;pryr&#39;:
##   method      from
##   print.bytes Rcpp</code></pre>
<pre><code>## [1] &quot;base&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="chap-utiliseR.html#cb16-1"></a><span class="kw">typeof</span>(sum)</span></code></pre></div>
<pre><code>## [1] &quot;builtin&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="chap-utiliseR.html#cb18-1"></a>pryr<span class="op">::</span><span class="kw">otype</span>(<span class="kw">matrix</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;base&quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="chap-utiliseR.html#cb20-1"></a><span class="kw">typeof</span>(<span class="kw">matrix</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p></p>
<p>Le package <strong>pryr</strong> permet d’afficher le langage dans lequel des objets sont définis.
La fonction <code>typeof()</code> affiche le type de stockage interne des objets:</p>
<ul>
<li>la fonction <code>sum()</code> appartient au langage de base de R et est une fonction primitive (<em>builtin</em>);</li>
<li>les éléments de la matrice numérique contenant un seul 1 des réels à double précision, et la matrice elle-même est définie dans le langage de base.</li>
</ul>
<p>Les fonctions primitives sont codées en C et sont très rapides.
Elles sont toujours disponibles, quels que soient les packages chargés.
Leur usage est donc à privilégier.</p>
</div>
<div id="sec:S3" class="section level3">
<h3><span class="header-section-number">2.1.2</span> S3</h3>
<p>S3 est le langage le plus utilisé, souvent le seul connu par les utilisateurs de R.</p>
<p>C’est un langage orienté objet dans lequel les classes, c’est-à-dire le type des objets, sont déclaratives.</p>
<p></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chap-utiliseR.html#cb22-1"></a>MonPrenom &lt;-<span class="st"> &quot;Eric&quot;</span></span>
<span id="cb22-2"><a href="chap-utiliseR.html#cb22-2"></a><span class="kw">class</span>(MonPrenom) &lt;-<span class="st"> &quot;Prenom&quot;</span></span></code></pre></div>
<p></p>
<p>La variable <code>MonPrenom</code> est ici de classe “Prenom” par une simple déclaration.</p>
<p>Contrairement au fonctionnement d’un langage orienté objet classique<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>, les méthodes S3 sont liées aux fonctions, pas aux objets.</p>
<p></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="chap-utiliseR.html#cb23-1"></a><span class="co"># Affichage par défaut</span></span>
<span id="cb23-2"><a href="chap-utiliseR.html#cb23-2"></a>MonPrenom</span></code></pre></div>
<pre><code>## [1] &quot;Eric&quot;
## attr(,&quot;class&quot;)
## [1] &quot;Prenom&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="chap-utiliseR.html#cb25-1"></a>print.Prenom &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">cat</span>(<span class="st">&quot;Le prénom est&quot;</span>, x)</span>
<span id="cb25-2"><a href="chap-utiliseR.html#cb25-2"></a><span class="co"># Affichage modifié</span></span>
<span id="cb25-3"><a href="chap-utiliseR.html#cb25-3"></a>MonPrenom</span></code></pre></div>
<pre><code>## Le prénom est Eric</code></pre>
<p></p>
<p>Dans cet exemple, la méthode <code>print()</code> appliquée à la classe “Prenom” est modifiée.
Dans un langage orienté objet classique, la méthode serait définie dans la classe <code>Prenom</code>.
Dans R, les méthodes sont définies à partir de méthodes génériques.</p>
<p><code>print</code> est une méthode générique (“un générique”) déclaré dans <strong>base</strong>.</p>
<p></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chap-utiliseR.html#cb27-1"></a>pryr<span class="op">::</span><span class="kw">otype</span>(print)</span></code></pre></div>
<pre><code>## [1] &quot;base&quot;</code></pre>
<p></p>
<p>Son code se résume à une déclaration <code>UseMethod("print")</code>:</p>
<p></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chap-utiliseR.html#cb29-1"></a>print</span></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;print&quot;)
## &lt;bytecode: 0x7fee500bc498&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p></p>
<p>Il existe beaucoup de méthodes S3 pour <code>print</code>:</p>
<p></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chap-utiliseR.html#cb31-1"></a><span class="kw">head</span>(<span class="kw">methods</span>(<span class="st">&quot;print&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;print.acf&quot;         &quot;print.AES&quot;         &quot;print.all_vars&quot;   
## [4] &quot;print.anova&quot;       &quot;print.ansi_string&quot; &quot;print.ansi_style&quot;</code></pre>
<p></p>
<p>Chacune s’applique à une classe. <code>print.default</code> est utilisée en dernier ressort et s’appuie sur le type de l’objet, pas sur sa classe S3.</p>
<p></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chap-utiliseR.html#cb33-1"></a><span class="kw">typeof</span>(MonPrenom)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="chap-utiliseR.html#cb35-1"></a>pryr<span class="op">::</span><span class="kw">otype</span>(MonPrenom)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<p></p>
<p>Un objet peut appartenir à plusieurs classes, ce qui permet une forme d’héritage des méthodes.
Dans un langage orienté objet classique, l’héritage permet de définir des classes plus précises (“PrenomFrancais”) qui héritent de classes plus générales (“Prenom”) et bénéficient de cette façon de leurs méthodes sans avoir à les redéfinir.
Dans R, l’héritage consiste simplement à déclarer un vecteur de classes de plus en plus larges pour un objet:</p>
<p></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="chap-utiliseR.html#cb37-1"></a><span class="co"># Définition des classes par un vecteur</span></span>
<span id="cb37-2"><a href="chap-utiliseR.html#cb37-2"></a><span class="kw">class</span>(MonPrenom) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PrenomFrancais&quot;</span>, <span class="st">&quot;Prenom&quot;</span>)</span>
<span id="cb37-3"><a href="chap-utiliseR.html#cb37-3"></a><span class="co"># Ecriture alternative, avec inherits()</span></span>
<span id="cb37-4"><a href="chap-utiliseR.html#cb37-4"></a><span class="kw">inherits</span>(MonPrenom, <span class="dt">what =</span> <span class="st">&quot;PrenomFrancais&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="chap-utiliseR.html#cb39-1"></a><span class="kw">inherits</span>(MonPrenom, <span class="dt">what =</span> <span class="st">&quot;Prenom&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Le générique cherche une méthode pour chaque classe, dans l’ordre de leur déclaration.</p>
<p></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="chap-utiliseR.html#cb41-1"></a>print.PrenomFrancais &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">cat</span>(<span class="st">&quot;Prénom français:&quot;</span>, </span>
<span id="cb41-2"><a href="chap-utiliseR.html#cb41-2"></a>    x)</span>
<span id="cb41-3"><a href="chap-utiliseR.html#cb41-3"></a>MonPrenom</span></code></pre></div>
<pre><code>## Prénom français: Eric</code></pre>
<p></p>
<p>En résumé, S3 est le langage courant de R.
Presque tous les packages sont écrits en S3.
Les génériques sont partout mais passent inaperçus, par exemple dans des packages:</p>
<p></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="chap-utiliseR.html#cb43-1"></a><span class="kw">library</span>(<span class="st">&quot;entropart&quot;</span>)</span>
<span id="cb43-2"><a href="chap-utiliseR.html#cb43-2"></a><span class="kw">.S3methods</span>(<span class="dt">class =</span> <span class="st">&quot;SpeciesDistribution&quot;</span>)</span></code></pre></div>
<pre><code>## [1] autoplot plot    
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>
La fonction <code>.S3methods()</code> permet d’afficher toutes les méthodes disponibles pour une classe, par opposition à <code>methods()</code> qui affiche toutes les classes pour lesquelles la méthode passée en argument est définie.</p>
<p>De nombreuses fonctions primitives de R sont des méthodes génériques.
Utiliser l’aide <code>help(InternalMethods)</code> pour les découvrir.</p>
</div>
<div id="s4" class="section level3">
<h3><span class="header-section-number">2.1.3</span> S4</h3>
<p>S4 est une évolution de S3 qui structure les classes pour se rapprocher d’un langage orienté objet classique:</p>
<ul>
<li>les classes doivent être définies explicitement, pas simplement déclarées;</li>
<li>les attributs (c’est-à-dire les variables décrivant les objets), appelés <em>slots</em>, sont déclarés explicitement;</li>
<li>le constructeur, c’est-à-dire la méthode qui crée un nouvelle instance d’une classe (c’est-à-dire une variable contenant un objet de la classe), est explicite.</li>
</ul>
<p>En reprenant l’exemple précédent, la syntaxe S4 est la suivante:</p>
<p></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="chap-utiliseR.html#cb45-1"></a><span class="co"># Définition de la classe Personne, avec ses slots</span></span>
<span id="cb45-2"><a href="chap-utiliseR.html#cb45-2"></a><span class="kw">setClass</span>(<span class="st">&quot;Personne&quot;</span>,  </span>
<span id="cb45-3"><a href="chap-utiliseR.html#cb45-3"></a>         <span class="dt">slots =</span> <span class="kw">list</span>(<span class="dt">Nom =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">Prenom =</span> <span class="st">&quot;character&quot;</span>))</span>
<span id="cb45-4"><a href="chap-utiliseR.html#cb45-4"></a><span class="co"># Construction d&#39;une instance</span></span>
<span id="cb45-5"><a href="chap-utiliseR.html#cb45-5"></a>Moi &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;Personne&quot;</span>, <span class="dt">Nom =</span> <span class="st">&quot;Marcon&quot;</span>, <span class="dt">Prenom =</span> <span class="st">&quot;Eric&quot;</span>)</span>
<span id="cb45-6"><a href="chap-utiliseR.html#cb45-6"></a><span class="co"># Langage</span></span>
<span id="cb45-7"><a href="chap-utiliseR.html#cb45-7"></a>pryr<span class="op">::</span><span class="kw">otype</span>(Moi)</span></code></pre></div>
<pre><code>## [1] &quot;S4&quot;</code></pre>
<p></p>
<p>Les méthodes appartiennent toujours aux fonctions.
Elles sont déclarées par la fonction <code>setMethod()</code>:</p>
<p></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="chap-utiliseR.html#cb47-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;print&quot;</span>, <span class="dt">signature =</span> <span class="st">&quot;Personne&quot;</span>, <span class="cf">function</span>(x, ...) {</span>
<span id="cb47-2"><a href="chap-utiliseR.html#cb47-2"></a>    <span class="kw">cat</span>(<span class="st">&quot;La personne est:&quot;</span>, x<span class="op">@</span>Prenom, x<span class="op">@</span>Nom)</span>
<span id="cb47-3"><a href="chap-utiliseR.html#cb47-3"></a>})</span>
<span id="cb47-4"><a href="chap-utiliseR.html#cb47-4"></a><span class="kw">print</span>(Moi)</span></code></pre></div>
<pre><code>## La personne est: Eric Marcon</code></pre>
<p></p>
<p>Les attributs sont appelés par la syntaxe <code>variable@slot</code>.</p>
<p>En résumé, S4 est plus rigoureux que S3.
Quelques packages sur CRAN : <strong>Matrix</strong>, <strong>sp</strong>, <strong>odbc</strong>… et beaucoup sur Bioconductor sont écrits en S4 mais le langage est maintenant clairement délaissé au profit de S3, notamment à cause du succès du <strong>tidyverse</strong>.</p>
</div>
<div id="rc" class="section level3">
<h3><span class="header-section-number">2.1.4</span> RC</h3>
<p>RC a été introduit dans R 2.12 (2010) avec le package <strong>methods</strong>.</p>
<p>Les méthodes appartiennent aux classes, comme en C++: elles sont déclarées dans la classe et appelées à partir des objets.</p>
<p></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chap-utiliseR.html#cb49-1"></a><span class="kw">library</span>(<span class="st">&quot;methods&quot;</span>)</span>
<span id="cb49-2"><a href="chap-utiliseR.html#cb49-2"></a><span class="co"># Déclaration de la classe</span></span>
<span id="cb49-3"><a href="chap-utiliseR.html#cb49-3"></a>PersonneRC &lt;-<span class="st"> </span><span class="kw">setRefClass</span>(<span class="st">&quot;PersonneRC&quot;</span>, </span>
<span id="cb49-4"><a href="chap-utiliseR.html#cb49-4"></a>    <span class="dt">fields =</span> <span class="kw">list</span>(<span class="dt">Nom =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">Prenom =</span> <span class="st">&quot;character&quot;</span>),</span>
<span id="cb49-5"><a href="chap-utiliseR.html#cb49-5"></a>    <span class="dt">methods =</span> <span class="kw">list</span>(<span class="dt">print =</span> <span class="cf">function</span>() <span class="kw">cat</span>(Prenom, Nom)))</span>
<span id="cb49-6"><a href="chap-utiliseR.html#cb49-6"></a><span class="co"># Constructeur</span></span>
<span id="cb49-7"><a href="chap-utiliseR.html#cb49-7"></a>MoiRC &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;PersonneRC&quot;</span>, <span class="dt">Nom =</span> <span class="st">&quot;Marcon&quot;</span>, <span class="dt">Prenom =</span><span class="st">&quot;Eric&quot;</span>)</span>
<span id="cb49-8"><a href="chap-utiliseR.html#cb49-8"></a><span class="co"># Langage</span></span>
<span id="cb49-9"><a href="chap-utiliseR.html#cb49-9"></a>pryr<span class="op">::</span><span class="kw">otype</span>(MoiRC)</span></code></pre></div>
<pre><code>## [1] &quot;RC&quot;</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="chap-utiliseR.html#cb51-1"></a><span class="co"># Appel de la méthode print</span></span>
<span id="cb51-2"><a href="chap-utiliseR.html#cb51-2"></a>MoiRC<span class="op">$</span><span class="kw">print</span>()</span></code></pre></div>
<pre><code>## Eric Marcon</code></pre>
<p></p>
<p>RC est un langage confidentiel, bien que ce soit le premier “vrai” langage orienté objet de R.</p>
</div>
<div id="s6" class="section level3">
<h3><span class="header-section-number">2.1.5</span> S6</h3>
<p>S6<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> perfectionne RC mais n’est pas inclus dans R: il nécessite d’installer son package.</p>
<p>Les attributs et les méthodes peuvent être publics ou privés.
Une méthode <code>initialize()</code> est utilisée comme constructeur.</p>
<p></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="chap-utiliseR.html#cb53-1"></a><span class="kw">library</span>(R6)</span>
<span id="cb53-2"><a href="chap-utiliseR.html#cb53-2"></a>PersonneR6 &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;PersonneR6&quot;</span>, <span class="dt">public =</span> <span class="kw">list</span>(<span class="dt">Nom =</span> <span class="st">&quot;character&quot;</span>, </span>
<span id="cb53-3"><a href="chap-utiliseR.html#cb53-3"></a>    <span class="dt">Prenom =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">Nom =</span> <span class="ot">NA</span>, </span>
<span id="cb53-4"><a href="chap-utiliseR.html#cb53-4"></a>        <span class="dt">Prenom =</span> <span class="ot">NA</span>) {</span>
<span id="cb53-5"><a href="chap-utiliseR.html#cb53-5"></a>        self<span class="op">$</span>Nom &lt;-<span class="st"> </span>Nom</span>
<span id="cb53-6"><a href="chap-utiliseR.html#cb53-6"></a>        self<span class="op">$</span>Prenom &lt;-<span class="st"> </span>Prenom</span>
<span id="cb53-7"><a href="chap-utiliseR.html#cb53-7"></a>    }, <span class="dt">print =</span> <span class="cf">function</span>() <span class="kw">cat</span>(self<span class="op">$</span>Prenom, self<span class="op">$</span>Nom)))</span>
<span id="cb53-8"><a href="chap-utiliseR.html#cb53-8"></a>MoiR6 &lt;-<span class="st"> </span>PersonneR6<span class="op">$</span><span class="kw">new</span>(<span class="dt">Nom =</span> <span class="st">&quot;Marcon&quot;</span>, <span class="dt">Prenom =</span> <span class="st">&quot;Eric&quot;</span>)</span>
<span id="cb53-9"><a href="chap-utiliseR.html#cb53-9"></a>MoiR6<span class="op">$</span><span class="kw">print</span>()</span></code></pre></div>
<pre><code>## Eric Marcon</code></pre>
<p></p>
<p>S6 permet de programmer rigoureusement en objet mais est très peu utilisé.
Les performances de S6 sont bien supérieures à celles de RC mais sont inférieures à celles de S3<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>.</p>
<p>La non-inclusion de R6 à R est montrée par <strong>pryr</strong>:</p>
<p></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chap-utiliseR.html#cb55-1"></a>pryr<span class="op">::</span><span class="kw">otype</span>(MoiR6)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<p></p>
</div>
<div id="tidyverse" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Tidyverse</h3>
<p>Le tidyverse est un ensemble de packages cohérents qui ont fait évoluer la façon de programmer R.
L’ensemble des packages indispensables peut être chargé par le package <strong>tidyverse</strong> qui n’a pas d’autre utilité:</p>
<p></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="chap-utiliseR.html#cb57-1"></a><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p></p>
<p>Il ne s’agit pas d’un nouveau langage à proprement parler mais plutôt d’une extension de S3, avec de profondes modifications techniques, notamment l’évaluation non conventionnelle des expressions<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>, qu’il n’est pas essentiel de maîtriser en détail.</p>
<p>Ses principes sont inscrits dans un manifeste<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>.
Son apport le plus visible pour l’utilisateur sont l’enchaînement des commandes dans un flux (pipeline de code).</p>
<p>En programmation standard, l’enchaînement des fonctions s’écrit par emboîtements successifs, ce qui en rend la lecture difficile, surtout quand des arguments sont nécessaires:</p>
<p></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="chap-utiliseR.html#cb58-1"></a><span class="co"># Logarithme de base 2 de la moyenne de 100 tirages</span></span>
<span id="cb58-2"><a href="chap-utiliseR.html#cb58-2"></a><span class="co"># aléatoires dans une loi uniforme</span></span>
<span id="cb58-3"><a href="chap-utiliseR.html#cb58-3"></a><span class="kw">log</span>(<span class="kw">mean</span>(<span class="kw">runif</span>(<span class="dv">100</span>)), <span class="dt">base =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -1.127903</code></pre>
<p></p>
<p>Dans le tidyverse, les fonctions s’enchaînent, ce qui correspond souvent mieux à la réflexion du programmeur sur le traitement des données:</p>
<p></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="chap-utiliseR.html#cb60-1"></a><span class="co"># 100 tirages aléatoires dans une loi uniforme</span></span>
<span id="cb60-2"><a href="chap-utiliseR.html#cb60-2"></a><span class="kw">runif</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-3"><a href="chap-utiliseR.html#cb60-3"></a><span class="st">  </span><span class="co"># Moyenne</span></span>
<span id="cb60-4"><a href="chap-utiliseR.html#cb60-4"></a><span class="st">  </span>mean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-5"><a href="chap-utiliseR.html#cb60-5"></a><span class="st">  </span><span class="co"># Logarithme</span></span>
<span id="cb60-6"><a href="chap-utiliseR.html#cb60-6"></a><span class="st">  </span><span class="kw">log</span>(<span class="dt">base=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -0.9772102</code></pre>
<p></p>
<p>Le tuyau <code>%&gt;%</code> est un opérateur qui appelle la fonction suivante en lui passant comme premier argument le résultat de la fonction précédente.
Les arguments supplémentaires sont passés normalement: pour la lisibilité du code, il est indispensable de les nommer.
La plupart des fonctions de R sont utilisables sans difficultés dans le tidyverse bien qu’elles n’aient pas été prévues pour cela: il suffit que leur premier argument soit les données à traiter.</p>
<p>Le pipeline ne permet de passer qu’une seule valeur à la fonction suivante, ce qui interdit les fonctions multidimensionnelles, de type <code>f(x,y)</code>.
La structure de données préférée est le <em>tibble</em>, qui est un dataframe amélioré: sa méthode <code>print()</code> est plus lisible, et il corrige quelques comportements non-intuitifs des dataframes, comme la conversion automatique en vecteurs des dataframes à une seule colonne.
Les colonnes du dataframe ou du tibble permettent de passer autant de données que nécessaire.</p>
<p>Enfin, la visualisation des données est prise en charge par <strong>ggplot2</strong> qui s’appuie sur une grammaire des graphiques <span class="citation">(Wickham <a href="#ref-Wickham2010" role="doc-biblioref">2010</a>)</span> solide sur le plan théorique.
Schématiquement, un graphique est construit selon le modèle suivant:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;</code></pre>
<ul>
<li>les données sont obligatoirement un dataframe;</li>
<li>la géométrie est le type de graphique choisi (points, lignes, histogrammes…);</li>
<li>l’esthétique (fonction <code>aes()</code>) désigne ce qui est représenté: c’est la correspondance entre les colonnes du dataframe et les éléments nécessaires à la géométrie;</li>
<li>la statistique est le traitement appliqué aux données avant de les transmettre à la géométrie (souvent “identity”, c’est-à-dire aucune transformation mais “boxplot” pour une boîte à moustache).
Les données peuvent être transformées par une fonction d’échelle, comme <code>scale_y_log10()</code>;</li>
<li>la position est l’emplacement des objets sur le graphique (souvent “identity”; “stack” pour un histogramme empilé, “jitter” pour déplacer légèrement les points superposés dans un <code>geom_point</code>);</li>
<li>les coordonnées définissent l’affichage du graphique (<code>coord_fixed()</code> pour ne pas déformer une carte par exemple) ;</li>
<li>enfin, les facettes offrent la possibilité d’afficher plusieurs aspects des mêmes données en produisant un graphique par modalité d’une variable.</li>
</ul>
<p>L’ensemble formé par le pipeline et <strong>ggplot2</strong> permet des traitements complexes dans un code lisible.
La figure <a href="chap-utiliseR.html#fig:diamonds">2.1</a> montre le résultat du code suivant:</p>

<p></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="chap-utiliseR.html#cb63-1"></a><span class="co"># Données sur les diamants fournies par ggplot2</span></span>
<span id="cb63-2"><a href="chap-utiliseR.html#cb63-2"></a>diamonds <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb63-3"><a href="chap-utiliseR.html#cb63-3"></a><span class="st">  </span><span class="co"># Ne conserver que les diamants de plus d&#39;un demi-carat</span></span>
<span id="cb63-4"><a href="chap-utiliseR.html#cb63-4"></a><span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb63-5"><a href="chap-utiliseR.html#cb63-5"></a><span class="st">  </span><span class="co"># Graphique : prix en fonction du poids</span></span>
<span id="cb63-6"><a href="chap-utiliseR.html#cb63-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb63-7"><a href="chap-utiliseR.html#cb63-7"></a><span class="st">    </span><span class="co"># Nuage de points</span></span>
<span id="cb63-8"><a href="chap-utiliseR.html#cb63-8"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb63-9"><a href="chap-utiliseR.html#cb63-9"></a><span class="st">    </span><span class="co"># Echelle logarithmique</span></span>
<span id="cb63-10"><a href="chap-utiliseR.html#cb63-10"></a><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb63-11"><a href="chap-utiliseR.html#cb63-11"></a><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb63-12"><a href="chap-utiliseR.html#cb63-12"></a><span class="st">    </span><span class="co"># Régression linéaire</span></span>
<span id="cb63-13"><a href="chap-utiliseR.html#cb63-13"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds"></span>
<img src="travailleR_files/figure-html/diamonds-1.png" alt="Prix des diamants en fonction de leur poids. Démonstration du code de ggplot2 combiné au traitement de données du tidyverse." width="80%" />
<p class="caption">
Figure 2.1: Prix des diamants en fonction de leur poids. Démonstration du code de <strong>ggplot2</strong> combiné au traitement de données du tidyverse.
</p>
</div>
<p></p>
<p>Le tidyverse est documenté en détail dans <span class="citation">Wickham et Grolemund (<a href="#ref-Wickham2016" role="doc-biblioref">2016</a>)</span> et <strong>ggplot2</strong> dans <span class="citation">Wickham (<a href="#ref-Wickham2017" role="doc-biblioref">2017</a>)</span>.</p>
</div>
</div>
<div id="sec:environnements" class="section level2">
<h2><span class="header-section-number">2.2</span> Environnements</h2>
<p>Les objets de R, données et fonctions, sont nommés.
Comme R est modulaire, avec la possibilité de lui ajouter un nombre indéterminé de packages, il est très probable que des conflits de nom apparaissent.
Pour les régler, R dispose d’un système rigoureux de précédence des noms: le code s’exécute dans un environnement défini, héritant d’environnements parents.</p>
<div id="organisation" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Organisation</h3>
<p>R démarre dans un environnement vide.
Chaque package chargé crée un environnement fils pour former une pile des environnements, dont chaque nouvel élément est appelé “fils” du précédent, qui est son “parent”.</p>
<p>La console se trouve dans l’environnement global, fils du dernier package chargé.</p>
<p></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="chap-utiliseR.html#cb64-1"></a><span class="kw">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;         &quot;package:R6&quot;         &quot;package:entropart&quot; 
##  [4] &quot;package:forcats&quot;    &quot;package:stringr&quot;    &quot;package:dplyr&quot;     
##  [7] &quot;package:purrr&quot;      &quot;package:readr&quot;      &quot;package:tidyr&quot;     
## [10] &quot;package:tibble&quot;     &quot;package:ggplot2&quot;    &quot;package:tidyverse&quot; 
## [13] &quot;package:kableExtra&quot; &quot;package:stats&quot;      &quot;package:graphics&quot;  
## [16] &quot;package:grDevices&quot;  &quot;package:utils&quot;      &quot;package:datasets&quot;  
## [19] &quot;package:methods&quot;    &quot;Autoloads&quot;          &quot;package:base&quot;</code></pre>
<p></p>
<p>Le code d’une fonction appelée de la console s’exécute dans un environnement fils de l’environnement global:</p>
<p></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="chap-utiliseR.html#cb66-1"></a><span class="co"># Environnement actuel</span></span>
<span id="cb66-2"><a href="chap-utiliseR.html#cb66-2"></a><span class="kw">environment</span>()</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="chap-utiliseR.html#cb68-1"></a><span class="co"># La fonction f affiche son environnement</span></span>
<span id="cb68-2"><a href="chap-utiliseR.html#cb68-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="kw">environment</span>()</span>
<span id="cb68-3"><a href="chap-utiliseR.html#cb68-3"></a><span class="co"># Affichage de l&#39;environnement de la fonction</span></span>
<span id="cb68-4"><a href="chap-utiliseR.html#cb68-4"></a><span class="kw">f</span>()</span></code></pre></div>
<pre><code>## &lt;environment: 0x7fee5a5f0c88&gt;</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="chap-utiliseR.html#cb70-1"></a><span class="co"># Environnement parent de celui de la fonction</span></span>
<span id="cb70-2"><a href="chap-utiliseR.html#cb70-2"></a><span class="kw">parent.env</span>(<span class="kw">f</span>())</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<p></p>
</div>
<div id="recherche" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Recherche</h3>
<p>La recherche des objets commence dans l’environnement local.
S’il n’est pas trouvé, il est cherché dans l’environnement parent, puis dans le parent du parent, jusqu’à l’épuisement des environnements qui génère une erreur indiquant que l’objet n’a pas été trouvé.</p>
<p>Exemple:</p>
<p></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="chap-utiliseR.html#cb72-1"></a><span class="co"># Variable q définie dans l&#39;environnement global</span></span>
<span id="cb72-2"><a href="chap-utiliseR.html#cb72-2"></a>q &lt;-<span class="st"> &quot;GlobalEnv&quot;</span></span>
<span id="cb72-3"><a href="chap-utiliseR.html#cb72-3"></a><span class="co"># Fonction définissant q dans son environnement</span></span>
<span id="cb72-4"><a href="chap-utiliseR.html#cb72-4"></a>qLocalFonction &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb72-5"><a href="chap-utiliseR.html#cb72-5"></a>    q &lt;-<span class="st"> &quot;Fonction&quot;</span></span>
<span id="cb72-6"><a href="chap-utiliseR.html#cb72-6"></a>    <span class="kw">return</span>(q)</span>
<span id="cb72-7"><a href="chap-utiliseR.html#cb72-7"></a>}</span>
<span id="cb72-8"><a href="chap-utiliseR.html#cb72-8"></a><span class="co"># La variable locale est retournée</span></span>
<span id="cb72-9"><a href="chap-utiliseR.html#cb72-9"></a><span class="kw">qLocalFonction</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Fonction&quot;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="chap-utiliseR.html#cb74-1"></a><span class="co"># Fonction (mal écrite) utilisant une variable qu&#39;elle</span></span>
<span id="cb74-2"><a href="chap-utiliseR.html#cb74-2"></a><span class="co"># ne définit pas</span></span>
<span id="cb74-3"><a href="chap-utiliseR.html#cb74-3"></a>qGlobalEnv &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb74-4"><a href="chap-utiliseR.html#cb74-4"></a>    <span class="kw">return</span>(q)</span>
<span id="cb74-5"><a href="chap-utiliseR.html#cb74-5"></a>}</span>
<span id="cb74-6"><a href="chap-utiliseR.html#cb74-6"></a><span class="co"># La variable de l&#39;environnement global est retournée</span></span>
<span id="cb74-7"><a href="chap-utiliseR.html#cb74-7"></a><span class="kw">qGlobalEnv</span>()</span></code></pre></div>
<pre><code>## [1] &quot;GlobalEnv&quot;</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="chap-utiliseR.html#cb76-1"></a><span class="co"># Suppression de cette variable</span></span>
<span id="cb76-2"><a href="chap-utiliseR.html#cb76-2"></a><span class="kw">rm</span>(q)</span>
<span id="cb76-3"><a href="chap-utiliseR.html#cb76-3"></a><span class="co"># La fonction base::q est retournée</span></span>
<span id="cb76-4"><a href="chap-utiliseR.html#cb76-4"></a><span class="kw">qGlobalEnv</span>()</span></code></pre></div>
<pre><code>## function (save = &quot;default&quot;, status = 0, runLast = TRUE) 
## .Internal(quit(save, status, runLast))
## &lt;bytecode: 0x7fee5bdfac18&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p></p>
<p>La variable <code>q</code> est définie dans l’environnement global.
La fonction <code>qLocalFonction</code> définit sa propre variable <code>q</code>.
L’appel de la fonction retourne la valeur locale de la fonction parce qu’elle se trouve dans l’environnement de la fonction.</p>
<p>La fonction <code>qGlobalEnv</code> retourne la variable <code>q</code> qu’elle ne définit pas localement.
Elle la recherche donc dans son environnement parent et trouve la variable définie dans l’environnement global.
En supprimant la variable de l’environnement global par <code>rm(q)</code>, la fonction <code>qGlobalEnv()</code> parcourt la pile des environnements jusqu’à trouver un objet nommé <code>q</code> dans le package <strong>base</strong>, qui est la fonction permettant de quitter R.
Elle aurait pu trouver un autre objet si un package contenant un objet <code>q</code>avait été chargé.</p>
<p>Pour éviter ce comportement erratique, une fonction ne doit <em>jamais</em> appeler un objet non défini dans son propre environnement.</p>
</div>
<div id="espaces-de-nom-des-packages" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Espaces de nom des packages</h3>
<p>Il est temps de définir précisément ce que les packages rendent visible.
Les packages contiennent des objets (fonctions et données) qu’ils <em>exportent</em> ou non.
Ils sont habituellement appelés par la fonction <code>library()</code> qui effectue deux opérations:</p>
<ul>
<li>elle <em>charge</em> le package en mémoire, ce qui permet d’accéder à tous ses objets avec la syntaxe <code>package::objet</code> pour les objets exportés et <code>package:::objet</code> pour ceux qui ne le sont pas;</li>
<li>elle <em>attache</em> ensuite le package, ce qui place son environnement en haut de la pile.</li>
</ul>
<p>Il est possible de détacher un package avec la fonction <code>unloadNamespace()</code> pour le retirer de la pile des environnements.
Exemple:</p>
<p></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="chap-utiliseR.html#cb78-1"></a><span class="co"># entropart chargé et attaché</span></span>
<span id="cb78-2"><a href="chap-utiliseR.html#cb78-2"></a><span class="kw">library</span>(<span class="st">&quot;entropart&quot;</span>)</span>
<span id="cb78-3"><a href="chap-utiliseR.html#cb78-3"></a><span class="co"># Est-il attaché ?</span></span>
<span id="cb78-4"><a href="chap-utiliseR.html#cb78-4"></a><span class="kw">isNamespaceLoaded</span>(<span class="st">&quot;entropart&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="chap-utiliseR.html#cb80-1"></a><span class="co"># Pile des environnements</span></span>
<span id="cb80-2"><a href="chap-utiliseR.html#cb80-2"></a><span class="kw">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;         &quot;package:R6&quot;         &quot;package:entropart&quot; 
##  [4] &quot;package:forcats&quot;    &quot;package:stringr&quot;    &quot;package:dplyr&quot;     
##  [7] &quot;package:purrr&quot;      &quot;package:readr&quot;      &quot;package:tidyr&quot;     
## [10] &quot;package:tibble&quot;     &quot;package:ggplot2&quot;    &quot;package:tidyverse&quot; 
## [13] &quot;package:kableExtra&quot; &quot;package:stats&quot;      &quot;package:graphics&quot;  
## [16] &quot;package:grDevices&quot;  &quot;package:utils&quot;      &quot;package:datasets&quot;  
## [19] &quot;package:methods&quot;    &quot;Autoloads&quot;          &quot;package:base&quot;</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="chap-utiliseR.html#cb82-1"></a><span class="co"># Diversity(), une fonction exportée par entropart est</span></span>
<span id="cb82-2"><a href="chap-utiliseR.html#cb82-2"></a><span class="co"># trouvée</span></span>
<span id="cb82-3"><a href="chap-utiliseR.html#cb82-3"></a><span class="kw">Diversity</span>(<span class="dv">1</span>, <span class="dt">CheckArguments =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## None 
##    1</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="chap-utiliseR.html#cb84-1"></a><span class="co"># Détacher et décharger entropart</span></span>
<span id="cb84-2"><a href="chap-utiliseR.html#cb84-2"></a><span class="kw">unloadNamespace</span>(<span class="st">&quot;entropart&quot;</span>)</span>
<span id="cb84-3"><a href="chap-utiliseR.html#cb84-3"></a><span class="co"># Est-il attaché ?</span></span>
<span id="cb84-4"><a href="chap-utiliseR.html#cb84-4"></a><span class="kw">isNamespaceLoaded</span>(<span class="st">&quot;entropart&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="chap-utiliseR.html#cb86-1"></a><span class="co"># Pile des environnements, sans entropart</span></span>
<span id="cb86-2"><a href="chap-utiliseR.html#cb86-2"></a><span class="kw">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;         &quot;package:R6&quot;         &quot;package:forcats&quot;   
##  [4] &quot;package:stringr&quot;    &quot;package:dplyr&quot;      &quot;package:purrr&quot;     
##  [7] &quot;package:readr&quot;      &quot;package:tidyr&quot;      &quot;package:tibble&quot;    
## [10] &quot;package:ggplot2&quot;    &quot;package:tidyverse&quot;  &quot;package:kableExtra&quot;
## [13] &quot;package:stats&quot;      &quot;package:graphics&quot;   &quot;package:grDevices&quot; 
## [16] &quot;package:utils&quot;      &quot;package:datasets&quot;   &quot;package:methods&quot;   
## [19] &quot;Autoloads&quot;          &quot;package:base&quot;</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="chap-utiliseR.html#cb88-1"></a><span class="co"># Diversity() est introuvable</span></span>
<span id="cb88-2"><a href="chap-utiliseR.html#cb88-2"></a><span class="kw">tryCatch</span>(<span class="kw">Diversity</span>(<span class="dv">1</span>), <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="kw">print</span>(e))</span></code></pre></div>
<pre><code>## &lt;simpleError in Diversity(1): could not find function &quot;Diversity&quot;&gt;</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="chap-utiliseR.html#cb90-1"></a><span class="co"># mais peut être appelée avec son nom complet.  L&#39;appel</span></span>
<span id="cb90-2"><a href="chap-utiliseR.html#cb90-2"></a><span class="co"># exécute implicitement</span></span>
<span id="cb90-3"><a href="chap-utiliseR.html#cb90-3"></a>entropart<span class="op">::</span><span class="kw">Diversity</span>(<span class="dv">1</span>, <span class="dt">CheckArguments =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## None 
##    1</code></pre>
<p></p>
<p>L’appel de <code>entropart::Diversity()</code> charge le package (c’est-à-dire, exécute implicitement <code>loadNamespace("entropart")</code>) mais ne l’attache pas.</p>
<p>En pratique, il faut limiter le nombre de package attachés pour limiter le risque d’appeler une fonction non désirée homonyme de la fonction recherchée.
Dans les cas critiques, il faut utiliser le nom complet de la fonction: <code>package::fonction()</code>.</p>
<p>Un problème fréquent concerne la <code>filter()</code> de <strong>dplyr</strong> homonyme de celle de <strong>stats</strong>.
Le package <strong>stats</strong> est habituellement chargé avant <strong>dplyr</strong>, un package du tidyverse.
<code>stats::filter()</code> doit donc être appelée explicitement.</p>
<p>Cependant, le package <strong>dplyr</strong> ou <strong>tidyverse</strong> (qui attache tous les packages du tidyverse) peut être chargé systématiquement en créant un fichier <code>.RProfile</code> à la racine du projet contenant la commande:</p>
<p></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="chap-utiliseR.html#cb92-1"></a><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p></p>
<p>Dans ce cas, <strong>dplyr</strong> est chargé <em>avant</em> <strong>stats</strong> et c’est sa fonction qui est inaccessible.</p>
</div>
</div>
<div id="mesure-du-temps-dexécution" class="section level2">
<h2><span class="header-section-number">2.3</span> Mesure du temps d’exécution</h2>
<p>Le temps d’exécution d’un code long peut être mesuré très simplement par la commande <code>system.time</code>.
Pour des temps d’exécution très courts, il est nécessaire de répéter la mesure: c’est l’objet du package <strong>microbenchmark</strong>.</p>
<div id="system.time" class="section level3">
<h3><span class="header-section-number">2.3.1</span> system.time</h3>
<p>La fonction retourne le temps d’exécution du code.</p>
<p></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="chap-utiliseR.html#cb93-1"></a><span class="co"># Ecart absolu moyen de 1000 valeurs dans une loi</span></span>
<span id="cb93-2"><a href="chap-utiliseR.html#cb93-2"></a><span class="co"># uniforme, répété 100 fois</span></span>
<span id="cb93-3"><a href="chap-utiliseR.html#cb93-3"></a><span class="kw">system.time</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>) <span class="kw">mad</span>(<span class="kw">runif</span>(<span class="dv">1000</span>)))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.021   0.002   0.022</code></pre>
<p></p>
</div>
<div id="microbenchmark" class="section level3">
<h3><span class="header-section-number">2.3.2</span> microbenchmark</h3>
<p>Le package <strong>microbenchmark</strong> est le plus avancé.</p>
<p>L’objectif est de comparer la vitesse du calcul du carré d’un vecteur (ou d’un nombre) en le multipliant par lui-même (<span class="math inline">\(x \times x\)</span>) ou en l’élevant à la puissance 2 (<span class="math inline">\(x^2\)</span>).</p>
<p></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="chap-utiliseR.html#cb95-1"></a><span class="co"># Fonctions à tester</span></span>
<span id="cb95-2"><a href="chap-utiliseR.html#cb95-2"></a>f1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span>x</span>
<span id="cb95-3"><a href="chap-utiliseR.html#cb95-3"></a>f2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">2</span></span>
<span id="cb95-4"><a href="chap-utiliseR.html#cb95-4"></a>f3 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x<span class="op">^</span><span class="fl">2.1</span></span>
<span id="cb95-5"><a href="chap-utiliseR.html#cb95-5"></a>f4 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">3</span></span>
<span id="cb95-6"><a href="chap-utiliseR.html#cb95-6"></a><span class="co"># Initialisation</span></span>
<span id="cb95-7"><a href="chap-utiliseR.html#cb95-7"></a>X &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb95-8"><a href="chap-utiliseR.html#cb95-8"></a><span class="co"># Test</span></span>
<span id="cb95-9"><a href="chap-utiliseR.html#cb95-9"></a><span class="kw">library</span>(<span class="st">&quot;microbenchmark&quot;</span>)</span>
<span id="cb95-10"><a href="chap-utiliseR.html#cb95-10"></a>(mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">f1</span>(X), <span class="kw">f2</span>(X), <span class="kw">f3</span>(X), <span class="kw">f4</span>(X)))</span></code></pre></div>
<pre><code>## Unit: microseconds
##   expr     min       lq      mean   median       uq      max neval
##  f1(X)  35.736  36.9660  51.73895  37.7270  39.2650 1321.688   100
##  f2(X)  42.961  44.5875  59.12417  45.5730  47.0865 1261.913   100
##  f3(X) 273.894 275.5610 291.50251 276.5000 279.7830 1526.769   100
##  f4(X) 407.231 409.0505 432.35935 411.6225 416.9765 1857.838   100</code></pre>
<p></p>
<p>Le tableau retourné contient les temps minimum, médian, moyen, max et les premiers et troisièmes quartiles, ainsi que le nombre de répétitions.
La valeur médiane est à comparer.
Le nombre de répétition est par défaut de 100, à moduler (argument <code>times</code>) en fonction de la complexité du calcul.</p>
<p>Le résultat du test, un objet de type <code>microbenchmark</code>, est un tableau brut des temps d’exécution.
L’analyse statistique est faite par les méthodes <code>print</code> et <code>summary</code>.
Pour choisir les colonnes à afficher, utiliser la syntaxe suivante:</p>
<p></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="chap-utiliseR.html#cb97-1"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##    expr   median
## 1 f1(X)  37.7270
## 2 f2(X)  45.5730
## 3 f3(X) 276.5000
## 4 f4(X) 411.6225</code></pre>
<p></p>
<p>Pour faire des calculs sur ces résultats, il faut les stocker dans une variable.
Pour empêcher l’affichage dans la console, la solution la plus simple est d’utiliser la fonction <code>capture.output</code> en affectant son résultat à une variable.</p>
<p></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="chap-utiliseR.html#cb99-1"></a>dummy &lt;-<span class="st"> </span><span class="kw">capture.output</span>(mbs &lt;-<span class="st"> </span><span class="kw">summary</span>(mb))</span></code></pre></div>
<p></p>
<p>Le test précédent est affiché à nouveau.</p>
<p></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="chap-utiliseR.html#cb100-1"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##    expr   median
## 1 f1(X)  37.7270
## 2 f2(X)  45.5730
## 3 f3(X) 276.5000
## 4 f4(X) 411.6225</code></pre>
<p></p>
<p>Le temps de calcul est à peu près identique entre <span class="math inline">\(x \times x\)</span> et <span class="math inline">\(x^2\)</span>.
Le calcul de puissance est nettement plus long, surtout si la puissance n’est pas entière, parce qu’il nécessite un calcul de logarithme.
Le calcul de la puissance 2 est donc optimisé par R pour éviter l’usage du log.</p>
<p>Deux représentations graphiques sont disponibles: les violons représentent la densité de probabilité du temps d’exécution; les boîtes à moustache sont classiques.</p>
<p></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="chap-utiliseR.html#cb102-1"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb102-2"><a href="chap-utiliseR.html#cb102-2"></a><span class="kw">autoplot</span>(mb)</span></code></pre></div>
<p><img src="travailleR_files/figure-html/unnamed-chunk-17-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="chap-utiliseR.html#cb103-1"></a><span class="kw">boxplot</span>(mb)</span></code></pre></div>
<p><img src="travailleR_files/figure-html/unnamed-chunk-17-2.png" width="80%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="profilage" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Profilage</h3>
<p><strong>profvis</strong> est l’outil de profilage de RStudio.</p>
<p>Il permet de suivre le temps d’exécution de chaque ligne de code et la mémoire utilisée.
L’objectif est de détecter les portions de code lentes, à améliorer.</p>
<p></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="chap-utiliseR.html#cb104-1"></a><span class="kw">library</span>(profvis)</span>
<span id="cb104-2"><a href="chap-utiliseR.html#cb104-2"></a>p &lt;-<span class="st"> </span><span class="kw">profvis</span>({</span>
<span id="cb104-3"><a href="chap-utiliseR.html#cb104-3"></a>    <span class="co"># Calculs de cosinus</span></span>
<span id="cb104-4"><a href="chap-utiliseR.html#cb104-4"></a>    <span class="kw">cos</span>(<span class="kw">runif</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">7</span>))</span>
<span id="cb104-5"><a href="chap-utiliseR.html#cb104-5"></a>    <span class="co"># 1/2 seconde de pause</span></span>
<span id="cb104-6"><a href="chap-utiliseR.html#cb104-6"></a>    <span class="kw">pause</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb104-7"><a href="chap-utiliseR.html#cb104-7"></a>})</span>
<span id="cb104-8"><a href="chap-utiliseR.html#cb104-8"></a>htmlwidgets<span class="op">::</span><span class="kw">saveWidget</span>(p, <span class="st">&quot;docs/profile.html&quot;</span>)</span></code></pre></div>
<p></p>
<p>Le résultat est un fichier HTML contenant le rapport de profilage<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>.
On peut observer que le temps de tirage des nombres aléatoires est similaire à celui du calcul des cosinus.</p>
<p>Lire la documentation complète<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a> sur le site de RStudio.</p>
</div>
</div>
<div id="boucles" class="section level2">
<h2><span class="header-section-number">2.4</span> Boucles</h2>
<p>Le cas le plus fréquent de code long à exécuter est celui des boucles: le même code est répété un grand nombre de fois.</p>
<div id="fonctions-vectorielles" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Fonctions vectorielles</h3>
<p>La plupart des fonctions de R sont vectorielles: les boucles sont traitées de façon interne, extrêmement rapide.
Il faut donc raisonner en termes de vecteurs plutôt que de scalaires.</p>
<p></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="chap-utiliseR.html#cb105-1"></a><span class="co"># Tirage de deux vecteurs de trois nombres aléatoires</span></span>
<span id="cb105-2"><a href="chap-utiliseR.html#cb105-2"></a><span class="co"># entre 0 et 1</span></span>
<span id="cb105-3"><a href="chap-utiliseR.html#cb105-3"></a>x1 &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">3</span>)</span>
<span id="cb105-4"><a href="chap-utiliseR.html#cb105-4"></a>x2 &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">3</span>)</span>
<span id="cb105-5"><a href="chap-utiliseR.html#cb105-5"></a><span class="co"># Racine carrée des trois nombres de x1</span></span>
<span id="cb105-6"><a href="chap-utiliseR.html#cb105-6"></a><span class="kw">sqrt</span>(x1)</span></code></pre></div>
<pre><code>## [1] 0.9427738 0.8665204 0.4586981</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="chap-utiliseR.html#cb107-1"></a><span class="co"># Sommes respective des trois nombres de x1 et x2</span></span>
<span id="cb107-2"><a href="chap-utiliseR.html#cb107-2"></a>x1 <span class="op">+</span><span class="st"> </span>x2</span></code></pre></div>
<pre><code>## [1] 1.6262539 1.6881583 0.9063973</code></pre>
<p></p>
<p>Il faut aussi écrire des fonctions vectorielles sur leur premier argument.
La fonction <code>lnq</code> du package <strong>entropart</strong> retourne le logarithme déformé d’ordre <span class="math inline">\(q\)</span> d’un nombre <span class="math inline">\(x\)</span>.</p>
<p></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="chap-utiliseR.html#cb109-1"></a><span class="co"># Code de la fonction</span></span>
<span id="cb109-2"><a href="chap-utiliseR.html#cb109-2"></a>entropart<span class="op">::</span>lnq</span></code></pre></div>
<pre><code>## function (x, q) 
## {
##     if (q == 1) {
##         return(log(x))
##     }
##     else {
##         Log &lt;- (x^(1 - q) - 1)/(1 - q)
##         Log[x &lt; 0] &lt;- NA
##         return(Log)
##     }
## }
## &lt;bytecode: 0x7fee3d27fd28&gt;
## &lt;environment: namespace:entropart&gt;</code></pre>
<p></p>
<p>Pour qu’une fonction soit vectorielle, chaque ligne de son code doit permettre que le premier argument soit traité comme un vecteur.
Ici: <code>log(x)</code> et <code>x^</code> sont une fonction et un opérateur vectoriels et la condition <code>[x &lt; 0]</code> retourne aussi un vecteur.</p>
</div>
<div id="lapply" class="section level3">
<h3><span class="header-section-number">2.4.2</span> lapply</h3>
<p>Les codes qui ne peuvent pas être écrits comme une fonction vectorielle nécessitent des boucles.</p>
<p><code>lapply()</code> applique une fonction à chaque élément d’une liste.
Elle est déclinée sous plusieurs versions:</p>
<ul>
<li><code>lapply()</code> renvoie une liste (économise le temps de leur réorganisation dans un tableau);</li>
<li><code>sapply()</code> renvoie un dataframe en rassemblant les listes par <code>simplify2array()</code>;</li>
<li><code>vapply()</code> est presque identique mais demande que le type de données du résultat soit fourni.</li>
</ul>
<p></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="chap-utiliseR.html#cb111-1"></a><span class="co"># Tirage de 1000 valeurs dans une loi uniforme</span></span>
<span id="cb111-2"><a href="chap-utiliseR.html#cb111-2"></a>x1 &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1000</span>)</span>
<span id="cb111-3"><a href="chap-utiliseR.html#cb111-3"></a><span class="co"># La racine carrée peut être calculée pour le vecteur ou</span></span>
<span id="cb111-4"><a href="chap-utiliseR.html#cb111-4"></a><span class="co"># chaque valeur</span></span>
<span id="cb111-5"><a href="chap-utiliseR.html#cb111-5"></a><span class="kw">identical</span>(<span class="kw">sqrt</span>(x1), <span class="kw">sapply</span>(x1, <span class="dt">FUN =</span> sqrt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="chap-utiliseR.html#cb113-1"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">sqrt</span>(x1), <span class="kw">lapply</span>(x1, <span class="dt">FUN =</span> sqrt), <span class="kw">sapply</span>(x1, </span>
<span id="cb113-2"><a href="chap-utiliseR.html#cb113-2"></a>    <span class="dt">FUN =</span> sqrt), <span class="kw">vapply</span>(x1, <span class="dt">FUN =</span> sqrt, <span class="dt">FUN.VALUE =</span> <span class="dv">0</span>))</span>
<span id="cb113-3"><a href="chap-utiliseR.html#cb113-3"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                                    expr   median
## 1                              sqrt(x1)   4.6280
## 2                lapply(x1, FUN = sqrt) 295.4855
## 3                sapply(x1, FUN = sqrt) 356.5005
## 4 vapply(x1, FUN = sqrt, FUN.VALUE = 0) 296.1095</code></pre>
<p>
<code>lapply()</code> est beaucoup plus lent qu’une fonction vectorielle.
<code>sapply()</code> nécessite plus de temps pour <code>simplify2array()</code>, qui doit détecter comment rassembler les résultats.
Enfin, <code>vapply()</code> économise le temps de détermination du type de données du résultat et permet d’accélérer le calcul avec peu d’efforts.</p>
</div>
<div id="boucles-for" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Boucles for</h3>
<p>Les boucles sont gérées par la fonction <code>for</code>.
Elles ont la réputation d’être lentes dans R parce que le code à l’intérieur de la boucle doit être interprété à chaque exécution.
Ce n’est plus le cas depuis la version 3.5 de R: les boucles sont compilées systématiquement avant leur exécution.
Le comportement du compilateur “juste à temps” est défini par la fonction <code>enableJIT</code>.
Le niveau par défaut est 3: les fonctions sont toutes compilées, et les boucles dans le code aussi.</p>
<p>Pour évaluer le gain de performance, le code suivant supprime toute compilation automatique, et compare la même boucle compilée ou non.</p>
<p></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="chap-utiliseR.html#cb115-1"></a><span class="kw">library</span>(<span class="st">&quot;compiler&quot;</span>)</span>
<span id="cb115-2"><a href="chap-utiliseR.html#cb115-2"></a><span class="co"># Pas de compilation automatique</span></span>
<span id="cb115-3"><a href="chap-utiliseR.html#cb115-3"></a><span class="kw">enableJIT</span>(<span class="dt">level =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="chap-utiliseR.html#cb117-1"></a><span class="co"># Boucle pour calculer la racine carrée d&#39;un vecteur</span></span>
<span id="cb117-2"><a href="chap-utiliseR.html#cb117-2"></a>Boucle &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb117-3"><a href="chap-utiliseR.html#cb117-3"></a>    <span class="co"># Initialisation du vecteur de résultat, indispensable</span></span>
<span id="cb117-4"><a href="chap-utiliseR.html#cb117-4"></a>    Racine &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dt">length =</span> <span class="kw">length</span>(x))</span>
<span id="cb117-5"><a href="chap-utiliseR.html#cb117-5"></a>    <span class="co"># Boucle</span></span>
<span id="cb117-6"><a href="chap-utiliseR.html#cb117-6"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)) Racine[i] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x[i])</span>
<span id="cb117-7"><a href="chap-utiliseR.html#cb117-7"></a>    <span class="kw">return</span>(Racine)</span>
<span id="cb117-8"><a href="chap-utiliseR.html#cb117-8"></a>}</span>
<span id="cb117-9"><a href="chap-utiliseR.html#cb117-9"></a><span class="co"># Version compilée</span></span>
<span id="cb117-10"><a href="chap-utiliseR.html#cb117-10"></a>Boucle2 &lt;-<span class="st"> </span><span class="kw">cmpfun</span>(Boucle)</span>
<span id="cb117-11"><a href="chap-utiliseR.html#cb117-11"></a><span class="co"># Comparaison</span></span>
<span id="cb117-12"><a href="chap-utiliseR.html#cb117-12"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">Boucle</span>(x1), <span class="kw">Boucle2</span>(x1))</span>
<span id="cb117-13"><a href="chap-utiliseR.html#cb117-13"></a>(mbs &lt;-<span class="st"> </span><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)])</span></code></pre></div>
<pre><code>##          expr   median
## 1  Boucle(x1) 782.1485
## 2 Boucle2(x1)  77.7740</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="chap-utiliseR.html#cb119-1"></a><span class="co"># Compilation automatique par défaut depuis la version</span></span>
<span id="cb119-2"><a href="chap-utiliseR.html#cb119-2"></a><span class="co"># 3.5</span></span>
<span id="cb119-3"><a href="chap-utiliseR.html#cb119-3"></a><span class="kw">enableJIT</span>(<span class="dt">level =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>
Le gain est considérable: de 1 à <code>10</code>.</p>
<p>Les boucles for sont maintenant nettement plus rapides que <code>vapply</code>.</p>
<p></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="chap-utiliseR.html#cb121-1"></a><span class="co"># Test</span></span>
<span id="cb121-2"><a href="chap-utiliseR.html#cb121-2"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">vapply</span>(x1, <span class="dt">FUN =</span> sqrt, <span class="dv">0</span>), <span class="kw">Boucle</span>(x1))</span>
<span id="cb121-3"><a href="chap-utiliseR.html#cb121-3"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                        expr  median
## 1 vapply(x1, FUN = sqrt, 0) 285.911
## 2                Boucle(x1)  76.012</code></pre>
<p></p>
<p>Attention, le test de performance peut être trompeur:</p>
<p></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="chap-utiliseR.html#cb123-1"></a><span class="co"># Préparation du vecteur de résultat</span></span>
<span id="cb123-2"><a href="chap-utiliseR.html#cb123-2"></a>Racine &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dt">length =</span> <span class="kw">length</span>(x1))</span>
<span id="cb123-3"><a href="chap-utiliseR.html#cb123-3"></a><span class="co"># Test</span></span>
<span id="cb123-4"><a href="chap-utiliseR.html#cb123-4"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">vapply</span>(x1, <span class="dt">FUN =</span> sqrt, <span class="dv">0</span>), </span>
<span id="cb123-5"><a href="chap-utiliseR.html#cb123-5"></a>                     <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x1)) </span>
<span id="cb123-6"><a href="chap-utiliseR.html#cb123-6"></a>                       Racine[i] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x1[i]))</span>
<span id="cb123-7"><a href="chap-utiliseR.html#cb123-7"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                                               expr   median
## 1                        vapply(x1, FUN = sqrt, 0)  289.541
## 2 for (i in 1:length(x1)) Racine[i] &lt;- sqrt(x1[i]) 3246.760</code></pre>
<p></p>
<p>Dans ce code, la boucle for n’est pas compilée donc elle est beaucoup plus lente que dans le cadre normal de son utilisation (dans une fonction ou au niveau supérieur du code).</p>
<p>Les boucles longues permettent un suivi de leur progression par une barre de texte, ce qui est un autre avantage.
La fonction suivante exécute des pauses d’un dixième de seconde pendant le temps passé en paramètre (en secondes).</p>
<p></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="chap-utiliseR.html#cb125-1"></a>BoucleSuivie &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">duree =</span> <span class="dv">1</span>) {</span>
<span id="cb125-2"><a href="chap-utiliseR.html#cb125-2"></a>    <span class="co"># Barre de progression</span></span>
<span id="cb125-3"><a href="chap-utiliseR.html#cb125-3"></a>    pgb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> duree <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)</span>
<span id="cb125-4"><a href="chap-utiliseR.html#cb125-4"></a>    <span class="co"># Boucle</span></span>
<span id="cb125-5"><a href="chap-utiliseR.html#cb125-5"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(duree <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)) {</span>
<span id="cb125-6"><a href="chap-utiliseR.html#cb125-6"></a>        <span class="co"># Pause d&#39;un dixième de seconde</span></span>
<span id="cb125-7"><a href="chap-utiliseR.html#cb125-7"></a>        <span class="kw">Sys.sleep</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</span>
<span id="cb125-8"><a href="chap-utiliseR.html#cb125-8"></a>        <span class="co"># Suivi de la progression</span></span>
<span id="cb125-9"><a href="chap-utiliseR.html#cb125-9"></a>        <span class="kw">setTxtProgressBar</span>(pgb, i)</span>
<span id="cb125-10"><a href="chap-utiliseR.html#cb125-10"></a>    }</span>
<span id="cb125-11"><a href="chap-utiliseR.html#cb125-11"></a>}</span>
<span id="cb125-12"><a href="chap-utiliseR.html#cb125-12"></a><span class="kw">BoucleSuivie</span>()</span></code></pre></div>
<pre><code>## ================================================================================</code></pre>
<p></p>
</div>
<div id="replicate" class="section level3">
<h3><span class="header-section-number">2.4.4</span> replicate</h3>
<p><code>replicate()</code> répète une instruction.</p>
<p></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="chap-utiliseR.html#cb127-1"></a><span class="kw">replicate</span>(<span class="dv">3</span>, <span class="kw">runif</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 0.9453453 0.5262818 0.7233425</code></pre>
<p></p>
<p>est équivalent à <code>runif(3)</code>, avec des performances similaires à celles de <code>vapply</code>: de 50 à 100 fois plus lent qu’une fonction vectorielle.</p>
<p></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="chap-utiliseR.html#cb129-1"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">runif</span>(<span class="dv">1</span>)), <span class="kw">runif</span>(<span class="dv">1000</span>))</span>
<span id="cb129-2"><a href="chap-utiliseR.html#cb129-2"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                        expr    median
## 1 replicate(1000, runif(1)) 4103.2175
## 2               runif(1000)   34.8375</code></pre>
<p></p>
</div>
<div id="vectorize" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Vectorize</h3>
<p><code>Vectorize()</code> rend vectorielle une fonction qui ne l’est pas, par des boucles.
Ecrire plutôt les boucles.</p>
</div>
<div id="statistiques-marginales" class="section level3">
<h3><span class="header-section-number">2.4.6</span> Statistiques marginales</h3>
<p><code>apply</code> applique une fonction aux lignes ou colonnes d’un objet en deux dimensions.</p>
<p><code>colSums</code> et ses semblables (<code>rowSums</code>, <code>colMeans</code>, <code>rowMeans</code>) sont optimisées.</p>
<p></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="chap-utiliseR.html#cb131-1"></a><span class="co"># Somme des colonnes numériques du jeu de données diamonds de ggplot()</span></span>
<span id="cb131-2"><a href="chap-utiliseR.html#cb131-2"></a><span class="co"># Boucle identique à l&#39;action de apply(, 2, )</span></span>
<span id="cb131-3"><a href="chap-utiliseR.html#cb131-3"></a>BoucleSomme &lt;-<span class="st"> </span><span class="cf">function</span>(Table) {</span>
<span id="cb131-4"><a href="chap-utiliseR.html#cb131-4"></a>  Somme &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(Table))</span>
<span id="cb131-5"><a href="chap-utiliseR.html#cb131-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Table)) Somme[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(Table[, i])</span>
<span id="cb131-6"><a href="chap-utiliseR.html#cb131-6"></a>  <span class="kw">return</span>(Somme)</span>
<span id="cb131-7"><a href="chap-utiliseR.html#cb131-7"></a>}</span>
<span id="cb131-8"><a href="chap-utiliseR.html#cb131-8"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw">BoucleSomme</span>(diamonds[<span class="op">-</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)]), </span>
<span id="cb131-9"><a href="chap-utiliseR.html#cb131-9"></a>                     <span class="kw">apply</span>(diamonds[<span class="op">-</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)], <span class="dv">2</span>, sum), </span>
<span id="cb131-10"><a href="chap-utiliseR.html#cb131-10"></a>                     <span class="kw">colSums</span>(diamonds[<span class="op">-</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)]))</span>
<span id="cb131-11"><a href="chap-utiliseR.html#cb131-11"></a><span class="kw">summary</span>(mb)[, <span class="kw">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;median&quot;</span>)]</span></code></pre></div>
<pre><code>##                              expr   median
## 1   BoucleSomme(diamonds[-(2:4)]) 3.414502
## 2 apply(diamonds[-(2:4)], 2, sum) 8.893266
## 3       colSums(diamonds[-(2:4)]) 2.314298</code></pre>
<p></p>
<p><code>apply</code> clarifie le code mais est plus lent que la boucle, qui est à peine plus lente que <code>colSums</code>.</p>
</div>
</div>
<div id="sec:cpp" class="section level2">
<h2><span class="header-section-number">2.5</span> Code C++</h2>
<p>L’intégration de code C++ dans R est largement simplifiée par le package <strong>Rcpp</strong> mais reste difficile à déboguer et donc à réserver à du code très simple (pour éviter toute erreur) et répété un grand nombre de fois (pour mériter l’effort).
La préparation des données et leur vérification doivent être exécutées sous R, de même que le traitement et la présentation des résultats.</p>
<p>L’utilisation habituelle est l’inclusion de code C++ dans un package, mais l’utilisation hors package est possible:</p>
<ul>
<li>Le code C++ peut être inclus dans un document C++ (fichier avec l’extension <code>.cpp</code>): il est compilé par la commande <code>sourceCpp()</code> qui crée les fonctions R permettant d’appeler le code C++.</li>
<li>Dans un document RMarkdown, des bouts de code Rcpp peuvent être créés pour y insérer le code C++: ils sont compilés et interfacés pour R au moment du tricotage.</li>
</ul>
<p>L’exemple suivant montre comment créer une fonction C++ pour calculer le double d’un vecteur numérique.</p>
<p></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb133-1"><a href="chap-utiliseR.html#cb133-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb133-2"><a href="chap-utiliseR.html#cb133-2"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb133-3"><a href="chap-utiliseR.html#cb133-3"></a></span>
<span id="cb133-4"><a href="chap-utiliseR.html#cb133-4"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb133-5"><a href="chap-utiliseR.html#cb133-5"></a>NumericVector timesTwo(NumericVector x) {</span>
<span id="cb133-6"><a href="chap-utiliseR.html#cb133-6"></a>  <span class="cf">return</span> x * <span class="dv">2</span>;</span>
<span id="cb133-7"><a href="chap-utiliseR.html#cb133-7"></a>}</span></code></pre></div>
<p></p>
<p>Une fonction R du même nom que la fonction C++ est maintenant disponible.</p>
<p></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="chap-utiliseR.html#cb134-1"></a><span class="kw">timesTwo</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]  2  4  6  8 10</code></pre>
<p></p>
<p>Les performances sont deux ordres de grandeur plus rapides que le code R (voir l’étude de cas, section <a href="chap-utiliseR.html#sec:cas">2.7</a>).</p>
</div>
<div id="paralléliser-r" class="section level2">
<h2><span class="header-section-number">2.6</span> Paralléliser R</h2>
<p>Lorsque des calculs longs peuvent être découpés en tâches indépendantes, l’exécution simultanée (<em>parallèle</em>) de ces tâches permet de réduire le temps de calcul total à celui de la tâche la plus longue, auquel s’ajoute le coût de la mise en place de la parallélisation (création des tâches, récupération des résultats…).</p>
<p>Lire l’excellente introduction de Josh Errickson<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a> détaille les enjeux et les contraintes de la parallélisation.</p>
<p>Deux mécanismes sont disponibles pour l’exécution de code en parallèle:</p>
<ul>
<li><em>fork</em>: le processus en cours d’exécution est dupliqué sur plusieurs coeurs du processeur de l’ordinateur de calcul.
C’est la méthode la plus simple mais elle ne fonctionne pas sous Windows (limite du système d’exploitation).</li>
<li><em>socket</em>: un cluster est constitué, soit physiquement (un ensemble d’ordinateurs exécutant R est nécessaire) soit logiquement (une instance de R sur chaque coeur de l’ordinateur utilisé).
Les membres du cluster communiquent par le réseau (le réseau interne de l’ordinateur utilisé pour un cluster logique).</li>
</ul>
<p>Différents packages de R permettent de mettre en oeuvre ces mécanismes.</p>
<div id="mclapply-fork" class="section level3">
<h3><span class="header-section-number">2.6.1</span> mclapply (fork)</h3>
<p>La fonction <code>mclapply</code> du package <strong>parallel</strong> a la même syntaxe que <code>lapply</code> mais parallélise l’exécution des boucles.
Sous Windows, elle n’a aucun effet puisque le système ne permet pas les <em>fork</em>: elle appelle simplement <code>lapply</code>.
Cependant, un contournement existe pour émuler <code>mclapply</code> sous Windows en appelant <code>parLapply</code>, qui utilise un cluster.</p>
<p></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="chap-utiliseR.html#cb136-1"></a><span class="co">##</span></span>
<span id="cb136-2"><a href="chap-utiliseR.html#cb136-2"></a><span class="co">## mclapply.hack.R</span></span>
<span id="cb136-3"><a href="chap-utiliseR.html#cb136-3"></a><span class="co">##</span></span>
<span id="cb136-4"><a href="chap-utiliseR.html#cb136-4"></a><span class="co">## Nathan VanHoudnos</span></span>
<span id="cb136-5"><a href="chap-utiliseR.html#cb136-5"></a><span class="co">## nathanvan AT northwestern FULL STOP edu</span></span>
<span id="cb136-6"><a href="chap-utiliseR.html#cb136-6"></a><span class="co">## July 14, 2014</span></span>
<span id="cb136-7"><a href="chap-utiliseR.html#cb136-7"></a><span class="co">##</span></span>
<span id="cb136-8"><a href="chap-utiliseR.html#cb136-8"></a><span class="co">## A script to implement a hackish version of </span></span>
<span id="cb136-9"><a href="chap-utiliseR.html#cb136-9"></a><span class="co">## parallel:mclapply() on Windows machines.</span></span>
<span id="cb136-10"><a href="chap-utiliseR.html#cb136-10"></a><span class="co">## On Linux or Mac, the script has no effect</span></span>
<span id="cb136-11"><a href="chap-utiliseR.html#cb136-11"></a><span class="co">## beyond loading the parallel library. </span></span>
<span id="cb136-12"><a href="chap-utiliseR.html#cb136-12"></a></span>
<span id="cb136-13"><a href="chap-utiliseR.html#cb136-13"></a><span class="kw">require</span>(parallel)    </span></code></pre></div>
<pre><code>## Loading required package: parallel</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="chap-utiliseR.html#cb138-1"></a><span class="co">## Define the hack</span></span>
<span id="cb138-2"><a href="chap-utiliseR.html#cb138-2"></a><span class="co"># mc.cores argument added: Eric Marcon</span></span>
<span id="cb138-3"><a href="chap-utiliseR.html#cb138-3"></a>mclapply.hack &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">mc.cores=</span><span class="kw">detectCores</span>()) {</span>
<span id="cb138-4"><a href="chap-utiliseR.html#cb138-4"></a>  <span class="co">## Create a cluster</span></span>
<span id="cb138-5"><a href="chap-utiliseR.html#cb138-5"></a>  size.of.list &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">list</span>(...)[[<span class="dv">1</span>]])</span>
<span id="cb138-6"><a href="chap-utiliseR.html#cb138-6"></a>  cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>( <span class="kw">min</span>(size.of.list, mc.cores) )</span>
<span id="cb138-7"><a href="chap-utiliseR.html#cb138-7"></a>  </span>
<span id="cb138-8"><a href="chap-utiliseR.html#cb138-8"></a>  <span class="co">## Find out the names of the loaded packages </span></span>
<span id="cb138-9"><a href="chap-utiliseR.html#cb138-9"></a>  loaded.package.names &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb138-10"><a href="chap-utiliseR.html#cb138-10"></a>    <span class="co">## Base packages</span></span>
<span id="cb138-11"><a href="chap-utiliseR.html#cb138-11"></a>    <span class="kw">sessionInfo</span>()<span class="op">$</span>basePkgs,</span>
<span id="cb138-12"><a href="chap-utiliseR.html#cb138-12"></a>    <span class="co">## Additional packages</span></span>
<span id="cb138-13"><a href="chap-utiliseR.html#cb138-13"></a>    <span class="kw">names</span>( <span class="kw">sessionInfo</span>()<span class="op">$</span>otherPkgs ))</span>
<span id="cb138-14"><a href="chap-utiliseR.html#cb138-14"></a>  </span>
<span id="cb138-15"><a href="chap-utiliseR.html#cb138-15"></a>  <span class="kw">tryCatch</span>( {</span>
<span id="cb138-16"><a href="chap-utiliseR.html#cb138-16"></a>    </span>
<span id="cb138-17"><a href="chap-utiliseR.html#cb138-17"></a>    <span class="co">## Copy over all of the objects within scope to</span></span>
<span id="cb138-18"><a href="chap-utiliseR.html#cb138-18"></a>    <span class="co">## all clusters. </span></span>
<span id="cb138-19"><a href="chap-utiliseR.html#cb138-19"></a>    this.env &lt;-<span class="st"> </span><span class="kw">environment</span>()</span>
<span id="cb138-20"><a href="chap-utiliseR.html#cb138-20"></a>    <span class="cf">while</span>( <span class="kw">identical</span>( this.env, <span class="kw">globalenv</span>() ) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span> ) {</span>
<span id="cb138-21"><a href="chap-utiliseR.html#cb138-21"></a>      <span class="kw">clusterExport</span>(cl,</span>
<span id="cb138-22"><a href="chap-utiliseR.html#cb138-22"></a>                    <span class="kw">ls</span>(<span class="dt">all.names=</span><span class="ot">TRUE</span>, <span class="dt">env=</span>this.env),</span>
<span id="cb138-23"><a href="chap-utiliseR.html#cb138-23"></a>                    <span class="dt">envir=</span>this.env)</span>
<span id="cb138-24"><a href="chap-utiliseR.html#cb138-24"></a>      this.env &lt;-<span class="st"> </span><span class="kw">parent.env</span>(<span class="kw">environment</span>())</span>
<span id="cb138-25"><a href="chap-utiliseR.html#cb138-25"></a>    }</span>
<span id="cb138-26"><a href="chap-utiliseR.html#cb138-26"></a>    <span class="kw">clusterExport</span>(cl,</span>
<span id="cb138-27"><a href="chap-utiliseR.html#cb138-27"></a>                  <span class="kw">ls</span>(<span class="dt">all.names=</span><span class="ot">TRUE</span>, <span class="dt">env=</span><span class="kw">globalenv</span>()),</span>
<span id="cb138-28"><a href="chap-utiliseR.html#cb138-28"></a>                  <span class="dt">envir=</span><span class="kw">globalenv</span>())</span>
<span id="cb138-29"><a href="chap-utiliseR.html#cb138-29"></a>    </span>
<span id="cb138-30"><a href="chap-utiliseR.html#cb138-30"></a>    <span class="co">## Load the libraries on all the clusters</span></span>
<span id="cb138-31"><a href="chap-utiliseR.html#cb138-31"></a>    <span class="co">## N.B. length(cl) returns the number of clusters</span></span>
<span id="cb138-32"><a href="chap-utiliseR.html#cb138-32"></a>    <span class="kw">parLapply</span>( cl, <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cl), <span class="cf">function</span>(xx){</span>
<span id="cb138-33"><a href="chap-utiliseR.html#cb138-33"></a>      <span class="kw">lapply</span>(loaded.package.names, <span class="cf">function</span>(yy) {</span>
<span id="cb138-34"><a href="chap-utiliseR.html#cb138-34"></a>        <span class="kw">require</span>(yy , <span class="dt">character.only=</span><span class="ot">TRUE</span>)})</span>
<span id="cb138-35"><a href="chap-utiliseR.html#cb138-35"></a>    })</span>
<span id="cb138-36"><a href="chap-utiliseR.html#cb138-36"></a>    </span>
<span id="cb138-37"><a href="chap-utiliseR.html#cb138-37"></a>    <span class="co">## Run the lapply in parallel </span></span>
<span id="cb138-38"><a href="chap-utiliseR.html#cb138-38"></a>    <span class="kw">return</span>( <span class="kw">parLapply</span>( cl, ...) )</span>
<span id="cb138-39"><a href="chap-utiliseR.html#cb138-39"></a>  }, <span class="dt">finally =</span> {        </span>
<span id="cb138-40"><a href="chap-utiliseR.html#cb138-40"></a>    <span class="co">## Stop the cluster</span></span>
<span id="cb138-41"><a href="chap-utiliseR.html#cb138-41"></a>    <span class="kw">stopCluster</span>(cl)</span>
<span id="cb138-42"><a href="chap-utiliseR.html#cb138-42"></a>  })</span>
<span id="cb138-43"><a href="chap-utiliseR.html#cb138-43"></a>}</span>
<span id="cb138-44"><a href="chap-utiliseR.html#cb138-44"></a></span>
<span id="cb138-45"><a href="chap-utiliseR.html#cb138-45"></a><span class="co">## Warn the user if they are using Windows</span></span>
<span id="cb138-46"><a href="chap-utiliseR.html#cb138-46"></a><span class="cf">if</span>( <span class="kw">Sys.info</span>()[[<span class="st">&#39;sysname&#39;</span>]] <span class="op">==</span><span class="st"> &#39;Windows&#39;</span> ){</span>
<span id="cb138-47"><a href="chap-utiliseR.html#cb138-47"></a>  <span class="kw">message</span>(<span class="kw">paste</span>(</span>
<span id="cb138-48"><a href="chap-utiliseR.html#cb138-48"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb138-49"><a href="chap-utiliseR.html#cb138-49"></a>    <span class="st">&quot;   *** Microsoft Windows detected ***</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-50"><a href="chap-utiliseR.html#cb138-50"></a>    <span class="st">&quot;   </span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-51"><a href="chap-utiliseR.html#cb138-51"></a>    <span class="st">&quot;   For technical reasons, the MS Windows version of mclapply()</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-52"><a href="chap-utiliseR.html#cb138-52"></a>    <span class="st">&quot;   is implemented as a serial function instead of a parallel</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-53"><a href="chap-utiliseR.html#cb138-53"></a>    <span class="st">&quot;   function.&quot;</span>,</span>
<span id="cb138-54"><a href="chap-utiliseR.html#cb138-54"></a>    <span class="st">&quot;   </span><span class="ch">\n\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-55"><a href="chap-utiliseR.html#cb138-55"></a>    <span class="st">&quot;   As a quick hack, we replace this serial version of mclapply()</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-56"><a href="chap-utiliseR.html#cb138-56"></a>    <span class="st">&quot;   with a wrapper to parLapply() for this R session. Please see</span><span class="ch">\n\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-57"><a href="chap-utiliseR.html#cb138-57"></a>    <span class="st">&quot;     http://www.stat.cmu.edu/~nmv/2014/07/14/</span></span>
<span id="cb138-58"><a href="chap-utiliseR.html#cb138-58"></a><span class="st">    implementing-mclapply-on-windows </span><span class="ch">\n\n</span><span class="st">&quot;</span>,</span>
<span id="cb138-59"><a href="chap-utiliseR.html#cb138-59"></a>    <span class="st">&quot;   for details.</span><span class="ch">\n\n</span><span class="st">&quot;</span>))</span>
<span id="cb138-60"><a href="chap-utiliseR.html#cb138-60"></a>}</span>
<span id="cb138-61"><a href="chap-utiliseR.html#cb138-61"></a></span>
<span id="cb138-62"><a href="chap-utiliseR.html#cb138-62"></a><span class="co">## If the OS is Windows, set mclapply to the</span></span>
<span id="cb138-63"><a href="chap-utiliseR.html#cb138-63"></a><span class="co">## the hackish version. Otherwise, leave the</span></span>
<span id="cb138-64"><a href="chap-utiliseR.html#cb138-64"></a><span class="co">## definition alone. </span></span>
<span id="cb138-65"><a href="chap-utiliseR.html#cb138-65"></a>mclapply &lt;-<span class="st"> </span><span class="cf">switch</span>( <span class="kw">Sys.info</span>()[[<span class="st">&#39;sysname&#39;</span>]],</span>
<span id="cb138-66"><a href="chap-utiliseR.html#cb138-66"></a>                    <span class="dt">Windows =</span> {mclapply.hack}, </span>
<span id="cb138-67"><a href="chap-utiliseR.html#cb138-67"></a>                    <span class="dt">Linux   =</span> {mclapply},</span>
<span id="cb138-68"><a href="chap-utiliseR.html#cb138-68"></a>                    <span class="dt">Darwin  =</span> {mclapply})</span>
<span id="cb138-69"><a href="chap-utiliseR.html#cb138-69"></a></span>
<span id="cb138-70"><a href="chap-utiliseR.html#cb138-70"></a><span class="co">## end mclapply.hack.R</span></span></code></pre></div>
<p></p>
<p>Le code suivant teste la parallélisation d’une fonction qui renvoie son argument inchangé après une pause d’un quart de seconde.
Ce document est tricoté avec <code>3</code> coeurs, qui sont tous utilisés sauf un pour ne pas saturer le système.</p>
<p></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="chap-utiliseR.html#cb139-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">time =</span> <span class="fl">0.25</span>) {</span>
<span id="cb139-2"><a href="chap-utiliseR.html#cb139-2"></a>    <span class="kw">Sys.sleep</span>(time)</span>
<span id="cb139-3"><a href="chap-utiliseR.html#cb139-3"></a>    <span class="kw">return</span>(x)</span>
<span id="cb139-4"><a href="chap-utiliseR.html#cb139-4"></a>}</span>
<span id="cb139-5"><a href="chap-utiliseR.html#cb139-5"></a><span class="co"># Laisser un coeur libre pour le système</span></span>
<span id="cb139-6"><a href="chap-utiliseR.html#cb139-6"></a>nbCoeurs &lt;-<span class="st"> </span><span class="kw">detectCores</span>() <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb139-7"><a href="chap-utiliseR.html#cb139-7"></a><span class="co"># Série : temps théorique = nbCoeurs/4 secondes</span></span>
<span id="cb139-8"><a href="chap-utiliseR.html#cb139-8"></a>(tserie &lt;-<span class="st"> </span><span class="kw">system.time</span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nbCoeurs, f)))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.003   0.000   0.605</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="chap-utiliseR.html#cb141-1"></a><span class="co"># Parallèle : temps théorique = 1/4 secondes</span></span>
<span id="cb141-2"><a href="chap-utiliseR.html#cb141-2"></a>(tparallele &lt;-<span class="st"> </span><span class="kw">system.time</span>(<span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>nbCoeurs, f, <span class="dt">mc.cores =</span> nbCoeurs)))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.005   0.019   0.267</code></pre>
<p></p>
<p>La mise en place de la parallélisation a un coût d’environ <code>0.017</code> secondes ici.
Le temps d’exécution est bien plus long en parallèle sous Windows parce que la mise en place du cluster prend bien plus de temps que la parallélisation n’en fait gagner.
La parallélisation est intéressante pour des tâches plus longues, comme une pause d’un seconde.</p>
<p></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="chap-utiliseR.html#cb143-1"></a><span class="co"># Série</span></span>
<span id="cb143-2"><a href="chap-utiliseR.html#cb143-2"></a><span class="kw">system.time</span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nbCoeurs, f, <span class="dt">time =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.000   0.000   2.087</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="chap-utiliseR.html#cb145-1"></a><span class="co"># Parallèle</span></span>
<span id="cb145-2"><a href="chap-utiliseR.html#cb145-2"></a><span class="kw">system.time</span>(<span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>nbCoeurs, f, <span class="dt">time =</span> <span class="dv">1</span>, <span class="dt">mc.cores =</span> nbCoeurs))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.001   0.002   1.127</code></pre>
<p></p>
<p>Le temps additionnel nécessaire pour l’exécution parallèle du nouveau code est relativement plus faible: les coûts deviennent inférieurs à l’économie quand le temps de chaque tâche s’allonge.</p>
<p>Si le nombre de tâches parallèles dépasse le nombre de coeurs utilisés, les performances s’effondrent parce que la tâche supplémentaire doit être exécutée après les premières.</p>
<p></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="chap-utiliseR.html#cb147-1"></a><span class="kw">system.time</span>(<span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>nbCoeurs, f, <span class="dt">time =</span> <span class="dv">1</span>, <span class="dt">mc.cores =</span> nbCoeurs))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.000   0.003   1.108</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="chap-utiliseR.html#cb149-1"></a><span class="kw">system.time</span>(<span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>(nbCoeurs <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), f, <span class="dt">time =</span> <span class="dv">1</span>, <span class="dt">mc.cores =</span> nbCoeurs))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.003   0.005   2.127</code></pre>
<p></p>
<p>Le temps reste ensuite stable jusqu’au double du nombre de coeurs.
La figure <a href="chap-utiliseR.html#fig:r-parallele">2.2</a> montre l’évolution du temps de calcul en fonction du nombre de tâches.</p>

<p></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="chap-utiliseR.html#cb151-1"></a>Taches &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>nbCoeurs<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb151-2"><a href="chap-utiliseR.html#cb151-2"></a>Temps &lt;-<span class="st"> </span><span class="kw">sapply</span>(Taches, <span class="cf">function</span>(nbTaches) {</span>
<span id="cb151-3"><a href="chap-utiliseR.html#cb151-3"></a>      <span class="kw">system.time</span>(<span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>nbTaches, f, <span class="dt">time=</span><span class="dv">1</span>, <span class="dt">mc.cores=</span>nbCoeurs))</span>
<span id="cb151-4"><a href="chap-utiliseR.html#cb151-4"></a>              })</span>
<span id="cb151-5"><a href="chap-utiliseR.html#cb151-5"></a><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb151-6"><a href="chap-utiliseR.html#cb151-6"></a><span class="kw">tibble</span>(Taches, <span class="dt">Temps=</span>Temps[<span class="st">&quot;elapsed&quot;</span>, ]) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb151-7"><a href="chap-utiliseR.html#cb151-7"></a><span class="st">  </span>ggplot <span class="op">+</span></span>
<span id="cb151-8"><a href="chap-utiliseR.html#cb151-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taches, <span class="dt">y =</span> Temps)) <span class="op">+</span></span>
<span id="cb151-9"><a href="chap-utiliseR.html#cb151-9"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> nbCoeurs, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb151-10"><a href="chap-utiliseR.html#cb151-10"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>nbCoeurs, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:r-parallele"></span>
<img src="travailleR_files/figure-html/r-parallele-1.png" alt="Temps d’exécution en parallèle de tâches nécessitant une seconde (chaque tâche est une pause d’une seconde). Le nombre de tâches varie de 1 à deux fois le nombre de coeurs utilisés (égal à 2) plus une." width="80%" />
<p class="caption">
Figure 2.2: Temps d’exécution en parallèle de tâches nécessitant une seconde (chaque tâche est une pause d’une seconde). Le nombre de tâches varie de 1 à deux fois le nombre de coeurs utilisés (égal à <code>2</code>) plus une.
</p>
</div>
<p></p>
<p>La forme théorique de cette courbe est la suivante:</p>
<ul>
<li>pour une tâche, le temps est égal à une seconde plus le temps de mise en place de la parallélisation;</li>
<li>le temps devrait rester stable jusqu’au nombre de coeurs utilisés;</li>
<li>quand les coeurs sont tous utilisés (pointillés rouges), le temps devrait augmenter d’une seconde puis rester stable jusqu’à la limite suivante.</li>
</ul>
<p>En pratique, le temps de calcul est déterminé par d’autres facteurs difficilement prévisibles.
La bonne pratique est d’adapter le nombre de tâches au nombre de coeurs sous peine de perte de performance.</p>
</div>
<div id="parlapply-socket" class="section level3">
<h3><span class="header-section-number">2.6.2</span> parLapply (socket)</h3>
<p><code>parLapply</code> nécessite de créer un cluster, exporter les variables utiles sur chaque noeud, charger les packages nécessaires sur chaque noeud, exécuter le code et enfin arrêter le cluster.
Le code de chaque étape se trouve dans la fonction <code>mclapply.hack</code> ci-dessus.</p>
<p>Pour un usage courant, <code>mclapply</code> est plus rapide, sauf sous Windows, et plus simple (y compris sous Windows grâce au contournement ci-dessus.)</p>
</div>
<div id="foreach" class="section level3">
<h3><span class="header-section-number">2.6.3</span> foreach</h3>
<div id="fonctionnement" class="section level4">
<h4><span class="header-section-number">2.6.3.1</span> Fonctionnement</h4>
<p>Le package <strong>foreach</strong> permet un usage avancé de la parallélisation.
Lire ses vignettes.</p>
<p></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="chap-utiliseR.html#cb152-1"></a><span class="co"># Manuel</span></span>
<span id="cb152-2"><a href="chap-utiliseR.html#cb152-2"></a><span class="kw">vignette</span>(<span class="st">&quot;foreach&quot;</span>, <span class="st">&quot;foreach&quot;</span>)</span>
<span id="cb152-3"><a href="chap-utiliseR.html#cb152-3"></a><span class="co"># Boucles imbriquées</span></span>
<span id="cb152-4"><a href="chap-utiliseR.html#cb152-4"></a><span class="kw">vignette</span>(<span class="st">&quot;nested&quot;</span>, <span class="st">&quot;foreach&quot;</span>)</span></code></pre></div>
<p></p>
<p>Indépendamment de la parallélisation, <strong>foreach</strong> redéfinit les boucles <em>for</em>.</p>
<p></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="chap-utiliseR.html#cb153-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) {</span>
<span id="cb153-2"><a href="chap-utiliseR.html#cb153-2"></a>    <span class="kw">f</span>(i)</span>
<span id="cb153-3"><a href="chap-utiliseR.html#cb153-3"></a>}</span>
<span id="cb153-4"><a href="chap-utiliseR.html#cb153-4"></a><span class="co"># devient</span></span>
<span id="cb153-5"><a href="chap-utiliseR.html#cb153-5"></a><span class="kw">library</span>(<span class="st">&quot;foreach&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;foreach&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     accumulate, when</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="chap-utiliseR.html#cb156-1"></a><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%do%</span><span class="st"> </span>{</span>
<span id="cb156-2"><a href="chap-utiliseR.html#cb156-2"></a>    <span class="kw">f</span>(i)</span>
<span id="cb156-3"><a href="chap-utiliseR.html#cb156-3"></a>}</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3</code></pre>
<p></p>
<p>La fonction <code>foreach</code> retourne une liste contenant les résultats de chaque boucle.
Les éléments de la liste peuvent être combinés par une fonction quelconque, comme <code>c</code>.</p>
<p></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="chap-utiliseR.html#cb158-1"></a><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span>{</span>
<span id="cb158-2"><a href="chap-utiliseR.html#cb158-2"></a>    <span class="kw">f</span>(i)</span>
<span id="cb158-3"><a href="chap-utiliseR.html#cb158-3"></a>}</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p></p>
<p>La fonction <code>foreach</code> est capable d’utiliser des itérateurs, c’est-à-dire des fonctions qui ne passent à la boucle que les données dont elle a besoin sans charger les autres en mémoire.
Ici, l’itérateur <code>icount</code> passe les valeurs 1, 2 et 3 individuellement, sans charger le vecteur 1:3 en mémoire.</p>
<p></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="chap-utiliseR.html#cb160-1"></a><span class="kw">library</span>(<span class="st">&quot;iterators&quot;</span>)</span>
<span id="cb160-2"><a href="chap-utiliseR.html#cb160-2"></a><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="kw">icount</span>(<span class="dv">3</span>), <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span>{</span>
<span id="cb160-3"><a href="chap-utiliseR.html#cb160-3"></a>    <span class="kw">f</span>(i)</span>
<span id="cb160-4"><a href="chap-utiliseR.html#cb160-4"></a>}</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p></p>
<p>Elle est donc très utile quand chaque objet de la boucle utilise une grande quantité de mémoire.</p>
</div>
<div id="parallélisation" class="section level4">
<h4><span class="header-section-number">2.6.3.2</span> Parallélisation</h4>
<p>Remplacer l’opérateur <code>%do%</code> par <code>%dopar%</code> parallélise les boucles, à condition qu’un adaptateur, c’est-à-dire un package intermédiaire entre <code>foreach</code> et un package chargé de l’implémentation de la parallélisation, soit chargé.
<strong>doParallel</strong> est un adaptateur pour utiliser le package <strong>parallel</strong> livré avec R.</p>
<p></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="chap-utiliseR.html#cb162-1"></a><span class="kw">library</span>(doParallel)</span>
<span id="cb162-2"><a href="chap-utiliseR.html#cb162-2"></a><span class="kw">registerDoParallel</span>(<span class="dt">cores =</span> nbCoeurs)</span>
<span id="cb162-3"><a href="chap-utiliseR.html#cb162-3"></a><span class="co"># Série</span></span>
<span id="cb162-4"><a href="chap-utiliseR.html#cb162-4"></a><span class="kw">system.time</span>(<span class="kw">foreach</span>(<span class="dt">i =</span> <span class="kw">icount</span>(nbCoeurs), <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span></span>
<span id="cb162-5"><a href="chap-utiliseR.html#cb162-5"></a><span class="st">    </span>{</span>
<span id="cb162-6"><a href="chap-utiliseR.html#cb162-6"></a>        <span class="kw">f</span>(i)</span>
<span id="cb162-7"><a href="chap-utiliseR.html#cb162-7"></a>    })</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.004   0.000   0.768</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="chap-utiliseR.html#cb164-1"></a><span class="co"># Parallèle</span></span>
<span id="cb164-2"><a href="chap-utiliseR.html#cb164-2"></a><span class="kw">system.time</span>(<span class="kw">foreach</span>(<span class="dt">i =</span> <span class="kw">icount</span>(nbCoeurs), <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%dopar%</span><span class="st"> </span></span>
<span id="cb164-3"><a href="chap-utiliseR.html#cb164-3"></a><span class="st">    </span>{</span>
<span id="cb164-4"><a href="chap-utiliseR.html#cb164-4"></a>        <span class="kw">f</span>(i)</span>
<span id="cb164-5"><a href="chap-utiliseR.html#cb164-5"></a>    })</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.008   0.011   0.308</code></pre>
<p></p>
<p>Le coût fixe de la parallélisation est faible.</p>
</div>
</div>
</div>
<div id="sec:cas" class="section level2">
<h2><span class="header-section-number">2.7</span> Etude de cas</h2>
<p>Cette étude de cas permet de tester les différentes techniques vues plus haut pour résoudre un problème concret.
L’objectif est de calculer la distance moyenne entre deux points d’un semis aléatoire de 1000 points dans une fenêtre carrée de côté 1.</p>
<p>Son espérance est calculable<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>.
Elle est égale à <span class="math inline">\(\frac{2+\sqrt{2}+5\ln{(1+\sqrt{2})}}{15} \approx 0,5214\)</span>.</p>
<div id="création-des-données" class="section level3">
<h3><span class="header-section-number">2.7.1</span> Création des données</h3>
<p>Le semis de points est créé avec le package <strong>spatstat</strong>.</p>
<p></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="chap-utiliseR.html#cb166-1"></a>NbPoints &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb166-2"><a href="chap-utiliseR.html#cb166-2"></a><span class="kw">library</span>(<span class="st">&quot;spatstat&quot;</span>)</span>
<span id="cb166-3"><a href="chap-utiliseR.html#cb166-3"></a>X &lt;-<span class="st"> </span><span class="kw">runifpoint</span>(NbPoints)</span></code></pre></div>
<p></p>
</div>
<div id="spatstat" class="section level3">
<h3><span class="header-section-number">2.7.2</span> Spatstat</h3>
<p>La fonction <code>pairdist()</code> de <strong>spatstat</strong> retourne la matrice des distances entre les points.
La distance moyenne est calculée en divisant la somme par le nombre de paires de points distincts.</p>
<p></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="chap-utiliseR.html#cb167-1"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(d &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">pairdist</span>(X))<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span></span>
<span id="cb167-2"><a href="chap-utiliseR.html#cb167-2"></a><span class="st">    </span><span class="dv">1</span>))</span>
<span id="cb167-3"><a href="chap-utiliseR.html#cb167-3"></a><span class="co"># suppressmessages pour éliminer les messages superflus</span></span>
<span id="cb167-4"><a href="chap-utiliseR.html#cb167-4"></a><span class="kw">suppressMessages</span>(<span class="kw">autoplot</span>(mb))</span></code></pre></div>
<p><img src="travailleR_files/figure-html/unnamed-chunk-41-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="chap-utiliseR.html#cb168-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>La fonction est rapide parce qu’elle est codée en langage C dans le package <strong>spatstat</strong> pour le coeur de ses calculs.</p>
</div>
<div id="apply" class="section level3">
<h3><span class="header-section-number">2.7.3</span> apply</h3>
<p>La distance peut être calculée par deux <code>sapply()</code> imbriqués.</p>
<p></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="chap-utiliseR.html#cb170-1"></a>fsapply1 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb170-2"><a href="chap-utiliseR.html#cb170-2"></a>    distances &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(i) <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, </span>
<span id="cb170-3"><a href="chap-utiliseR.html#cb170-3"></a>        <span class="cf">function</span>(j) <span class="kw">sqrt</span>((X<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(X<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span></span>
<span id="cb170-4"><a href="chap-utiliseR.html#cb170-4"></a><span class="st">            </span>X<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span>)))</span>
<span id="cb170-5"><a href="chap-utiliseR.html#cb170-5"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(distances)<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb170-6"><a href="chap-utiliseR.html#cb170-6"></a>}</span>
<span id="cb170-7"><a href="chap-utiliseR.html#cb170-7"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fsapply1</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.476   0.032   5.514</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="chap-utiliseR.html#cb172-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>Un peu de temps peut être gagnée en remplaçant <code>sapply</code> par <code>vapply</code>: le format des résultats n’a pas à être déterminé par la fonction.
Le gain est négligeable sur un long calcul comme celui-ci mais important pour des calculs courts.</p>
<p></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="chap-utiliseR.html#cb174-1"></a>fsapply2 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb174-2"><a href="chap-utiliseR.html#cb174-2"></a>    distances &lt;-<span class="st"> </span><span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(i) <span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, </span>
<span id="cb174-3"><a href="chap-utiliseR.html#cb174-3"></a>        <span class="cf">function</span>(j) <span class="kw">sqrt</span>((X<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(X<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span></span>
<span id="cb174-4"><a href="chap-utiliseR.html#cb174-4"></a><span class="st">            </span>X<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span>), <span class="dv">0</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span> <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb174-5"><a href="chap-utiliseR.html#cb174-5"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(distances)<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb174-6"><a href="chap-utiliseR.html#cb174-6"></a>}</span>
<span id="cb174-7"><a href="chap-utiliseR.html#cb174-7"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fsapply2</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.224   0.026   5.254</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="chap-utiliseR.html#cb176-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p>
Le format de sortie n’est pas toujours évident à écrire:</p>
<ul>
<li>il doit respecter la taille des données: un vecteur de taille 1000 pour la boucle externe, un scalaire pour la boucle interne.</li>
<li>il doit respecter leur type: <code>0</code> pour un entier, <code>0.0</code> pour un réel. Dans la boucle externe, l’ajout de <code>0.0</code> au vecteur d’entiers le transforme en vecteur de réels.</li>
</ul>
<p>Une amélioration plus significative consiste à ne calculer les racines carrées qu’à la fin de la boucle, pour profiter de la vectorisation de la fonction.</p>
<p></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="chap-utiliseR.html#cb178-1"></a>fsapply3 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb178-2"><a href="chap-utiliseR.html#cb178-2"></a>    distances &lt;-<span class="st"> </span><span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(i) <span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, </span>
<span id="cb178-3"><a href="chap-utiliseR.html#cb178-3"></a>        <span class="cf">function</span>(j) (X<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(X<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span>, </span>
<span id="cb178-4"><a href="chap-utiliseR.html#cb178-4"></a>        <span class="dv">0</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span> <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb178-5"><a href="chap-utiliseR.html#cb178-5"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(<span class="kw">sqrt</span>(distances))<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb178-6"><a href="chap-utiliseR.html#cb178-6"></a>}</span>
<span id="cb178-7"><a href="chap-utiliseR.html#cb178-7"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fsapply3</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   5.228   0.042   5.272</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="chap-utiliseR.html#cb180-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>Les calculs sont effectués deux fois (distance entre les points <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>, mais aussi entre les points <span class="math inline">\(j\)</span> et <span class="math inline">\(i\)</span>): un test sur les indices permet de diviser presque le temps par 2 (pas tout à fait parce que les boucles sans calcul, qui retournent <span class="math inline">\(0\)</span>, prennent du temps).</p>
<p></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="chap-utiliseR.html#cb182-1"></a>fsapply4 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb182-2"><a href="chap-utiliseR.html#cb182-2"></a>    distances &lt;-<span class="st"> </span><span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(i) {</span>
<span id="cb182-3"><a href="chap-utiliseR.html#cb182-3"></a>        <span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(j) {</span>
<span id="cb182-4"><a href="chap-utiliseR.html#cb182-4"></a>            <span class="cf">if</span> (j <span class="op">&gt;</span><span class="st"> </span>i) {</span>
<span id="cb182-5"><a href="chap-utiliseR.html#cb182-5"></a>                (X<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(X<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span></span>
<span id="cb182-6"><a href="chap-utiliseR.html#cb182-6"></a>            } <span class="cf">else</span> {</span>
<span id="cb182-7"><a href="chap-utiliseR.html#cb182-7"></a>                <span class="dv">0</span></span>
<span id="cb182-8"><a href="chap-utiliseR.html#cb182-8"></a>            }</span>
<span id="cb182-9"><a href="chap-utiliseR.html#cb182-9"></a>        }, <span class="dv">0</span>)</span>
<span id="cb182-10"><a href="chap-utiliseR.html#cb182-10"></a>    }, <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span> <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb182-11"><a href="chap-utiliseR.html#cb182-11"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(<span class="kw">sqrt</span>(distances))<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span></span>
<span id="cb182-12"><a href="chap-utiliseR.html#cb182-12"></a><span class="st">        </span><span class="dv">2</span>)</span>
<span id="cb182-13"><a href="chap-utiliseR.html#cb182-13"></a>}</span>
<span id="cb182-14"><a href="chap-utiliseR.html#cb182-14"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fsapply4</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   3.103   0.012   3.117</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="chap-utiliseR.html#cb184-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>En parallèle, le temps de calcul n’est pas amélioré sous Windows parce que les tâches individuelles sont trop courtes.
Sous MacOS ou Linux, le calcul est accéléré.</p>
<p></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="chap-utiliseR.html#cb186-1"></a>fsapply5 &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb186-2"><a href="chap-utiliseR.html#cb186-2"></a>    distances &lt;-<span class="st"> </span><span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(i) {</span>
<span id="cb186-3"><a href="chap-utiliseR.html#cb186-3"></a>        <span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>NbPoints, <span class="cf">function</span>(j) {</span>
<span id="cb186-4"><a href="chap-utiliseR.html#cb186-4"></a>            <span class="cf">if</span> (j <span class="op">&gt;</span><span class="st"> </span>i) {</span>
<span id="cb186-5"><a href="chap-utiliseR.html#cb186-5"></a>                (X<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(X<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span></span>
<span id="cb186-6"><a href="chap-utiliseR.html#cb186-6"></a>            } <span class="cf">else</span> {</span>
<span id="cb186-7"><a href="chap-utiliseR.html#cb186-7"></a>                <span class="dv">0</span></span>
<span id="cb186-8"><a href="chap-utiliseR.html#cb186-8"></a>            }</span>
<span id="cb186-9"><a href="chap-utiliseR.html#cb186-9"></a>        }, <span class="dv">0</span>)</span>
<span id="cb186-10"><a href="chap-utiliseR.html#cb186-10"></a>    })</span>
<span id="cb186-11"><a href="chap-utiliseR.html#cb186-11"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(<span class="kw">sqrt</span>(<span class="kw">simplify2array</span>(distances)))<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span></span>
<span id="cb186-12"><a href="chap-utiliseR.html#cb186-12"></a><span class="st">        </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb186-13"><a href="chap-utiliseR.html#cb186-13"></a>}</span>
<span id="cb186-14"><a href="chap-utiliseR.html#cb186-14"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fsapply5</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   3.367   0.255   1.844</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="chap-utiliseR.html#cb188-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
</div>
<div id="boucle-for" class="section level3">
<h3><span class="header-section-number">2.7.4</span> boucle for</h3>
<p>Une boucle for est plus rapide et consomme moins de mémoire parce qu’elle ne stocke pas la matrice de distances.</p>
<p></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="chap-utiliseR.html#cb190-1"></a>distance &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb190-2"><a href="chap-utiliseR.html#cb190-2"></a>ffor &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb190-3"><a href="chap-utiliseR.html#cb190-3"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(NbPoints <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</span>
<span id="cb190-4"><a href="chap-utiliseR.html#cb190-4"></a>        <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>NbPoints) {</span>
<span id="cb190-5"><a href="chap-utiliseR.html#cb190-5"></a>            distance &lt;-<span class="st"> </span>distance <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>((X<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span></span>
<span id="cb190-6"><a href="chap-utiliseR.html#cb190-6"></a><span class="st">                </span>(X<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span>X<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb190-7"><a href="chap-utiliseR.html#cb190-7"></a>        }</span>
<span id="cb190-8"><a href="chap-utiliseR.html#cb190-8"></a>    }</span>
<span id="cb190-9"><a href="chap-utiliseR.html#cb190-9"></a>    <span class="kw">return</span>(distance<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb190-10"><a href="chap-utiliseR.html#cb190-10"></a>}</span>
<span id="cb190-11"><a href="chap-utiliseR.html#cb190-11"></a><span class="co"># Temps de calcul, mémorisé</span></span>
<span id="cb190-12"><a href="chap-utiliseR.html#cb190-12"></a>(for_time &lt;-<span class="st"> </span><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">ffor</span>()))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.809   0.009   1.819</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="chap-utiliseR.html#cb192-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p>
C’est la façon la plus simple et efficace d’écrire ce code sans parallélisation et en se limitant au langage de R.</p>
</div>
<div id="boucle-foreach" class="section level3">
<h3><span class="header-section-number">2.7.5</span> boucle foreach</h3>
<p>Deux boucles foreach imbriquées sont nécessaires ici: elles sont extrêmement lente en comparaison d’une boucle simple.
Le test est lancé ici avec 10 fois moins de points, donc 100 fois moins de distances à calculer.</p>
<p></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="chap-utiliseR.html#cb194-1"></a>NbPointsReduit &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb194-2"><a href="chap-utiliseR.html#cb194-2"></a>Y &lt;-<span class="st"> </span><span class="kw">runifpoint</span>(NbPointsReduit)</span>
<span id="cb194-3"><a href="chap-utiliseR.html#cb194-3"></a>fforeach1 &lt;-<span class="st"> </span><span class="cf">function</span>(Y) {</span>
<span id="cb194-4"><a href="chap-utiliseR.html#cb194-4"></a>    distances &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span>NbPointsReduit, <span class="dt">.combine =</span> <span class="st">&quot;cbind&quot;</span>) <span class="op">%:%</span><span class="st"> </span></span>
<span id="cb194-5"><a href="chap-utiliseR.html#cb194-5"></a><span class="st">        </span><span class="kw">foreach</span>(<span class="dt">j =</span> <span class="dv">1</span><span class="op">:</span>NbPointsReduit, <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span></span>
<span id="cb194-6"><a href="chap-utiliseR.html#cb194-6"></a><span class="st">        </span>{</span>
<span id="cb194-7"><a href="chap-utiliseR.html#cb194-7"></a>            <span class="cf">if</span> (j <span class="op">&gt;</span><span class="st"> </span>i) {</span>
<span id="cb194-8"><a href="chap-utiliseR.html#cb194-8"></a>                (Y<span class="op">$</span>x[i] <span class="op">-</span><span class="st"> </span>Y<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(Y<span class="op">$</span>y[i] <span class="op">-</span><span class="st"> </span>Y<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span></span>
<span id="cb194-9"><a href="chap-utiliseR.html#cb194-9"></a>            } <span class="cf">else</span> {</span>
<span id="cb194-10"><a href="chap-utiliseR.html#cb194-10"></a>                <span class="dv">0</span></span>
<span id="cb194-11"><a href="chap-utiliseR.html#cb194-11"></a>            }</span>
<span id="cb194-12"><a href="chap-utiliseR.html#cb194-12"></a>        }</span>
<span id="cb194-13"><a href="chap-utiliseR.html#cb194-13"></a>    <span class="kw">return</span>(<span class="kw">sum</span>(<span class="kw">sqrt</span>(distances))<span class="op">/</span>NbPointsReduit<span class="op">/</span>(NbPointsReduit <span class="op">-</span><span class="st"> </span></span>
<span id="cb194-14"><a href="chap-utiliseR.html#cb194-14"></a><span class="st">        </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb194-15"><a href="chap-utiliseR.html#cb194-15"></a>}</span>
<span id="cb194-16"><a href="chap-utiliseR.html#cb194-16"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fforeach1</span>(Y))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   2.816   0.017   2.836</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="chap-utiliseR.html#cb196-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5181951</code></pre>
<p></p>
<p>Les boucles foreach imbriquées sont à réserver à des tâches très longues (plusieurs secondes au moins) pour amortir les coûts fixes de leur mise en place.</p>
<p>La parallélisation est efficace dans le code ci-dessous, notamment parce qu’elle permet d’éviter les boucles foreach imbriquées.
En revanche, les distances sont calculées deux fois.
La performance reste très inférieure à celle d’une simple boucle for (rappel: 100 fois moins de distances sont calculées).</p>
<p></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="chap-utiliseR.html#cb198-1"></a><span class="kw">registerDoParallel</span>(<span class="dt">cores =</span> <span class="kw">detectCores</span>())</span>
<span id="cb198-2"><a href="chap-utiliseR.html#cb198-2"></a>fforeach3 &lt;-<span class="st"> </span><span class="cf">function</span>(Y) {</span>
<span id="cb198-3"><a href="chap-utiliseR.html#cb198-3"></a>  distances &lt;-<span class="st"> </span></span>
<span id="cb198-4"><a href="chap-utiliseR.html#cb198-4"></a><span class="st">    </span><span class="kw">foreach</span>(<span class="dt">i=</span><span class="kw">icount</span>(NbPointsReduit), </span>
<span id="cb198-5"><a href="chap-utiliseR.html#cb198-5"></a>            <span class="dt">.combine=</span><span class="st">&#39;+&#39;</span>) <span class="op">%dopar%</span><span class="st"> </span>{</span>
<span id="cb198-6"><a href="chap-utiliseR.html#cb198-6"></a>      distance &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb198-7"><a href="chap-utiliseR.html#cb198-7"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>Y<span class="op">$</span>n) {</span>
<span id="cb198-8"><a href="chap-utiliseR.html#cb198-8"></a>        distance &lt;-<span class="st"> </span>distance <span class="op">+</span><span class="st"> </span></span>
<span id="cb198-9"><a href="chap-utiliseR.html#cb198-9"></a><span class="st">          </span><span class="kw">sqrt</span>((Y<span class="op">$</span>x[i]<span class="op">-</span>Y<span class="op">$</span>x[j])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(Y<span class="op">$</span>y[i]<span class="op">-</span>Y<span class="op">$</span>y[j])<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb198-10"><a href="chap-utiliseR.html#cb198-10"></a>      }</span>
<span id="cb198-11"><a href="chap-utiliseR.html#cb198-11"></a>      distance</span>
<span id="cb198-12"><a href="chap-utiliseR.html#cb198-12"></a>    }</span>
<span id="cb198-13"><a href="chap-utiliseR.html#cb198-13"></a>  <span class="kw">return</span>(distances<span class="op">/</span>NbPointsReduit<span class="op">/</span>(NbPointsReduit<span class="dv">-1</span>))</span>
<span id="cb198-14"><a href="chap-utiliseR.html#cb198-14"></a>}</span>
<span id="cb198-15"><a href="chap-utiliseR.html#cb198-15"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">fforeach3</span>(Y))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.128   0.053   0.112</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="chap-utiliseR.html#cb200-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5181951</code></pre>
<p></p>
<p><strong>foreach</strong> dispose d’adaptateurs optimisés permettant d’utiliser des clusters physiques par exemple.
Son intérêt est limité avec le package <strong>parallel</strong>.</p>
</div>
<div id="rcpp" class="section level3">
<h3><span class="header-section-number">2.7.6</span> RCpp</h3>
<p>La fonction C++ permettant de calculer les distances est la suivante.</p>
<p></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb202-1"><a href="chap-utiliseR.html#cb202-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb202-2"><a href="chap-utiliseR.html#cb202-2"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb202-3"><a href="chap-utiliseR.html#cb202-3"></a></span>
<span id="cb202-4"><a href="chap-utiliseR.html#cb202-4"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb202-5"><a href="chap-utiliseR.html#cb202-5"></a><span class="dt">double</span> MeanDistance(SEXP Rx, SEXP Ry) {</span>
<span id="cb202-6"><a href="chap-utiliseR.html#cb202-6"></a>  <span class="co">// x, y coordinates of points</span></span>
<span id="cb202-7"><a href="chap-utiliseR.html#cb202-7"></a>  NumericVector x(Rx);</span>
<span id="cb202-8"><a href="chap-utiliseR.html#cb202-8"></a>  NumericVector y(Ry);</span>
<span id="cb202-9"><a href="chap-utiliseR.html#cb202-9"></a>  <span class="dt">double</span> distance=<span class="dv">0</span>;</span>
<span id="cb202-10"><a href="chap-utiliseR.html#cb202-10"></a>  <span class="dt">double</span> dx, dy;</span>
<span id="cb202-11"><a href="chap-utiliseR.html#cb202-11"></a>  <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>; i &lt; (x.length()-<span class="dv">1</span>); i++) {</span>
<span id="cb202-12"><a href="chap-utiliseR.html#cb202-12"></a>    <span class="cf">for</span> (<span class="dt">int</span> j=i+<span class="dv">1</span>; j &lt; x.length(); j++) {</span>
<span id="cb202-13"><a href="chap-utiliseR.html#cb202-13"></a>    <span class="co">// Calculate distance</span></span>
<span id="cb202-14"><a href="chap-utiliseR.html#cb202-14"></a>        dx = x[i]-x[j];</span>
<span id="cb202-15"><a href="chap-utiliseR.html#cb202-15"></a>        dy = y[i]-y[j];</span>
<span id="cb202-16"><a href="chap-utiliseR.html#cb202-16"></a>        distance += sqrt(dx*dx + dy*dy);</span>
<span id="cb202-17"><a href="chap-utiliseR.html#cb202-17"></a>    }</span>
<span id="cb202-18"><a href="chap-utiliseR.html#cb202-18"></a>  }</span>
<span id="cb202-19"><a href="chap-utiliseR.html#cb202-19"></a>  <span class="cf">return</span> distance/(<span class="dt">double</span>)(x.length()/<span class="dv">2</span>*(x.length()-<span class="dv">1</span>));</span>
<span id="cb202-20"><a href="chap-utiliseR.html#cb202-20"></a>}</span></code></pre></div>
<p></p>
<p>Elle est appelée dans R très simplement.
Le temps d’exécution est très court.</p>
<p></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="chap-utiliseR.html#cb203-1"></a>mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(d &lt;-<span class="st"> </span><span class="kw">MeanDistance</span>(X<span class="op">$</span>x, X<span class="op">$</span>y))</span>
<span id="cb203-2"><a href="chap-utiliseR.html#cb203-2"></a><span class="co"># suppressmessages pour éliminer les messages superflus</span></span>
<span id="cb203-3"><a href="chap-utiliseR.html#cb203-3"></a><span class="kw">suppressMessages</span>(<span class="kw">autoplot</span>(mb))</span></code></pre></div>
<p><img src="travailleR_files/figure-html/unnamed-chunk-51-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="chap-utiliseR.html#cb204-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
</div>
<div id="rcppparallel" class="section level3">
<h3><span class="header-section-number">2.7.7</span> RcppParallel</h3>
<p><strong>RcppParallel</strong> permet d’interfacer du code C++ parallélisé, au prix d’une syntaxe plus complexe qu’avec <strong>RCpp</strong>.
Une documentation est disponible<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>.</p>
<p>La fonction C++ exportée dans R ne réalise pas les calculs mais organise seulement l’exécution en parallèle d’une autre fonction, non exportée, de type <code>Worker</code>.</p>
<p>Deux fonctions (C++) de parallélisation sont disponibles pour deux types de tâches:</p>
<ul>
<li><code>parallelReduce</code> pour l’accumulation d’une valeur, utilisée ici pour additionner les distances.</li>
<li><code>parallelFor</code> pour remplir une matrice de résultats.</li>
</ul>
<p>La syntaxe du <code>Worker</code> est un peu laborieuse mais assez simple à adapter: les constructeurs initialisent les variables C à partir des valeurs transmises par R et déclarent la parallélisation.</p>
<p></p>
<div class="sourceCode" id="cb206"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb206-1"><a href="chap-utiliseR.html#cb206-1"></a><span class="co">// [[Rcpp::depends(RcppParallel)]]</span></span>
<span id="cb206-2"><a href="chap-utiliseR.html#cb206-2"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb206-3"><a href="chap-utiliseR.html#cb206-3"></a><span class="pp">#include </span><span class="im">&lt;RcppParallel.h&gt;</span></span>
<span id="cb206-4"><a href="chap-utiliseR.html#cb206-4"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb206-5"><a href="chap-utiliseR.html#cb206-5"></a><span class="kw">using</span> <span class="kw">namespace</span> RcppParallel;</span>
<span id="cb206-6"><a href="chap-utiliseR.html#cb206-6"></a></span>
<span id="cb206-7"><a href="chap-utiliseR.html#cb206-7"></a><span class="co">// Fonction de travail, non exportée</span></span>
<span id="cb206-8"><a href="chap-utiliseR.html#cb206-8"></a><span class="kw">struct</span> TotalDistanceWrkr : <span class="kw">public</span> Worker</span>
<span id="cb206-9"><a href="chap-utiliseR.html#cb206-9"></a>{</span>
<span id="cb206-10"><a href="chap-utiliseR.html#cb206-10"></a>  <span class="co">// source vectors</span></span>
<span id="cb206-11"><a href="chap-utiliseR.html#cb206-11"></a>  <span class="at">const</span> RVector&lt;<span class="dt">double</span>&gt; Rx;</span>
<span id="cb206-12"><a href="chap-utiliseR.html#cb206-12"></a>  <span class="at">const</span> RVector&lt;<span class="dt">double</span>&gt; Ry;</span>
<span id="cb206-13"><a href="chap-utiliseR.html#cb206-13"></a>  </span>
<span id="cb206-14"><a href="chap-utiliseR.html#cb206-14"></a>  <span class="co">// accumulated value</span></span>
<span id="cb206-15"><a href="chap-utiliseR.html#cb206-15"></a>  <span class="dt">double</span> distance;</span>
<span id="cb206-16"><a href="chap-utiliseR.html#cb206-16"></a>   </span>
<span id="cb206-17"><a href="chap-utiliseR.html#cb206-17"></a>  <span class="co">// constructors</span></span>
<span id="cb206-18"><a href="chap-utiliseR.html#cb206-18"></a>  TotalDistanceWrkr(<span class="at">const</span> NumericVector x, <span class="at">const</span> NumericVector y) :</span>
<span id="cb206-19"><a href="chap-utiliseR.html#cb206-19"></a>    Rx(x), Ry(y), distance(<span class="dv">0</span>) {}</span>
<span id="cb206-20"><a href="chap-utiliseR.html#cb206-20"></a>  TotalDistanceWrkr(<span class="at">const</span> TotalDistanceWrkr&amp; TotalDistanceWrkr, Split) :</span>
<span id="cb206-21"><a href="chap-utiliseR.html#cb206-21"></a>    Rx(TotalDistanceWrkr.Rx), Ry(TotalDistanceWrkr.Ry),  distance(<span class="dv">0</span>) {}</span>
<span id="cb206-22"><a href="chap-utiliseR.html#cb206-22"></a>  </span>
<span id="cb206-23"><a href="chap-utiliseR.html#cb206-23"></a>  <span class="co">// count neighbors</span></span>
<span id="cb206-24"><a href="chap-utiliseR.html#cb206-24"></a>  <span class="dt">void</span> <span class="kw">operator</span>()(<span class="bu">std::</span>size_t begin, <span class="bu">std::</span>size_t end) {</span>
<span id="cb206-25"><a href="chap-utiliseR.html#cb206-25"></a>    <span class="dt">double</span> dx, dy;</span>
<span id="cb206-26"><a href="chap-utiliseR.html#cb206-26"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> Npoints = Rx.length();</span>
<span id="cb206-27"><a href="chap-utiliseR.html#cb206-27"></a></span>
<span id="cb206-28"><a href="chap-utiliseR.html#cb206-28"></a>    <span class="cf">for</span> (<span class="dt">unsigned</span> <span class="dt">int</span> i = begin; i &lt; end; i++) {</span>
<span id="cb206-29"><a href="chap-utiliseR.html#cb206-29"></a>      <span class="cf">for</span> (<span class="dt">unsigned</span> <span class="dt">int</span> j=i+<span class="dv">1</span>; j &lt; Npoints; j++) {</span>
<span id="cb206-30"><a href="chap-utiliseR.html#cb206-30"></a>          <span class="co">// Calculate squared distance</span></span>
<span id="cb206-31"><a href="chap-utiliseR.html#cb206-31"></a>          dx = Rx[i]-Rx[j];</span>
<span id="cb206-32"><a href="chap-utiliseR.html#cb206-32"></a>          dy = Ry[i]-Ry[j];</span>
<span id="cb206-33"><a href="chap-utiliseR.html#cb206-33"></a>          distance += sqrt(dx*dx + dy*dy);</span>
<span id="cb206-34"><a href="chap-utiliseR.html#cb206-34"></a>      }</span>
<span id="cb206-35"><a href="chap-utiliseR.html#cb206-35"></a>    }</span>
<span id="cb206-36"><a href="chap-utiliseR.html#cb206-36"></a>  }</span>
<span id="cb206-37"><a href="chap-utiliseR.html#cb206-37"></a></span>
<span id="cb206-38"><a href="chap-utiliseR.html#cb206-38"></a>  <span class="co">// join my value with that of another Sum</span></span>
<span id="cb206-39"><a href="chap-utiliseR.html#cb206-39"></a>  <span class="dt">void</span> join(<span class="at">const</span> TotalDistanceWrkr&amp; rhs) { </span>
<span id="cb206-40"><a href="chap-utiliseR.html#cb206-40"></a>    distance += rhs.distance; </span>
<span id="cb206-41"><a href="chap-utiliseR.html#cb206-41"></a>  }</span>
<span id="cb206-42"><a href="chap-utiliseR.html#cb206-42"></a>};</span>
<span id="cb206-43"><a href="chap-utiliseR.html#cb206-43"></a></span>
<span id="cb206-44"><a href="chap-utiliseR.html#cb206-44"></a></span>
<span id="cb206-45"><a href="chap-utiliseR.html#cb206-45"></a><span class="co">// Fonction exportée</span></span>
<span id="cb206-46"><a href="chap-utiliseR.html#cb206-46"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb206-47"><a href="chap-utiliseR.html#cb206-47"></a><span class="dt">double</span> TotalDistance(NumericVector x, NumericVector y) {</span>
<span id="cb206-48"><a href="chap-utiliseR.html#cb206-48"></a>  </span>
<span id="cb206-49"><a href="chap-utiliseR.html#cb206-49"></a>  <span class="co">// Declare TotalDistanceWrkr instance</span></span>
<span id="cb206-50"><a href="chap-utiliseR.html#cb206-50"></a>  TotalDistanceWrkr totalDistanceWrkr(x, y);</span>
<span id="cb206-51"><a href="chap-utiliseR.html#cb206-51"></a>  </span>
<span id="cb206-52"><a href="chap-utiliseR.html#cb206-52"></a>  <span class="co">// call parallel_reduce to start the work</span></span>
<span id="cb206-53"><a href="chap-utiliseR.html#cb206-53"></a>  parallelReduce(<span class="dv">0</span>, x.length(), totalDistanceWrkr);</span>
<span id="cb206-54"><a href="chap-utiliseR.html#cb206-54"></a>  </span>
<span id="cb206-55"><a href="chap-utiliseR.html#cb206-55"></a>  <span class="co">// return the result</span></span>
<span id="cb206-56"><a href="chap-utiliseR.html#cb206-56"></a>  <span class="cf">return</span> totalDistanceWrkr.distance;</span>
<span id="cb206-57"><a href="chap-utiliseR.html#cb206-57"></a>}</span></code></pre></div>
<p></p>
<p>L’usage dans R est identique à celui des fonctions C++ interfacées par <strong>RCpp</strong>.</p>
<p></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="chap-utiliseR.html#cb207-1"></a>(mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(d &lt;-<span class="st"> </span><span class="kw">TotalDistance</span>(X<span class="op">$</span>x, X<span class="op">$</span>y)<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span></span>
<span id="cb207-2"><a href="chap-utiliseR.html#cb207-2"></a><span class="st">    </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Unit: microseconds
##                                                      expr     min       lq
##  d &lt;- TotalDistance(X$x, X$y)/NbPoints/(NbPoints - 1) * 2 674.252 767.8525
##      mean   median       uq      max neval
##  821.5037 787.5605 824.2425 2420.918   100</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="chap-utiliseR.html#cb209-1"></a><span class="co"># suppressmessages pour éliminer les messages superflus</span></span>
<span id="cb209-2"><a href="chap-utiliseR.html#cb209-2"></a><span class="kw">suppressMessages</span>(<span class="kw">autoplot</span>(mb))</span></code></pre></div>
<p><img src="travailleR_files/figure-html/unnamed-chunk-53-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="chap-utiliseR.html#cb210-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.5154062</code></pre>
<p></p>
<p>Le temps de mise en place des tâches parallèles est bien plus long que le temps de calcul en série.</p>
<p>En multipliant le nombre de points par 50, le temps de calcul en série doit être multiplié par 2500 environ.</p>
<p></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="chap-utiliseR.html#cb212-1"></a>NbPoints &lt;-<span class="st"> </span><span class="dv">50000</span></span>
<span id="cb212-2"><a href="chap-utiliseR.html#cb212-2"></a>X &lt;-<span class="st"> </span><span class="kw">runifpoint</span>(NbPoints)</span>
<span id="cb212-3"><a href="chap-utiliseR.html#cb212-3"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">MeanDistance</span>(X<span class="op">$</span>x, X<span class="op">$</span>y))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   7.853   0.047   7.905</code></pre>
<p></p>
<p>En parallèle, le temps augmente peu: la parallélisation devient réellement efficace.
Ce temps est à comparer à celui de la boucle for de référence, multiplié par 2500, soit <code>4547</code> secondes.</p>
<p></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="chap-utiliseR.html#cb214-1"></a><span class="kw">system.time</span>(d &lt;-<span class="st"> </span><span class="kw">TotalDistance</span>(X<span class="op">$</span>x, X<span class="op">$</span>y)<span class="op">/</span>NbPoints<span class="op">/</span>(NbPoints <span class="op">-</span><span class="st"> </span></span>
<span id="cb214-2"><a href="chap-utiliseR.html#cb214-2"></a><span class="st">    </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   4.954   0.038   1.855</code></pre>
<p></p>
</div>
<div id="conclusions-sur-loptimisation-de-la-vitesse-du-code" class="section level3">
<h3><span class="header-section-number">2.7.8</span> Conclusions sur l’optimisation de la vitesse du code</h3>
<p>De cette étude de cas, plusieurs enseignements peuvent être retirés:</p>
<ul>
<li>une boucle for est une bonne base pour des calculs répétitifs, plus rapide que <code>vapply()</code>, simple à lire et à écrire;</li>
<li>des fonctions optimisées peuvent exister dans les packages de R pour des tâches courantes (ici, la fonction <code>pairdist()</code> de <strong>spatstat</strong> est deux ordres de grandeur plus rapide que la boucle for);</li>
<li>le recours au code C++ permet d’accélérer significativement les calculs, de trois ordres de grandeur ici;</li>
<li>la parallélisation du code C++ divise encore le temps de calcul par environ la moitié du nombre de coeurs pour de longs calculs.</li>
</ul>
<p>Au-delà de cet exemple, l’optimisation du temps de calcul sous R peut être compliquée si elle passe par la parallélisation et l’écriture de code C++.
L’effort doit donc être concentré sur les calculs réellement long alors que la lisibilité du code doit rester la priorité pour le code courant.
Le code C est assez facile à intégrer grâce à <strong>RCpp</strong> et sa parallélisation n’est pas très coûteuse avec <strong>RCppParallel</strong>.</p>
<p>L’utilisation de boucles for n’est plus pénalisante depuis la version 3.5 de R.
L’écriture de code vectoriel, utilisant <code>sapply()</code> se justifie toujours pour sa lisibilité.</p>
<p>Le choix de paralléliser le code doit être évalué selon le temps d’exécution de chaque tâche parallélisable.
S’il dépasse quelques secondes, la parallélisation se justifie.
<code>mclapply()</code> remplace <code>lapply()</code> sans aucun effort, mais nécessite un hack (fourni ici) sous Windows.
<code>foreach()</code> ne remplace pas <code>for()</code> aussi simplement et ne se justifie que pour des tâches très lourdes en termes de mémoire et de temps de calcul, en particulier sur des clusters de calcul.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Barnier2020">
<p>Barnier, Julien. 2020. <em>Introduction à R et au tidyverse</em>. <a href="https://juba.github.io/tidyverse/">https://juba.github.io/tidyverse/</a>.</p>
</div>
<div id="ref-Gillespie2016">
<p>Gillespie, Colin, et Robin Lovelace. 2016. <em>Efficient R Programming</em>. O’Reilly Media. <a href="https://csgillespie.github.io/efficientR/">https://csgillespie.github.io/efficientR/</a>.</p>
</div>
<div id="ref-Wickham2010">
<p>Wickham, Hadley. 2010. « A Layered Grammar of Graphics ». <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3‑28. <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">http://vita.had.co.nz/papers/layered-grammar.pdf</a>.</p>
</div>
<div id="ref-Wickham2014">
<p>Wickham, Hadley. 2014. <em>Advanced R</em>. Chapman; Hall/CRC. <a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a>.</p>
</div>
<div id="ref-Wickham2017">
<p>Wickham, Hadley. 2017. <em>ggplot2: Elegant Graphics for Data Analysis</em>. 2nd éd. Springer. <a href="https://doi.org/10.1007/978-3-319-24277-4">https://doi.org/10.1007/978-3-319-24277-4</a>.</p>
</div>
<div id="ref-Wickham2016">
<p>Wickham, Hadley, et Garrett Grolemund. 2016. <em>R for Data Science</em>. O’Reilly Media. <a href="http://r4ds.had.co.nz/">http://r4ds.had.co.nz/</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p><a href="https://adv-r.had.co.nz/OO-essentials.html" class="uri">https://adv-r.had.co.nz/OO-essentials.html</a><a href="chap-utiliseR.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p><a href="https://www.troispointzero.fr/le-blog/introduction-a-la-programmation-orientee-objet-poo/" class="uri">https://www.troispointzero.fr/le-blog/introduction-a-la-programmation-orientee-objet-poo/</a><a href="chap-utiliseR.html#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p><a href="https://r6.r-lib.org/" class="uri">https://r6.r-lib.org/</a><a href="chap-utiliseR.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p><a href="https://r6.r-lib.org/articles/Performance.html" class="uri">https://r6.r-lib.org/articles/Performance.html</a><a href="chap-utiliseR.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p><a href="https://dplyr.tidyverse.org/articles/programming.html" class="uri">https://dplyr.tidyverse.org/articles/programming.html</a><a href="chap-utiliseR.html#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p><a href="https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html" class="uri">https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html</a><a href="chap-utiliseR.html#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p><a href="https://EricMarcon.github.io/travailleR/profile.html" class="uri">https://EricMarcon.github.io/travailleR/profile.html</a><a href="chap-utiliseR.html#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p><a href="https://rstudio.github.io/profvis/" class="uri">https://rstudio.github.io/profvis/</a><a href="chap-utiliseR.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p><a href="http://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/parallel.html" class="uri">http://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/parallel.html</a><a href="chap-utiliseR.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p><a href="https://mindyourdecisions.com/blog/2016/07/03/distance-between-two-random-points-in-a-square-sunday-puzzle/" class="uri">https://mindyourdecisions.com/blog/2016/07/03/distance-between-two-random-points-in-a-square-sunday-puzzle/</a><a href="chap-utiliseR.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p><a href="http://rcppcore.github.io/RcppParallel/" class="uri">http://rcppcore.github.io/RcppParallel/</a><a href="chap-utiliseR.html#fnref22" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chap-logiciels.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-git.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["travailleR.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
